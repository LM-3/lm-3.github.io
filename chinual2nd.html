<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 5.2, http://www.gnu.org/software/texinfo/ -->
<head>
<title>Lisp Machine Manual</title>

<meta name="description" content="Lisp Machine Manual">
<meta name="keywords" content="Lisp Machine Manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="#Top" rel="start" title="Top">
<link href="#Top" rel="index" title="Top">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="dir.html#Top" rel="up" title="(dir)">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<h1 class="settitle" align="center">Lisp Machine Manual</h1>





































<a name="Top"></a>
<a name="Lisp-Machine-Manual"></a>
<h1 class="top">Lisp Machine Manual</h1>

<a name="SEC_Contents"></a>
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">

<ul class="no-bullet">
  <li><a name="toc-Introduction" href="#Introduction">1 Introduction</a>
  <ul class="no-bullet">
    <li><a name="toc-General-Information" href="#General-Information">1.1 General Information</a></li>
    <li><a name="toc-Structure-of-the-Manual" href="#Structure-of-the-Manual">1.2 Structure of the Manual</a></li>
    <li><a name="toc-Notational-Conventions-and-Helpful-Notes" href="#Notational-Conventions-and-Helpful-Notes">1.3 Notational Conventions and Helpful Notes</a></li>
    <li><a name="toc-Data-Types" href="#Data-Types">1.4 Data Types</a></li>
    <li><a name="toc-Lambda-Lists" href="#Lambda-Lists">1.5 Lambda Lists</a></li>
  </ul></li>
  <li><a name="toc-Predicates" href="#Predicates">2 Predicates</a></li>
  <li><a name="toc-Evaluation" href="#Evaluation">3 Evaluation</a>
  <ul class="no-bullet">
    <li><a name="toc-Functions-and-Special-Forms" href="#Functions-and-Special-Forms">3.1 Functions and Special Forms</a></li>
    <li><a name="toc-Multiple-Values" href="#Multiple-Values">3.2 Multiple Values</a></li>
    <li><a name="toc-Evalhook" href="#Evalhook">3.3 Evalhook</a></li>
  </ul></li>
  <li><a name="toc-Flow-of-Control" href="#Flow-of-Control">4 Flow of Control</a>
  <ul class="no-bullet">
    <li><a name="toc-Conditionals" href="#Conditionals">4.1 Conditionals</a></li>
    <li><a name="toc-Iteration" href="#Iteration">4.2 Iteration</a></li>
    <li><a name="toc-Non_002dlocal-Exits" href="#Non_002dlocal-Exits">4.3 Non-local Exits</a></li>
    <li><a name="toc-Mapping" href="#Mapping">4.4 Mapping</a></li>
  </ul></li>
  <li><a name="toc-Manipulating-List-Structure" href="#Manipulating-List-Structure">5 Manipulating List Structure</a>
  <ul class="no-bullet">
    <li><a name="toc-Conses" href="#Conses">5.1 Conses</a></li>
    <li><a name="toc-Lists" href="#Lists">5.2 Lists</a></li>
    <li><a name="toc-Alteration-of-List-Structure" href="#Alteration-of-List-Structure">5.3 Alteration of List Structure</a></li>
    <li><a name="toc-Cdr_002dCoding" href="#Cdr_002dCoding">5.4 Cdr-Coding</a></li>
    <li><a name="toc-Tables" href="#Tables">5.5 Tables</a></li>
    <li><a name="toc-Property-Lists" href="#Property-Lists">5.6 Property Lists</a></li>
    <li><a name="toc-Hash-Tables" href="#Hash-Tables">5.7 Hash Tables</a></li>
    <li><a name="toc-Sorting" href="#Sorting">5.8 Sorting</a></li>
  </ul></li>
  <li><a name="toc-Symbols" href="#Symbols">6 Symbols</a>
  <ul class="no-bullet">
    <li><a name="toc-The-Value-Cell" href="#The-Value-Cell">6.1 The Value Cell</a></li>
    <li><a name="toc-The-Function-Cell" href="#The-Function-Cell">6.2 The Function Cell</a></li>
    <li><a name="toc-The-Property-List" href="#The-Property-List">6.3 The Property List</a></li>
    <li><a name="toc-The-Print-Name" href="#The-Print-Name">6.4 The Print Name</a></li>
    <li><a name="toc-The-Creation-and-Interning-of-Symbols" href="#The-Creation-and-Interning-of-Symbols">6.5 The Creation and Interning of Symbols</a></li>
  </ul></li>
  <li><a name="toc-Numbers" href="#Numbers">7 Numbers</a>
  <ul class="no-bullet">
    <li><a name="toc-Numeric-Predicates" href="#Numeric-Predicates">7.1 Numeric Predicates</a></li>
    <li><a name="toc-Arithmetic" href="#Arithmetic">7.2 Arithmetic</a></li>
    <li><a name="toc-Random-Functions" href="#Random-Functions">7.3 Random Functions</a></li>
    <li><a name="toc-Logical-Operations-on-Numbers" href="#Logical-Operations-on-Numbers">7.4 Logical Operations on Numbers</a></li>
    <li><a name="toc-Byte-Manipulation-Functions" href="#Byte-Manipulation-Functions">7.5 Byte Manipulation Functions</a></li>
    <li><a name="toc-24_002dBit-Numbers" href="#g_t24_002dBit-Numbers">7.6 24-Bit Numbers</a></li>
    <li><a name="toc-Double_002dPrecision-Arithmetic" href="#Double_002dPrecision-Arithmetic">7.7 Double-Precision Arithmetic</a></li>
  </ul></li>
  <li><a name="toc-Strings" href="#Strings">8 Strings</a>
  <ul class="no-bullet">
    <li><a name="toc-String-Manipulation" href="#String-Manipulation">8.1 String Manipulation</a></li>
    <li><a name="toc-I_002fO-to-Strings" href="#I_002fO-to-Strings">8.2 I/O to Strings</a></li>
    <li><a name="toc-Maclisp_002dcompatible-Functions" href="#Maclisp_002dcompatible-Functions">8.3 Maclisp-compatible Functions</a></li>
    <li><a name="toc-Formatted-Output" href="#Formatted-Output">8.4 Formatted Output</a></li>
  </ul></li>
  <li><a name="toc-Arrays" href="#Arrays">9 Arrays</a>
  <ul class="no-bullet">
    <li><a name="toc-What-Arrays-Are" href="#What-Arrays-Are">9.1 What Arrays Are</a></li>
    <li><a name="toc-How-Arrays-Work" href="#How-Arrays-Work">9.2 How Arrays Work</a></li>
    <li><a name="toc-Extra-Features-of-Arrays" href="#Extra-Features-of-Arrays">9.3 Extra Features of Arrays</a></li>
    <li><a name="toc-Basic-Array-Functions" href="#Basic-Array-Functions">9.4 Basic Array Functions</a></li>
    <li><a name="toc-Array-Leaders" href="#Array-Leaders">9.5 Array Leaders</a></li>
    <li><a name="toc-Maclisp-Array-Compatibility" href="#Maclisp-Array-Compatibility">9.6 Maclisp Array Compatibility</a></li>
  </ul></li>
  <li><a name="toc-Closures" href="#Closures">10 Closures</a>
  <ul class="no-bullet">
    <li><a name="toc-What-a-Closure-Is" href="#What-a-Closure-Is">10.1 What a Closure Is</a></li>
    <li><a name="toc-Examples-of-the-Use-of-Closures" href="#Examples-of-the-Use-of-Closures">10.2 Examples of the Use of Closures</a></li>
    <li><a name="toc-Function-Descriptions" href="#Function-Descriptions">10.3 Function Descriptions</a></li>
  </ul></li>
  <li><a name="toc-Stack-Groups" href="#Stack-Groups">11 Stack Groups</a>
  <ul class="no-bullet">
    <li><a name="toc-What-is-Going-On-Inside" href="#What-is-Going-On-Inside">11.1 What is Going On Inside</a></li>
  </ul></li>
  <li><a name="toc-Locatives" href="#Locatives">12 Locatives</a>
  <ul class="no-bullet">
    <li><a name="toc-Cells-and-Locatives" href="#Cells-and-Locatives">12.1 Cells and Locatives</a></li>
    <li><a name="toc-Functions-Which-Operate-on-Locatives" href="#Functions-Which-Operate-on-Locatives">12.2 Functions Which Operate on Locatives</a></li>
  </ul></li>
  <li><a name="toc-Subprimitives" href="#Subprimitives">13 Subprimitives</a>
  <ul class="no-bullet">
    <li><a name="toc-Data-Types-1" href="#Data-Types-1">13.1 Data Types</a></li>
    <li><a name="toc-Creating-Objects" href="#Creating-Objects">13.2 Creating Objects</a></li>
    <li><a name="toc-Pointer-Manipulation" href="#Pointer-Manipulation">13.3 Pointer Manipulation</a></li>
    <li><a name="toc-Special-Memory-Referencing" href="#Special-Memory-Referencing">13.4 Special Memory Referencing</a></li>
    <li><a name="toc-The-Paging-System" href="#The-Paging-System">13.5 The Paging System</a></li>
    <li><a name="toc-Microcode-Variables" href="#Microcode-Variables">13.6 Microcode Variables</a></li>
  </ul></li>
  <li><a name="toc-Areas" href="#Areas">14 Areas</a></li>
  <li><a name="toc-The-Compiler" href="#The-Compiler">15 The Compiler</a>
  <ul class="no-bullet">
    <li><a name="toc-The-Basic-Operations-of-the-Compiler" href="#The-Basic-Operations-of-the-Compiler">15.1 The Basic Operations of the Compiler</a></li>
    <li><a name="toc-How-to-Invoke-the-Compiler" href="#How-to-Invoke-the-Compiler">15.2 How to Invoke the Compiler</a></li>
    <li><a name="toc-Input-to-the-Compiler" href="#Input-to-the-Compiler">15.3 Input to the Compiler</a></li>
    <li><a name="toc-Compiler-Declarations" href="#Compiler-Declarations">15.4 Compiler Declarations</a></li>
    <li><a name="toc-Compiler-Source_002dLevel-Optimizers" href="#Compiler-Source_002dLevel-Optimizers">15.5 Compiler Source-Level Optimizers</a></li>
    <li><a name="toc-Files-that-Maclisp-Must-Compile" href="#Files-that-Maclisp-Must-Compile">15.6 Files that Maclisp Must Compile</a></li>
  </ul></li>
  <li><a name="toc-Macros" href="#Macros">16 Macros</a>
  <ul class="no-bullet">
    <li><a name="toc-Introduction-to-Macros" href="#Introduction-to-Macros">16.1 Introduction to Macros</a></li>
    <li><a name="toc-Aids-for-Defining-Macros" href="#Aids-for-Defining-Macros">16.2 Aids for Defining Macros</a>
    <ul class="no-bullet">
      <li><a name="toc-Defmacro" href="#Defmacro">16.2.1 Defmacro</a></li>
      <li><a name="toc-Backquote" href="#Backquote">16.2.2 Backquote</a></li>
    </ul></li>
    <li><a name="toc-Aids-for-Debugging-Macros" href="#Aids-for-Debugging-Macros">16.3 Aids for Debugging Macros</a></li>
    <li><a name="toc-Displacing-Macros" href="#Displacing-Macros">16.4 Displacing Macros</a></li>
    <li><a name="toc-Advanced-Features-of-Defmacro" href="#Advanced-Features-of-Defmacro">16.5 Advanced Features of Defmacro</a></li>
    <li><a name="toc-Functions-to-Expand-Macros" href="#Functions-to-Expand-Macros">16.6 Functions to Expand Macros</a></li>
  </ul></li>
  <li><a name="toc-Defstruct" href="#Defstruct">17 Defstruct</a>
  <ul class="no-bullet">
    <li><a name="toc-Introduction-to-Structure-Macros" href="#Introduction-to-Structure-Macros">17.1 Introduction to Structure Macros</a></li>
    <li><a name="toc-Setf-and-Locf" href="#Setf-and-Locf">17.2 Setf and Locf</a></li>
    <li><a name="toc-How-to-Use-Defstruct" href="#How-to-Use-Defstruct">17.3 How to Use Defstruct</a></li>
    <li><a name="toc-Options-to-Defstruct" href="#Options-to-Defstruct">17.4 Options to Defstruct</a></li>
    <li><a name="toc-Using-the-Constructor-Macro" href="#Using-the-Constructor-Macro">17.5 Using the Constructor Macro</a></li>
    <li><a name="toc-Grouped-Arrays" href="#Grouped-Arrays">17.6 Grouped Arrays</a></li>
    <li><a name="toc-Named-Structures" href="#Named-Structures">17.7 Named Structures</a></li>
  </ul></li>
  <li><a name="toc-The-I_002fO-System" href="#The-I_002fO-System">18 The I/O System</a>
  <ul class="no-bullet">
    <li><a name="toc-The-Character-Set" href="#The-Character-Set">18.1 The Character Set</a></li>
    <li><a name="toc-Printed-Representation" href="#Printed-Representation">18.2 Printed Representation</a>
    <ul class="no-bullet">
      <li><a name="toc-What-the-Printer-Produces" href="#What-the-Printer-Produces">18.2.1 What the Printer Produces</a></li>
      <li><a name="toc-What-The-Reader-Accepts" href="#What-The-Reader-Accepts">18.2.2 What The Reader Accepts</a></li>
      <li><a name="toc-Sharp_002dsign-Abbreviations" href="#Sharp_002dsign-Abbreviations">18.2.3 Sharp-sign Abbreviations</a></li>
      <li><a name="toc-The-Readtable" href="#The-Readtable">18.2.4 The Readtable</a></li>
      <li><a name="toc-Reader-Macros" href="#Reader-Macros">18.2.5 Reader Macros</a></li>
    </ul></li>
    <li><a name="toc-Input-Functions" href="#Input-Functions">18.3 Input Functions</a></li>
    <li><a name="toc-Output-Functions" href="#Output-Functions">18.4 Output Functions</a></li>
    <li><a name="toc-I_002fO-Streams" href="#I_002fO-Streams">18.5 I/O Streams</a>
    <ul class="no-bullet">
      <li><a name="toc-What-Streams-Are" href="#What-Streams-Are">18.5.1 What Streams Are</a></li>
      <li><a name="toc-General-Purpose-Stream-Operations" href="#General-Purpose-Stream-Operations">18.5.2 General Purpose Stream Operations</a></li>
      <li><a name="toc-Special-Purpose-Stream-Operations" href="#Special-Purpose-Stream-Operations">18.5.3 Special Purpose Stream Operations</a></li>
      <li><a name="toc-Standard-Streams" href="#Standard-Streams">18.5.4 Standard Streams</a></li>
      <li><a name="toc-Making-Your-Own-Stream" href="#Making-Your-Own-Stream">18.5.5 Making Your Own Stream</a></li>
    </ul></li>
    <li><a name="toc-Accessing-Files" href="#Accessing-Files">18.6 Accessing Files</a>
    <ul class="no-bullet">
      <li><a name="toc-Other-File-Operations" href="#Other-File-Operations">18.6.1 Other File Operations</a></li>
      <li><a name="toc-File-Name-Manipulation" href="#File-Name-Manipulation">18.6.2 File Name Manipulation</a></li>
    </ul></li>
    <li><a name="toc-Rubout-Handling" href="#Rubout-Handling">18.7 Rubout Handling</a></li>
    <li><a name="toc-Special-I_002fO-Devices" href="#Special-I_002fO-Devices">18.8 Special I/O Devices</a></li>
  </ul></li>
  <li><a name="toc-Packages" href="#Packages">19 Packages</a>
  <ul class="no-bullet">
    <li><a name="toc-The-Need-for-Multiple-Contexts" href="#The-Need-for-Multiple-Contexts">19.1 The Need for Multiple Contexts</a></li>
    <li><a name="toc-The-Organization-of-Name-Spaces" href="#The-Organization-of-Name-Spaces">19.2 The Organization of Name Spaces</a></li>
    <li><a name="toc-Shared-Programs" href="#Shared-Programs">19.3 Shared Programs</a></li>
    <li><a name="toc-Declaring-Packages" href="#Declaring-Packages">19.4 Declaring Packages</a></li>
    <li><a name="toc-Packages-and-Writing-Code" href="#Packages-and-Writing-Code">19.5 Packages and Writing Code</a></li>
    <li><a name="toc-Shadowing" href="#Shadowing">19.6 Shadowing</a></li>
    <li><a name="toc-Packages-and-Interning" href="#Packages-and-Interning">19.7 Packages and Interning</a></li>
    <li><a name="toc-Status-Information" href="#Status-Information">19.8 Status Information</a></li>
    <li><a name="toc-Packages_002c-Loading_002c-and-Compilation" href="#Packages_002c-Loading_002c-and-Compilation">19.9 Packages, Loading, and Compilation</a></li>
    <li><a name="toc-Subpackages" href="#Subpackages">19.10 Subpackages</a></li>
    <li><a name="toc-Initialization-of-the-Package-System" href="#Initialization-of-the-Package-System">19.11 Initialization of the Package System</a></li>
    <li><a name="toc-Initial-Packages" href="#Initial-Packages">19.12 Initial Packages</a></li>
    <li><a name="toc-Multiple-Instantiations-of-a-Program" href="#Multiple-Instantiations-of-a-Program">19.13 Multiple Instantiations of a Program</a></li>
  </ul></li>
  <li><a name="toc-Files" href="#Files">20 Files</a>
  <ul class="no-bullet">
    <li><a name="toc-Functions-for-Loading-Programs" href="#Functions-for-Loading-Programs">20.1 Functions for Loading Programs</a>
    <ul class="no-bullet">
      <li><a name="toc-Functions-for-Loading-Single-Files" href="#Functions-for-Loading-Single-Files">20.1.1 Functions for Loading Single Files</a></li>
      <li><a name="toc-Loading-and-Compiling-Whole-Packages" href="#Loading-and-Compiling-Whole-Packages">20.1.2 Loading and Compiling Whole Packages</a></li>
    </ul></li>
  </ul></li>
  <li><a name="toc-Processes" href="#Processes">21 Processes</a>
  <ul class="no-bullet">
    <li><a name="toc-Functions-for-Manipulating-Processes" href="#Functions-for-Manipulating-Processes">21.1 Functions for Manipulating Processes</a></li>
    <li><a name="toc-Locks" href="#Locks">21.2 Locks</a></li>
  </ul></li>
  <li><a name="toc-TVOBs-and-Jobs" href="#TVOBs-and-Jobs">22 TVOBs and Jobs</a>
  <ul class="no-bullet">
    <li><a name="toc-Introduction-to-the-Concepts-of-This-Chapter" href="#Introduction-to-the-Concepts-of-This-Chapter">22.1 Introduction to the Concepts of This Chapter</a></li>
    <li><a name="toc-TVOBs" href="#TVOBs">22.2 TVOBs</a></li>
    <li><a name="toc-Jobs" href="#Jobs">22.3 Jobs</a></li>
    <li><a name="toc-Controlling-Jobs" href="#Controlling-Jobs">22.4 Controlling Jobs</a></li>
    <li><a name="toc-Functions-for-Manipulating-TVOBs_002e" href="#Functions-for-Manipulating-TVOBs_002e">22.5 Functions for Manipulating TVOBs.</a></li>
    <li><a name="toc-Functions-for-Manipulating-Jobs_002e" href="#Functions-for-Manipulating-Jobs_002e">22.6 Functions for Manipulating Jobs.</a></li>
  </ul></li>
  <li><a name="toc-The-TV-Display" href="#The-TV-Display">23 The TV Display</a>
  <ul class="no-bullet">
    <li><a name="toc-The-Hardware" href="#The-Hardware">23.1 The Hardware</a></li>
    <li><a name="toc-Screens" href="#Screens">23.2 Screens</a></li>
    <li><a name="toc-Simple-Bit-Manipulation" href="#Simple-Bit-Manipulation">23.3 Simple Bit Manipulation</a></li>
    <li><a name="toc-Fonts" href="#Fonts">23.4 Fonts</a></li>
    <li><a name="toc-TVOBs-1" href="#TVOBs-1">23.5 TVOBs</a></li>
    <li><a name="toc-Pieces-of-Paper" href="#Pieces-of-Paper">23.6 Pieces of Paper</a>
    <ul class="no-bullet">
      <li><a name="toc-Simple-Typeout" href="#Simple-Typeout">23.6.1 Simple Typeout</a></li>
      <li><a name="toc-Cursor-Motion" href="#Cursor-Motion">23.6.2 Cursor Motion</a></li>
      <li><a name="toc-Erasing_002c-etc_002e" href="#Erasing_002c-etc_002e">23.6.3 Erasing, etc.</a></li>
      <li><a name="toc-String-Typeout" href="#String-Typeout">23.6.4 String Typeout</a></li>
      <li><a name="toc-More-Processing" href="#More-Processing">23.6.5 More Processing</a></li>
      <li><a name="toc-ALU-Functions" href="#ALU-Functions">23.6.6 ALU Functions</a></li>
      <li><a name="toc-Blinkers" href="#Blinkers">23.6.7 Blinkers</a></li>
    </ul></li>
    <li><a name="toc-Graphics" href="#Graphics">23.7 Graphics</a></li>
    <li><a name="toc-The-Who-Line" href="#The-Who-Line">23.8 The Who Line</a></li>
    <li><a name="toc-Microcode-Routines" href="#Microcode-Routines">23.9 Microcode Routines</a></li>
    <li><a name="toc-Opening-a-Piece-of-Paper" href="#Opening-a-Piece-of-Paper">23.10 Opening a Piece of Paper</a></li>
    <li><a name="toc-Creating-Pieces-of-Paper-and-Blinkers" href="#Creating-Pieces-of-Paper-and-Blinkers">23.11 Creating Pieces of Paper and Blinkers</a></li>
    <li><a name="toc-The-Keyboard" href="#The-Keyboard">23.12 The Keyboard</a></li>
    <li><a name="toc-Internal-Special-Variables" href="#Internal-Special-Variables">23.13 Internal Special Variables</a></li>
    <li><a name="toc-Font-Utility-Routines" href="#Font-Utility-Routines">23.14 Font Utility Routines</a></li>
    <li><a name="toc-The-Font-Compiler" href="#The-Font-Compiler">23.15 The Font Compiler</a></li>
  </ul></li>
  <li><a name="toc-Errors-and-Debugging" href="#Errors-and-Debugging">24 Errors and Debugging</a>
  <ul class="no-bullet">
    <li><a name="toc-The-Error-System" href="#The-Error-System">24.1 The Error System</a>
    <ul class="no-bullet">
      <li><a name="toc-Conditions" href="#Conditions">24.1.1 Conditions</a></li>
      <li><a name="toc-Error-Conditions" href="#Error-Conditions">24.1.2 Error Conditions</a></li>
      <li><a name="toc-Signalling-Errors" href="#Signalling-Errors">24.1.3 Signalling Errors</a></li>
      <li><a name="toc-Standard-Condition-Names" href="#Standard-Condition-Names">24.1.4 Standard Condition Names</a></li>
      <li><a name="toc-Errset" href="#Errset">24.1.5 Errset</a></li>
    </ul></li>
    <li><a name="toc-The-Debugger" href="#The-Debugger">24.2 The Debugger</a>
    <ul class="no-bullet">
      <li><a name="toc-Entering-the-Debugger" href="#Entering-the-Debugger">24.2.1 Entering the Debugger</a></li>
      <li><a name="toc-How-to-Use-the-Debugger" href="#How-to-Use-the-Debugger">24.2.2 How to Use the Debugger</a></li>
      <li><a name="toc-Debugger-Commands" href="#Debugger-Commands">24.2.3 Debugger Commands</a></li>
      <li><a name="toc-Summary-of-Commands" href="#Summary-of-Commands">24.2.4 Summary of Commands</a></li>
      <li><a name="toc-Miscellany" href="#Miscellany">24.2.5 Miscellany</a></li>
    </ul></li>
    <li><a name="toc-Trace" href="#Trace">24.3 Trace</a></li>
    <li><a name="toc-The-Stepper" href="#The-Stepper">24.4 The Stepper</a>
    <ul class="no-bullet">
      <li><a name="toc-How-to-Get-Into-the-Stepper_002e" href="#How-to-Get-Into-the-Stepper_002e">24.4.1 How to Get Into the Stepper.</a></li>
      <li><a name="toc-How-to-Use-the-Stepper" href="#How-to-Use-the-Stepper">24.4.2 How to Use the Stepper</a></li>
    </ul></li>
    <li><a name="toc-The-MAR" href="#The-MAR">24.5 The MAR</a></li>
    <li><a name="toc-Useful-Commands" href="#Useful-Commands">24.6 Useful Commands</a></li>
    <li><a name="toc-Querying-the-User" href="#Querying-the-User">24.7 Querying the User</a></li>
    <li><a name="toc-Stuff-That-Doesn_0027t-Fit-Anywhere-Else" href="#Stuff-That-Doesn_0027t-Fit-Anywhere-Else">24.8 Stuff That Doesn&rsquo;t Fit Anywhere Else</a></li>
    <li><a name="toc-Status-and-SStatus" href="#Status-and-SStatus">24.9 Status and SStatus</a></li>
    <li><a name="toc-The-Lisp-Top-Level" href="#The-Lisp-Top-Level">24.10 The Lisp Top Level</a></li>
    <li><a name="toc-Logging-In" href="#Logging-In">24.11 Logging In</a></li>
  </ul></li>
  <li><a name="toc-Concept-Index" href="#Concept-Index">Concept Index</a></li>
  <li><a name="toc-Variable-Index" href="#Variable-Index">Variable Index</a></li>
  <li><a name="toc-Function-index" href="#Function-index">Function index</a></li>
</ul>
</div>


<a name="Introduction"></a>
<h2 class="chapter">1 Introduction</h2>

<a name="General-Information"></a>
<h3 class="section">1.1 General Information</h3>

<p>The Lisp Machine is a new computer system designed to provide
a high performance and economical implementation of the Lisp language.
It is a personal computation system, which means that processors and
main memories are not time-multiplexed: each person gets his own for
the duration of the session.  It is designed this way to relieve the
problems of the running of large Lisp programs on time-sharing
systems.  Everything on the Lisp Machine is written in Lisp, including
all system programs; there is never any need to program in machine
language.  The system is highly interactive.
</p>

<p>This document is intended to serve both as a User&rsquo;s Guide and
as a Reference Manual for the language and the Lisp Machine itself.
It is hoped that anyone with some previous programming experience (not
necessarily in Lisp) could learn all about the Lisp language and the
Lisp Machine from this manual.
</p>
<p>This is a <i>preliminary</i> version of the Manual.  The authors
are well aware that several sections are missing.  Some small sections
were left out in the interest of publishing a manual as quickly
as possible.  Several full chapters have not been written because the
corresponding software has not settled down enough for a meaningful
document to be written; these include chapters on the Chaos network,
the mouse, and menus.  Many more major software changes are expected
in both the language and the system; this manual is far from the last word.
</p>
<p>The Lisp Machine executes a new dialect of Lisp called Lisp
Machine Lisp, developed at the M.I.T. Artificial Intelligence
Laboratory for use in artificial intelligence research and related
fields.  It is closely related to the Maclisp dialect, and attempts to
maintain a good degree of compatibility with Maclisp, while also
providing many improvements and new features.  Maclisp, in turn, is
based on Lisp 1.5.
</p>
<a name="Structure-of-the-Manual"></a>
<h3 class="section">1.2 Structure of the Manual</h3>

<p>This manual attempts to document both the dialect of Lisp used
on the Lisp Machine, and the system itself.  The manual starts out with
an explanation of the language.  Chapter 2 presents some basic <i>predicate</i>
functions, Chapter 3 explains the process of evaluation, and Chapter 4
introduces the basic Lisp control structures.
</p>
<p>Next, in Chapters 4 through 12, various Lisp data types are presented,
along with functions for manipulating objects of those types.  These nine
chapters discuss list structure, symbols, numbers, strings, arrays, closures,
stack groups, and locatives.
</p>
<p>Chapter 13 explains the &quot;subprimitive&quot; functions, which are primarily
useful for implementation of the Lisp language itself and the Lisp Machine&rsquo;s
&quot;operating system&quot;.  Chapter 14 explains <i>areas</i>, which give
the programmer control over storage and locality of reference.
</p>
<p>Chapter 15 discusses the Lisp compiler, which converts Lisp programs
into &quot;machine language&quot;.  Chapter 16 explains the Lisp macro facility, which
allows users to write their own extensions to Lisp, and Chapter 17 goes into
detail about one such extension that provides <i>structures</i>.
</p>
<p>Chapter 18 explains the Lisp Machine&rsquo;s Input/Output system, including
<i>streams</i> and the <i>printed representation</i> of Lisp objects.  Chapter 19
describes the <i>package</i> system, which allows many name spaces within
a single Lisp environment.  Chapter 20 talks about how files from a file
system are used from Lisp.
</p>
<p>Chapter 21 discusses the <i>job system</i>, which allows shared access
to the TV screen, and multiple processes.  Chapter 22 goes into detail on
the TV display itself.  Chapter 23 explains how exceptional conditions (errors)
can be handled by programs, handled by users, and debugged.  Chapter 24
contains other miscellaneous functions and facilities.
</p>
<a name="Notational-Conventions-and-Helpful-Notes"></a>
<h3 class="section">1.3 Notational Conventions and Helpful Notes</h3>

<p>There are several conventions of notation, and various points
that should be understood before reading the manual, particularly the
reference sections, to avoid confusion.
</p>
<p>Most numbers shown are in octal radix (base eight).  Spelled out
numbers and numbers followed by a decimal point are in decimal.  This is
because, by default, Lisp Machine Lisp types out numbers in base 8; don&rsquo;t
be surprised by this.  To change it, see the documentation on the symbols
<code>ibase</code> and <code>base</code> ((ibase-var)).
</p>
<p>The symbol &quot; =&gt; &quot; will be used to indicate evaluation in
examples.  Thus, when you see &quot; <code>foo</code> =&gt; <code>nil</code>&quot;, this means the
same thing as &quot;the result of evaluating <code>foo</code> is (or would have
been) <code>nil</code>&quot;.
</p>
<p>All uses of the phrase &quot;Lisp reader&quot;, unless further qualified,
refer to the part of Lisp which reads characters from I/O streams
(the <code>read</code> function), and not the person reading this manual.
</p>
<p>There are several terms which are used widely in other
references on Lisp, but are not used much in this document since they have become
largely obsolete and misleading.  For the benefit of those who may
have seen them before, they are: &quot;S-expression&quot;, which means a Lisp
object;  &quot;Dotted pair&quot;, which means a cons, and &quot;Atom&quot;, which means,
roughly, symbols and numbers and sometimes other things, but not
conses.
<a name="index-S_002dexpression"></a>
<a name="index-dotted-pair"></a>
<a name="index-atom"></a>
</p>
<p>The characters acute accent (<code>'</code>) (also called &quot;single quote&quot;) and
semicolon (<code>;</code>) have special meanings when typed to Lisp; they are
examples of what are called <i>macro characters</i>.  Though the
mechanism of macro characters is not of immediate interest to the new
user, it is important to understand the effect of these two, which are
used in the examples.
</p>
<p>When the Lisp reader encounters a &quot;<code>'</code>&quot;, it reads in the next
Lisp object and encloses it in a <code>quote</code> special form.  That
is, <code>'foo-symbol</code> turns into <code>(quote foo-symbol)</code>, and <code>'(cons 'a 'b)</code>
turns into <code>(quote (cons (quote a) (quote b)))</code>.  The reason
for this is that &quot;<code>quote</code>&quot; would otherwise have to be typed in very
frequently, and would look ugly.
</p>
<p>The semicolon is used as a commenting character.  When the
Lisp reader sees one, the remainder of the line is
discarded.
</p>
<p>The character &quot;<code>/</code>&quot; is used for quoting strange characters so
that they are not interpreted in their usual way by the Lisp reader,
but rather are treated the way normal alphabetic characters are treated.
So, for example, in order to give a &quot;<code>/</code>&quot; to the reader, you must type &quot;<code>//</code>&quot;,
the first &quot;<code>/</code>&quot; quoting the second one.  When a character
is preceeded by a &quot;<code>/</code>&quot; it is said to be <i>slashified</i>.  Slashifying
also turns off the effects of macro characters such as &quot;<code>'</code>&quot; and &quot;<code>;</code>&quot;.
</p>
<p>The following characters also have special meanings,
and may not be used in symbols without slashification.  These characters
are explained in detail in the section on printed-representation
((reader)).
</p>
<dl compact="compact">
<dt><code>&quot;</code></dt>
<dd><p>String quote
</p></dd>
<dt><code>#</code></dt>
<dd><p>Introduces miscellaneous reader macros
</p></dd>
<dt><code>,</code></dt>
<dd><p>See <code>`</code>
</p></dd>
<dt><code>:</code></dt>
<dd><p>Package prefix
</p></dd>
<dt><code>`</code></dt>
<dd><p>List structure construction
</p></dd>
<dt><code>|</code></dt>
<dd><p>Symbol quoter
</p></dd>
<dt><code></code></dt>
<dd><p>Octal escape
</p></dd>
</dl>

<p>All Lisp code in this manual is written in lower case.
In fact, the reader turns all symbols into upper-case, and consequently
everything prints out in upper case.  You may write programs in whichever
case you prefer.
</p>
<p>By convention, all &quot;keyword&quot; symbols in the Lisp machine system
have names starting with a colon (<code>:</code>).  The colon character is not
actually part of the print name, but is a package prefix indicating
that the symbol belongs to the package with a null name, which means
the <code>user</code> package.  If you are not using packages, that is, you are
doing everything in the <code>user</code> package, it is not necessary to type the
colon.  However, it is recommended that you always put in the colon so
that you will not have problems if you later put your program into a
package.  But it is necessary to leave out the colon in programs that
must run in both Maclisp and Lisp Machine Lisp.   The colon can usually
be omitted when you are simply typing at the top-level of Lisp, since
your typein is being read in the <code>user</code> package, but it is better to type
it so you will get used to it.  In this manual the colon will always
be included.
</p>
<p>Lisp Machine Lisp is descended from Maclisp, and a good deal
of effort was gone through to try to allow Maclisp programs to run
in Lisp Machine Lisp.  There is an extensive section explaining the
differences between the dialects, and how to convert Maclisp programs
to work in the Lisp Machine.  For the new user, it is important
to note that many functions herein exist solely for Maclisp compatibility;
they should <i>not</i> be used in new programs.  Such functions are
clearly marked in the text.
</p>
<p>The Lisp Machine character set is not quite the same as that used
on I.T.S. nor on Multics; it is described in all detail elsewhere
in the manual.  The important thing to note for now is that the
character &quot;newline&quot; is the same as &quot;return&quot;, and is represented by
the number 215 octal.
</p>
<p>When the text speaks of &quot;typing Control-Q&quot; (for example),
this means to hold down the CTRL key on the keyboard (either of
the two), and, while holding it down, to strike the &quot;Q&quot; key.
Similarly, to type &quot;Meta-P&quot;, hold down either of the META keys
and strike &quot;P&quot;.  To type &quot;Control-Meta-T&quot; hold down both CTRL
and META.  Unlike the PDP-10, there are no &quot;control characters&quot;
in the character set; Control and Meta are merely things
that can be typed on the keyboard.
</p>
<p>Many of the functions refer to &quot;areas&quot;.  The <i>area</i> feature
is only of interest to writers of large systems, and can be safely
disregarded by the casual user.  It is described elsewhere.
</p>

<p>The rest of this chapter explains more of the details of the Lisp Machine
Lisp dialect.  This section is also suitable for the Maclisp user, as
it goes into detail about important differences between the dialects.
Those Maclisp users who have skipped the previous sections should definitely
read this one.
</p>
<a name="Data-Types"></a>
<h3 class="section">1.4 Data Types</h3>

<p>This section enumerates the various different types of objects
in Lisp Machine Lisp.  The types explained below include symbols, conses,
various types of numbers, two kinds of compiled code object, locatives,
arrays, stack groups, and closures.  With each is given the associated
symbolic name, which is returned by the function <code>data-type</code> ((data-type-fun)).
</p>
<a name="index-data_002dtype"></a>
<a name="index-symbol"></a>
<a name="index-print-name"></a>
<a name="index-binding"></a>
<a name="index-definition"></a>
<a name="index-property-list"></a>

<p>A <i>symbol</i> (these are sometimes called &quot;atoms&quot; or &quot;atomic
symbols&quot; by other texts) has a <i>print name</i>, a <i>binding</i>, a
<i>definition</i>, a <i>property list</i>, and a <i>package</i>.
</p>
<p>The print name is a string, which may be obtained by the
function <code>get-pname</code> ((get-pname-fun)).
This string serves as the <i>printed representation</i>
(see (printer)) of the symbol.  The binding
(sometimes also called the &quot;value&quot;) may be any object.  It is also
referred to sometimes as the &quot;contents of the value cell&quot;, since
internally every symbol has a cell called the <i>value cell</i> which
holds the binding.  It is accessed by the <code>symeval</code>
function ((symeval-fun)), and updated by the <code>set</code> function ((set-fun)).
(That is, given a
symbol, you use <code>symeval</code> to find out what its binding is,
and use <code>set</code> to change its binding.)  The definition may
also be any Lisp object.  It is also referred to as the &quot;contents of
the function cell&quot;, since internally every symbol has a cell called
the <i>function cell</i> which holds the definition.  The
definition can be accessed by the <code>fsymeval</code> function ((fsymeval-fun)), and updated
with <code>fset</code> ((fset-fun)).  The property list is a list of an even number of
elements; it can be accessed directly by <code>plist</code> ((plist-fun)), and updated
directly by <code>setplist</code> ((setplist-fun)), although usually the functions <code>get</code>,
<code>putprop</code>, and <code>remprop</code> ((get-fun)) are used.
The property list is used to associate any number
of additional attributes with a symbol&ndash;attributes not used frequently enough
to deserve their cells as the value and definition do.
Symbols also have a package cell, which indicates which &quot;package&quot; of names
the symbol belongs to.  This is explained further in the section on packages
and can be disregarded by the casual user.
</p>
<p>The primitive function for creating symbols is
<code>make-symbol</code> ((make-symbol-fun))
(currently named <code>make-atom</code>), although most symbols
are created by <code>read</code>, <code>intern</code>, or
<code>fasload</code> (who call <code>make-symbol</code> themselves.)
</p>
<p>A <i>cons</i> is an object that cares about two
other objects, arbitrarily named the <i>car</i> and the <i>cdr</i>.
These objects can be accessed with <code>car</code> and <code>cdr</code> ((car-fun)), and updated
with <code>rplaca</code> and <code>rplacd</code> ((rplaca-fun)).  The primitive function for creating
conses is <code>cons</code> ((cons-fun)).
</p>
<p>There are several kinds of numbers in Lisp Machine Lisp.
<i>Fixnums</i> represent integers in the range of -2^23 to 2^23-1.
<i>Bignums</i> represent integers of arbitrary size, with more overhead than fixnums.
The system automatically converts between fixnums and bignums as required.
<i>Flonums</i> are floating-point numbers.  <i>Small-flonums</i> are another
kind of floating-point numbers, with less range and precision, but less
computational overhead.
Other types of numbers are likely to be added in the future.
See (number) for full details.
</p>
<a name="index-fef"></a>
<p>The usual form of compiled code is a Lisp object
called a &quot;Function Entry Frame&quot; or &quot;FEF&quot;.  A FEF contains the code
for one function.  This is analogous to what Maclisp calls a &quot;subr pointer&quot;.
FEFs are produced by the Lisp Compiler ((compiler)), and are usually found
as the definitions of symbols.  The printed representation of a FEF
includes its name, so that it can be identified.
</p>
<p>Another Lisp object which represents executable code is
a &quot;micro-code entry&quot;.
These are the microcoded primitive functions of the Lisp system,
and user functions compiled into microcode.
</p>
<p>About the only useful thing to do with one of these objects
is to <i>apply</i> it to arguments.  However, some functions are
provided for examining such objects, for user convenience.  See
<code>arglist</code> ((arglist-fun)),
<code>args-info</code> ((args-info-fun)),
<code>describe</code> ((describe-fun)),
and <code>disassemble</code> ((disassemble-fun)).
</p>
<p>A <i>locative</i> (see (locative)) is a kind of a pointer to a single cell
anywhere in the system.  The contents of this cell can be accessed by
either <code>car</code> or <code>cdr</code> (both do the same thing for a locative)
(see (car-fun))
and updated by either <code>rplaca</code> or <code>rplacd</code> (see (rplaca-fun)).
</p>
<p>An <i>array</i> (see (array))
is a set of cells indexed by a tuple of integer subscripts.
The contents of cells may be accessed and changed individually.  There are several
types of arrays.  Some have cells which may contain any object, while others (numeric
arrays) may only contain small positive numbers.  Strings are a type of array;
the elements are 8-bit positive numbers which encode characters.
</p>
<a name="Lambda-Lists"></a>
<h3 class="section">1.5 Lambda Lists</h3>
<a name="index-lambda-lists"></a>

<p>Note: the examples in this section are examples of lambda-lists,
not of Lisp forms!
</p>
<p>A <i>lambda-expression</i> is the form of a user-defined function
in Lisp.  It looks like <code>(lambda <i>lambda-list</i> . <i>body</i>)</code>.  The
<i>body</i> may be any number of forms.  In Maclisp and Lisp 1.5, the
<i>lambda-list</i> (also called a <i>bound-variable list</i>) is simply a
list of symbols (which act like <i>formal parameters</i> in some other
languages).  When the lambda-expression is <i>applied</i> to its
arguments (which act like <i>actual parameters</i> in other languages),
the symbols are bound to the arguments, and the forms of the body
are evaluated sequentially; the result of the last of these evaluations
is returned.  If the number of arguments is not the same as the
length of the lambda-list, an error is generated.
</p>
<p>In Lisp Machine Lisp the same simple lambda-lists may be used,
but there are additional features accessible via certain keywords (which start
with <code>&amp;</code>) and by using lists as elements of the lambda-list.
</p>
<p>The principle weakness of the simple scheme is that any
function must only take a certain, fixed number of arguments.  As we
know, many very useful functions, such as <code>list</code>, <code>append</code>, <code>+</code>,
and so on, may take a varying number of arguments.  Maclisp
solved this problem by the use of <i>lexpr</i>s and <i>lsubr</i>s, which
were somewhat inelegant since the parameters had to be referred to by
numbers instead of names (e.g. <code>(arg 3)</code>).  (For compatibility
reasons, Lisp Machine Lisp supports <i>lexpr</i>s, but they should not be
used in new programs).
</p>
<p>In general, a function in Lisp Machine Lisp has zero or more
<i>required</i> parameters, followed by zero or more <i>optional</i>
parameters, followed by zero or one <i>rest</i> parameter.
This means that the caller must provide enough arguments so that each
of the required parameters gets bound, but he may provide some extra
arguments for each of the optional parameters.  Also, if there is a
rest parameter, he can provide as many extra arguments as he wants,
and the rest parameter will be bound to a list of all these extras.
Also, optional parameters may have a <i>default-form</i>, which is a
form to be evaluated to produce the default argument if none is supplied.
</p>
<p>Here is the exact explanation of how this all works.  When
<code>apply</code> matches up the arguments with the parameters, it follows the
following algorithm:
</p>
<p>The first required parameter is bound to the first
argument.  <code>apply</code> continues to bind successive required parameters
to the successive arguments.  If, during this process, there are no
arguments left but there are still some required parameters which have
not been bound yet, then an error is caused (&quot;too few arguments&quot;).
</p>
<p>Next, after all required parameters are handled, <code>apply</code>
continues with the optional parameters, binding each argument to each
successive parameter.  If, during this process, there are no arguments
left, each remaining optional parameter&rsquo;s default-form is evaluated,
and the parameter is bound to it.  This is done one parameter at a time;
that is, first one default-form is evaluated, and then the parameter is
bound to it, then the next default-form is evaluated, and so on.
This allows the default for an argument to depend on the previous argument.
</p>
<p>Finally, if there is no rest parameter and there are no
remaining arguments, we are finished.  If there is no rest parameter
but there are still some arguments remaining, an error is caused (&quot;too
many arguments&quot;).  But if there <i>is</i> a rest parameter, it is bound
to a list of all of the remaining arguments.  (If there are no
remaining arguments, it gets bound to <code>nil</code>.)
</p>
<p>The way you express which parameters are required, optional,
and rest is by means of specially recognized symbols, which are called
<code>&amp;-<i>keywords</i></code>, in the lambda-list.  All such symbols&rsquo; print names
begin with the character &quot;<code>&amp;</code>&quot;.  A list of all such symbols is the value of
the symbol <code>lambda-list-keywords</code>.
</p>
<p>The keywords used here are <code>&amp;optional</code> and <code>&amp;rest</code>.
The way they are used is best explained by means of examples;
the following are typical lambda-lists, followed by descriptions
of which parameters are required, optional, and rest.
</p>
<dl compact="compact">
<dt><code>(a b c)</code></dt>
<dd><p><code>a</code>, <code>b</code>, and <code>c</code> are all required.  This function must be
passed three arguments.
</p></dd>
<dt><code>(a b &amp;optional c)</code></dt>
<dd><p><code>a</code> and <code>b</code> are required, <code>c</code> is optional.  The function
may be passed either two or three arguments.
</p></dd>
<dt><code>(&amp;optional a b c)</code></dt>
<dd><p><code>a</code>, <code>b</code>, and <code>c</code> are all optional.  The function may
be passed any number of arguments between zero and three, inclusively.
</p></dd>
<dt><code>(&amp;rest a)</code></dt>
<dd><p><code>a</code> is a rest parameter.  The function may be passed any number of arguments.
</p></dd>
<dt><code>(a b &amp;optional c d &amp;rest e)</code></dt>
<dd><p><code>a</code> and <code>b</code> are required, <code>c</code> and <code>d</code> are optional,
and <code>e</code> is rest.  The function may be passed two or more arguments.
</p></dd>
</dl>

<p>In all of the cases above, the <i>default-forms</i> for each parameter
were <code>nil</code>.  To specify your own default forms, instead
of putting a symbol as the element of a lambda-list, put in a list
whose first element is the symbol (the parameter itself) and
whose second element is the default-form.  For example:
</p>
<dl compact="compact">
<dt><code>(a &amp;optional (b 3))</code></dt>
<dd><p>The default-form for <code>b</code> is <code>3</code>.  <code>a</code> is a required parameter, and
so it doesn&rsquo;t have a default form.
</p></dd>
<dt><code>(&amp;optional (a 'foo) b (c (symeval a)) &amp;rest d)</code></dt>
<dd><p><code>a</code>&rsquo;s default-form is <code>'foo</code>, <code>b</code>&rsquo;s is <code>nil</code>, and <code>c</code>&rsquo;s is
<code>(symeval a)</code>.  Note that if
the function whose lambda-list this is were called on no arguments,
<code>a</code> would be bound to the symbol <code>foo</code>, and <code>c</code> would be bound
to the binding of the symbol <code>foo</code>; this illustrates the fact
that each variable is bound immediately after its default-form is evaluated,
and so later default-forms may take advantage of earlier parameters
in the lambda-list.  <code>b</code> and <code>d</code> would be bound to <code>nil</code>.
</p></dd>
</dl>

<p>It is also possible to include, in the lambda-list, some other
symbols which are bound to the values of their default-forms upon
entry to the function.  These are <i>not</i> parameters, and they are
never bound to arguments;  they are like &quot;prog variables&quot;.
</p>
<p>To include such symbols, put them after any parameters, preceeded
by the <code>&amp;</code>-keyword <code>&amp;aux</code>.  Examples:
</p>
<dl compact="compact">
<dt><code>(a &amp;optional b &amp;rest c &amp;aux d (e 5) (f (cons a e)))</code></dt>
<dd><p><code>d</code>, <code>e</code>, and <code>f</code> are bound, when the function is
called, to <code>nil</code>, <code>5</code>, and a cons of the first argument and 5.
</p></dd>
</dl>

<p>Note that aux-variables are bound sequentially rather than
in parallel.
</p>
<p>It is important to realize that the list of arguments to which
a rest-parameter is bound is set up in whatever way is most efficiently
implemented, rather than in the way that is most convenient for the
function receiving the arguments.  It is guaranteed neither to be a &quot;real&quot; list, nor to be
a temporary object which may be freely modified.  Sometimes the rest-args list
is stored in the function-calling stack, and loses its validity when the
function returns; if a rest-argument is to be returned or made part
of permanent list-structure, it must first be copied (see <code>append</code>).
The system will not detect the error of omitting to copy a rest-argument;
you will simply find that you have a value which seems to change behind your back.
</p>
<p>At other times the rest-args list will be an argument that was given to <code>apply</code>;
therefore it is not safe to <code>rplaca</code> this list as you may modify permanent
data structure.  An attempt to <code>rplacd</code> a rest-args list will be unsafe
in this case, while in the first case it would cause an error.
</p>
<a name="Predicates"></a>
<h2 class="chapter">2 Predicates</h2>
<a name="index-predicate"></a>

<p>A <i>predicate</i> is a function which tests for some condition involving
its arguments and returns the symbol <code>t</code> if the condition is true, or
the symbol <code>nil</code> if it is not true.
</p>
<p>By convention, the names of predicates usually end in the letter &quot;p&quot; (which
stands for &quot;predicate&quot;).  (See [section on naming conventions]).
<a name="index-naming-convention"></a>
</p>
<p>The following predicates are for testing data types.  These predicates
return <code>t</code> if the argument is of the type indicated by the name of the function,
<code>nil</code> if it is of some other type.
<a name="index-data_002dtype-1"></a>
</p>
<dl>
<dt><a name="index-symbolp"></a>Function: <strong>symbolp</strong> <em>arg</em></dt>
<dd><a name="index-symbol-1"></a>
<p><code>symbolp</code> returns <code>t</code> if its argument is a symbol, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-nsymbolp"></a>Function: <strong>nsymbolp</strong> <em>arg</em></dt>
<dd><p><code>nsymbolp</code> returns <code>nil</code> if its argument is a symbol, otherwise <code>t</code>.
</p></dd></dl>

<dl>
<dt><a name="index-listp"></a>Function: <strong>listp</strong> <em>arg</em></dt>
<dd><a name="index-cons"></a>
<p><code>listp</code> returns <code>t</code> if its argument is a cons, otherwise <code>nil</code>.
<code>(listp nil)</code> is <code>nil</code> even though <code>nil</code> is the empty list.
</p></dd></dl>

<dl>
<dt><a name="index-nlistp"></a>Function: <strong>nlistp</strong> <em>arg</em></dt>
<dd><p><code>nlistp</code> returns <code>t</code> if its argument is anything besides a cons,
otherwise <code>nil</code>.
This is the recommended predicate for terminating iterations or recursions
on lists.  It is, in fact, identical to <code>atom</code>.
</p></dd></dl>

<dl>
<dt><a name="index-atom-2"></a>Function: <strong>atom</strong> <em>arg</em></dt>
<dd><a name="index-atom-1"></a>
<p>The predicate <code>atom</code> returns <code>t</code> if its argument is not a cons,
otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-fixp"></a>Function: <strong>fixp</strong> <em>arg</em></dt>
<dd><p><code>fixp</code> returns <code>t</code> if its argument is a fixnum or a bignum, otherwise
<code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-floatp"></a>Function: <strong>floatp</strong> <em>arg</em></dt>
<dd><p><code>floatp</code> returns <code>t</code> if its argument is a flonum or a small flonum,
otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-small_002dfloatp"></a>Function: <strong>small-floatp</strong> <em>arg</em></dt>
<dd><p><code>small-floatp</code> returns <code>t</code> if <i>arg</i> is a small flonum, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-bigp"></a>Function: <strong>bigp</strong> <em>arg</em></dt>
<dd><p><code>bigp</code> returns <code>t</code> if <i>arg</i> is a bignum, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-numberp"></a>Function: <strong>numberp</strong> <em>arg</em></dt>
<dd><a name="index-number"></a>
<p><code>numberp</code> returns <code>t</code> if its argument is any kind of number,
otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-stringp"></a>Function: <strong>stringp</strong> <em>arg</em></dt>
<dd><a name="index-string"></a>
<p><code>stringp</code> returns <code>t</code> if its argument is a string, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-arrayp"></a>Function: <strong>arrayp</strong> <em>arg</em></dt>
<dd><a name="index-array"></a>
<p><code>arrayp</code> returns <code>t</code> if its argument is an array, otherwise <code>nil</code>.
Note that strings are arrays.
</p></dd></dl>

<dl>
<dt><a name="index-subrp"></a>Function: <strong>subrp</strong> <em>arg</em></dt>
<dd><p><code>subrp</code> returns <code>t</code> if its argument is any compiled code object,
otherwise <code>nil</code>.  The Lisp Machine system doesn&rsquo;t use the term &quot;subr&quot;,
but the name of this function comes from Maclisp.
</p></dd></dl>

<dl>
<dt><a name="index-closurep"></a>Function: <strong>closurep</strong> <em>arg</em></dt>
<dd><a name="index-closure"></a>
<p><code>closurep</code> returns <code>t</code> if its argument is a closure, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-locativep"></a>Function: <strong>locativep</strong> <em>arg</em></dt>
<dd><a name="index-locative"></a>
<p><code>locativep</code> returns <code>t</code> if its argument is a locative, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-typep"></a>Function: <strong>typep</strong> <em>arg</em></dt>
<dd><p><code>typep</code> is not really a predicate, but it is explained here because it is
used to determine the datatype of an object.  It returns a symbol describing the
type of its argument, one of the following:
</p>
<dl compact="compact">
<dt><code>:symbol</code></dt>
<dd><p>A symbol.
</p></dd>
<dt><code>:fixnum</code></dt>
<dd><p>A fixnum.
</p></dd>
<dt><code>:flonum</code></dt>
<dd><p>A flonum.
</p></dd>
<dt><code>:small-flonum</code></dt>
<dd><p>A small flonum.
</p></dd>
<dt><code>:bignum</code></dt>
<dd><p>A bignum.
</p></dd>
<dt><code>:list</code></dt>
<dd><p>A cons.
</p></dd>
<dt><code>:string</code></dt>
<dd><p>A string.
</p></dd>
<dt><code>:array</code></dt>
<dd><p>An array that is not a string.
</p></dd>
<dt><code>:random</code></dt>
<dd><p>Any built-in data type that does not fit into one of the above categories.
</p></dd>
<dt><code><i>foo</i></code></dt>
<dd><p>An object of user-defined data-type <i>foo</i> (any symbol).
See Named Structures, (named-structure).
</p></dd>
</dl>

<p>See also <code>data-type</code>, (data-type-fun).
</p></dd></dl>

<p>The following functions are some other general purpose predicates.
</p>
<dl>
<dt><a name="index-eq"></a>Function: <strong>eq</strong> <em>x y</em></dt>
<dd><p><code>(eq <i>x y</i>) =&gt; t</code> if and only if <i>x</i> and <i>y</i> are the same object.
It should be noted that things that print the same are not necessarily <code>eq</code> to each other.
In particular, numbers with the same value
need not be <code>eq</code>, and two similar lists are usually not <code>eq</code>.
<a name="index-eq-versus-equal"></a>
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(eq 'a 'b) =&gt; nil
(eq 'a 'a) =&gt; t
(eq (cons 'a 'b) (cons 'a 'b)) =&gt; nil
(setq x '(a . b)) (eq x x) =&gt; t
</pre></div>

<p>Note that in Lisp Machine Lisp equal fixnums are <code>eq</code>; this is not true in Maclisp.
Equality does not imply <code>eq</code>-ness for other types of numbers.
</p></dd></dl>

<dl>
<dt><a name="index-neq"></a>Macro: <strong>neq</strong> <em>x y</em></dt>
<dd><p><code>(neq <i>x y</i>)</code> = <code>(not (eq <i>x y</i>))</code>.  This is provided
simply as an abbreviation for typing convenience.
</p></dd></dl>

<dl>
<dt><a name="index-equal"></a>Function: <strong>equal</strong> <em>x y</em></dt>
<dd><p>The <code>equal</code> predicate returns <code>t</code> if its arguments are similar
(isomorphic) objects. (cf. <code>eq</code>)
</p>
<a name="index-eq-versus-equal-1"></a>
<p>Two numbers are <code>equal</code> if they have the same value (a flonum
is never <code>equal</code> to a fixnum though).
Two strings are <code>equal</code> if they have the same length,
and the characters composing them are the same.  Alphabetic case is ignored.
For conses, <code>equal</code> is defined recursively as
the two <code>car</code>&rsquo;s being <code>equal</code> and the two <code>cdr</code>&rsquo;s being equal.
All other objects are <code>equal</code> if and only if they are <code>eq</code>.
Thus <code>equal</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun equal (x y)
       (or (eq x y)
           (and (numberp x) (numberp y) (= x y))
           (and (stringp x) (stringp y) (string-equal x y))
           (and (listp x)
                (listp y)
                (equal (car x) (car y))
                (equal (cdr x) (cdr y)))))
</pre></div>

<p>As a consequence of the above definition, it can be seen that
<code>equal</code> need not terminate when applied to looped list structure.
In addition, <code>eq</code> always implies <code>equal</code>; that is, if <code>(eq a b)</code>
then <code>(equal a b)</code>.  An intuitive definition of <code>equal</code> (which is
not quite correct) is that two objects are <code>equal</code> if they look the
same when printed out.  For example:
</p>
<div class="lisp">
<pre class="lisp">(setq a '(1 2 3))
(setq b '(1 2 3))
(eq a b) =&gt; nil
(equal a b) =&gt; t
(equal &quot;Foo&quot; &quot;foo&quot;) =&gt; t
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-not"></a>Function: <strong>not</strong> <em>x</em></dt>
<dt><a name="index-null"></a>Function: <strong>null</strong> <em>x</em></dt>
<dd><p><code>not</code> returns <code>t</code> if <i>x</i> is <code>nil</code>, else <code>nil</code>.
<code>null</code> is the same as <code>not</code>; both functions are included for the sake
of clarity.  Use <code>null</code> to check whether something is <code>nil</code>; use <code>not</code>
to invert the sense of a logical value.  Even though Lisp uses the symbol
<code>nil</code> to represent falseness, you shouldn&rsquo;t make understanding of your program
depend on this fortuitously.  For example, one often writes:
</p>
<div class="lisp">
<pre class="lisp">(cond ((not (null lst)) ... )
      ( ... ))
<span class="roman">rather than</span>
(cond (lst ... )
      ( ... ))
</pre></div>

<p>There is no loss of efficiency, since these will compile into exactly
the same instructions.
</p></dd></dl>

<a name="Evaluation"></a>
<h2 class="chapter">3 Evaluation</h2>
<a name="index-evaluation"></a>

<p>The following is a complete description of the actions taken by the
evaluator, given a <i>form</i> to evaluate.
</p>
<p>If <i>form</i> is a number, the result is <i>form</i>.
</p>
<p>If <i>form</i> is a string, the result is <i>form</i>.
</p>
<p>If <i>form</i> is a symbol, the result is the binding
of <i>form</i>.  If <i>form</i> is unbound, an error is signalled.
</p>
<p>If <i>form</i> is not any of the above types, and is not a list,
an error is signalled.
</p>
<p>If <i>form</i> is a special form, indentified by a distinguished
symbol as its car, it is handled accordingly; each special form works
differently.  All of them are documented in this manual.
</p>
<p>If <i>form</i> is not a special form, it calls for the <i>application</i>
of a function to <i>arguments</i>.  The <i>car</i> of the form is a function or
the name of a function.  The <i>cdr</i> of the form is a list of forms which
are evaluated to produce arguments, which are fed to the function.  Whatever
results the function <i>returns</i> is the value of the original <i>form</i>.
</p>
<p>[Here there should be the rest of the moby description of evaluation and application,
particularly multiple values.  Explain the term &quot;variables&quot;, also a very
brief bit about locals and specials (fluids and lexicals??).
The nature of functions should be revealed;
including compiled-code, interpreted-code, arrays, stack-groups, closures,
symbols.  Discuss macros.
Talk about function-calling in compiled code, how this is essentially
identical to the <code>apply</code> function, and no need for <code>(sstatus uuolinks)</code>
and the like.]
</p>
<a name="Functions-and-Special-Forms"></a>
<h3 class="section">3.1 Functions and Special Forms</h3>

<dl>
<dt><a name="index-eval"></a>Function: <strong>eval</strong> <em>x</em></dt>
<dd><p><code>(eval <i>x</i>)</code> evaluates <i>x</i>, and returns the result.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x 43 foo 'bar)
(eval (list 'cons x 'foo))
    =&gt; (43 . bar)
</pre></div>

<p>It is unusual to explicitly call <code>eval</code>, since usually
evaluation is done implicitly.  If you are writing a simple Lisp program and
explicitly calling <code>eval</code>, you are probably doing something wrong.
<code>eval</code> is primarily useful in programs which deal with Lisp itself,
rather than programs about knowledge or mathematics or games.
</p>
<p>Also, if you are only interested in getting at the value of a
symbol (that is, the contents of the symbol&rsquo;s value cell), then you
should use the primitive function <code>symeval</code>.
<a name="index-symeval"></a>
</p>
<p>Note: the actual name of the compiled code for <code>eval</code> is &quot;<code>si:*eval</code>&quot;;
this is because use of the <i>evalhook</i> feature binds the function cell of <code>eval</code>.
If you don&rsquo;t understand this, you can safely ignore it.
<a name="index-evalhook"></a>
<a name="index-evalhook-1"></a>
</p>
<p>Note: unlike Maclisp, <code>eval</code> never takes a second argument; there
are no &quot;binding context pointers&quot; in Lisp Machine Lisp.
They are replaced by Closures (see (closure)).
</p></dd></dl>

<dl>
<dt><a name="index-apply"></a>Function: <strong>apply</strong> <em>fn arglist</em></dt>
<dd><p><code>(apply <i>fn arglist</i>)</code> applies the function <i>fn</i> to the list of
arguments <i>arglist</i>.  <i>arglist</i> should be a list; <i>fn</i> can be a
compiled-code object, or a &quot;lambda expression&quot;, i.e., a list whose <code>car</code>
is the symbol <code>lambda</code>, or a symbol, in which case its definition (the contents
of its function cell) is used.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq f '+) (apply f '(1 2)) =&gt; 3
(setq f '-) (apply f '(1 2)) =&gt; -1
(apply 'cons '((+ 2 3) 4)) =&gt;
                ((+ 2 3) . 4)   <i>not</i> (5 . 4)
</pre></div>

<p>Of course, <i>arglist</i> may be <code>nil</code>.
</p>
<p>Note: unlike Maclisp, <code>apply</code> never takes a third argument; there
are no &quot;binding context pointers&quot; in Lisp Machine Lisp.
</p>
<p>Compare <code>apply</code> with <code>funcall</code> and <code>eval</code>.
</p></dd></dl>

<dl>
<dt><a name="index-funcall"></a>Function: <strong>funcall</strong> <em>f &amp;rest args</em></dt>
<dd><p><code>(funcall <i>f a1 a2 ... an</i>)</code> applies the function <i>f</i> to the arguments
<i>a1, a2, ..., an</i>.
<code>f</code> may not
be a special form nor a macro; this would not be meaningful.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(cons 1 2) =&gt; (1 . 2)
(setq cons 'plus)
(funcall cons 1 2) =&gt; 3
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-lexpr_002dfuncall"></a>Function: <strong>lexpr-funcall</strong> <em>f &amp;rest args</em></dt>
<dd><p><code>lexpr-funcall</code> is like a cross between <code>apply</code> and <code>funcall</code>.
<code>(lexpr-funcall <i>f a1 a2 ... an list</i>)</code> applies the function <i>f</i>
to the arguments <i>a1</i> through <i>an</i> followed by the elements of
<i>list</i>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(lexpr-funcall 'plus 1 1 1 '(1 1 1)) =&gt; 6

(defun report-error (&amp;rest args)
   (lexpr-funcall (function format) error-output args))
</pre></div>
</dd></dl>

<p>Note:  the Maclisp functions <code>subrcall</code>, <code>lsubrcall</code>, and <code>arraycall</code>
are not needed on the Lisp Machine; <code>funcall</code> is just as efficient.
<a name="index-subrcall"></a>
<a name="index-lsubrcall"></a>
<a name="index-arraycall"></a>
</p>
<dl>
<dt><a name="index-quote-1"></a>Special Form: <strong>quote</strong></dt>
<dd><a name="index-quote"></a>
<p><code>(quote <i>x</i>)</code> simply returns <i>x</i>.  It is useful because it takes the
argument <i>quoted</i>, so that it is not evaluated by <code>eval</code>.  <code>quote</code> is used
to include constants in a form.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(quote x) =&gt; x
(setq x (quote (some list)))   x =&gt; (some list)
</pre></div>

<p>Since <code>quote</code> is so useful but somewhat cumbersome to type, the reader normally
converts any form preceded by a single quote (<code>'</code>) character into a <code>quote</code> form.
</p>
<div class="lisp">
<pre class="lisp"><span class="roman">For example,</span>
(setq x '(some list))
<span class="roman">is converted by read into</span>
(setq x (quote (some list)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-function"></a>Special Form: <strong>function</strong></dt>
<dd><p><code>(function <i>x</i>)</code> is similar to <code>quote</code>, except that it implies
to the compiler that <i>x</i> is a function.  In the interpreter, if <i>x</i> is a symbol
<code>(function <i>x</i>)</code> returns <i>x</i>&rsquo;s definition;
otherwise <i>x</i> itself is returned.
Because of this, using <code>function</code> rules out the possibility of later
changing the function definition of <i>x</i>, including tracing it.  Care is required!
</p></dd></dl>

<dl>
<dt><a name="index-comment"></a>Special Form: <strong>comment</strong></dt>
<dd><p><code>comment</code> ignores its form and returns the symbol <code>comment</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(defun foo (x)
    (cond ((null x) 0)
          (t (comment x has something in it)
             (1+ (foo (cdr x))))))
</pre></div>

<p>Usually it is preferable to comment code using the
semicolon-macro feature of the standard input syntax.  This allows the
user to add comments to his code which are ignored by the lisp reader.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(defun foo (x)
    (cond ((null x) 0)
          (t (1+ (foo (cdr x))))     ;x has something in it
      ))
</pre></div>

<p>A problem with such comments is that they are discarded when the S-expression
is read into lisp.  If the function is read into Lisp, modified, and printed
out again, the comment will be lost.  However, this style of operation is hardly
ever used; usually the source of a function is kept in an editor buffer and
any changes are made to the buffer, rather than the actual list structure
of the function.  Thus, this is not a real problem.
</p></dd></dl>

<dl>
<dt><a name="index-_0040"></a>Macro: <strong>@</strong> <em>define</em></dt>
<dd><p>This macro turns into <code>nil</code>.  It exists for the sake of the
@ listing generation program, which uses it to declare names of special forms
which define objects (such as functions) which @ should cross-reference.
</p></dd></dl>

<dl>
<dt><a name="index-progn"></a>Special Form: <strong>progn</strong></dt>
<dd><p>A progn-form looks like <code>(progn <i>form1 form2 ...</i>)</code>.
The <i>forms</i> are evaluated in order from left to right and the value
of the last one is the result of the progn.
<code>progn</code> is the primitive control structure construct for &quot;compound
statements&quot;.  Although lambda-expressions, cond-forms, do-forms, and
many other control structure forms use <code>progn</code> implicitly, that is,
they allow multiple forms in their bodies, there are occasions when
one needs to evaluate a number of forms for their side-effects and
make them appear to be a single form.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(foo (cdr a)
     (progn (setq b (extract frob))
            (car b))
     (cadr b))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-prog1"></a>Special Form: <strong>prog1</strong></dt>
<dd><p><code>prog1</code> is similar to <code>progn</code>, but it returns the value of its <i>first</i> form.
It is most commonly used to evaluate an expression with side effects, and return
a value which must be computed <i>before</i> the side effects happen.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x (prog1 y (setq y x)))
</pre></div>

<p>which interchanges the values of the variables <i>x</i> and <i>y</i>.
</p>
<p><code>prog1</code> could have been defined as:
</p>
<div class="lisp">
<pre class="lisp">(defun prog1 (&amp;rest values)
    (car values))
</pre></div>

<p>It is actually implemented as a macro which expands into a <code>prog2</code>.
</p></dd></dl>

<dl>
<dt><a name="index-prog2"></a>Special Form: <strong>prog2</strong></dt>
<dd><p><code>prog2</code> is similar to <code>progn</code> and <code>prog1</code>,
but it returns its <i>second</i> argument.
It is included largely for Maclisp compatibility.  It has two purposes: to evaluate
two forms sequentially, which can be done more generally with <code>progn</code>, or
to do what <code>prog1</code> is used for (c.f. <code>prog1</code> above).
</p></dd></dl>

<dl>
<dt><a name="index-let"></a>Special Form: <strong>let</strong></dt>
<dd><p><code>let</code> is used to bind some variables for some objects.
A <code>let</code> form looks like
</p>
<div class="lisp">
<pre class="lisp">(let ((<i>var1</i> <i>vform1</i>)
      (<i>var2</i> <i>vform2</i>)
      ...)
  <i>bform1</i>
  <i>bform2</i>
  ...)
</pre></div>

<p>When this form is evaluated, first the <i>vform</i>s are evaluated.
Then the <i>var</i>s are bound to the values returned by the
corresponding  <i>vform</i>s.  Finally, the <i>bform</i>s are evaluated sequentially
and the result of the last one returned.
</p>
<p><code>let</code> is implemented as a macro which expands into a lambda-combination;
however, it is preferable
to use <code>let</code> rather than <code>lambda</code> because the variables and the corresponding forms
appear textually close to each other, which increases readability
of the program.
</p></dd></dl>

<p>See also <code>let-globally</code>, (let-globally-fun).
</p>
<dl>
<dt><a name="index-progv"></a>Special Form: <strong>progv</strong></dt>
<dd><p><code>progv</code> is a special form to provide the user with extra control
over lambda-binding.  It binds a list of symbols to a list of values,
and then evaluates some forms.  The lists of symbols and values
are computed quantities; this is what makes <code>progv</code> different from
<code>lambda</code>, <code>let</code>, <code>prog</code>, and <code>do</code>.
</p>
<div class="lisp">
<pre class="lisp">(progv <i>symbol-list value-list form1 form2 </i>... )
</pre></div>

<p>first evaluates <i>symbol-list</i> and <i>value-list</i>.  Then the symbols
are bound to the values.  In compiled code the symbols must be <i>special</i>,
since the compiler has no way of knowing what symbols might appear in the
<i>symbol-list</i>.  If too few values are supplied, the remaining symbols
are bound to <code>nil</code>.  If too many values are supplied, the
excess values are ignored.
</p>
<p>After the symbols have been bound to the values, the <i>form</i>s are
evaluated, and finally the symbols&rsquo; bindings are undone.
The result returned is the value of the last form.  Note that the
&quot;body&quot; of a <code>progv</code> is similar to that of <code>progn</code>, not that of <code>prog</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a 'foo b 'bar)

(progv (list a b 'b) (list b) (list a b foo bar))
    =&gt; (foo nil bar nil)
</pre></div>

<p>During the evaluation of the body of this <code>progv</code>, <code>foo</code>
is bound to <code>bar</code>, <code>bar</code> is bound to <code>nil</code>, <code>b</code> is
bound to <code>nil</code>, and <code>a</code> remains bound to <code>foo</code>.
</p></dd></dl>

<p>See also <code>bind</code> (see (bind-fun)), which is a
subprimitive which gives you maximal control over binding.
</p>
<p>The following three functions (<code>arg</code>, <code>setarg</code>, and <code>listify</code>)
exist only for compatibility with Maclisp <i>lexprs</i>.
<a name="index-lexpr"></a>
</p>
<dl>
<dt><a name="index-arg"></a>Function: <strong>arg</strong> <em>x</em></dt>
<dd><p><code>(arg nil)</code>, when evaluated during the application of
a lexpr, gives the number of arguments supplied to that
lexpr.
This is primarily a debugging aid, since lexprs also receive their number of arguments
as the value of their <code>lambda</code>-variable.
</p>
<p><code>(arg <i>i</i>)</code>, when evaluated during the application of a lexpr, gives the value of the
<i>i</i>&rsquo;th argument to the lexpr.  <i>i</i> must be a fixnum in this case. It is an error if <i>i</i> is less than 1 or greater than the number
of arguments supplied to the lexpr.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(defun foo nargs            ;<span class="roman">define a lexpr </span>foo.
    (print (arg 2))         ;<span class="roman">print the second argument.</span>
    (+ (arg 1)              ;<span class="roman">return the sum of the first</span>
       (arg (- nargs 1))))  ;<span class="roman">and next to last arguments.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-setarg"></a>Function: <strong>setarg</strong> <em>i x</em></dt>
<dd><p><code>setarg</code> is used only during the application of a lexpr.
<code>(setarg <i>i x</i>)</code> sets the
lexpr&rsquo;s <i>i</i>&rsquo;th argument to <i>x</i>.
<i>i</i> must be greater than zero
and not greater than the number of arguments passed to the lexpr.
After <code>(setarg <i>i x</i>)</code> has been done, <code>(arg <i>i</i>)</code> will return <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-listify"></a>Function: <strong>listify</strong> <em>n</em></dt>
<dd><p><code>(listify <i>n</i>)</code> manufactures a list of <i>n</i> of the
arguments of a lexpr.  With a positive argument <i>n</i>, it returns a
list of the first <i>n</i> arguments of the lexpr.  With a negative
argument <i>n</i>, it returns a list of the last <code>(abs <i>n</i>)</code>
arguments of the lexpr.  Basically, it works as if defined as follows:
</p>
<div class="lisp">
<pre class="lisp">    (defun listify (n)
         (cond ((minusp n)
                (listify1 (arg nil) (+ (arg nil) n 1)))
               (t
                (listify1 n 1)) ))

    (defun listify1 (n m)      ;<span class="roman"> auxiliary function.</span>
         (do ((i n (1- i))
              (result nil (cons (arg i) result)))
             ((&lt; i m) result) ))
</pre></div>
</dd></dl>

<a name="Multiple-Values"></a>
<h3 class="section">3.2 Multiple Values</h3>

<p>The Lisp machine includes a facility by which the evaluation of a form
can produce more than one value.  When a function needs to return more
than one result to its caller, multiple values are a cleaner way of doing
this than returning a list of the values or <code>setq</code>&rsquo;ing special variables
to the extra values.
</p>
<p>In the normal case, multiple values are not used.  Special syntax is
required both to <i>produce</i> multiple values and to <i>receive</i> them.
If the caller does not receive multiple values, the first of the
multiple values will be received as the ordinary value.
</p>
<p>The primitive for producing multiple values is <code>return</code>, which when
given more than one argument returns all its arguments as the values of
the <code>prog</code> or <code>do</code> from which it is returning.  The variant
<code>return-from</code> also can produce multiple values.  Many system functions
produce multiple values, but they all do it via the <code>return</code> primitive.
</p>
<p>The special forms for receiving multiple values are <code>multiple-value</code>,
<code>multiple-value-list</code>, and <code>multiple-value-bind</code>.  These include
a form and an indication of where to put the values returned by that form.
</p>
<dl>
<dt><a name="index-multiple_002dvalue"></a>Special Form: <strong>multiple-value</strong></dt>
<dd><p><code>(multiple-value <i>var-list</i> <i>form</i>)</code> is a special
form used for calling a function which
is expected to return more than one value.
<a name="index-multiple-value"></a>
<a name="index-returning-multiple-values"></a>
</p>
<p><i>var-list</i> should be a list of variables.
<i>form</i> is evaluated, and the variables in <i>var-list</i>
will be <i>set</i> (not lambda-bound) to the values returned by <i>form</i>.  If more values
are returned than there are variables in <i>var-list</i>, then the extra values
are ignored.  If there are more variables than values returned,
extra values of <code>nil</code> are supplied.  It is allowed to have <code>nil</code>
in the <i>var-list</i>, which means that the corresponding value is to be
ignored (you can&rsquo;t use <code>nil</code> as a variable.)
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(multiple-value (symbol already-there-p)
        (intern &quot;goo&quot;))
</pre></div>

<p><code>intern</code> returns a second value, which is <code>t</code> if the symbol returned as the
first value was already on the obarray, or else <code>nil</code> if it just put it there.
So if the symbol <code>goo</code> was already on the obarray, the variable <code>already-there-p</code>
will be set to <code>t</code>, else it will be set to <code>nil</code>.
</p>
<p><code>multiple-value</code> is usually used for effect rather than for value, however
its value is defined to be the first of the values returned by <i>form</i>.
</p></dd></dl>

<dl>
<dt><a name="index-multiple_002dvalue_002dbind"></a>Special Form: <strong>multiple-value-bind</strong></dt>
<dd><p>This is similar to <code>multiple-value</code>, but locally binds the variables which
receive the values, rather than <code>setq</code>ing them.  The form looks like:
</p>
<div class="lisp">
<pre class="lisp">(multiple-value-bind (<i>var1 var2...</i>)
     (<i>function</i> <i>args...</i>)
  <i>body...</i>)
</pre></div>

<p>The scope of the binding of <i>var1</i>, <i>var2</i>, etc. is <i>body</i>; they are
not bound until after the function call.
</p></dd></dl>

<dl>
<dt><a name="index-multiple_002dvalue_002dlist"></a>Special Form: <strong>multiple-value-list</strong></dt>
<dd><p><code>(multiple-value-list <i>form</i>)</code> evaluates <i>form</i>, and returns a list of
the values it returned.  This is useful for when you don&rsquo;t know how many values
to expect.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a (multiple-value-list (intern &quot;goo&quot;)))
a =&gt; (goo nil #&lt;Package User&gt;)
</pre></div>

<p>This is similar to the example of <code>multiple-value</code> above; <code>a</code> will be set
to a list of three elements, the three values returned by <code>intern</code>.
The first is the newly interned symbol <code>goo</code>, the second is
<code>nil</code> to indicate that it is newly-interned, and the third is
the package on which it was interned.
</p></dd></dl>

<p>Due to the syntactic structure of Lisp, it is often the case that the value
of a certain form is the value of a sub-form of it.  For example, the
value of a <code>cond</code> is the value of the last form in the selected clause.
In most such cases, if the sub-form produces multiple values, the original
form will also produce all of those values.  This <i>passing-back</i> of
multiple values of course has no effect unless eventually one of the
special forms for receiving multiple values is reached.
The exact rule governing passing-back of multiple values is as follows:
</p>
<p>If <i>X</i> is a form, and <i>Y</i> is a sub-form of <i>X</i>, then if the value
of <i>Y</i> is unconditionally returned as the value of <i>X</i>, with no
intervening computation, then all the multiple values returned by <i>Y</i>
are returned by <i>X</i>.  In all other cases, multiple values or only
single values may be returned at the discretion of the implementation;
users should not depend on this.  The reason we don&rsquo;t guarantee
non-transmission of multiple values is because such a guarantee would
not be very useful and the efficiency cost of enforcing it would be
high.  Even <code>setq</code>&rsquo;ing a variable to the result of a form, then
returning the value of that variable might be made to pass multiple
values by an optimizing compiler which realized that the <code>setq</code>ing of
the variable was unnecessary.
</p>
<p>Note that use of a form as an argument to a function never passes-back
multiple values.  We choose not to generate several separate arguments
from the several values, because this would make the source code
obscure; it would not be syntactically obvious that a single form does
not coorrespond to a single argument.  Instead the first value of a
form is used as the argument and the remaining values are discarded.
Passing-back of multiple values happens only with special forms.
For clarity, the interaction of several common special forms with
multiple values is described.  This can all be deduced from the rule
given above.
</p>
<p>The body of a <code>defun</code> or a <code>lambda</code>, and variations such as the
body of a function, the body of a <code>let</code>, etc. pass back multiple
values from the last form in the body.
</p>
<p><code>eval</code>, <code>apply</code>, <code>funcall</code>, <code>lexpr-funcall</code>, and <code>&lt;-</code>
pass back multiple values from the function called.
</p>
<p><code>progn</code> passes back multiple values from its last form.
<code>progv</code> does so also.
<code>prog1</code> and <code>prog2</code> however do not pass back multiple values.
</p>
<p><code>and</code> and <code>or</code> pass back multiple values from their last form,
but not from previous forms since the return is conditional.
</p>
<p><code>cond</code> passes back multiple values from the last form in the
selected clause, but not if the clause is only one long (i.e. the
returned value is the value of the predicate) since the return is
conditional.  This applies even to the last clause where the return
is not really conditional (the implementation is allowed to pass
or not to pass multiple values in this case).
</p>
<p>The variants of <code>cond</code>, <code>if</code>, <code>select</code>, <code>selectq</code>, and
<code>dispatch</code> pass back multiple values.
</p>
<p><code>prog</code> passes back the number of values given as arguments to
the <code>return</code> that returns from it.  <code>(return <i>form</i>)</code>
may return 1 value or may return all the values of <i>form</i>; as always
the implementation is not constrained not to return extra values.
<code>(multiple-value-return <i>form</i>)</code> returns from a <code>prog</code>,
passing back all the values of <i>form</i>.
</p>
<p><code>do</code> behaves like <code>prog</code> with respect to <code>return</code>.
All the values of the last <i>exit-form</i> are returned.
[This is the &quot;right&quot; thing unless you think of the implementation
in terms of <code>return</code>; what should we do?] *******
</p>
<p><code>unwind-protect</code> does <i>not</i> pass back multiple values.
It clearly should, however this is currently difficult to implement.
This should be fixed later. *******
</p>
<a name="Evalhook"></a>
<h3 class="section">3.3 Evalhook</h3>

<dl>
<dt><a name="index-evalhook-3"></a>Variable: <strong>evalhook</strong></dt>
<dd><p>If the value of <code>evalhook</code> is non-<code>nil</code>, then special things
happen in the evaluator.  When a form (even an atom) is to be evaluated,
<code>evalhook</code> is bound to <code>nil</code> and the function which
was <code>evalhook</code>&rsquo;s value is applied to one argument&ndash;the form that was trying
to be evaluated.  The value it returns is then returned from the evaluator.
This feature is used by the <code>step</code> program (see (step-fun)).
</p></dd></dl>

<p><code>evalhook</code> is bound to <code>nil</code> by <code>break</code> and by
the error handler,
and <code>setq</code>&rsquo;ed
to <code>nil</code> by errors that go back to top level and print <code>*</code>.
This provides the ability to escape from this mode if something bad
happens.
</p>
<p>In order not to impair the efficiency of the Lisp interpreter,
several restrictions are imposed on <code>evalhook</code>.
It only applies to evaluation &ndash; whether in a read-eval-print loop,
internally in evaluating arguments in forms, or by explicit use
of the function <code>eval</code>.  It <i>does not</i> have any effect
on compiled function references, on use of the function <code>apply</code>,
or on the &quot;mapping&quot; functions.
(On the Lisp Machine, as opposed to Maclisp, it is not
necessary to do <code>(*rset t)</code> nor <code>(sstatus evalhook t)</code>.)
(Also, Maclisp&rsquo;s special-case check for <code>store</code> is not implemented.)
</p>
<dl>
<dt><a name="index-evalhook-2"></a>Function: <strong>evalhook</strong> <em>form hook</em></dt>
<dd><p><code>evalhook</code> is a function which helps
exploit the <code>evalhook</code> feature.  The <i>form</i> is evaluated
with <code>evalhook</code> lambda-bound to the functional form <code>hook</code>.
The checking of <code>evalhook</code> is bypassed in the evaluation
of <i>form</i> itself, but not in any subsidiary evaluations,
for instance of arguments in the <i>form</i>.
This is like a &quot;one-instruction proceed&quot; in a machine-language
debugger.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp"><span class="roman">;; This function evaluates a form while printing debugging information.</span>
(defun hook (x)
   (terpri)
   (evalhook x 'hook-function))

<span class="roman">;; Notice how this function calls <code>evalhook</code> to evaluate the form <code>f</code>,</span>
<span class="roman">;; so as to hook the sub-forms.</span>
(defun hook-function (f)
   (let ((v (evalhook f 'hook-function)))
     (format t &quot;form: ~s~%value: ~s~%&quot; f v)
     v))
</pre></div>

<p>The following output might be seen from <code>(hook '(cons (car '(a . b)) 'c))</code>:
</p>
<div class="lisp">
<pre class="lisp">form: (cons (car (quote (a . b))) (quote c))
form: (car (quote (a . b)))
form: (quote (a . b))
value: (a . b)
value: a
form: (quote c)
value: c
value: (a . c)

(a . c)
</pre></div>
</dd></dl>


<a name="Flow-of-Control"></a>
<h2 class="chapter">4 Flow of Control</h2>
<a name="index-control-structure"></a>
<a name="index-flow-of-control"></a>

<p>Lisp provides a variety of structures for flow of control.
</p>
<p>Function application is the basic method for construction of
programs.  Operations are written as the application of a function
to its arguments.  Usually, Lisp programs are written as a large collection
of small functions, each of which implements a simple operation.
These functions operate by calling one another, and so larger
operations are defined in terms of smaller ones.
</p>
<a name="index-recursion"></a>
<p>A function may always call itself in Lisp.  The calling of
a function by itself is known as <i>recursion</i>; it is analogous
to mathematical induction.
</p>
<a name="index-iteration"></a>
<p>The performing of an action repeatedly (usually with some
changes between repetitions) is called <i>iteration</i>, and is provided
as a basic control structure in most languages.  The <i>do</i> statement
of PL/I, the <i>for</i> statement of ALGOL/60, and so on are examples
of iteration primitives.  Lisp provides a general iteration facility
called <code>do</code>, which is explained below.
</p>
<a name="index-conditional"></a>
<p>A <i>conditional</i> construct is one which allows a program
to make a decision, and do one thing or another based on some logical
condition.  Lisp provides <code>and</code> and <code>or</code>, which are simple
conditionals, and <code>cond</code>, which is a more general conditional.
</p>
<a name="index-non_002dlocal-exit"></a>
<a name="index-exits"></a>
<p>Non-local exits are similar to the <i>leave</i>, <i>exit</i>, and
<i>escape</i> constructs in many modern languages.
They are similar to
a <i>return</i>, but are more general.  In Lisp, their scope is
determined at run-time.  They are implemented as the <code>catch</code> and
<code>*throw</code> functions.
</p>
<p>Lisp Machine Lisp also provides a multiple-process or coroutine capability.
This is explained in the section on <i>stack-groups</i> ((stack-group)).
</p>
<a name="Conditionals"></a>
<h3 class="section">4.1 Conditionals</h3>

<dl>
<dt><a name="index-and"></a>Special Form: <strong>and</strong></dt>
<dd><p><code>(and <i>form1 form2</i> ... )</code> evaluates the <i>form</i>s one at a time,
from left to right.  If any <i>form</i> evaluates to <code>nil</code>, <code>and</code>
immediately returns <code>nil</code> without evaluating the remaining
<i>forms</i>.  If all the <i>forms</i> evaluate non-<code>nil</code>, <code>and</code> returns
the value of the last <i>form</i>.  <code>and</code> can be used both for logical operations,
where <code>nil</code> stands for <i>False</i> and <code>t</code> stands for <i>True</i>, and as a
conditional expression.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(and x y)

(and (setq temp (assq x y))
     (rplacd temp z))

(and (not error-p)
     (princ &quot;There was no error.&quot;))
</pre></div>

<p>Note: <code>(and) =&gt; t</code>, which is the identity for this operation.
</p></dd></dl>

<dl>
<dt><a name="index-or"></a>Special Form: <strong>or</strong></dt>
<dd><p><code>(or <i>form1 form2</i> ...)</code> evaluates the <i>form</i>s one by one from left to right.
If a <i>form</i> evaluates to <code>nil</code>, <code>or</code> proceeds to evaluate the
next <i>form</i>.  If there are no more <i>form</i>s, <code>or</code> returns <code>nil</code>.
But if a <i>form</i> evaluates non-<code>nil</code>, <code>or</code> immediately returns
that value without evaluating any remaining <i>form</i>s.  <code>or</code> can
be used both for logical operations, where <code>nil</code> stands for False
and <code>t</code> for True, and as a conditional expression.
</p>
<p>Note:  <code>(or) =&gt; nil</code>, the identity for this operation.
</p></dd></dl>

<dl>
<dt><a name="index-cond"></a>Special Form: <strong>cond</strong></dt>
<dd><p>The <code>cond</code> special form consists of the symbol <code>cond</code> followed by
several <i>clauses</i>.  Each clause consists of a <i>predicate</i> followed
by zero or more <i>forms</i>.  Sometimes the predicate is called the
<i>antecedent</i> and the forms are called the <i>consequents</i>.
</p>
<div class="lisp">
<pre class="lisp">(cond (<i>antecedent consequent consequent</i>...)
      (<i>antecedent</i>)
      (<i>antecedent consequent</i> ...)
      ... )
</pre></div>

<p>The idea is that each clause represents a case which
is selected if its antecedent is satisfied and the antecedents
of all preceding clauses were not satisfied.  When a clause
is selected, its consequent forms are evaluated.
</p>
<p><code>cond</code> processes its clauses in order from left to right.  First,
the antecedent of the current clause is evaluated.  If the result is
<code>nil</code>, <code>cond</code> advances to the next clause.  Otherwise, the cdr of
the clause is treated as a list of forms, or consequents, which are
evaluated in order from left to right.  After evaluating the
consequents, <code>cond</code> returns without inspecting any remaining
clauses.  The value of the <code>cond</code> special form is the value of the
last consequent evaluated, or the value of the antecedent if there
were no consequents in the clause.  If <code>cond</code> runs out of clauses,
that is, if every antecedent is <code>nil</code>, that is, if no case is
selected, the value of the <code>cond</code> is <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">    (cond ((zerop x)    ;<span class="roman">First clause:</span>
           (+ y 3))     ; (zerop x)<span class="roman"> is the antecedent.</span>
                        ; (+ y 3)<span class="roman"> is the consequent.</span>
          ((null y)     ;<span class="roman">A clause with 2 consequents:</span>
           (setq y 4)   ;<span class="roman"> this</span>
           (cons x z))  ;<span class="roman"> and this.</span>
          (z)           ;<span class="roman">A clause with no consequents:</span>
                        ;<span class="roman"> the antecedent is just z.</span>
          (t            ;<span class="roman">An antecedent of </span>t
           105)         ;<span class="roman"> is always satisfied.</span>
       )                ;<span class="roman">This is the end of the cond.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-if"></a>Macro: <strong>if</strong></dt>
<dd><p><code>if</code> allows a simple &quot;if-then-else&quot; conditional to
be expressed as <code>(if <i>pred-form</i> <i>then-form</i> <i>else-form</i>)</code>.
<code>if</code> is provided for stylistic reasons; some people think
it looks nicer than <code>cond</code> for the simple case it handles.
<code>(if <i>x y z</i>)</code> expands into <code>(cond (<i>x</i> <i>y</i>) (t <i>z</i>))</code>.
</p></dd></dl>

<dl>
<dt><a name="index-selectq"></a>Macro: <strong>selectq</strong></dt>
<dd><p>Many programs require <code>cond</code> forms which check various
specific values of a form.
</p>
<div class="lisp">
<pre class="lisp"><span class="roman">A typical example:</span>
(cond ((eq x 'foo) ...)
      ((eq x 'bar) ...)
      ((memq x '(baz quux mum)) ...)
      (t ...))
</pre></div>

<p>The <code>selectq</code> macro can be used for such tests.
Its form is as follows:
</p>
<div class="lisp">
<pre class="lisp">(selectq <i>key-form</i>
         (<i>pattern consequent consequent</i> ...)
         (<i>pattern consequent consequent</i> ...)
         (<i>pattern consequent consequent</i> ...)
         ...)
</pre></div>

<p>Its first &quot;argument&quot; is a form, which is evaluated (only once) as the
first thing <code>selectq</code> does.  The resulting value is called the <i>key</i>.  It is
followed by any number of <i>clauses</i>.  The <code>car</code> of each clause is
compared with the key, and if it matches, the consequents of this
clause are evaluated, and <code>selectq</code> returns the value of the last
consequent.  If there are no matches, <code>selectq</code> returns <code>nil</code>.
Note that the patterns are <i>not</i> evaluated; if you want them to
be evaluated use <code>select</code> rather than <code>selectq</code>.
</p>
<p>A <i>pattern</i> may be any of:
</p>
<dl compact="compact">
<dt><span class="roman">1) A symbol</span></dt>
<dd><p>If the <i>key</i> is <code>eq</code> to the symbol, it matches.
</p></dd>
<dt><span class="roman">2) A number</span></dt>
<dd><p>If the <i>key</i> is <code>eq</code> to the number, it matches.
Only small numbers (<i>fixnums</i>) will work.
</p></dd>
<dt><span class="roman">3) A list</span></dt>
<dd><p>If the <i>key</i> is <code>eq</code> to one of the elements of the list,
then it matches.  The elements of the list should be symbols
or fixnums.
</p></dd>
<dt><span class="roman">4) <code>t</code> or <code>otherwise</code></span></dt>
<dd><p>The symbols <code>t</code> and <code>otherwise</code> are special keywords which match anything.
Either symbol may be used, it makes no difference.
<code>t</code> is accepted for compatibility with Maclisp&rsquo;s <code>caseq</code> construct.
</p></dd>
</dl>

<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(selectq x              ;<span class="roman">This is the same as the <code>cond</code> example</span>
         (foo ...)      ;<span class="roman"> above.</span>
         (bar ...)
         ((baz quux mum) ...)
         (otherwise ...))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-select"></a>Macro: <strong>select</strong></dt>
<dd><p><code>select</code> is the same as <code>selectq</code>, except that the elements of the
patterns are evaluated before they are used.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(select (frob x)
   (foo 1)
   ((bar baz) 2)
   (otherwise 3))
<span class="roman">is equivalent to</span>
(let ((var (frob x)))
  (cond ((eq var foo) 1)
        ((or (eq var bar) (eq var baz)) 2)
        (t 3)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-selector"></a>Macro: <strong>selector</strong></dt>
<dd><p><code>selector</code> is the same as <code>select</code>, except that you get to specify the function
used for the comparison instead of <code>eq</code>.  For example,
</p>
<div class="lisp">
<pre class="lisp">(selector (frob x) equal
   (('(one . two)) (frob-one x))
   (('(three . four)) (frob-three x))
   (otherwise (frob-any x)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-dispatch"></a>Macro: <strong>dispatch</strong></dt>
<dd><p><code>(dispatch <i>byte-specifier</i> <i>n</i> <i>clauses...</i>)</code> is the same
as <code>select</code> (not <code>selectq</code>), but the key is obtained by evaluating
<code>(ldb <i>byte-specifier n</i>)</code>.
<a name="index-ldb"></a>
<i>byte-specifier</i> and <i>n</i> are both evaluated.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(princ (dispatch 0202 cat-type
           (0 &quot;Siamese.&quot;)
           (1 &quot;Persian.&quot;)
           (2 &quot;Alley.&quot;)
           (3 (ferror nil
                      &quot;~S is not a known cat type.&quot;
                      cat-type))))
</pre></div>

<p>It is not necessary to include all possible values of the byte which
will be dispatched on.
[This function may get flushed.]
</p></dd></dl>

<a name="Iteration"></a>
<h3 class="section">4.2 Iteration</h3>
<a name="index-iteration-1"></a>

<dl>
<dt><a name="index-prog"></a>Special Form: <strong>prog</strong></dt>
<dd><p><code>prog</code> is a special form which provides temporary variables,
sequential evaluation of forms, and a &quot;goto&quot; facility.  A typical <code>prog</code>
looks like:
</p>
<div class="lisp">
<pre class="lisp">(prog (<i>var1 var2</i> (<i>var3 init3</i>) <i>var4</i> (<i>var5 init5</i>))
 <i>tag1</i>
     <i>statement1</i>
     <i>statement2</i>
 <i>tag2</i>
     <i>statement2</i>
     . . .
    )
</pre></div>

<p><i>var1, var2, ...</i> are temporary variables.  When the <code>prog</code> is entered, the
values of these variables are saved.  When the <code>prog</code> is finished,
the saved values are restored.  The initial value of a variable inside
the <code>prog</code> depends on whether the variable had an associated <i>init</i>
form or not; if it did, then the <i>init</i> form is evaluated and becomes
the initial value of the corresponding variable.  If there was no <i>init</i> form,
the variable is initialized to <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(prog ((a t)  b  (c 5)  (d (car '(zz . pp))))
      <i>&lt;body&gt;</i>
      )
</pre></div>

<p>The initial value of <code>a</code> is <code>t</code>, that of <code>b</code> is <code>nil</code>, that of <code>c</code> is
the fixnum 5, and that of <code>d</code> is the symbol <code>zz</code>.
The binding and initialization of the variables is done in
<i>parallel</i>; that is,
all the initial values are computed before any of the variables are changed.
</p>
<p>The part of a <code>prog</code> after the variable list is called the <i>body</i>.
An item in the body may be a symbol or a number, in which case it is called a
<i>tag</i>, or some other form (i.e. a list), in which case it is called a
<i>statement</i>.
</p>
<p>After <code>prog</code> binds the temporary variables, it processes each form
in its body sequentially.  <i>tags</i> are skipped over.  <i>Statements</i>
are evaluated, and their returned values discarded.  If the end of the body
is reached, the <code>prog</code> returns <code>nil</code>.  However, two special forms
may be used in <code>prog</code> bodies to alter the flow of control.
If <code>(return <i>x</i>)</code> is evaluated,
<code>prog</code> stops processing its body, evaluates <i>x</i>, and returns the result.
If <code>(go <i>tag</i>)</code> is evaluated, <code>prog</code> jumps to the part of the body
labelled with the <i>tag</i>.  <i>tag</i> is not evaluated.
The &quot;computed-<code>go</code>&quot; (mis)feature of Maclisp is not supported.
</p>
<p>The compiler requires that <code>go</code> and <code>return</code> forms be
<i>lexically</i> within the scope of the <code>prog</code>; it is not possible for
one function to <code>return</code> to a <code>prog</code> which is in progress in its
caller.  This restriction happens not to be enforced in the interpreter.
Thus, a program which contains a <code>go</code> which is not
contained within the body of a <code>prog</code> (or a <code>do</code>, see below)
cannot be compiled.  Since virtually all programs will be compiled
at some time, the restriction should be adhered to.
</p>
<p>Sometimes code which is lexically within more than one <code>prog</code>
(or <code>do</code>) form wants to <code>return</code> from one of the outer <code>prog</code>s.
However, the <code>return</code> function normally returns from the innermost
<code>prog</code>.  In order to make <code>return</code>ing from outer <code>prog</code>s more
convenient, a <code>prog</code> may be given a <i>name</i> by which it may be
referenced by a function called <code>return-from</code>, which is similar to
<code>return</code> but allows a particular <code>prog</code> to be specified.
If the first subform of a <code>prog</code> is a non-<code>nil</code> symbol
(rather than a variable list), it is the name of the <code>prog</code>.
See the description of the <code>return-from</code> special form,
on (return-from-fun).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(prog george (a b d)
      (prog (c b)
            ...
            (return-from george (cons b d))
            ...))
</pre></div>

<p>If the symbol <code>t</code> is used as the name
of a <code>prog</code>, then it will be made &quot;invisible&quot; to <code>return</code>s;
<code>return</code>s inside that <code>prog</code> will return to the next outermost level
whose name is not <code>t</code>.  <code>(return-from t ...)</code> will return
from a <code>prog</code> named <code>t</code>.
</p>
<p>See also the <code>do</code> special form, which uses a body similar to
<code>prog</code>. The <code>do</code>, <code>*catch</code>, and <code>*throw</code> special forms are
included in Lisp Machine Lisp as an attempt to encourage goto-less programming
style, which often leads to more readable, more easily maintained code.  The
programmer is recommended to use these functions instead of <code>prog</code>
wherever reasonable.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(prog (x y z)  ;x, y, z <span class="roman">are prog variables  - temporaries.</span>
   (setq y (car w) z (cdr w))     ;w<span class="roman"> is a free variable.</span>
loop
   (cond ((null y) (return x))
         ((null z) (go err)))
rejoin
   (setq x (cons (cons (car y) (car z))
                 x))
   (setq y (cdr y)
         z (cdr z))
   (go loop)
err
   (break are-you-sure? t)
   (setq z y)
   (go rejoin))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-prog_002a"></a>Special Form: <strong>prog*</strong></dt>
<dd><p>The <code>prog*</code> special form is almost the same as <code>prog</code>.  The only
difference is that the binding and initialization of the temporary
variables is done <i>sequentially</i>, so each one can depend on the
previous ones.  For example,
</p>
<div class="lisp">
<pre class="lisp">(prog ((y z) (x y)) (return x))
</pre></div>

<p>returns the value of <code>z</code>.
</p></dd></dl>

<dl>
<dt><a name="index-do"></a>Special Form: <strong>do</strong></dt>
<dd><p>The <code>do</code> special form provides a generalized iteration facility,
with an arbitrary number of &quot;index variables&quot; whose values are saved
when the <code>do</code> is entered and restored when it is left, i.e. they are
bound by the <code>do</code>.  The index variables are used in the iteration
performed by <code>do</code>.  At the beginning, they are initialized to
specified values, and then at the end of each trip around the loop the
values of the index variables are changed according to specified
rules.  <code>do</code> allows the programmer to specify a predicate which
determines when the iteration will terminate.  The value to be
returned as the result of the form may, optionally, be specified.
</p>
<p><code>do</code> comes in two varieties.
</p>
<p>The newer variety of
<code>do</code> looks like:
</p>
<div class="lisp">
<pre class="lisp">(do ((<i>var init repeat</i>)...)
    (<i>end-test exit-form</i>...)
    <i>body</i>...)
</pre></div>

<p>The first item in the form is a list of zero or more index variable
specifiers.  Each index variable specifier is a list of the name of a
variable <i>var</i>, an initial value <i>init</i>, which defaults to <code>nil</code>
if it is omitted, and a repeat value <i>repeat</i>.  If <i>repeat</i> is
omitted, the <i>var</i> is not changed between repetitions.
</p>
<p>In index variable specifier can also be just the name of a variable.
In this case, the variable has an initial value of <code>nil</code>, and is
not changed between repetitions.
</p>
<p>All assignment to the index variables is done in parallel.  At the
beginning of the first iteration, all the <i>init</i>s are evaluated,
then the <i>var</i>s are saved, then the <i>var</i>s are <i>set</i> to the
values of the <i>init</i>s.  To put it another way, the <i>var</i>s are
<code>lambda</code>-bound to the values of the <i>init</i>s.  Note that the
<i>init</i>s are evaluated <i>before</i> the <i>var</i>s are bound, i.e.
lexically <i>outside</i> of the <code>do</code>.
At the beginning of each succeeding iteration those <i>var</i>s that have
<i>repeat</i>s get <code>setq</code>&rsquo;ed to the values of their respective
<i>repeat</i>s.  Note that all the <i>repeat</i>s are evaluated before any
of the <i>var</i>s is changed.
</p>
<p>The second element of the <code>do</code>-form is a list of an end-testing
predicate <i>end-test</i>, and zero or more forms, called the
<i>exit-form</i>s.  At the beginning of each iteration, after processing
of the <i>repeat</i>s, the <i>end-test</i> is evaluated.  If the result is
<code>nil</code>, execution proceeds with the body of the <code>do</code>.  If the
result is not <code>nil</code>, the <i>exit-forms</i> are evaluated from left to
right and then <code>do</code> returns.  The value of the <code>do</code> is the value
of the last <i>exit-form</i>, or <code>nil</code> (<i>not</i> the value of the
<i>end-test</i> as you might expect) if there were no <i>exit-form</i>s.
Note that the second element of the <code>do</code>-form resembles a <code>cond</code>
clause.
</p>
<p>If the second element of the form is <code>nil</code>, there is no <i>end-test</i>
nor <i>exit-form</i>s, and the <i>body</i> of the <code>do</code> is executed only
once.  In this type of <code>do</code> it is an error to have <i>repeat</i>s.
This type of <code>do</code> is a &quot;<code>prog</code> with initial values.&quot;
</p>
<p>If the second element of the form is <code>(nil)</code>, the <i>end-test</i> is never
true and there are no <i>exit-form</i>s.  The <i>body</i> of the <code>do</code>
is executed over and over.
The infinite loop can be terminated by use of <code>return</code> or <code>*throw</code>.
</p>
<p>The remainder of the <code>do</code>-form constitutes a <code>prog</code>-body; that is,
<code>go</code>&rsquo;s and <code>return</code> forms are understood within the <code>do</code> body,
as if it were a <code>prog</code> body.  When the end of the body is reached,
the next iteration of the <code>do</code> begins.  If a <code>return</code> form is evaluated,
<code>do</code> returns the indicated value and no more iterations occur.
</p>
<p>The older variety of <code>do</code> is:
</p>
<div class="lisp">
<pre class="lisp">(do <i>var</i> <i>init</i> <i>repeat</i> <i>end-test</i> <i>body</i>...)
</pre></div>

<p>The first time through the loop <i>var</i> gets the value of <i>init</i>;
the remaining times through the loop it gets the value of <i>repeat</i>,
which is re-evaluated each time.  Note that <i>init</i> is evaluated
before the value of <i>var</i> is saved, i.e. lexically <i>outside</i> of the <code>do</code>.
Each time around the loop, after <i>var</i> is set,
<i>end-test</i> is evaluated.  If it is non-<code>nil</code>, the <code>do</code> finishes
and returns <code>nil</code>.  If the <i>end-test</i> evaluated to <code>nil</code>, the <i>body</i> of
the loop is executed.  The <i>body</i> is like a <code>prog</code> body.  <code>go</code>
may be used.  If <code>return</code> is used, its argument is the value of the
<code>do</code>.  If the end of the <code>prog</code> body is reached, another loop
begins.
</p>
<div class="lisp">
<pre class="lisp">Examples of the older variety of <code>do</code>:
</pre><pre class="lisp">(setq n (array-length foo-array))
(do i 0 (1+ i) (= i n)
  (aset 0 foo-array i))         <span class="roman">;zeroes out the array foo-array</span>

(do zz x (cdr zz) (or (null zz)
                      (zerop (f (car zz)))))
                   <span class="roman">; this applies f to each element of x
                   ; continuously until f returns zero.
                   ; Note that the <code>do</code> has no body.</span>

<span class="roman"><code>return</code> forms are often useful to do simple searches:</span>

(do i 0 (1+ i) (= i n)  <span class="roman">; Iterate over the length of <code>foo-array</code>.</span>
  (and (= (aref foo-array i) 5) <span class="roman">; If we find an element which
                                ;equals <code>5</code>,</span>
       (return i)))     <span class="roman">;  then return its index.</span>

</pre></div>

<div class="lisp">
<pre class="lisp">Examples of the new form of <code>do</code>:
</pre><pre class="lisp">(do ((i 0 (1+ i))       <span class="roman">; This is just the same as the above example,</span>
     (n (array-length foo-array)))
    ((= i n))           <span class="roman">; but written as a new-style <code>do</code>.</span>
  (aset 0 foo-array i))

(do ((z list (cdr z)) <span class="roman">; z starts as <code>list</code> and is <i>cdr</i>&rsquo;ed each time.</span>
     (y other-list)   <span class="roman">; y starts as <code>other-list</code>, and is unchanged by the do.</span>
     (x))             <span class="roman">; x starts as <code>nil</code> and is not changed by the <code>do</code>.</span>
    (nil)             <span class="roman">; The end-test is <code>nil</code>, so this is an infinite loop.</span>
  <i>body</i>)

(do ((x) (y) (z)) (nil) <i>body</i>)

<span class="roman">is like</span>

(prog (x y z) <i>body</i>)
<span class="roman">except that when it runs off the end of the <i>body</i>,
<code>do</code> loops but <code>prog</code> returns <code>nil</code>.

On the other hand,</span>

     (do ((x) (y) (z)) nil <i>body</i>)

<span class="roman">is identical to the <code>prog</code> above (it does not loop.)</span>
</pre></div>

<p>The construction
</p>
<div class="lisp">
<pre class="lisp">(do ((x e (cdr x))
     (oldx x x))
    ((null x))
  <i>body</i>)
</pre></div>

<p>exploits parallel assignment to index variables.  On the first
iteration, the value of <code>oldx</code> is whatever value <code>x</code> had before
the <code>do</code> was entered.  On succeeding iterations, <code>oldx</code> contains
the value that <code>x</code> had on the previous iteration.
</p>
<p>In either form of <code>do</code>, the <i>body</i> may contain no forms at all.
Very often an iterative algorithm can be most clearly expressed entirely
in the <i>repeats</i> and <i>exit-forms</i> of a new-style <code>do</code>,
and the <i>body</i> is empty.
</p>
<div class="lisp">
<pre class="lisp">(do ((x x (cdr x))
     (y y (cdr y))
     (z nil (cons (f x y) z))) ;<span class="roman">exploits parallel</span>
    ((or (null x) (null y))    ;<span class="roman"> assignment.</span>
     (nreverse z))             ;<span class="roman">typical use of </span>nreverse.
    )                          ;<span class="roman">no <code>do</code>-body required.</span>

<span class="roman">is like</span> (maplist 'f x y).
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-do_002dnamed"></a>Special Form: <strong>do-named</strong></dt>
<dd><p><code>do-named</code> is just like <code>do</code> except that its first subform
is a symbol, which is interpreted as the <i>name</i> of the <code>do</code>.
The <code>return-from</code> special form allows a <code>return</code> from
a particular <code>prog</code> or <code>do-named</code> when several are nested.
See the description of such names in the explanation of the <code>prog</code>
special form on (prog-fun), and that of <code>return-from</code> on (return-from-fun).
</p></dd></dl>

<dl>
<dt><a name="index-dotimes"></a>Special Form: <strong>dotimes</strong></dt>
<dd><p><code>dotimes</code> is a convenient abbreviation for the most common integer iteration.
<code>(dotimes (<i>index</i> <i>count</i>) <i>body...</i>)</code> performs <i>body</i>
the number of times given by the value of <i>count</i>, with <i>index</i> bound
to <code>0</code>, <code>1</code>, etc. on successive iterations.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(dotimes (i (// m n)
  (frob i))
</pre><pre class="lisp"><span class="roman">is equivalent to:</span>
</pre><pre class="lisp">(do ((i 0 (1+ i))
     (count (// m n)))
    (( i count))
  (frob i))
</pre><pre class="lisp"><span class="roman">except that the name <code>count</code> is not used.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-dolist"></a>Special Form: <strong>dolist</strong></dt>
<dd><p><code>dolist</code> is a convenient abbreviation for the most common list iteration.
<code>(dolist (<i>item</i> <i>list</i>) <i>body...</i>)</code> performs <i>body</i>
once for each element in the list which is the value of <i>list</i>, with
<i>item</i> bound to the successive elements.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(dolist (item (frobs foo))
  (mung item))
</pre><pre class="lisp"><span class="roman">is equivalent to:</span>
</pre><pre class="lisp">(do ((lst (frobs foo) (cdr lst))
     (item))
    ((null lst))
  (setq item (car lst))
  (mung item))
</pre><pre class="lisp"><span class="roman">except that the name <code>lst</code> is not used.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-go"></a>Special Form: <strong>go</strong></dt>
<dd><p>The <code>(go <i>tag</i>)</code> special form is used to do a &quot;go-to&quot; within the
body of a <code>do</code> or a <code>prog</code>.  The <i>tag</i> must be a symbol.
It is not evaluated. <code>go</code> transfers control to the point in the body labelled by a
tag <code>eq</code> to the one given.  If there is no such tag in the body, the
bodies of lexically containing <code>prog</code>s and <code>do</code>s (if any) are examined as well.
If no tag is found, an error is signalled.
</p>
<p>Note that the <code>go</code> form is a very special form: it does not ever
return a value.  A <code>go</code> form may not appear as an argument to a regular
function, but only at the top level of a <code>prog</code> or <code>do</code>,
or within certain special forms such as conditionals which are within
a <code>prog</code> or <code>do</code>.
A <code>go</code> as an argument to a regular function would be not only useless but
possibly meaningless.  The compiler does not bother to know how to compile it
correctly.  <code>return</code> and <code>*throw</code> are similar.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(prog (x y z)
  (setq x <i>some frob</i>)
loop
  <i>do something</i>
  (and <i>some predicate</i> (go endtag))
  <i>do something more</i>
  (and (minusp x) (go loop))
endtag
  (return z))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-return"></a>Function: <strong>return</strong> <em>arg</em></dt>
<dd><p><code>return</code> is used to return from a <code>prog</code> or a <code>do</code>.  The value
of <code>return</code>&rsquo;s argument is returned by <code>prog</code> or <code>do</code> as its
value.  In addition, <code>break</code> recognizes the typed-in S-expression
<code>(return <i>value</i>)</code> specially.  If this form is typed at a
<code>break</code>, <i>value</i> will be evaluated and returned as the value of
<code>break</code>.  If not at the top level of a form typed at a <code>break</code>,
and not inside a <code>prog</code> or <code>do</code>, <code>return</code> will cause an
error.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(do ((x x (cdr x))
     (n 0 (* n 2)))
    ((null x) n)
 (cond ((atom (car x))
        (setq n (1+ n)))
       ((memq (caar x) '(sys boom bleah))
        (return n))))
</pre></div>

<p><code>return</code> is, like <code>go</code>, a special form which does not return a value.
</p>
<p><code>return</code> can also be used to return multiple values from a <code>prog</code> or
<code>do</code>, by giving it multiple arguments.  For example,
</p>
<div class="lisp">
<pre class="lisp">(defun assqn (x table)
  (do ((l table (cdr l))
       (n 0 (1+ n)))
      ((null l) nil)
    (and (eq (caar l) x)
         (return (car l) n))))
</pre></div>

<p>This function is like <code>assq</code>, but it returns an additional value
which is the index in the table of the entry it found.
See the special forms <code>multiple-value</code> ((multiple-value-fun))
and <code>multiple-value-list</code> ((multiple-value-list-fun)).
</p></dd></dl>

<dl>
<dt><a name="index-return_002dfrom"></a>Special Form: <strong>return-from</strong></dt>
<dd><p>A <code>return-from</code> form looks like <code>(return-from <i>name form1 form2 form3</i>)</code>.
The <i>form</i>s are evaluated sequentially, and then are returned
from the innermost containing <code>prog</code> or <code>do-named</code> whose name
is <i>name</i>.  See the description of <code>prog</code> ((prog-fun)) in which
named <code>prog</code>s and <code>do</code>s are explained, and that of <code>do-named</code> ((do-named-fun)).
</p></dd></dl>

<dl>
<dt><a name="index-return_002dlist"></a>Function: <strong>return-list</strong> <em>list</em></dt>
<dd><p><i>list</i> must not be <code>nil</code>.  This function is like <code>return</code> except
that the <code>prog</code> returns all of the elements of <i>list</i>; if
<i>list</i> has more then one element, the <code>prog</code> does a multiple-value
return.
</p>
<p>To direct the returned values to a <code>prog</code> or <code>do-named</code> of a specific
name, use <code>(return-from <i>name</i> (return-list <i>list</i>))</code>.
</p></dd></dl>

<dl>
<dt><a name="index-multiple_002dvalue_002dreturn"></a>Special Form: <strong>multiple-value-return</strong></dt>
<dd><p><code>(multiple-value-return (<i>function</i> <i>arg1</i> <i>arg2</i> ...))</code>
applies the function to the arguments, and returns from the current <code>prog</code> or <code>do</code>
with the same values as <i>function</i> returns.
</p></dd></dl>

<dl>
<dt><a name="index-defunp"></a>Macro: <strong>defunp</strong></dt>
<dd><p>Usually when a function uses <code>prog</code>, the <code>prog</code> form is
the entire body of the function; the definition of such a function
looks like <code>(defun <i>name</i> <i>arglist</i> (prog <i>varlist</i> ...))</code>.
For convenience, the <code>defunp</code> macro can be used to produce such definitions.
A <code>defunp</code> form expands as follows:
</p>
<div class="lisp">
<pre class="lisp">(defunp fctn (args)
    form1
    form2
    ...
    formn)
</pre></div>

<p>expands into
</p>
<div class="lisp">
<pre class="lisp">(defun fctn (args)
  (prog nil
        form1
        form2
        ...
        (return formn)))
</pre></div>
</dd></dl>

<a name="Non_002dlocal-Exits"></a>
<h3 class="section">4.3 Non-local Exits</h3>
<a name="index-non_002dlocal-exit-1"></a>
<a name="index-catch"></a>
<a name="index-throw"></a>

<dl>
<dt><a name="index-_002acatch"></a>Function: <strong>*catch</strong> <em>tag form</em></dt>
<dd><p><code>*catch</code> is the Lisp Machine Lisp function for doing structured
non-local exits.  <code>(*catch <i>tag form</i>)</code> evaluates <i>form</i> and
returns its value, except that if, during the evaluation of <i>form</i>,
<code>(*throw <i>tag y</i>)</code> should be evaluated, <code>*catch</code> immediately returns
<i>y</i> without further evaluating <i>x</i>.  Note that the <i>form</i> argument
is <i>not</i> evaluated twice; the special action of <code>*catch</code> happens
during the evaluation of its arguments, not during the execution of <code>*catch</code>
itself.
</p>
<p>The <i>tag</i>&rsquo;s are used to match up <code>*throw</code>&rsquo;s with <code>*catch</code>&rsquo;s.
<code>(*catch 'foo <i>form</i>)</code> will catch a <code>(*throw 'foo <i>form</i>)</code> but
not a <code>(*throw 'bar <i>form</i>)</code>.  It is an error if <code>*throw</code> is done
when there is no suitable <code>*catch</code> (or <code>catch-all</code>; see below).
</p>
<p>The values <code>t</code> and <code>nil</code> for <i>tag</i> are special and mean that all
throws are to be caught.  These are used by <code>unwind-protect</code> and <code>catch-all</code>
respectively.  The only difference between <code>t</code> and <code>nil</code> is in the
error checking; <code>t</code> implies that after a &quot;cleanup handler&quot; is executed
control will be thrown again to the same tag, therefore it is an error if a specific
catch for this tag does not exist higher up in the stack.
</p>
<p><code>*catch</code> returns up to four values; trailing null values are not
returned for reasons of microcode simplicity, however the values not
returned will default to <code>nil</code> if they are received with the
<code>multiple-value</code> special form.
If the catch completes normally,
the first value is the value of <i>form</i> and the second is <code>nil</code>.
If a <code>*throw</code> occurs, the first value is the second argument to
<code>*throw</code>, and the second value is the first argument to <code>*throw</code>,
the tag thrown to.  The third and fourth values are the third and fourth
arguments to <code>*unwind-stack</code> if that was used in place of <code>*throw</code>,
otherwise <code>nil</code>.
To summarize, the four values returned by <code>*catch</code> are the value,
the tag, the active-frame-count, and the action.
</p>
<div class="lisp">
<pre class="lisp">Example
</pre><pre class="lisp">(*catch 'negative
        (mapcar (function (lambda (x)
                            (cond ((minusp x)
                                   (*throw 'negative x))
                                  (t (f x)) )))
               y)
     )
</pre></div>

<p>which returns a list of <code>f</code> of each element of <code>y</code> if they are all
positive, otherwise the first negative member of <code>y</code>.
</p>
<p>Note: The Lisp Machine Lisp functions <code>*catch</code> and <code>*throw</code> are
improved versions of the Maclisp functions <code>catch</code> and <code>throw</code>.
The Maclisp ones are similar in purpose, but take their arguments in
reversed order, do not evaluate the <i>tag</i>, and may be used in an older form
in which no <i>tag</i> is supplied.  Compatibility macros are supplied so
that programs using the Maclisp functions will work.
</p></dd></dl>

<dl>
<dt><a name="index-_002athrow"></a>Function: <strong>*throw</strong> <em>tag value</em></dt>
<dd><p><code>*throw</code> is used with <code>*catch</code> as a structured non-local exit mechanism.
</p>
<p><code>(*throw <i>tag x</i>)</code> throws the value of <i>x</i> back to the most recent <code>*catch</code>
labelled with <i>tag</i> or <code>t</code> or <code>nil</code>.  Other <code>*catches</code> are skipped over.
Both <i>x</i> and <i>tag</i> are evaluated, unlike the Maclisp <code>throw</code> function.
</p>
<p>The values <code>t</code> and <code>nil</code> for <i>tag</i> are reserved.  <code>nil</code> may not
be used, because it would cause an ambiguity in the returned values of <code>*catch</code>.
<code>t</code> invokes a special feature whereby the entire stack is unwound, and then
a coroutine transfer to the invoking stack-group is done.  During this process
<code>unwind-protect</code>s receive control, but <code>catch-all</code>s do not.  This feature
is provided for the benefit of system programs which want to completely unwind a stack.
It leaves the stack-group in a somewhat inconsistent state; it is best to
do a <code>stack-group-preset</code> immediately afterwards.
</p>
<p>See the description of <code>*catch</code> for further details.
</p></dd></dl>

<dl>
<dt><a name="index-catch-1"></a>Macro: <strong>catch</strong></dt>
<dt><a name="index-throw-1"></a>Macro: <strong>throw</strong></dt>
<dd><p><code>catch</code> and <code>throw</code> are provided only for Maclisp compatibility.
They expand as follows:
</p>
<div class="lisp">
<pre class="lisp">(catch <i>form</i> <i>tag</i>) ==&gt; (*catch (quote <i>tag</i>) <i>form</i>)
(throw <i>form</i> <i>tag</i>) ==&gt; (*throw (quote <i>tag</i>) <i>form</i>)
</pre></div>

<p>The forms of <code>catch</code> and <code>throw</code> without tags are not supported.
</p></dd></dl>

<a name="index-unwinding-a-stack"></a>
<dl>
<dt><a name="index-_002aunwind_002dstack"></a>Function: <strong>*unwind-stack</strong> <em>tag value active-frame-count action</em></dt>
<dd><p>This is a generalization of <code>*throw</code> provided for program-manipulating
programs such as the error handler.
</p>
<p><i>tag</i> and <i>value</i> are the same as the corresponding arguments to
<code>*throw</code>.
</p>
<p><i>active-frame-count</i>, if non-<code>nil</code>, is the number of frames
to be unwound.  If this counts down to zero before a suitable <code>*catch</code>
is found, the <code>*unwind-stack</code> terminates and
<i>that frame</i> returns <i>value</i> to whoever called it.
This is similar to Maclisp&rsquo;s <code>freturn</code> function.
<a name="index-freturn"></a>
</p>
<p>If <i>action</i> is non-<code>nil</code>, whenever the <code>*unwind-stack</code> would be
ready to terminate (either due to <i>active-frame-count</i> or due to
<i>tag</i> being caught as in <code>*throw</code>), instead, a stack-group call is
forced to the previous stack-group, generally the error handler.  The
unwound stack-group is left in <i>awaiting-return</i> state, such that the
value returned when the stack-group is resumed will become the value
returned by the frame, (i.e. the <i>value</i> argument to
<code>*unwind-stack</code> will be ignored in this case, and the value passed to
the stack group when it is resumed will be used instead.)
</p>
<p>Note that if both <i>active-frame-count</i> and <i>action</i> are <code>nil</code>,
<code>*unwind-stack</code> is identical to <code>*throw</code>.
</p></dd></dl>

<a name="index-unwind-protection"></a>
<a name="index-cleanup-handlers"></a>
<dl>
<dt><a name="index-unwind_002dprotect"></a>Macro: <strong>unwind-protect</strong></dt>
<dd><p>Sometimes it is necessary to evaluate a form and make sure that
certain side-effects take place after the form is evaluated;
a typical example is:
</p>
<div class="lisp">
<pre class="lisp">(progn
   (turn-on-water-faucet)
   (hairy-function 3 nil 'foo)
   (turn-off-water-faucet))
</pre></div>

<p>The non-local exit facility of Lisp creates a situation in which
the above code won&rsquo;t work, however: if <code>hairy-function</code> should
do a <code>*throw</code> to a <code>*catch</code> which is outside of the <code>progn</code>
form, then <code>(turn-off-water-faucet)</code> will never be evaluated
(and the faucet will presumably be left running).
</p>
<p>In order to allow the above program to work, it can
be rewritten using <code>unwind-protect</code> as follows:
</p>
<div class="lisp">
<pre class="lisp">(unwind-protect
  (progn (turn-on-water-faucet)
         (hairy-function 3 nil 'foo))
  (turn-off-water-faucet))
</pre></div>

<p>If <code>hairy-function</code> does a <code>*throw</code> which attempts to quit
out of the evaluation of the <code>unwind-protect</code>, the
<code>(turn-off-water-faucet)</code> form will be evaluated in between
the time of the <code>*throw</code> and the time at which the <code>*catch</code> returns.
If the <code>progn</code> returns normally, then the <code>(turn-off-water-faucet)</code>
is evaluated, and the <code>unwind-protect</code> returns the result of the <code>progn</code>.
One thing to note is that <code>unwind-protect</code> cannot return multiple values.
</p>
<p>The general form of <code>unwind-protect</code> looks like
</p>
<div class="lisp">
<pre class="lisp">(unwind-protect <i>protected-form</i>
                <i>form1</i>
                <i>form2</i>
                ...)
</pre></div>

<p><i>protected-form</i> is evaluated, and when it returns or when it
attempts to quit out of the <code>unwind-protect</code>, the <i>form</i>s
are evaluated.
</p></dd></dl>

<dl>
<dt><a name="index-let_002dglobally"></a>Macro: <strong>let-globally</strong></dt>
<dd><p><code>let-globally</code> is similar in form to <code>let</code> (see (let-fun)).
The difference is that <code>let-globally</code> does not <i>bind</i> the
variables; instead, it <i>sets</i> them, and sets up an <code>unwind-protect</code>
(see (unwind-protect-fun)) to set them back.  The important
difference between <code>let-globally</code> and <code>let</code> is that when
the current stack group (see (stack-group)) cocalls some other stack
group, the old values of the variables are <i>not</i> restored.
</p></dd></dl>

<dl>
<dt><a name="index-catch_002dall"></a>Macro: <strong>catch-all</strong></dt>
<dd><p><code>(catch-all <i>form</i>)</code> is like <code>(*catch <i>some-tag form</i>)</code>
except that it will catch a
<code>*throw</code> to any tag at all.  Since the tag thrown to
is the second returned value, the caller of <code>catch-all</code> may continue
throwing to that tag if he wants.  The one thing that <code>catch-all</code>
will not catch is a <code>*throw</code> to <code>t</code>.
<code>catch-all</code> is a macro which expands into <code>*catch</code> with a <i>tag</i> of <code>nil</code>.
</p></dd></dl>

<a name="Mapping"></a>
<h3 class="section">4.4 Mapping</h3>
<a name="index-mapping"></a>

<dl>
<dt><a name="index-map"></a>Function: <strong>map</strong> <em>fcn &amp;rest lists</em></dt>
<dt><a name="index-mapc"></a>Function: <strong>mapc</strong> <em>fcn &amp;rest lists</em></dt>
<dt><a name="index-maplist"></a>Function: <strong>maplist</strong> <em>fcn &amp;rest lists</em></dt>
<dt><a name="index-mapcar"></a>Function: <strong>mapcar</strong> <em>fcn &amp;rest lists</em></dt>
<dt><a name="index-mapcon"></a>Function: <strong>mapcon</strong> <em>fcn &amp;rest lists</em></dt>
<dt><a name="index-mapcan"></a>Function: <strong>mapcan</strong> <em>fcn &amp;rest lists</em></dt>
<dd><p>Mapping is a type of iteration in which a function is
successively applied to pieces of a list.
There are several options for the way in which the pieces of the list are
chosen and for what is done with the results returned by the applications of
the function.
</p>
<p>For example, <code>mapcar</code> operates on successive <i>elements</i> of the list.
As it goes down the list, it calls the function giving it an element
of the list as its one argument:  first the <code>car</code>, then the
<code>cadr</code>, then the <code>caddr</code>, etc., continuing until the end of the
list is reached.  The value returned by <code>mapcar</code> is a list of the
results of the successive calls to the function.  An example of the
use of <code>mapcar</code> would be <code>mapcar</code>&rsquo;ing the function <code>abs</code> over
the list <code>(1 -2 -4.5 6.0e15 -4.2)</code>, which would be written as
<code>(mapcar (function abs) '(1 -2 -4.5 6.0e15 -4.2))</code>.
The result is <code>(1 2 4.5 6.0e15
4.2)</code>.
</p>
<p>In general, the mapping functions take any number of arguments.  For example,
</p>
<div class="lisp">
<pre class="lisp">(mapcar <i>f x1 x2 ... xn</i>)
</pre></div>

<p>In this case <i>f</i> must be a function of <i>n</i> arguments.
<code>mapcar</code> will proceed
down the lists <i>x1, x2, ..., xn</i> in parallel.
The first argument to <i>f</i> will
come from <i>x1</i>, the second from <i>x2</i>, etc.
The iteration stops as soon as
any of the lists is exhausted.
</p>
<p>There are five other mapping functions besides <code>mapcar</code>.  <code>maplist</code>
is like <code>mapcar</code> except that the function is applied to the list and
successive cdr&rsquo;s of that list rather than to successive elements of the
list.  <code>map</code> and <code>mapc</code> are like <code>maplist</code> and <code>mapcar</code>
respectively, except that they don&rsquo;t return any useful value.  These
functions are used when the function is being called merely for its
side-effects, rather than its returned values.  <code>mapcan</code> and
<code>mapcon</code> are like <code>mapcar</code> and <code>maplist</code> respectively, except
that they combine the results of the function using <code>nconc</code> instead
of <code>list</code>.  That is,
</p>
<div class="lisp">
<pre class="lisp">(defun mapcon (f x y)
    (apply 'nconc (maplist f x y)))
</pre></div>

<p>Of course, this definition is less general than the real one.
</p>
<p>Sometimes a <code>do</code> or a straightforward recursion is preferable to a
map;  however, the mapping functions should be used wherever they
naturally apply because this increases the clarity of the code.
</p>
<p>Often <i>f</i> will be a lambda-expression, rather than a symbol;
for example,
</p>
<div class="lisp">
<pre class="lisp">(mapcar (function (lambda (x) (cons x something)))
        some-list)
</pre></div>

<p>The functional argument to a mapping function must be acceptable
to <code>apply</code> - it cannot be a macro or the name of a special form.
Of course, there is nothing wrong with using functions which have optional
and rest parameters.
</p>
<p>Here is a table showing the relations between
the six map functions.
</p>
<pre class="verbatim">                              applies function to

                         |  successive  |   successive  |
                         |   sublists   |    elements   |
          ---------------+--------------+---------------+
              its own    |              |               |
              second     |     map      |     mapc      |
             argument    |              |               |
          ---------------+--------------+---------------+
            list of the  |              |               |
returns      function    |    maplist   |    mapcar     |
              results    |              |               |
          ---------------+--------------+---------------+
            nconc of the |              |               |
              function   |    mapcon    |    mapcan     |
              results    |              |               |
          ---------------+--------------+---------------+
</pre>
<p>There are also functions (<code>mapatoms</code> and <code>mapatoms-all</code>)
for mapping over all symbols in certain
packages.  See the explanation of packages ((package)).
</p></dd></dl>


<a name="Manipulating-List-Structure"></a>
<h2 class="chapter">5 Manipulating List Structure</h2>
<a name="index-conses"></a>
<a name="index-lists"></a>

<a name="Conses"></a>
<h3 class="section">5.1 Conses</h3>

<dl>
<dt><a name="index-car"></a>Function: <strong>car</strong> <em>x</em></dt>
<dd><p>Returns the <i>car</i> of <i>x</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(car '(a b c)) =&gt; a
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-cdr"></a>Function: <strong>cdr</strong> <em>x</em></dt>
<dd><p>Returns the <i>cdr</i> of <i>x</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(cdr '(a b c)) =&gt; (b c)
</pre></div>
</dd></dl>

<p>Officially <code>car</code> and <code>cdr</code> are only applicable to conses and locatives.
However, as a matter of convenience, a degree of control is provided
over the action taken when there is an attempt to apply one of them to
a symbol or a number.  There are four mode-switches known as the
<i>car-number mode, cdr-number mode, car-symbol mode,</i> and
<i>cdr-symbol mode</i>.  Here are the meanings of the values of these
mode switches:
</p>
<dl compact="compact">
<dt><span class="roman">car-number = 0</span></dt>
<dd><p><i>car</i> of a number is an error. This is the default.
</p></dd>
<dt><span class="roman">car-number = 1</span></dt>
<dd><p><i>car</i> of a number is <code>nil</code>.
</p></dd>
<dt><span class="roman">cdr-number = 0</span></dt>
<dd><p><i>cdr</i> of a number is an error. This is the default.
</p></dd>
<dt><span class="roman">cdr-number = 1</span></dt>
<dd><p><i>cdr</i> of a number is <code>nil</code>.
</p></dd>
<dt><span class="roman">car-symbol = 0</span></dt>
<dd><p><i>car</i> of a symbol is an error.
</p></dd>
<dt><span class="roman">car-symbol = 1</span></dt>
<dd><p><i>car</i> of <code>nil</code> is <code>nil</code>, but the <i>car</i> of any other
symbol is an error.  This is the default.
</p></dd>
<dt><span class="roman">car-symbol = 2</span></dt>
<dd><p><i>car</i> of any symbol is <code>nil</code>.
</p></dd>
<dt><span class="roman">car-symbol = 3</span></dt>
<dd><p><i>car</i> of a symbol is its print-name.
</p></dd>
<dt><span class="roman">cdr-symbol = 0</span></dt>
<dd><p><i>cdr</i> of a symbol is an error.
</p></dd>
<dt><span class="roman">cdr-symbol = 1</span></dt>
<dd><p><i>cdr</i> of <code>nil</code> is <code>nil</code>, but the <i>cdr</i> of any other
symbol is an error.  This is the default.
</p></dd>
<dt><span class="roman">cdr-symbol = 2</span></dt>
<dd><p><i>cdr</i> of any symbol is <code>nil</code>.
</p></dd>
<dt><span class="roman">cdr-symbol = 3</span></dt>
<dd><p><i>cdr</i> of <code>nil</code> is <code>nil</code>, <i>cdr</i> of
any other symbol is its property list.
</p></dd>
</dl>

<p>The values of the mode switches can be altered with the function <code>set-error-mode</code>
(see (set-error-mode-fun)).
<a name="index-set_002derror_002dmode"></a>
They are stored as byte fields in the special variable <code>%m-flags</code>.
<a name="index-_0025m_002dflags"></a>
The reason that the two <i>symbol</i> modes default in that fashion is
to allow programs to <code>car</code> and <code>cdr</code> off the ends of lists without
having to check, which is sometimes useful.  A few system functions depend
on <code>car</code> and <code>cdr</code> of <code>nil</code> being <code>nil</code>, although they
hadn&rsquo;t ought to, so things may break if you change these modes.
</p>
<p>The value of 3 for the <i>symbol</i> modes
exists for compatibility with ancient versions of Maclisp, and should not be used for
any other reasons.  (The appropriate functions are <code>get-pname</code>
(see (get-pname-fun)) and <code>plist</code> (see (plist-fun)).)
<a name="index-get_002dpname"></a>
<a name="index-plist"></a>
Note: unlike Maclisp, the values of the symbols <code>car</code> and <code>cdr</code> are not
used; the various mode switches above serve their purpose.
<a name="index-car-1"></a>
<a name="index-cdr-1"></a>
Also unlike Maclisp, this error checking is always done, even in compiled code,
regardless of the value of <code>*rset</code>.
<a name="index-_002arset-1"></a>
</p>
<dl>
<dt><a name="index-c_002e_002e_002er"></a>Function: <strong>c...r</strong> <em>x</em></dt>
<dd><a name="index-caaaar"></a>
<a name="index-caaadr"></a>
<a name="index-caaar"></a>
<a name="index-caadar"></a>
<a name="index-caaddr"></a>
<a name="index-caadr"></a>
<a name="index-caar"></a>
<a name="index-cadaar"></a>
<a name="index-cadadr"></a>
<a name="index-cadar"></a>
<a name="index-caddar"></a>
<a name="index-cadddr"></a>
<a name="index-caddr"></a>
<a name="index-cadr"></a>
<a name="index-cdaaar"></a>
<a name="index-cdaadr"></a>
<a name="index-cdaar"></a>
<a name="index-cdadar"></a>
<a name="index-cdaddr"></a>
<a name="index-cdadr"></a>
<a name="index-cdar"></a>
<a name="index-cddaar"></a>
<a name="index-cddadr"></a>
<a name="index-cddar"></a>
<a name="index-cdddar"></a>
<a name="index-cddddr"></a>
<a name="index-cdddr"></a>
<a name="index-cddr"></a>
<p>All of the compositions of up to four <i>car</i>&rsquo;s and <i>cdr</i>&rsquo;s are defined as
functions in their own right.  The names of these functions begin with &quot;<code>c</code>&quot; and end
with &quot;<code>r</code>&quot;, and in between is a sequence of &quot;<code>a</code>&quot;&rsquo;s and &quot;<code>d</code>&quot;&rsquo;s corresponding to
the composition performed by the function.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(cddadr x) <span class="roman">is the same as</span> (cdr (cdr (car (cdr x))))
</pre></div>

<p>The error checking for these functions is exactly the same as for <code>car</code> and <code>cdr</code>
above.
</p></dd></dl>

<dl>
<dt><a name="index-cons-1"></a>Function: <strong>cons</strong> <em>x y</em></dt>
<dd><p><code>cons</code> is the primitive function to create a new <i>cons</i>, whose
<i>car</i> is <i>x</i> and whose <i>cdr</i> is <i>y</i>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(cons 'a 'b) =&gt; (a . b)
(cons 'a (cons 'b (cons 'c nil))) =&gt; (a b c)
(cons 'a '(b c d)) =&gt; (a b c d)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-ncons"></a>Function: <strong>ncons</strong> <em>x</em></dt>
<dd><p><code>(ncons <i>x</i>)</code> is the same as <code>(cons <i>x</i> nil)</code>.
The name of the function is from &quot;nil-cons&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-xcons"></a>Function: <strong>xcons</strong> <em>x y</em></dt>
<dd><p><code>xcons</code> (&quot;exchanged cons&quot;) is like <code>cons</code> except that the order of
the arguments is reversed.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(xcons 'a 'b) =&gt; (b . a)
</pre></div>

<p>There are two reasons this exists: one is that you might want the arguments
to <code>cons</code> evaluated in the other order, and the other is that the compiler
might convert calls to <code>cons</code> into calls to <code>xcons</code> for efficiency.  In fact,
it doesn&rsquo;t.
</p></dd></dl>

<dl>
<dt><a name="index-cons_002din_002darea"></a>Function: <strong>cons-in-area</strong> <em>x y area-number</em></dt>
<dd><a name="index-area"></a>
<p>This function creates a <i>cons</i> in a specific <i>area</i>.  (<i>Areas</i>
are an advanced feature of storage management; if you aren&rsquo;t interested in them,
you can safely skip all this stuff).  The first two arguments are the same as the
two arguments to <code>cons</code>,  and the third is the number of the area in which
to create the <i>cons</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(cons-in-area 'a 'b my-area) =&gt; (a . b)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-ncons_002din_002darea"></a>Function: <strong>ncons-in-area</strong> <em>x area-number</em></dt>
<dd><p><code>(ncons-in-area <i>x area-number</i>)</code> = <code>(cons-in-area <i>x</i> nil <i>area-number</i>)</code>
</p></dd></dl>

<dl>
<dt><a name="index-xcons_002din_002darea"></a>Function: <strong>xcons-in-area</strong> <em>x y area-number</em></dt>
<dd><p><code>(xcons-in-area <i>x y area-number</i>) = (cons-in-area <i>y x area-number</i>)</code>
</p></dd></dl>

<p>The backquote reader macro facility is also generally useful
for creating list structure, especially mostly-constant list structure,
or forms constructed by plugging variables into a template.
It is documented in the chapter on Macros, see (macro).
</p>
<dl>
<dt><a name="index-car_002dlocation"></a>Function: <strong>car-location</strong> <em>cons</em></dt>
<dd><p><code>car-location</code> returns a locative pointer to the cell containing
the car of <i>cons</i>.
</p></dd></dl>

<p>Note: there is no <code>cdr-location</code> function; it is difficult
because of the cdr-coding scheme.
</p>
<a name="Lists"></a>
<h3 class="section">5.2 Lists</h3>
<a name="index-cons-vs-list"></a>

<p>The following section explains some of the basic functions
provided for dealing with <i>lists</i>.  There has been some confusion
about the term <i>list</i> ever since the beginnings of the language: for
the purposes of the following descriptions, a list is the symbol
<code>nil</code>, or a cons whose cdr is a list.  Note well that although we
consider <code>nil</code> to be a <i>list</i> (the list of zero elements), it is a
symbol and not a cons, and the <code>listp</code> predicate is not true of it
(but perhaps <code>listp</code> will be changed in the future).
</p>
<dl>
<dt><a name="index-last"></a>Function: <strong>last</strong> <em>list</em></dt>
<dd><p><code>last</code> returns the last cons of <i>list</i>.  If <i>list</i> is <code>nil</code>,
it returns <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x '(a b c d))
(last x) =&gt; (d)
(rplacd (last x) '(e f))
x =&gt; '(a b c d e f)
</pre></div>

<p><code>last</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun last (x)
    (cond ((atom x) x)
          ((atom (cdr x)) x)
          ((last (cdr x))) ))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-length"></a>Function: <strong>length</strong> <em>list</em></dt>
<dd><p><code>length</code> returns the length of <i>list</i>.  The length of a list
is the number of top-level conses in it.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(length nil) =&gt; 0
(length '(a b c d)) =&gt; 4
(length '(a (b c) d)) =&gt; 3
</pre></div>

<p><code>length</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun length (x)
    (cond ((atom x) 0)
          ((1+ (length (cdr x)))) ))
<span class="roman">or by:</span>

(defun length (x)
    (do ((n 0 (1+ n))
         (y x (cdr y)))
        ((atom y) n) ))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-first"></a>Macro: <strong>first</strong></dt>
<dt><a name="index-second"></a>Macro: <strong>second</strong></dt>
<dt><a name="index-third"></a>Macro: <strong>third</strong></dt>
<dt><a name="index-fourth"></a>Macro: <strong>fourth</strong></dt>
<dt><a name="index-fifth"></a>Macro: <strong>fifth</strong></dt>
<dt><a name="index-sixth"></a>Macro: <strong>sixth</strong></dt>
<dt><a name="index-seventh"></a>Macro: <strong>seventh</strong></dt>
<dd><div class="lisp">
<pre class="lisp">(first x) ==&gt; (car x)
(second x) ==&gt; (cadr x)
(third x) ==&gt; (caddr x)
(fourth x) ==&gt; (cadddr x)
<span class="roman">etc.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-rest1"></a>Macro: <strong>rest1</strong></dt>
<dt><a name="index-rest2"></a>Macro: <strong>rest2</strong></dt>
<dt><a name="index-rest3"></a>Macro: <strong>rest3</strong></dt>
<dt><a name="index-rest4"></a>Macro: <strong>rest4</strong></dt>
<dd><div class="lisp">
<pre class="lisp">(rest1 x) ==&gt; (cdr x)
(rest2 x) ==&gt; (cddr x)
(rest3 x) ==&gt; (cdddr x)
(rest4 x) ==&gt; (cddddr x)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-nth"></a>Function: <strong>nth</strong> <em>n list</em></dt>
<dd><p><code>(nth <i>n list</i>)</code> returns the <i>n</i>&rsquo;th element of <i>list</i>, where
the zeroth element is the <i>car</i> of the list.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(nth 1 '(foo bar gack)) =&gt; bar
(nth 3 '(foo bar gack)) =&gt; nil
</pre></div>

<p>Note: this is not the same as the InterLisp function called <code>nth</code>,
which is similar to but not exactly the same as the Lisp Machine function
<code>nthcdr</code>.
Also, some people have used macros and functions called <code>nth</code> of their own in
their Maclisp programs, which may not work the same way; be careful.
</p>
<p><code>nth</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun nth (n list)
  (do ((i n (1- i))
       (l list (cdr l)))
      ((zerop i) (car l))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-nthcdr"></a>Function: <strong>nthcdr</strong> <em>n list</em></dt>
<dd><p><code>(nthcdr <i>n list</i>)</code> <i>cdr</i>s <i>list</i> <i>n</i> times,
and returns the result.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(nthcdr 0 '(a b c)) =&gt; (a b c)
(nthcdr 2 '(a b c)) =&gt; (c)
</pre></div>

<p>In other words, it returns the <i>n</i>&rsquo;th <i>cdr</i> of the list.
This is the similar to InterLisp&rsquo;s function <code>nth</code>, except that the
InterLisp function is one-based instead of zero-based; see the
InterLisp manual for details.
<code>nthcdr</code> is defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun nthcdr (n list)
    (do ((i 0 (1+ i))
         (list list (cdr list)))
        ((= i n) list)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-list"></a>Function: <strong>list</strong> <em>&amp;rest args</em></dt>
<dd><p><code>list</code> constructs and returns a list of its arguments.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(list 3 4 'a (car '(b . c)) (+ 6 -2)) =&gt; (3 4 a b 4)
</pre></div>

<p><code>list</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun list (&amp;rest args)
    (let ((list (make-list default-cons-area (length args))))
      (do ((l list (cdr l))
           (a args (cdr a)))
          ((null a) list)
        (rplaca l (car a)))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-list_002a"></a>Function: <strong>list*</strong> <em>&amp;rest args</em></dt>
<dd><p><code>list*</code> is like <code>list</code> except that the last <i>cons</i>
of the constructed list is &quot;dotted&quot;.  It must be given at least
two arguments.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(list* 'a 'b 'c 'd) =&gt; (a b c . d)
<span class="roman">This is like</span>
(cons 'a (cons 'b (cons 'c 'd)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-list_002din_002darea"></a>Function: <strong>list-in-area</strong> <em>area-number &amp;rest args</em></dt>
<dd><p><code>list-in-area</code> is exactly the same as <code>list</code> except that it takes
an extra argument, an area number, and creates the list in that area.
</p></dd></dl>

<dl>
<dt><a name="index-make_002dlist"></a>Function: <strong>make-list</strong> <em>area size</em></dt>
<dd><p>This creates and returns a list containing <i>size</i> elements, each
of which is <code>nil</code>.  <i>size</i> should be a fixnum.  The list
is allocated in the area specified; if you are not using areas in any special
way, just use the value of the symbol <code>default-cons-area</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(make-list default-cons-area 3) =&gt; (nil nil nil)
</pre></div>

<p>Of course, this function is not usually used when the value of the second argument
is a constant; if you want a list of three <code>nil</code>s, it is easy enough
to type <code>(nil nil nil)</code>.  <code>make-list</code> is used when the number
of elements is to be computed while the program is being run.
</p>
<p><code>make-list</code> and <code>cons</code> are the two primitive list-creation functions
which all the other functions call.  The difference is that <code>make-list</code>
creates a <i>cdr-coded</i> list (see (cdr-code)).
</p></dd></dl>

<dl>
<dt><a name="index-circular_002dlist"></a>Function: <strong>circular-list</strong> <em>&amp;rest args</em></dt>
<dd><p><code>circular-list</code> constructs a circular list whose elements are <code>args</code>, repeated
infinitely.  <code>circular-list</code> is the same as <code>list</code> except that the list itself
is used as the last cdr, instead of <code>nil</code>.
<code>circular-list</code> is especially useful with <code>mapcar</code>, as in the expression
</p>
<div class="lisp">
<pre class="lisp">(mapcar (function +) foo (circular-list 5))
</pre></div>

<p>which adds each element of <code>foo</code> to 5.
</p></dd></dl>

<dl>
<dt><a name="index-append"></a>Function: <strong>append</strong> <em>&amp;rest lists</em></dt>
<dd><p>The arguments to <code>append</code> are lists.  The result is a list which is the
concatenation of the arguments.
The arguments are not changed (cf. <code>nconc</code>).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(append '(a b c) '(d e f) nil '(g)) =&gt; (a b c d e f g)
</pre></div>

<p>Note that <code>append</code> copies the top-level list structure of each of its
arguments except the last.  Thus, to copy
a list but not its elements, use <code>(append <i>x</i> nil)</code>.
The <code>copylist</code> function is equivalent.
</p>
<p>A version of <code>append</code> which only accepts two arguments could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun append2 (x y)
    (cond ((null x) y)
          ((cons (car x) (append2 (cdr x) y)) )))
</pre></div>

<p>The generalization to any number of arguments could then be made:
</p>
<div class="lisp">
<pre class="lisp">(defun append (&amp;rest args)
    (and args (append2 (car args)
                       (apply (function append) (cdr args)))))
</pre></div>

<p>These definitions do not express the full functionality of <code>append</code>; the
real definition minimizes storage utilization by cdr-coding the list it produces,
using <i>cdr-next</i> except at the end where a full node is used to link to
the last argument, unless the last argument was <code>nil</code> in which case
<i>cdr-nil</i> is used.
</p></dd></dl>

<dl>
<dt><a name="index-copylist"></a>Function: <strong>copylist</strong> <em>list &amp;optional area</em></dt>
<dd><p>Returns a list which is <code>equal</code> to <i>list</i>, but not <code>eq</code>.
Only the top level of list-structure is copied, i.e. <code>copylist</code>
copies in the <code>cdr</code> direction but not in the <code>car</code> direction.
The returned list is fully cdr-coded to minimize storage.
If the list is &quot;dotted&quot;, that is, <code>(cdr (last <i>list</i>))</code>
is a non-<code>nil</code> atom, this will be true of the returned list also.
You may optionally specify the area in which to create the new copy.
</p></dd></dl>

<dl>
<dt><a name="index-copylist_002a"></a>Function: <strong>copylist*</strong> <em>list &amp;optional area</em></dt>
<dd><p>This is the same as <code>copylist</code> except that the last cons of the
resulting list is never cdr-coded.  This makes for increased efficiency
if you <code>nconc</code> something onto the list later.
</p></dd></dl>

<dl>
<dt><a name="index-copyalist"></a>Function: <strong>copyalist</strong> <em>list &amp;optional area</em></dt>
<dd><p><code>copyalist</code> is for copying association lists.  The top level of
list structure of <i>list</i> is copied, just as <code>copylist</code> does.
In addition, each element of <i>list</i> which is a cons is replaced
in the copy by a new cons with the same car and cdr.
You may optionally specify the area in which to create the new copy.
</p></dd></dl>

<dl>
<dt><a name="index-reverse"></a>Function: <strong>reverse</strong> <em>list</em></dt>
<dd><p><code>reverse</code> creates a new list whose elements
are the elements of <i>list</i> taken in reverse order.
<code>reverse</code> does not modify its argument, unlike <code>nreverse</code> which is faster
but does modify its argument.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(reverse '(a b (c d) e)) =&gt; (e (c d) b a)
</pre></div>

<p><code>reverse</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun reverse (x)
    (do ((l x (cdr l))         ;<span class="roman"> scan down argument,</span>
         (r nil                ;<span class="roman"> putting each element</span>
            (cons (car l) r))) ;<span class="roman"> into list, until</span>
        ((null l) r)))         ;<span class="roman"> no more elements.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-nconc"></a>Function: <strong>nconc</strong> <em>&amp;rest lists</em></dt>
<dd><p><code>nconc</code> takes lists as arguments.  It returns a list which is the arguments
concatenated together.  The arguments are changed, rather than copied.
(cf. <code>append</code>, (append-fun))
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x '(a b c))
(setq y '(d e f))
(nconc x y) =&gt; (a b c d e f)
x =&gt; (a b c d e f)
</pre></div>

<p>Note that the value of x is now different, since its last cons has been <code>rplacd</code>&rsquo;d to
the value of <code>y</code>.
If the nconc form is evaluated again, it would yield a piece of &quot;circular&quot; list
structure, whose printed representation would be
<code>(a b c d e f d e f d e f ...)</code>, repeating forever.
</p>
<p><code>nconc</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun nconc (x y)               ;<span class="roman">for simplicity, this definition</span>
    (cond ((null x) y)           ;<span class="roman">only works for 2 arguments.</span>
          (t (rplacd (last x) y) ;<span class="roman">hook <code>y</code> onto </span>x
              x)))               ;<span class="roman">and return the modified <code>x</code>.</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-nreverse"></a>Function: <strong>nreverse</strong> <em>list</em></dt>
<dd><p><code>nreverse</code> reverses its argument, which should be a list.  The argument
is destroyed by <code>rplacd</code>&rsquo;s all through the list (cf. <code>reverse</code>).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(nreverse '(a b c)) =&gt; (c b a)
</pre></div>

<p><code>nreverse</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun nreverse  (x)
    (cond ((null x) nil)
          ((nreverse1 x nil))))

(defun nreverse1 (x y)          ;<span class="roman">auxiliary function</span>
    (cond ((null (cdr x)) (rplacd x y))
          ((nreverse1 (cdr x) (rplacd x y)))))
          ;;<span class="roman"> this last call depends on order of argument evaluation.</span>
</pre></div>

<p>Currently, <code>nreverse</code> does something inefficient with <i>cdr-coded</i>
lists, however this will be changed.  In the meantime <code>reverse</code> might
be preferable in some cases.
</p></dd></dl>

<dl>
<dt><a name="index-nreconc"></a>Function: <strong>nreconc</strong> <em>x y</em></dt>
<dd><p><code>(nreconc <i>x y</i>)</code> is exactly the same as
<code>(nconc (nreverse <i>x</i>) <i>y</i>)</code> except that it is more
efficient.  Both <i>x</i> and <i>y</i> should be lists.
</p>
<p><code>nreconc</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun nreconc (x y)
    (cond ((null x) y)
          ((nreverse1 x y)) ))
</pre></div>

<p>using the same <code>nreverse1</code> as above.
</p></dd></dl>

<dl>
<dt><a name="index-push"></a>Macro: <strong>push</strong></dt>
<dd><p>The form is <code>(push <i>item place</i>)</code>, where <i>item</i> is an
arbitrary object and <i>place</i> is a reference to a cell containing
a list.  Usually <i>place</i> is the name of a variable.  <i>item</i>
is consed onto the front of the list.
</p>
<p>The form
</p>
<div class="lisp">
<pre class="lisp">(push (hairy-function x y z) variable)
</pre></div>

<p>replaces the commonly-used construct
</p>
<div class="lisp">
<pre class="lisp">(setq variable (cons (hairy-function x y z) variable))
</pre></div>

<p>and is intended to be more explicit and esthetic.
In general, <code>(push <i>item place</i>)</code> expands into
<code>(setf <i>place</i> (cons <i>item place</i>))</code>.
(See (setf-fun) for an explanation of <code>setf</code>.)
</p></dd></dl>

<dl>
<dt><a name="index-pop"></a>Macro: <strong>pop</strong></dt>
<dd><p>The form is <code>(pop <i>place</i>)</code>.  The result is
the <code>car</code> of the contents of <i>place</i>, and as a side-effect
the <code>cdr</code> of the contents is stored back into <i>place</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x '(a b c))
(pop x) =&gt; a
x =&gt; (b c)
</pre></div>

<p>In general, <code>(pop <i>place</i>)</code> expands into
<code>(prog1 (car <i>place</i>) (setf <i>place</i> (cdr <i>place</i>)))</code>.
(See (setf-fun) for an explanation of <code>setf</code>.)
</p></dd></dl>

<dl>
<dt><a name="index-butlast"></a>Function: <strong>butlast</strong> <em>list</em></dt>
<dd><p>This creates and returns a list with the same elements as <i>list</i>,
excepting the last element.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(butlast '(a b c d)) =&gt; (a b c)
(butlast '((a b) (c d)) =&gt; ((a b))
(butlast '(a)) =&gt; nil
(butlast nil) =&gt; nil
</pre></div>

<p>The name is from the phrase &quot;all elements but the last&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-nbutlast"></a>Function: <strong>nbutlast</strong> <em>list</em></dt>
<dd><p>This is the destructive version of <code>butlast</code>; it changes the cdr of
the second-to-last cons of the list to nil.  If there is no
second-to-last cons (that is, if the list has fewer than two elements)
it returns <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq foo '(a b c d))
(nbutlast foo) =&gt; (a b c)
foo =&gt; (a b c)
(nbutlast '(a)) =&gt; nil
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-firstn"></a>Function: <strong>firstn</strong> <em>n list</em></dt>
<dd><p><code>firstn</code> returns a list of length <i>n</i>, whose elements are the
first <i>n</i> elements of <code>list</code>.  If <i>list</i> is fewer than
<i>n</i> elements long, the remaining elements of the returned list
will be <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(firstn 2 '(a b c d)) =&gt; (a b)
(firstn 0 '(a b c d)) =&gt; nil
(firstn 6 '(a b c d)) =&gt; (a b c d nil nil)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-ldiff"></a>Function: <strong>ldiff</strong> <em>list sublist</em></dt>
<dd><p><i>list</i> should be a list, and <i>sublist</i> should be a sublist
of <i>list</i>, i.e. one of the conses that make up <i>list</i>.
<code>ldiff</code> (meaning List Difference) will return a new list,
whose elements are those elements of <i>list</i> that appear before
<i>sublist</i>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq x '(a b c d e))
(setq y (cdddr x)) =&gt; (d e)
(ldiff x y) =&gt; (a b c)
<span class="roman">but</span>
(ldiff '(a b c d) '(c d)) =&gt; (a b c d)
<span class="roman">since the sublist was not <code>eq</code> to any part of the list.</span>
</pre></div>
</dd></dl>

<a name="Alteration-of-List-Structure"></a>
<h3 class="section">5.3 Alteration of List Structure</h3>

<p>The functions <code>rplaca</code> and <code>rplacd</code>
are used to make alterations in already-existing
list structure; that is, to change the cars and cdrs of existing conses.
  The structure is not copied but is physically altered;
hence caution should be exercised when using these functions, as
strange side-effects can occur if portions of list structure become
shared unbeknownst to the programmer.
The <code>nconc</code>, <code>nreverse</code>, <code>nreconc</code>, and <code>nbutlast</code> functions already
described, and the <code>delq</code> family described later,
have the same property.  However, they are normally not
used for this side-effect; rather, the list-structure modification
is purely for efficiency and compatible non-modifying functions
are provided.
</p>
<dl>
<dt><a name="index-rplaca"></a>Function: <strong>rplaca</strong> <em>x y</em></dt>
<dd><p><code>(rplaca <i>x y</i>)</code> changes the car of <i>x</i> to <i>y</i> and returns
(the modified) <i>x</i>.  <i>x</i> should be a cons, but <i>y</i> may be any Lisp object.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq g '(a b c))
(rplaca (cdr g) 'd) =&gt; (d c)
<span class="roman">Now</span> g =&gt; (a d c)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-rplacd"></a>Function: <strong>rplacd</strong> <em>x y</em></dt>
<dd><p><code>(rplacd <i>x y</i>)</code> changes the cdr of <i>x</i> to <i>y</i> and returns
(the modified) <i>x</i>.  <i>x</i> should be a cons, but <i>y</i> may be any Lisp object.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x '(a b c))
(rplacd x 'd) =&gt; (a . d)
<span class="roman">Now</span> x =&gt; (a . d)
</pre></div>

<p>Note to Maclisp users: <code>rplacd</code> should not be used to set the property
list of a symbol, although there is a compatibility mode in which it will work.
See <code>car</code> ((car-fun)).  The right way to set a property list is with
<code>setplist</code> (see (setplist-fun)).
<a name="index-setplist"></a>
</p></dd></dl>

<a name="index-substitution"></a>
<dl>
<dt><a name="index-subst"></a>Function: <strong>subst</strong> <em>new old s-exp</em></dt>
<dd><p><code>(subst <i>new old s-exp</i>)</code> substitutes <i>new</i> for all occurrences of <i>old</i>
in <i>s-exp</i>, and returns the modified copy of <i>s-exp</i>.  The original <i>s-exp</i>
is unchanged, as <code>subst</code> recursively copies all of <i>s-exp</i> replacing
elements <code>equal</code> to <i>old</i> as it goes.  If <i>new</i> and <i>old</i> are <code>nil</code>,
<i>s-exp</i> is just copied, which is a convenient way to copy arbitrary list
structure.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(subst 'Tempest 'Hurricane
       '(Shakespeare wrote (The Hurricane)))
    =&gt; (Shakespeare wrote (The Tempest))
</pre></div>

<p><code>subst</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun subst (new old s-exp)
    (cond ((equal s-exp old) new) ;<span class="roman">if item eq to old, replace.</span>
          ((atom s-exp) s-exp)    ;<span class="roman">if no substructure, return arg.</span>
          ((cons (subst new old (car s-exp))  ;<span class="roman">otherwise recurse.</span>
                 (subst new old (cdr s-exp))))))
</pre></div>

<p>Note that this function is not &quot;destructive&quot;; that is, it does not change
the <i>car</i> or <i>cdr</i> of any already-existing list structure.
</p></dd></dl>

<dl>
<dt><a name="index-nsubst"></a>Function: <strong>nsubst</strong> <em>new old s-exp</em></dt>
<dd><p><code>nsubst</code> is a destructive version of <code>subst</code>.  The list structure of
<i>s-exp</i> is altered by replacing each occurrence of <i>old</i> with
<i>new</i>.  <code>nsubst</code> could have been defined as
</p>
<div class="lisp">
<pre class="lisp">(defun nsubst (new old s-exp)
    (cond ((eq s-exp old) new)    ;<span class="roman">If item eq to old, replace.</span>
          ((atom s-exp) s-exp)    ;<span class="roman">If no substructure, return arg.</span>
          (t ;; <span class="roman">Otherwise, recurse.</span>
             (rplaca s-exp (nsubst new old (car s-exp)))
             (rplacd s-exp (nsubst new old (cdr s-exp)))
             s-exp)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-sublis"></a>Function: <strong>sublis</strong> <em>alist S-expression</em></dt>
<dd><p><code>sublis</code> makes substitutions for symbols in an S-expression
(a structure of nested lists).
The first argument to <code>sublis</code> is an association list (see the next
section).  The second argument is the S-expression in which
substitutions are to be made.  <code>sublis</code> looks at all symbols
in the S-expression; if a symbol appears in the association
list occurrences of it are replaced by the object it is associated
with.  The argument is not modified; new conses are created where
necessary and only where necessary, so the newly created structure
shares as much of its substructure as possible with the old.  For
example, if no substitutions are made, the result is <code>eq</code> to the old
S-expression.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(sublis '((x . 100) (z . zprime))
        '(plus x (minus g z x p) 4))
   =&gt; (plus 100 (minus g zprime 100 p) 4)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-nsublis"></a>Function: <strong>nsublis</strong> <em>alist S-expression</em></dt>
<dd><p><code>nsublis</code> is like <code>sublis</code> but changes the original list structure
instead of creating new.
</p></dd></dl>

<a name="Cdr_002dCoding"></a>
<h3 class="section">5.4 Cdr-Coding</h3>

<p>There is an issue which those who must be concerned with
efficiency will need to think about.  In the Lisp Machine there are
actually two kinds of lists; normal lists and <i>cdr-coded</i> lists.  Normal
lists take two words for each <i>cons</i>, while cdr-coded lists require
only one word for each <i>cons</i>.  The saving is achieved by taking
advantage of the usual structure of lists to avoid storing the redundant cdrs
which link together the conses which make up the list.  Ordinarily,
<code>rplacd</code>&rsquo;ing such a list would be impossible, since there is no explicit
representation of the cdr to be modified.  However, in the Lisp machine system
it is merely somewhat expensive; a 2-word ordinary
cons must be allocated and linked into the list by an invisible pointer.
This is slower than an ordinary <code>rplacd</code>,
uses extra space, and slows down future accessing of the list.
</p>
<p>One should try to use normal lists for those data structures that will
be subject to <code>rplacd</code>ing operations, including <code>nconc</code> and
<code>nreverse</code>, and cdr-coded lists for other structures.
The functions <code>cons</code>, <code>xcons</code>, <code>ncons</code>, and their area variants make normal lists.
The functions <code>list</code>, <code>list*</code>, <code>list-in-area</code>, <code>make-list</code>,
and <code>append</code> make cdr-coded lists.  The other list-creating functions,
including <code>read</code>,
currently make normal lists, but this should not be relied upon.
Some functions, such as <code>sort</code>, take special care to operate
efficiently on cdr-coded lists (<code>sort</code> treats them as arrays).
<code>nreverse</code> is rather slow on cdr-coded lists, currently, since it
simple-mindedly uses <code>rplacd</code>, however this will be changed.
</p>
<p>It is currently <i>not</i> planned that the garbage collector
compact ordinary lists into cdr-coded lists.  <code>(append <i>x</i> nil)</code>
is a suitable way to copy a list, converting it into cdr-coded form.
</p>
<a name="Tables"></a>
<h3 class="section">5.5 Tables</h3>

<p>Lisp Machine Lisp includes several functions which simplify the maintenance
of tabular data structures of several varieties.  The simplest is
a plain list of items, which models (approximately) the concept of a <i>set</i>.
<a name="index-set"></a>
</p>
<p>There are functions to add (<code>cons</code>), remove (<code>delete</code>, <code>delq</code>,
<code>del</code>, <code>del-if</code>, <code>del-if-not</code>, <code>remove</code>, <code>remq</code>, <code>rem</code>,
<code>rem-if</code>, <code>rem-if-not</code>),
and search for (<code>member</code>, <code>memq</code>, <code>mem</code>) items in a list.
Set union, intersection, and difference functions are easily written using these.
</p>
<a name="index-association-lists"></a>
<p><i>Association lists</i> are very commonly used.  An association list
is a list of conses.  The car of each cons is a &quot;key&quot; and the cdr
is a &quot;datum&quot;, or a list of associated data.  The functions
<code>assoc</code>, <code>assq</code>, <code>ass</code>, <code>memass</code>, and <code>rassoc</code>
may be used to retrieve the data, given the key.
</p>
<p><i>Structured records</i> can be stored as association lists or as
stereotyped cons-structures where each element of the structure has a certain
car-cdr path associated with it.  However, these are better implemented
using structure macros (see (defstruct)).
</p>
<p>Simple list-structure is very convenient, but may not be efficient enough
for large data bases because it takes a long time to search a long list.
Lisp Machine lisp includes a hashing function (<code>sxhash</code>) which
aids in the construction of more efficient, hairier structures.
</p>
<dl>
<dt><a name="index-memq"></a>Function: <strong>memq</strong> <em>item list</em></dt>
<dd><p><code>(memq <i>item list</i>)</code> returns <code>nil</code> if <i>item</i> is not one of the elements of
<i>list</i>.  Otherwise, it returns the portion of <i>list</i> beginning
with the first occurrence of <i>item</i>.  The comparison is made by
<code>eq</code>.  <i>list</i> is searched on the top level only.
Because <code>memq</code> returns <code>nil</code> if it doesn&rsquo;t find anything,
and something non-<code>nil</code> if it finds something, it is often used as a predicate.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(memq 'a '(1 2 3 4)) =&gt; nil
(memq 'a '(g (x y) c a d e a f)) =&gt; (a d e a f)
</pre></div>

<p>Note that the value returned by <code>memq</code> is <code>eq</code> to the portion of the list
beginning with <i>a</i>.
Thus <code>rplaca</code> on the result of <code>memq</code> may be used,
if you first check to make sure <code>memq</code> did not return <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(*catch 'lose
        (rplaca (or (memq x z)
                    (*throw 'lose nil))
                y)
        )
</pre></div>

<p><code>memq</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun memq (item list)
    (cond ((atom list) nil)
          ((eq item (car list)) list)
          ((memq item (cdr list))) ))
</pre></div>

<p><code>memq</code> is hand-coded in microcode and therefore especially fast.
</p></dd></dl>

<dl>
<dt><a name="index-member"></a>Function: <strong>member</strong> <em>item list</em></dt>
<dd><p><code>member</code> is like <code>memq</code>, except <code>equal</code> is used for the comparison,
instead of <code>eq</code>.
</p>
<p><code>member</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun member (item list)
    (cond ((null list) nil)
          ((equal item (car list)) list)
          ((member item (cdr list))) ))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-mem"></a>Function: <strong>mem</strong> <em>predicate item list</em></dt>
<dd><p><code>mem</code> is the same as <code>memq</code> except that it takes an extra argument
which should be a predicate of two arguments, which is used for the
comparison instead of <code>eq</code>.  <code>(mem 'eq a b)</code> is the same as
<code>(memq a b)</code>.  <code>(mem 'equal a b)</code> is the same as <code>(member a b)</code>.
</p>
<p><code>mem</code> is usually used with equality predicates other than
<code>eq</code> and <code>equal</code>, such
as <code>=</code>, <code>char-equal</code> or <code>string-equal</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tailp"></a>Function: <strong>tailp</strong> <em>tail list</em></dt>
<dd><p>A <i>tail</i> of a list is anything that can be obtained by taking <code>cdr</code> of it zero
or more times.  <code>tailp</code> is used to ask whether <i>tail</i> is a tail of
<i>list</i>.  That is, it <code>cdr</code>&rsquo;s down <i>list</i> checking at each step
whether what it has got is <code>eq</code> to <i>tail</i>.  If so, the value is <code>t</code>.
</p></dd></dl>

<dl>
<dt><a name="index-delq"></a>Function: <strong>delq</strong> <em>item list &amp;optional n</em></dt>
<dd><p><code>(delq <i>item list</i>)</code> returns the <i>list</i> with all top-level
occurrences of <i>item</i> removed.  <code>eq</code> is used for the comparison.
The argument <i>list</i> is actually modified (<code>rplacd</code>&rsquo;ed) when instances
of <i>item</i> are spliced out.  <code>delq</code> should be used for value, not
for effect.  That is, use
</p>
<div class="lisp">
<pre class="lisp">(setq a (delq 'b a))
</pre></div>

<p>rather than
</p>
<div class="lisp">
<pre class="lisp">(delq 'b a)
</pre></div>

<p>The latter is <i>not</i> equivalent when the first element
of the value of <code>a</code> is <code>b</code>.
</p>
<p><code>(delq <i>item list n</i>)</code> is like <code>(delq <i>item list</i>)</code> except only the first
<i>n</i> instances of <i>item</i> are deleted.  <i>n</i> is allowed to be zero.
If <i>n</i> is greater than the number of occurrences of <i>item</i> in the
list, all occurrences of <i>item</i> in the list will be deleted.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(delq 'a '(b a c (a b) d a e)) =&gt; (b c (a b) d e)
</pre></div>

<p><code>delq</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun delq (item list &amp;optional (n 7777777))  ;<span class="roman">7777777 as infinity.</span>
    (cond ((or (atom list) (zerop n)) list)
          ((eq item (car list))
           (delq item (cdr list) (1- n)))
          ((rplacd list (delq item (cdr list) n)))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-delete"></a>Function: <strong>delete</strong> <em>item list &amp;optional n</em></dt>
<dd><p><code>delete</code> is the same as <code>delq</code> except that <code>equal</code> is used for the comparison
instead of <code>eq</code>.
</p></dd></dl>

<dl>
<dt><a name="index-del"></a>Function: <strong>del</strong> <em>predicate item list &amp;optional n</em></dt>
<dd><p><code>del</code> is the same as <code>delq</code> except that it takes an extra argument
which should be a predicate of two arguments, which is used for the
comparison instead of <code>eq</code>.  <code>(del 'eq a b)</code> is the same as
<code>(delq a b)</code>. (c.f. <code>mem</code>, (mem-fun))
</p></dd></dl>

<dl>
<dt><a name="index-remq"></a>Function: <strong>remq</strong> <em>item list &amp;optional n</em></dt>
<dd><p><code>remq</code> is similar to <code>delq</code>, except that the list is not altered;
rather, a new list is returned.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq x '(a b c d e f))
(remq 'b x) =&gt; (a c d e f)
x =&gt; (a b c d e f)
(remq 'b '(a b c b a b) 2) =&gt; (a c a b)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-remove"></a>Function: <strong>remove</strong> <em>item list &amp;optional n</em></dt>
<dd><p><code>remove</code> is the same as <code>remq</code> except that <code>equal</code> is used for the
comparison instead of <code>eq</code>.
</p></dd></dl>

<dl>
<dt><a name="index-rem"></a>Function: <strong>rem</strong> <em>predicate item list &amp;optional n</em></dt>
<dd><p><code>rem</code> is the same as <code>remq</code> except that it takes an extra argument
which should be a predicate of two arguments, which is used for the
comparison instead of <code>eq</code>.  <code>(rem 'eq a b)</code> is the same as
<code>(remq a b)</code>. (c.f. <code>mem</code> (mem-fun))
</p></dd></dl>

<dl>
<dt><a name="index-rem_002dif"></a>Function: <strong>rem-if</strong> <em>predicate list</em></dt>
<dd><p><i>predicate</i> should be a function of one argument.
<code>rem-if</code> makes a new list by applying <i>predicate</i> to
all of the elements of <i>list</i> and removing the ones for which the predicate
returns non-<code>nil</code>.  The function&rsquo;s name
means &quot;remove if this condition is true&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-rem_002dif_002dnot"></a>Function: <strong>rem-if-not</strong> <em>predicate list</em></dt>
<dd><p><i>predicate</i> should be a function of one argument.
<code>rem-if-not</code> makes a new list by applying <i>predicate</i> to
all of the elements of <i>list</i> and removing the ones for which the predicate
returns <code>nil</code>.  The function&rsquo;s name
means &quot;remove if this condition is not true&quot;; i.e. it keeps the elements
for which <i>predicate</i> is true.
</p></dd></dl>

<dl>
<dt><a name="index-del_002dif"></a>Function: <strong>del-if</strong> <em>predicate list</em></dt>
<dd><p><code>del-if</code> is just like <code>rem-if</code> except that it modifies <i>list</i>
rather than creating a new list.  See <code>rem-if</code>.
</p></dd></dl>

<dl>
<dt><a name="index-del_002dif_002dnot"></a>Function: <strong>del-if-not</strong> <em>predicate list</em></dt>
<dd><p><code>del-if-not</code> is just like <code>rem-if-not</code> except that it modifies <i>list</i>
rather than creating a new list.  See <code>rem-if-not</code>.
</p></dd></dl>

<dl>
<dt><a name="index-every"></a>Function: <strong>every</strong> <em>list predicate &amp;optional step-function</em></dt>
<dd><p><code>every</code> returns <code>t</code> if <i>predicate</i> returns
non-<code>nil</code> when applied to every element of <i>list</i>,
or <code>nil</code> if <i>predicate</i> returns <code>nil</code> for some element.
If <i>step-function</i> is present, it replaces <code>cdr</code>
as the function used to get to the next element of the list.
</p></dd></dl>

<dl>
<dt><a name="index-some"></a>Function: <strong>some</strong> <em>list predicate &amp;optional step-function</em></dt>
<dd><p><code>some</code> returns a tail of <i>list</i> such that the car
of the tail is the first element that the <i>predicate</i> returns
non-<code>nil</code> when applied to,
or <code>nil</code> if <i>predicate</i> returns <code>nil</code> for every element.
If <i>step-function</i> is present, it replaces <code>cdr</code>
as the function used to get to the next element of the list.
</p></dd></dl>

<dl>
<dt><a name="index-tailp-1"></a>Function: <strong>tailp</strong> <em>sublist list</em></dt>
<dd><p>Returns <code>t</code> if <i>sublist</i> is a sublist of <i>list</i> (i.e.
one of the conses that makes up <i>list</i>).  Otherwise returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-sxhash"></a>Function: <strong>sxhash</strong> <em>S-expression</em></dt>
<dd><a name="index-hash-table"></a>
<p><code>sxhash</code> computes a hash code of an S-expression, and returns it as
a fixnum, which may be positive or negative.  A property of <code>sxhash</code>
is that <code>(equal <i>x y</i>)</code> implies <code>(= (sxhash <i>x</i>) (sxhash <i>y</i>))</code>.  The
number returned by <code>sxhash</code> is some possibly large number in the
range allowed by fixnums.  It is guaranteed that:
</p>
<ol>
<li> <code>sxhash</code> for a symbol will always be positive.

</li><li> <code>sxhash</code> of any particular expression will be constant
in a particular implementation for all time, probably.

</li><li> <code>sxhash</code> of any object of type <code>random</code> will be zero.

</li><li> <code>sxhash</code> of a fixnum will <code>=</code> that fixnum.
</li></ol>

<p>Here is an example of how to use <code>sxhash</code> in maintaining
hash tables of S-expressions:
</p>
<div class="lisp">
<pre class="lisp">(defun knownp (x)    ;<span class="roman">look up x in the table</span>
  (prog (i bkt)
    (setq i (plus 76 (remainder (sxhash x) 77)))
      ;The remainder should be reasonably randomized between
      ;-76 and 76, thus table size must be &gt; 175 octal.
    (setq bkt (aref table i))
      ;bkt is thus a list of all those expressions that hash
      ;into the same number as does x.
    (return (memq x bkt))))
</pre></div>

<p>To write an &quot;intern&quot; for S-expressions, one could
</p>
<div class="lisp">
<pre class="lisp">(defun sintern (x)
  (prog (bkt i tem)
    (setq bkt (aref table
                    (setq i (+ 2n-2 (\ (sxhash x) 2n-1)))))
        ;2n-1 and 2n-2 stand for a power of 2 minus one and
        ;minus two respectively.  This is a good choice to
        ;randomize the result of the remainder operation.
    (return (cond ((setq tem (memq x bkt))
                   (car tem))
                  (t (aset (cons x bkt) table i)
                     x)))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-assq"></a>Function: <strong>assq</strong> <em>item alist</em></dt>
<dd><a name="index-association-lists-1"></a>
<p><code>(assq <i>item alist</i>)</code> looks up <i>item</i> in the association list
(list of conses) <i>alist</i>.  The value is the first cons whose <code>car</code>
is <code>eq</code> to <i>x</i>, or <code>nil</code> if there is none such.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(assq 'r '((a . b) (c . d) (r . x) (s . y) (r . z)))
        =&gt;  (r . x)

(assq 'fooo '((foo . bar) (zoo . goo))) =&gt; nil

(assq 'b '((a b c) (b c d) (x y z))) =&gt; (b c d)
</pre></div>

<p>It is okay to <code>rplacd</code> the result of <code>assq</code> as long as it is not <code>nil</code>,
if your intention is to &quot;update&quot; the &quot;table&quot; that was <code>assq</code>&rsquo;s second argument.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq values '((x .  100) (y  . 200) (z .  50)))
(assq 'y values) =&gt; (y . 200)
(rplacd (assq 'y values)  201)
(assq 'y values)  =&gt; (y . 201) <span class="roman">now</span>
</pre></div>

<p>A typical trick is to say
<code>(cdr (assq x y))</code>.
Assuming the cdr of <code>nil</code> is guaranteed to be <code>nil</code>,
this yields <code>nil</code> if no pair is found (or if a pair is
found whose cdr is <code>nil</code>.)
</p>
<p><code>assq</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun assq (item list)
    (cond ((null list) nil)
          ((eq item (caar list)) (car list))
          ((assq item (cdr list))) ))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-assoc"></a>Function: <strong>assoc</strong> <em>item alist</em></dt>
<dd><p><code>assoc</code> is like <code>assq</code> except that the comparison uses <code>equal</code> instead of <code>eq</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(assoc '(a b) '((x . y) ((a b) . 7) ((c . d) .e)))
        =&gt; ((a b) . 7)
</pre></div>

<p><code>assoc</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun assoc (item list)
    (cond ((null list) nil)
          ((equal item (caar list)) (car list))
          ((assoc item (cdr list))) ))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-ass"></a>Function: <strong>ass</strong> <em>predicate item alist</em></dt>
<dd><p><code>ass</code> is the same as <code>assq</code> except that it takes an extra argument
which should be a predicate of two arguments, which is used for the
comparison instead of <code>eq</code>.  <code>(ass 'eq a b)</code> is the same as
<code>(assq a b)</code>. (c.f. <code>mem</code> (mem-fun))
</p></dd></dl>

<dl>
<dt><a name="index-memass"></a>Function: <strong>memass</strong> <em>predicate item alist</em></dt>
<dd><p><code>memass</code> searches <i>alist</i> just like <code>ass</code>, but returns
the portion of the list beginning with the pair containing <i>item</i>,
rather than the pair itself.  <code>(car (memass <i>x y z</i>)) =
(ass <i>x y z</i>)</code>.
</p></dd></dl>

<dl>
<dt><a name="index-rassoc"></a>Function: <strong>rassoc</strong> <em>item alist</em></dt>
<dd><p><code>rassoc</code> means <i>reverse assoc</i>.  It is like <code>assoc</code>, but
it tries to find an element of <i>alist</i> whose <i>cdr</i> (not car)
is <i>equal</i> to <i>item</i>.  <code>rassoc</code> is defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun rassoc (item in-list)
    (do l in-list (cdr l) (null l)
      (and (equal item (cdar l))
           (return (car l)))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-sassq"></a>Function: <strong>sassq</strong> <em>item alist fcn</em></dt>
<dd><p><code>(sassq <i>item alist fcn</i>)</code> is like <code>(assq <i>item alist</i>)</code> except
that if <i>item</i> is not found in <i>alist</i>, instead of returning <code>nil</code>,
<code>sassq</code> calls the function <i>fcn</i> with no arguments.  <code>sassq</code> could
have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun sassq (item alist fcn)
    (or (assq item alist)
        (apply fcn nil)))
</pre></div>

<p><code>sassq</code> and <code>sassoc</code> (see below) are of limited use.
These are primarily leftovers from Lisp 1.5.
</p></dd></dl>

<dl>
<dt><a name="index-sassoc"></a>Function: <strong>sassoc</strong> <em>item alist fcn</em></dt>
<dd><p><code>(sassoc <i>item alist fcn</i>)</code> is like <code>(assoc <i>item alist</i>)</code> except that if
<i>item</i> is not found in <i>alist</i>, instead of returning <code>nil</code>, <code>sassoc</code> calls
the function <i>fcn</i> with no arguments.  <code>sassoc</code> could have been
defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun sassoc (item alist fcn)
    (or (assoc item alist)
        (apply fcn nil)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-pairlis"></a>Function: <strong>pairlis</strong> <em>cars cdrs</em></dt>
<dd><p><code>pairlis</code> takes two lists and makes an association list which associates
elements of the first list with corresponding elements of the second
list.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(pairlis '(beef clams kitty) '(roast fried yu-shiang))
   =&gt; ((beef . roast) (clams . fried) (kitty . yu-shiang))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-find_002dposition_002din_002dlist"></a>Function: <strong>find-position-in-list</strong> <em>item list</em></dt>
<dd><p><code>find-position-in-list</code> looks down <i>list</i> for an element which
is <code>eq</code> to <i>item</i>, like <code>memq.</code>  However, it returns the numeric index
in the list at which it found the first occurence of <i>item</i>, or
<code>nil</code> if it did not find it at all.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(find-position-in-list 'a '(a b c)) =&gt; 0
(find-position-in-list 'c '(a b c)) =&gt; 2
(find-position-in-list 'e '(a b c)) =&gt; nil
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-find_002dposition_002din_002dlist_002dequal"></a>Function: <strong>find-position-in-list-equal</strong> <em>item list</em></dt>
<dd><p><code>find-position-in-list-equal</code> is exactly the same as
<code>find-position-in-list</code>, except that the comparison is done
with <code>equal</code> instead of <code>eq</code>.
</p></dd></dl>

<a name="Property-Lists"></a>
<h3 class="section">5.6 Property Lists</h3>
<a name="index-Property-list"></a>

<p>[The stuff in FD.SYM will get moved here, leaving a pointer behind, and
will be generalized for disembodied property lists and made to clarify
the distinction between a plist and a paired list.]
</p>
<a name="Hash-Tables"></a>
<h3 class="section">5.7 Hash Tables</h3>
<a name="index-hash-table-1"></a>

<p>A hash table is a Lisp object that works something like a property list.
Each hash table has a set of <i>entries</i>, each of which associates a
particular <i>key</i> with a particular <i>value</i>.  The basic functions
that deal with hash tables can create entries, delete entries, and find
the value that is associated with a given key.  Finding the value is
very fast even if there are many entries, because hashing is used; this
is an important advantage of hash tables over property lists.
</p>
<p>A given hash table can only associate one <i>value</i> with a given
<i>key</i>; if you try to add a second <i>value</i> it will replace the
first.
</p>
<p>Hash tables are created with the function <code>make-hash-table</code>, which
takes various options.  New entries are added to hash tables with the
<code>puthash</code> function.  To look up a key and find the associated value,
the <code>gethash</code> function is used.  To remove an entry, use <code>remhash</code>.
Here is a simple example.
</p>
<div class="lisp">
<pre class="lisp">(setq a (make-hash-table))

(puthash 'color 'brown a)

(puthash 'name 'fred a)

(gethash 'color a) =&gt; brown

(gethash 'name a) =&gt; fred
</pre></div>

<p>In this example, the symbols <code>color</code> and <code>name</code> are being used as
keys, and the symbols <code>brown</code> and <code>fred</code> are being used as the
associated values.  The hash table has two items in it, one of which
associates from <code>color</code> to <code>brown</code>, and the other of which
associates from <code>name</code> to <code>fred</code>.
</p>
<p>Keys do not have to be symbols; they can be any Lisp object.  Likewise
values can be any Lisp object.  The Lisp function <code>eq</code> is used to
compare keys, rather than <code>equal</code>.  This means that keys are really
objects, but it means that it is not reasonable to use numbers other
than fixnums as keys.  Hash tables are properly interfaced to the
relocating garbage collector so that garbage collection will have no
perceptible effect on the functionality of hash tables.
</p>
<p>When a hash table is first created, it has a <i>size</i>, which is the
maximum number of entries it can hold.  Usually the actual capacity of
the table is somewhat less, since the hashing is not perfectly
collision-free.  With the maximum possible bad luck, the capacity could
be very much less, but this rarely happens.  If so many entries are
added that the capacity is exceeded, the hash table will automatically
grow, and the entries will be <i>rehashed</i> (new hash values will be
recomputed, and everything will be rearranged so that the fast hash
lookup still works).  This is transparent to the caller; it all happens
automatically.
</p>
<p>If the calling program is using multiprocessing, it must be careful to
make sure that there are never two processes both referencing the hash
table at the same time.  There is no locking built into hash tables; if
you have two processes that both want to reference the same hash table,
you must arrange mutual exclusion yourself by using a lock or some other
means.  Don&rsquo;t worry about this if you don&rsquo;t use multiprocessing; but if
you do use multiprocessing, you will have a lot of trouble if you don&rsquo;t
understand this.
</p>
<dl>
<dt><a name="index-make_002dhash_002dtable"></a>Function: <strong>make-hash-table</strong> <em>&amp;rest options</em></dt>
<dd><p>This creates a new hash table.  Valid option keywords are:
</p>
<dl compact="compact">
<dt><code>:size</code></dt>
<dd><p>Set the initial size of the hash table, in entries, as a fixnum.  The
default is 100 (octal).  The actual size is rounded up from the size
you specify to the next &quot;good&quot; size.
You won&rsquo;t necessarily be able to store this many entries into the table
before it overflows and becomes bigger; but except in the case of extreme
bad luck you will be able to store almost this many.
</p></dd>
<dt><code>:area</code></dt>
<dd><p>Specify the area in which the hash table should be created.  This is
just like the first argument to <code>make-array</code> (see (make-array-fun)).
Defaults to <code>nil</code> (i.e. <code>default-cons-area</code>).
</p></dd>
<dt><code>:rehash-function</code></dt>
<dd><p>Specify the function to be used for rehashing when the table becomes
full.  Defaults to the internal rehashing function that does the usual
thing.  If you want to write your own rehashing function, you will
have to understand all the internals of how hash tables work.  These
internals are not documented here, as the best way to learn them is
to read the source code.
</p></dd>
<dt><code>:rehash-size</code></dt>
<dd><p>Specifies how much to increase the size of the hash table when it becomes
full.  This can be a fixnum which is the number of entries to add, or
it can be a flonum which is the ratio of the new size to the old size.
The default is <code>1.3</code>, which causes the table to be made 30% bigger
each time it has to grow.
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-gethash"></a>Function: <strong>gethash</strong> <em>key hash-table</em></dt>
<dd><p>Find the entry in <i>hash-table</i> whose key is <i>key</i>, and return the
associated value.  If there is no such entry, return <code>nil</code>.
Returns a second value, which is <code>t</code> if an entry was found or <code>nil</code> if there
is no entry for <i>key</i> in this table.
</p></dd></dl>

<dl>
<dt><a name="index-puthash"></a>Function: <strong>puthash</strong> <em>key value hash-table</em></dt>
<dd><p>Create an entry associating <i>key</i> to <i>value</i>; if there is already an
entry for <i>key</i>, then replace the value of that entry with <i>value</i>.
Returns <i>value</i>.
</p></dd></dl>

<dl>
<dt><a name="index-remhash"></a>Function: <strong>remhash</strong> <em>key hash-table</em></dt>
<dd><p>Remove any entry for <i>key</i> in <i>hash-table</i>.  Returns <code>t</code> if there was an
entry or <code>nil</code> if there was not.
</p></dd></dl>

<dl>
<dt><a name="index-maphash"></a>Function: <strong>maphash</strong> <em>function hash-table</em></dt>
<dd><p>For each entry in <i>hash-table</i>, call <i>function</i> on two arguments:
the key of the entry and the value of the entry.
</p></dd></dl>

<dl>
<dt><a name="index-clrhash"></a>Function: <strong>clrhash</strong> <em>hash-table</em></dt>
<dd><p>Remove all the entries from <i>hash-table</i>.  Returns the hash table itself.
</p></dd></dl>

<p>The <code>describe</code> function (see (describe-fun)) prints a variety of
useful information when applied to a hash table.
</p>
<p>This hash table facility is similar to the hasharray facility of Interlisp,
and some of the function names are the same.  However, it is <i>not</i> compatible.
The exact details and the order of arguments are designed to be consistent
with the rest of the Lisp machine rather than with Interlisp.  For instance,
the order of arguments to <code>maphash</code> is different, we do not have the Interlisp
&quot;system hash table&quot;, and we do not have the
Interlisp restriction that keys and values may not be <code>nil</code>.
</p>
<a name="Sorting"></a>
<h3 class="section">5.8 Sorting</h3>
<a name="index-sorting"></a>

<p>Several functions are provided for sorting arrays and lists.  These
functions use algorithms which always terminate no matter what sorting
predicate is used, provided only that the predicate always terminates.
The array sort is not necessarily <i>stable</i>; that is, equal items may
not stay in their original order.  However the list sort <i>is</i>
stable.
</p>
<p>After sorting, the argument (be it list or array) is rearranged
internally so as to be completely ordered.  In the case of an array
argument, this is accomplished by permuting the elements of the array,
while in the list case, the list is reordered by <code>rplacd</code>&rsquo;s in the
same manner as <code>nreverse</code>.  Thus if the argument should not be
clobbered, the user must sort a copy of the argument, obtainable by
<code>fillarray</code> or <code>append</code>, as appropriate.
</p>
<p>Should the comparison predicate cause an error, such as a wrong type
argument error, the state of the list or array being sorted is
undefined.  However, if the error is corrected the sort will, of
course, proceed correctly.
</p>
<p>The sorting package is smart about cdr-coded lists.
</p>
<dl>
<dt><a name="index-sort"></a>Function: <strong>sort</strong> <em>table predicate</em></dt>
<dd><p>The first argument to <code>sort</code> is an array or a list.  The second
is a predicate, which must be applicable to
all the objects in the array or list.  The predicate should take two
arguments, and return non-<code>nil</code> if and only if the first argument is
strictly less than the second (in some appropriate sense).
</p>
<p>The <code>sort</code> function proceeds to sort the contents of the array or
list under the ordering imposed by the predicate, and returns the
array or list modified into sorted order, i.e. its modified first
argument.  Note that since sorting requires many comparisons, and thus
many calls to the predicate, sorting will be much faster if the
predicate is a compiled function rather than interpreted.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(defun mostcar (x)
    (cond ((symbolp x) x)
          ((mostcar (car x)))))

(sort 'fooarray
      (function (lambda (x y)
          (alphalessp (mostcar x) (mostcar y)))))
</pre></div>

<p>If <code>fooarray</code> contained these items before the sort:
</p>
<div class="lisp">
<pre class="lisp">(Tokens (The lion sleeps tonight))
(Carpenters (Close to you))
((Rolling Stones) (Brown sugar))
((Beach Boys) (I get around))
(Beatles (I want to hold your hand))
</pre></div>

<p>then after the sort <code>fooarray</code> would contain:
</p>
<div class="lisp">
<pre class="lisp">((Beach Boys) (I get around))
(Beatles (I want to hold your hand))
(Carpenters (Close to you))
((Rolling Stones) (Brown sugar))
(Tokens (The lion sleeps tonight))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-sortcar"></a>Function: <strong>sortcar</strong> <em>x predicate</em></dt>
<dd><p><code>sortcar</code> is exactly like <code>sort</code>, but the items in the array or
list being sorted should all be conses.  <code>sortcar</code> takes the
<code>car</code> of each item before handing two items to the predicate.  Thus
<code>sortcar</code> is to <code>sort</code> as <code>mapcar</code> is to <code>maplist</code>.
</p></dd></dl>

<p>The spelling of the names of the next two functions will be corrected at some point.
</p>
<dl>
<dt><a name="index-sort_002dgrouped_002darray"></a>Function: <strong>sort-grouped-array</strong> <em>array group-size predicate</em></dt>
<dd><p><code>sort-grouped-array</code> considers its array argument to
be composed of records of <i>group-size</i> elements each.
These records are considered as units, and are sorted with respect
to one another.  The <i>predicate</i> is applied to the first element
of each record; so the first elements act as the keys on which
the records are sorted.
</p></dd></dl>

<dl>
<dt><a name="index-sort_002dgrouped_002darray_002dgroup_002dkey"></a>Function: <strong>sort-grouped-array-group-key</strong> <em>array group-size predicate</em></dt>
<dd><p>This is like <code>sort-grouped-array</code> except that the
<i>predicate</i> is applied to four arguments:  an array,
an index into that array, a second array, and an index into
the second array.  <i>predicate</i> should consider each index
as a subscript of the first element of a record in the corresponding
array, and compare the two records.  This is more general
than <code>sort-grouped-array</code> since the function can get at
all of the elements of the relevant records, instead of only the first element.
</p></dd></dl>


<a name="Symbols"></a>
<h2 class="chapter">6 Symbols</h2>
<a name="index-symbol-2"></a>

<a name="The-Value-Cell"></a>
<h3 class="section">6.1 The Value Cell</h3>
<a name="index-value-cell"></a>

<p>Each symbol has associated with it a <i>value cell</i>, which refers
to one Lisp object.  This object is called the symbol&rsquo;s <i>binding</i> or <i>value</i>,
since it is what you get when you evaluate the symbol.  The binding of symbols to values
allows symbols to be used as the implementation of <i>variables</i> in programs.
</p>
<p>The value cell can also be <i>empty</i>, referring to <i>no</i> Lisp
object, in which case the symbol is said to be <i>unbound</i>.  This is the initial
state of a symbol when it is created.  An attempt to evaluate an unbound symbol
causes an error.
</p>
<p>The binding of a symbol can be changed either by <i>lambda-binding</i> or by
<i>assignment</i>.  The difference is that when a symbol is lambda-bound, its previous
value is saved away, to be restored later, whereas assignment discards the previous
value.
</p>
<p>The symbols <code>nil</code> and <code>t</code> are always bound to themselves; they
may not be assigned nor lambda-bound.  (The error of changing the value of
<code>t</code> or <code>nil</code> is not yet detected, but it will be.)
</p>
<p>When <i>closures</i> are in use, the situation is a little more complicated.
See the section on closures.
</p>
<p>When a Lisp function is <i>compiled</i>, most of its variables are compiled
into <i>local variables</i>, which are not represented by means of symbols.  However
the compiler recognizes usage of the <code>setq</code> special form, and of the <code>set</code>
and <code>value-cell-location</code> functions with a quoted argument, as referring to
variables rather than symbols, and generates the appropriate code to access the
corresponding local variable rather than the symbol.
</p>
<dl>
<dt><a name="index-defvar"></a>Special Form: <strong>defvar</strong> <em>symbol &amp;optional initial-value</em></dt>
<dd><p><code>defvar</code> is the recommended way to declare the use of a global variable in a
program.  Placed at top level in a file, it serves to initialize the variable,
declare it special for the sake of compilation, and record the location for the
sake of the editor so that you can ask to see where the variable is defined.
It also provides a good place to put a comment describing the meaning of the
variable (whereas an ordinary <code>declare</code> offers the temptation to declare
several variables at once and not have room to describe them all).
If the variable has a value already, that value is not changed.
If <i>initial-value</i> is omitted, the variable is left unbound.
<code>defvar</code> should be used only at top level, never in function definitions,
and only for global variables (used by more than one function).
<code>(defvar foo 'bar)</code> is equivalent to
</p>
<div class="lisp">
<pre class="lisp">(declare (special foo))
(or (boundp 'foo)
    (setq foo 'bar))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-set-1"></a>Function: <strong>set</strong> <em>symbol value</em></dt>
<dd><p><code>set</code> is the primitive for assignment of symbols.  The <i>symbol</i>&rsquo;s value
is changed to <i>value</i>; <i>value</i> may be any Lisp object.  <i>set</i> returns
<i>value</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(set (cond ((eq a b) 'c)
           (t 'd))
     'foo)
</pre></div>

<p>will either set <code>c</code> to <code>foo</code> or set <code>d</code> to <code>foo</code>.
</p></dd></dl>

<dl>
<dt><a name="index-setq"></a>Special Form: <strong>setq</strong></dt>
<dd><p>The special form <code>(setq <i>var1 form1 var2 form2...</i>)</code> is the
&quot;variable assignment statement&quot; of Lisp.  First <i>form1</i> is evaluated
and the result is assigned to <i>var1</i>, using <code>set</code>, then <i>form2</i>
is evaluated and the result is assigned to <i>var2</i>, and so forth.
<code>setq</code> returns the last value assigned, i.e. the result of the
evaluation of its last argument.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq x (+ 3 2 1) y (cons x nil))
</pre></div>

<p><code>x</code> is set to <code>6</code>, <code>y</code> is set to <code>(6)</code>, and the <code>setq</code>
returns <code>(6)</code>.  Note that the first assignment was performed before
the second form was evaluated, allowing that form to use the new value of <code>x</code>.
</p></dd></dl>

<dl>
<dt><a name="index-psetq"></a>Macro: <strong>psetq</strong></dt>
<dd><p>A <code>psetq</code> form is just like a <code>setq</code> form, except
that the assignments happen in parallel; first all of the forms
are evaluated, and then the symbols are set to the resulting
values.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a 1)
(setq b 2)
(psetq a b b a)
a =&gt; 2
b =&gt; 1
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-symeval-1"></a>Function: <strong>symeval</strong> <em>sym</em></dt>
<dd><p><code>symeval</code> is the basic primitive for retrieving a symbols&rsquo;s value.
<code>(symeval <i>sym</i>)</code> returns <i>sym</i>&rsquo;s current binding.
This is the function called by <code>eval</code> when it is given a symbol
to evaluate.  If the symbol is unbound, then <code>symeval</code> causes
an error.
</p></dd></dl>

<dl>
<dt><a name="index-boundp"></a>Function: <strong>boundp</strong> <em>sym</em></dt>
<dd><p><code>boundp</code> returns <code>t</code> if <i>sym</i> is bound; otherwise, it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-makunbound"></a>Function: <strong>makunbound</strong> <em>sym</em></dt>
<dd><p><code>makunbound</code> causes <i>sym</i> to become unbound.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a 1)
a =&gt; 1
(makunbound 'a)
a =&gt; <span class="roman">causes an error.</span>
</pre></div>

<p><code>makunbound</code> returns its argument.
</p></dd></dl>

<dl>
<dt><a name="index-value_002dcell_002dlocation"></a>Function: <strong>value-cell-location</strong> <em>sym</em></dt>
<dd><p><code>value-cell-location</code> returns a locative pointer to <i>sym</i>&rsquo;s value cell.
See the section on locatives.
</p>
<p>[Must explain about external vs internal value cell.]
</p></dd></dl>

<a name="The-Function-Cell"></a>
<h3 class="section">6.2 The Function Cell</h3>
<a name="index-function-cell"></a>

<p>Every symbol also has associated with it a <i>function cell</i>.  The <i>function</i>
cell is similar to the <i>value</i> cell; it refers to a Lisp object.
When a function is referred to by name, that is, when a symbol is <i>applied</i>
or appears as the car of a form to be evaluated, that symbol&rsquo;s function cell
is used to find its <i>definition</i>, the functional object which is to be applied.
For example, when evaluating <code>(+ 5 6)</code>,
the evaluator looks in <code>+</code>&rsquo;s function cell to find the definition of <code>+</code>,
in this case a <i>FEF</i> containing a compiled program, to apply to 5 and 6.
</p>
<p>Maclisp does not have function cells; instead, it looks for special
properties on the property list.  This is one of the major incompatibilities
between the two dialects.
</p>
<p>Like the value cell, a function cell can be empty, and it can be lambda-bound
or assigned.  The following functions are analogous to the value-cell related
functions in the previous section.
</p>
<dl>
<dt><a name="index-fsymeval"></a>Function: <strong>fsymeval</strong> <em>sym</em></dt>
<dd><p><code>fsymeval</code> returns <i>sym</i>&rsquo;s definition, the contents of its function cell.
If the function cell is empty, <code>fsymeval</code> causes an error.
</p></dd></dl>

<dl>
<dt><a name="index-fset"></a>Function: <strong>fset</strong> <em>sym x</em></dt>
<dd><p><code>fset</code> stores <i>x</i>, which may be any Lisp object, into <i>sym</i>&rsquo;s
function cell.  It returns <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-fboundp"></a>Function: <strong>fboundp</strong> <em>sym</em></dt>
<dd><p><code>fboundp</code> returns <code>nil</code> if <i>sym</i>&rsquo;s function cell is empty,
i.e. <i>sym</i> is undefined.
Otherwise it returns <code>t</code>.
</p></dd></dl>

<dl>
<dt><a name="index-fmakunbound"></a>Function: <strong>fmakunbound</strong> <em>sym</em></dt>
<dd><p><code>fmakunbound</code> causes <i>sym</i>&rsquo;s to be undefined, i.e. its
function cell to be empty.
It returns <i>sym</i>.
</p></dd></dl>

<dl>
<dt><a name="index-function_002dcell_002dlocation"></a>Function: <strong>function-cell-location</strong> <em>sym</em></dt>
<dd><p><code>function-cell-location</code> returns a locative pointer to <i>sym</i>&rsquo;s function
cell.  See the section on locatives.
</p></dd></dl>

<a name="index-definition-1"></a>
<p>The usual means of putting a function in a symbol&rsquo;s function
cell (<i>defining</i> the symbol) is by means of the <code>defun</code> special
form.  Macros are put in a symbol&rsquo;s function cell by means of the
<code>macro</code> special form.  Substitutable functions can be put there with the
<code>defsubst</code> special form.  Anything else requires the <code>deff</code> special form.
</p>
<dl>
<dt><a name="index-defun"></a>Special Form: <strong>defun</strong></dt>
<dd><p><code>defun</code> is used for defining functions.  A
<code>defun</code> form looks like:
</p>
<div class="lisp">
<pre class="lisp">(defun <i>name type lambda-list
       body</i>)
</pre></div>

<p>The <i>type</i> is only for Maclisp
compatibility, and is optional and usually absent.  The <i>lambda-list</i>
is as described on (lambda-list) and may contain &quot;&amp;-keywords&quot;.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(defun addone (x)
       (1+ x))

(defun foo (a &amp;optional (b 5) c &amp;rest e &amp;aux j)
        (setq j (+ a b))
        (cond ((not (null c))
               (cons j e))
              (t j)))
</pre></div>

<p>A list  <code>(named-lambda <i>name</i> <i>lambda-list . body</i>)</code> is left in
the function cell of <i>name</i>.
</p>
<p>For compatibility, the Maclisp <i>type</i>s <code>expr</code>, <code>fexpr</code>, and <code>macro</code>,
and Maclisp <i>lexprs</i> (which have an atomic lambda-list)
are recognized and the corresponding Lisp Machine flavor of <code>defun</code> is assumed.
</p></dd></dl>

<dl>
<dt><a name="index-defsubst"></a>Special Form: <strong>defsubst</strong></dt>
<dd><p><code>defsubst</code> is used for defining substitutable functions.  It is used just
like <code>defun</code>
</p>
<div class="lisp">
<pre class="lisp">(defsubst <i>name</i> <i>lambda-list</i> . <i>body</i>)
</pre></div>

<p>and does almost the same thing.  It defines a function which executes
identically to the one which a similar call to <i>defun</i> would define.  The
difference comes when a function which <i>calls</i> this one is compiled.  Then,
the call will be open-coded by substituting the substitutable function&rsquo;s
definition into the code being compiled.  Substitutable
functions are a sort of cross between ordinary functions and macros; they can be
applied like functions, but act like macros for the compiler.  The actual
definition looks like <code>(subst <i>lambda-list</i> . <i>body</i>)</code>.  For example, if
we define
</p>
<div class="lisp">
<pre class="lisp">(defsubst square (x) (* x x))

(defun foo (a b) (square (+ a b)))
</pre></div>

<p>then if <code>foo</code> is used interpreted, <code>square</code> will work just as if it had
been defined by <code>defun</code>.  If <code>foo</code> is compiled, however, the squaring
will be substituted into it and it will compile just like
</p>
<div class="lisp">
<pre class="lisp">(defun foo (a b) (* (+ a b) (+ a b)))
</pre></div>

<p>You will notice that the substitution performed is very simple and takes no care
about the possibility of computing an argument twice when it really ought to be
computed once.
</p></dd></dl>

<dl>
<dt><a name="index-macro"></a>Special Form: <strong>macro</strong></dt>
<dd><p><code>macro</code> is used for defining macros.  Its form is:
</p>
<div class="lisp">
<pre class="lisp">(macro <i>name</i> (<i>arg</i>)
       <i>body</i>)
</pre></div>

<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(macro addone (x)
       (list '1+ (cadr x)))

(macro increment (x)
       (list 'setq (cadr x) (list '1+ (cadr x))))
</pre></div>

<p>In the function cell of <i>name</i> is placed a cons whose car is
the symbol <code>macro</code>, and whose cdr is a <code>lambda</code>-expression of the
form <code>(lambda (<i>arg</i>) . <i>body</i>)</code>.
</p>
<p>Much of the time it is more convenient and clear to use a macro-defining
macro such as <code>defmacro</code> (see (defmacro-fun)) to define macros.
</p></dd></dl>

<dl>
<dt><a name="index-deff"></a>Special Form: <strong>deff</strong></dt>
<dd><p><code>deff</code> is used for giving a function a definition which is not obtainable
with the specific defining forms such as <code>defun</code> and <code>macro</code>.  It looks
like
</p>
<div class="lisp">
<pre class="lisp">(deff <i>name</i> <i>definition</i>)
</pre></div>

<p>where <i>definition</i> is <i>evaluated</i> so you can get any object you want.
For example,
</p>
<div class="lisp">
<pre class="lisp">(deff foo 'bar)
</pre></div>

<p>will make <code>foo</code> equivalent to <code>bar</code>, with an indirection so that if
<code>bar</code> changes <code>foo</code> will likewise change;
</p>
<div class="lisp">
<pre class="lisp">(deff foo (function bar))
</pre></div>

<p>copies the definition of <code>bar</code> into <code>foo</code> with no indirection, so that
further changes to <code>bar</code> will have no effect on <code>foo</code>.
</p></dd></dl>

<dl>
<dt><a name="index-def"></a>Special Form: <strong>def</strong></dt>
<dd><p>[from what&rsquo;s explained here, nobody would understand why def is useful.
The whole section towards functions and definitions needs to be rewritten].
</p></dd></dl>

<dl>
<dt><a name="index-fset_002dcarefully"></a>Function: <strong>fset-carefully</strong> <em>symbol definition &amp;optional force-flag</em></dt>
<dd><p>This is the same as <code>(fset <i>symbol</i> <i>definition</i>)</code> except that it
makes some checks and saves the old definition.  <code>defun</code>, <code>macro</code>,
<code>undefun</code>, <code>load</code>, and the compiler call <code>fset-carefully</code> when
they define functions.
</p>
<p><code>fset-carefully</code> prints a message and asks the user if the current
package (value of <code>package</code>) is not allowed to redefine the
<i>symbol</i>.  Specifying <i>force-flag</i> non-<code>nil</code> suppresses this
check.
</p>
<p>The previous definition, if any, of <i>symbol</i> is saved on the
<code>:previous-definition</code> property.  If it is a list, it is also saved
on the <code>:previous-expr-definition</code> property.  These properties are
used by the <code>undefun</code> function ((undefun-fun)), which restores the
previous definition, and the <code>uncompile</code> function ((uncompile-fun)),
which restores the previous interpreted definition.
</p>
<p>If <i>symbol</i> is not a symbol, but a list <code>(<i>name</i> <i>prop</i>)</code>,
then the definition is put on <i>name</i>&rsquo;s <i>prop</i> property, the
package error check is not done, and the old definition is not saved.
This is used to implement the <code>(defun (<i>name</i> <i>prop</i>) ...)</code> feature.
</p></dd></dl>

<dl>
<dt><a name="index-undefun"></a>Function: <strong>undefun</strong> <em>symbol</em></dt>
<dd><p>If <i>symbol</i> has a <code>:previous-definition</code> property,
<code>undefun</code> interchanges it with <i>symbol</i>&rsquo;s function definition.
This undoes the effect of a <code>defun</code>, <code>compile</code>, etc.
</p></dd></dl>

<dl>
<dt><a name="index-arglist"></a>Function: <strong>arglist</strong> <em>function &amp;optional literal-flag</em></dt>
<dd><p><code>arglist</code> is given a function, and returns its best guess at the nature of the function&rsquo;s
<i>lambda</i>-list.
</p>
<p>If <i>function</i> is a symbol, <code>arglist</code>
of its function definition is used.
</p>
<p>If the <i>function</i> is an actual <i>lambda</i>-expression,
its <i>cadr</i>, the lambda-list, is returned.  But if <i>function</i>
is compiled, <code>arglist</code> attempts to reconstruct the <i>lambda</i>-list of the original
definition, using whatever debugging information was saved by the compiler.
Sometimes the actual names of the bound variables are not available, and
<code>arglist</code> uses the symbol <code>*unknown*</code> for these.  Also, sometimes
the initialization of an optional parameter is too complicated
for <code>arglist</code> to reconstruct; for these it returns the symbol
<code>*hairy*</code>.
</p>
<p>Some functions&rsquo; real argument lists are not what would be most
descriptive to a user.  A function may take a &amp;rest argument for
technical reasons even though there are standard meanings for the
first element of that argument.  For such cases, the definition of the
function can specify a value to be returned when the user asks about
the argument list, with a <code>local-declare</code>.  Example:
</p>
<div class="lisp">
<pre class="lisp">(def foo                ;So the definition of foo can be found
  (local-declare ((arglist x y &amp;rest z))
    (defun foo (&amp;rest rest-arg) .....)))
</pre></div>

<p><code>literal-flag</code> allows the caller of <code>arglist</code> to say that
declared arglists of this sort should not be used.
</p>
<p><code>arglist</code> cannot be relied upon to return the exactly
correct answer, since some of the information may have been lost.
Programs interested in how many and what kind of arguments there are
should use <code>args-info</code> instead.  <code>arglist</code> is a reliable way
of getting the names of the arguments, if that information is
available, provided the <code>literal-flag</code> argument is <code>t</code>.  This
inhibits use of <code>arglist</code> declarations.
</p></dd></dl>

<dl>
<dt><a name="index-args_002dinfo"></a>Function: <strong>args-info</strong> <em>function</em></dt>
<dd><p><code>args-info</code> returns a fixnum called the &quot;numeric argument descriptor&quot;
of the <i>function</i>, which describes the way the function takes arguments.
The information in it is stored in various bits and byte fields in the
fixnum, which are referenced by the symbolic names shown below.
By the usual Lisp Machine convention, those starting with a single &quot;%&quot;
are bit-masks (meant to be <code>logand</code>ed with the number), and those
starting with &quot;%%&quot; are byte descriptors (meant to be used with <code>ldb</code>).
</p>
<p>Here are the fields:
</p>
<dl compact="compact">
<dt><code>%arg-desc-quoted-rest</code></dt>
<dd><p>If this bit is set, the function has a &quot;rest&quot; argument, and it is &quot;quoted&quot;.
Most special forms have this bit.
</p></dd>
<dt><code>%arg-desc-evaled-rest</code></dt>
<dd><p>If this bit is set, the function has a &quot;rest&quot; argument, and it is not &quot;quoted&quot;.
</p></dd>
<dt><code>%arg-desc-fef-quote-hair</code></dt>
<dd><p>If this bit is set, there are some quoted arguments other
than the &quot;rest&quot; argument (if any), and the pattern of quoting is too complicated
to describe here.  The ADL (Argument Description List) in the FEF should be consulted.
</p></dd>
<dt><code>%arg-desc-interpreted</code></dt>
<dd><p>This function is not a compiled-code object, and a numeric argument descriptor
cannot be computed.
Usually <code>args-info</code> will not return this bit, although <code>%args-info</code> will.
</p></dd>
<dt><code>%arg-desc-fef-bind-hair</code></dt>
<dd><p>There is argument initialization, or something else too
complicated to describe here.
The ADL (Argument Description List) in the FEF should be consulted.
</p></dd>
<dt><code>%%arg-desc-min-args</code></dt>
<dd><p>This is the minimum number of arguments which may be passed
to this function, i.e., the number of &quot;required&quot; parameters.
</p></dd>
<dt><code>%%arg-desc-max-args</code></dt>
<dd><p>This is the maximum number of arguments which may be passed
to this function, i.e., the sum of the number of &quot;required&quot;
parameters and the number of &quot;optional&quot; paramaters.
If there is a rest argument, this is not really the maximum
number of arguments which may be passed; an arbitrarily-large
number of arguments is permitted, subject to limitations on
the maximum size of a stack frame.
</p></dd>
</dl>

<p>Note that <code>%arg-desc-quoted-rest</code> and <code>%arg-desc-evaled-rest</code> cannot both be set.
</p></dd></dl>

<dl>
<dt><a name="index-_0025args_002dinfo"></a>Function: <strong>%args-info</strong> <em>function</em></dt>
<dd><p>This is an internal function of <code>args-info</code>; it is like <code>args-info</code> but only
works for compiled-code objects.  It exists because it has to be in the microcode
anyway, for <code>apply</code>.
</p></dd></dl>

<a name="The-Property-List"></a>
<h3 class="section">6.3 The Property List</h3>
<a name="index-property-list-1"></a>
<a name="index-indicator"></a>
<a name="index-attribute"></a>

<p>Every symbol has associated with it a <i>property list</i>, which
is a list used for associating &quot;attributes&quot; with symbols.  A property
list has an even number of elements.  Each pair of elements constitutes a
<i>property</i>;  the first of the pair is a symbol called the
<i>indicator</i>, and the second is a Lisp object called the <i>value</i>
or, more loosely, the <i>property</i>.  The indicator serves as the name
of the property, and the value as the value of the property. Here is
an example of the property list of a symbol named <code>b1</code> which is
being used by a program which deals with blocks:
<a name="index-blocks"></a>
</p>
<div class="lisp">
<pre class="lisp">        (color blue on b6 associated-with (b2 b3 b4))
</pre></div>

<p>There are three properties, and so the list has six elements.
The first property&rsquo;s indicator is the symbol <code>color</code>, and its value
is the symbol <code>blue</code>.  One says that &quot;the value of <code>b1</code>&rsquo;s <code>color</code>
property is <code>blue</code>&quot;, or, informally, that &quot;<code>b1</code>&rsquo;s <code>color</code> property
is <code>blue</code>.&quot;  The program is probably representing the information that
the block represented by <code>b1</code> is blue.  Similarly, it is probably
representing in the rest of the property list that block <code>b1</code> is on
top of block <code>b6</code>, and that <code>b1</code> is associated with blocks
<code>b2</code>, <code>b3</code>, and <code>b4</code>.
</p>
<p>When a symbol is created, its property list is initially <code>nil</code>.
</p>
<p>Because of the existence of print-name, value, function, and package cells,
none of the Maclisp system property names (<code>expr</code>, <code>fexpr</code>, <code>macro</code>, <code>array</code>,
<code>subr</code>, <code>lsubr</code>, <code>fsubr</code>, and in former times <code>value</code> and
<code>pname</code>) exist in Lisp Machine lisp.  The compiler (see (compiler))
and the editor use several properties, which are documented in those sections.
</p>
<a name="index-disembodied-property-list"></a>
<p>It is also possible to have a &quot;disembodied&quot; property list,
which is not associated with any symbol.
A disembodied property list is a cons.  Its car may be used for any purpose.
The property list resides in its cdr.
The way to create a disembodied property list is with <code>(ncons nil)</code>.
In all of the functions in this section, disembodied property lists
may be used as well as symbols; for brevity, the text speaks only of symbols.
</p>
<dl>
<dt><a name="index-get"></a>Function: <strong>get</strong> <em>sym indicator</em></dt>
<dd><p><i>get</i> looks up <i>sym</i>&rsquo;s <i>indicator</i> property.  If it finds such a property,
it returns the value; otherwise, it returns <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example: If the property list of <code>foo</code> is <code>(baz 3)</code>, then
</pre><pre class="lisp">(get 'foo 'baz) =&gt; 3
(get 'foo 'zoo) =&gt; nil
</pre></div>

</dd></dl>

<dl>
<dt><a name="index-getl"></a>Function: <strong>getl</strong> <em>sym indicator-list</em></dt>
<dd><p><code>getl</code> is like <code>get</code>, except that the second argument is a list
of indicators.  <code>getl</code> searches down <i>sym</i>&rsquo;s property list for any
of the indicators in <i>indicator-list</i>, until it finds a property whose
indicator is one of the elements of <i>indicator-list</i>.
</p>
<p><code>getl</code> returns the portion of <i>sym</i>&rsquo;s property list beginning
with the first such property which it found.  So the <i>car</i> of the returned
list is an indicator, and the <i>cadr</i> is the property value.  If none
of the indicators on <i>indicator-list</i> are on the property list, <code>getl</code>
returns <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp"><span class="roman">If the property list of</span> foo <span class="roman">were</span>
(bar (1 2 3) baz (3 2 1) color blue height six-two)
<span class="roman">then</span>
(getl 'foo '(baz height))
  =&gt; (baz (3 2 1) color blue height six-two)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-putprop"></a>Function: <strong>putprop</strong> <em>sym x indicator</em></dt>
<dd><p>This gives <i>sym</i> an <i>indicator</i>-property of <i>x</i>.
After this is done, <code>(get <i>sym indicator</i>)</code> will return <i>x</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(putprop 'Nixon 'not 'crook)
</pre></div>

<p>If <i>sym</i> already has a property with the name <i>indicator</i>,
then that property is removed first; this insures that <code>getl</code> will always
find the property that was added most recently.
</p></dd></dl>

<dl>
<dt><a name="index-defprop"></a>Special Form: <strong>defprop</strong></dt>
<dd><p><code>defprop</code> is a form of <code>putprop</code> with unevaluated arguments,
which is sometimes more convenient for typing.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(defprop foo bar next-to)
</pre></div>

<p>is the same as
</p>
<div class="lisp">
<pre class="lisp">(putprop 'foo 'bar 'next-to)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-remprop"></a>Function: <strong>remprop</strong> <em>sym indicator</em></dt>
<dd><p>This removes <i>sym</i>&rsquo;s <i>indicator</i> property, by splicing it out of the property
list.  It returns that portion of <i>sym</i>&rsquo;s property list of which the
former <i>indicator</i>-property was the <code>car</code>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp"><span class="roman">If the property list of <code>foo</code> was</span>
(color blue height six-three near-to bar)
<span class="roman">then</span>
(remprop 'foo 'height) =&gt; (six-three near-to bar)
<span class="roman">and <code>foo</code>&rsquo;s property list would be</span>
(color blue near-to bar)
</pre></div>

<p>If <i>sym</i> has no <i>indicator</i>-property, then <code>remprop</code> has no side-effect
and returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-plist-1"></a>Function: <strong>plist</strong> <em>sym</em></dt>
<dd><p>This returns the property list of <i>sym</i>.
</p></dd></dl>

<dl>
<dt><a name="index-setplist-1"></a>Function: <strong>setplist</strong> <em>sym property-list</em></dt>
<dd><p>This sets the property list of <i>sym</i> to <i>property-list</i>.  <code>setplist</code> is to be used
with caution, since property lists sometimes contain internal system properties, which
are used by many useful system functions.  Also it is inadvisable to have the property
lists of two different symbols be <code>eq</code>, since the shared list structure will
cause unexpected effects on one symbol if <code>putprop</code> or <code>remprop</code> is done to the other.
</p></dd></dl>

<dl>
<dt><a name="index-property_002dcell_002dlocation"></a>Function: <strong>property-cell-location</strong> <em>sym</em></dt>
<dd><p>This returns a locative pointer to the location of <i>sym</i>&rsquo;s property-list
cell.  See the section on locatives.
</p></dd></dl>

<a name="The-Print-Name"></a>
<h3 class="section">6.4 The Print Name</h3>
<a name="index-print-name-1"></a>

<p>Every symbol has an associated string called the <i>print-name</i>, or <i>pname</i>
for short.  This string is used as the external representation of the symbol:
if the string is typed in to <code>read</code>, it is read as a reference to that symbol
(if it is interned), and if the symbol is <i>print</i>ed, <code>print</code> types out the
print-name.
For more information, see the section on the <i>reader</i>
(see (reader)) and <i>printer</i> (see (printer)).
</p>
<dl>
<dt><a name="index-samepnamep"></a>Function: <strong>samepnamep</strong> <em>sym1 sym2</em></dt>
<dd><p>This predicate returns <code>t</code> if the two symbols <i>sym1</i> and <i>sym2</i> have
<code>equal</code> print-names; that is, if their printed representation is the same.
Upper and lower case letters are normally considered the same.
If either or both of the arguments is a string instead of a symbol, then that
string is used in place of the print-name.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(samepnamep 'xyz (maknam '(x y z)) =&gt; t

(samepnamep 'xyz (maknam '(w x y)) =&gt; nil

(samepnamep 'xyz &quot;xyz&quot;) =&gt; t
</pre></div>

<p>This is the same function as <code>string-equal</code> (see (string-equal-fun)).
</p></dd></dl>

<dl>
<dt><a name="index-get_002dpname-1"></a>Function: <strong>get-pname</strong> <em>sym</em></dt>
<dd><p>This returns the print-name of the symbol <i>sym</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(get-pname 'xyz) =&gt; &quot;xyz&quot;
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-print_002dname_002dcell_002dlocation"></a>Function: <strong>print-name-cell-location</strong> <em>sym</em></dt>
<dd><p>This returns a locative pointer to the location of <i>sym</i>&rsquo;s
print-name cell.  See the section on locatives.
Note that the contents of this cell is not actually the print name,
but the symbol header, an object which may not be directly manipulated.
Use <code>get-pname</code>, the microcode primitive which knows how to
extract the pname from the symbol header.
</p></dd></dl>

<a name="The-Creation-and-Interning-of-Symbols"></a>
<h3 class="section">6.5 The Creation and Interning of Symbols</h3>
<a name="index-intern"></a>

<p>Normally, one wants to refer to the same symbol every
time the same print-name-like string is typed.  So, when
<code>read</code> sees such a character-string in the input to Lisp,
it looks in a table called the <i>obarray</i> for some symbol
with that print-name.  If it finds such a symbol, then that is what it
returns; otherwise, it creates a symbol with that print-name (using
the <code>make-symbol</code> function, see below), enters that symbol
on the obarray, and returns it.  The sub-function of <code>read</code> which performs
these functions is called <code>intern</code>, and when a symbol has been entered
on the obarray it is said to be <i>interned</i>.
</p>
<p>A symbol can also be <i>uninterned</i>, indicating that it is not
on the obarray and cannot be referred to simply by typing its print
name.  Such symbols can be used as objects within a data-structure,
but can cause trouble during debugging because they cannot be &quot;typed in&quot;
directly, yet they look just like interned symbols when &quot;typed out&quot;.
</p>
<p>Actually there can be many obarrays; the Lisp Machine system
includes a feature called the <i>package system</i> (see (package)) which keeps track
of multiple <i>packages</i> or <i>name spaces</i> and their interrelationships,
using separate obarrays for each package.
</p>
<dl>
<dt><a name="index-make_002dsymbol"></a>Function: <strong>make-symbol</strong> <em>pname &amp;optional permanent-p</em></dt>
<dd><p>This creates a new uninterned symbol, whose print-name is the string <i>pname</i>.
The value and function bindings will be unbound, the property list will be empty,
and the package will be <code>nil</code>.  If <i>permanent-p</i> is specified, the symbol
is going to be interned and kept around forever; in this case it and its pname
will be put in the proper areas.  If <i>permanent-p</i> is <code>nil</code> (the default),
nothing special is done with areas.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq a (make-symbol &quot;foo&quot;)) =&gt; foo
(symeval a) =&gt; ERROR!
</pre></div>

<p>Note that the symbol is <i>not</i> interned; it is simply created and returned.
</p></dd></dl>

<dl>
<dt><a name="index-copysymbol"></a>Function: <strong>copysymbol</strong> <em>sym copy-p</em></dt>
<dd><p>This returns a new uninterned symbol with the same print-name
as <i>sym</i>.  If <i>copy-p</i> is non-<code>nil</code>, then the initial
value and function-definition of the new symbol will
be the same as those of <i>sym</i>, and the property list of
the new symbol will be a copy of <i>sym</i>&rsquo;s.  If <i>copy-p</i>
is <code>nil</code>, then the new symbol will be unbound and undefined, and
its property list will be <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-gensym"></a>Function: <strong>gensym</strong> <em>&amp;optional x</em></dt>
<dd><p><code>gensym</code> invents a print-name, and creates a new symbol with that print-name.
It returns the new, uninterned symbol.
</p>
<p>The invented print-name is a character prefix (the value of <code>si:*gensym-prefix</code>)
followed by the decimal representation of a number (the value of <code>si:*gensym-counter</code>),
e.g. &quot;g0001&quot;.  The number is increased by one every time <code>gensym</code> is called.
</p>
<p>If the argument <i>x</i> is present and is a fixnum, then <code>si:*gensym-counter</code> is
set to <i>x</i>.  If <i>x</i> is a string or a symbol, then <code>si:*gensym-prefix</code> is set to
the first character of the string or of the print-name.
After handling the argument, <code>gensym</code> creates a symbol as it would with no argument.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp"><span class="roman">if</span>   (gensym) =&gt; g0007
<span class="roman">then</span> (gensym 'foo) =&gt; f0008
     (gensym 40) =&gt; f0032
     (gensym) =&gt; f0033
</pre></div>

<p>Note that the number is in decimal and always has four digits, and the prefix is
always one character.
</p>
<p><code>gensym</code> is usually used to create a symbol which should not normally
be seen by the user, and whose print-name is unimportant, except to
allow easy distinction by eye between two such symbols.
The optional argument is rarely supplied.
The name comes from &quot;generate symbol&quot;, and the symbols produced by it
are often called &quot;gensyms&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-package_002dcell_002dlocation"></a>Function: <strong>package-cell-location</strong> <em>symbol</em></dt>
<dd><p>Returns a locative pointer to <i>symbol</i>&rsquo;s package cell, which contains
the package (see (package)) which owns <i>symbol</i>.
</p></dd></dl>


<a name="Numbers"></a>
<h2 class="chapter">7 Numbers</h2>
<a name="index-number-1"></a>

<p>Lisp Machine Lisp includes several types of numbers, with different
characteristics.  Most numeric functions will accept any type of numbers as
arguments and do the right thing.  That is to say, they are <i>generic</i>.
In Maclisp, there are generic numeric functions (like <code>plus</code>) and there
are specific numeric functions (like <code>+</code>) which only operate on a certain
type.  In Lisp Machine Lisp, this distinction does not exist; both function
names exist for compatibility but they are identical.  The microprogrammed
structure of the machine makes it possible to have only the generic
functions without loss of efficiency.
</p>
<p>The types of numbers in Lisp Machine Lisp are:
</p>
<dl compact="compact">
<dt><span class="roman">fixnum</span></dt>
<dd><p>Fixnums are 24-bit 2&rsquo;s complement binary integers.  These are the &quot;preferred,
most efficient&quot; type of number.
</p></dd>
<dt><span class="roman">bignum</span></dt>
<dd><p>Bignums are arbitrary-precision binary integers.
</p></dd>
<dt><span class="roman">flonum</span></dt>
<dd><p>Flonums are floating-point numbers.  They have a mantissa of 32 bits and an exponent
of 11 bits, providing a precision of about 9 digits and a range of about 10^300.
Stable rounding is employed.
</p></dd>
<dt><span class="roman">small-flonum</span></dt>
<dd><p>Small flonums are another form of floating-point number, with a mantissa of
18 bits and an exponent of 7 bits, providing a precision of about 5 digits
and a range of about 10^19.  Small flonums are useful because, like fixnums,
they don&rsquo;t require any storage.  Computing with small flonums is
more efficient than with regular flonums.
</p></dd>
</dl>

<p>Numbers are different from other objects in that they don&rsquo;t &quot;have
identity.&quot; To put it another way, <code>eq</code> does not work on them.
Numbers do not behave &quot;like objects.&quot; Fixnums and small flonums are
exceptions to this rule; some system code knows that <code>eq</code> works on
fixnums used to represent characters or small integers, and uses
<code>memq</code> or <code>assq</code> on them.
</p>
<p>The Lisp machine automatically converts between fixnums and bignums
as necessary when computing with integers.  That is, if the result
of a computation with fixnums is too large to be represented as a fixnum,
it will be represented as a bignum.  If the result of a computation
with bignums is small enough to be represented as a fixnum, it will be.
</p>
<p>The Lisp machine never automatically converts between flonums and small
flonums, since this would lead  either to inefficiency or to unexpected
numerical inaccuracies.  The user controls whether floating-point
calculations are done in large or small precision by the type of the
original input data.
</p>
<p>Integer computations cannot &quot;overflow&quot;, except for division by zero,
since bignums can be of arbitrary size.  Floating-point computations
can get exponent overflow or underflow, if the result is too large or small
to be represented.  This will signal an error.
</p>
<p>When an arithmetic function of more than one argument is given arguments of
different numeric types, uniform <i>coercion rules</i> are followed to convert
the arguments to a common type, which is also the type of the result (for
functions which return a number).  When a fixnum meets a bignum, the result
is (usually) a bignum.  When a fixnum or a bignum meets a small flonum or a flonum,
the result is a small flonum or a flonum (respectively).  When a small flonum
meets a regular flonum, the result is a regular flonum.
</p>
<p>Unlike Maclisp, Lisp Machine Lisp does not have number declarations in the compiler.
Note that because fixnums and small flonums are &quot;inums&quot; (require no associated
storage) they are as efficient as declared numbers in Maclisp.
</p>
<p>The different types of numbers are distinguished by their printed
representations.  A leading or embedded decimal point, and/or an exponent
separated by &quot;e&quot;, indicates a flonum.  If a number has an exponent
separated by &quot;s&quot;, it is a small flonum.  Small flonums require a special
indicator so that naive users will not be accidentally tricked into
computing with the lesser precision.  Fixnums and bignums have similar
printed representations; the number is a bignum if it is too big to be a
fixnum.
</p>
<a name="Numeric-Predicates"></a>
<h3 class="section">7.1 Numeric Predicates</h3>

<dl>
<dt><a name="index-zerop"></a>Function: <strong>zerop</strong> <em>x</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> is zero.  Otherwise it returns <code>nil</code>.
If <i>x</i> is not a number, <code>zerop</code> causes an error.
</p></dd></dl>

<dl>
<dt><a name="index-plusp"></a>Function: <strong>plusp</strong> <em>x</em></dt>
<dd><p>Returns <code>t</code> if its argument is a positive number, strictly greater
than zero.  Otherwise it returns <code>nil</code>.
If <i>x</i> is not a number, <code>plusp</code> causes an error.
</p></dd></dl>

<dl>
<dt><a name="index-minusp"></a>Function: <strong>minusp</strong> <em>x</em></dt>
<dd><p>Returns <code>t</code> if its argument is a negative number, strictly
less than zero.  Otherwise it returns <code>nil</code>.
If <i>x</i> is not a number, <code>minusp</code> causes an error.
</p></dd></dl>

<dl>
<dt><a name="index-oddp"></a>Function: <strong>oddp</strong> <em>number</em></dt>
<dd><p>Returns <code>t</code> if <i>number</i> is odd, otherwise <code>nil</code>.
If <i>number</i> is not a fixnum or a bignum, <code>oddp</code> causes an error.
</p></dd></dl>

<dl>
<dt><a name="index-evenp"></a>Function: <strong>evenp</strong> <em>number</em></dt>
<dd><p>Returns <code>t</code> if <i>number</i> is even, otherwise <code>nil</code>.
If <i>number</i> is not a fixnum or a bignum, <code>evenp</code> causes an error.
</p></dd></dl>

<dl>
<dt><a name="index-signp"></a>Special Form: <strong>signp</strong></dt>
<dd><p><i>signp</i> is used to test the sign of a number.  It is present
only for Maclisp compatibility, and is not recommended for use in new
programs.  <code>(signp <i>test x</i>)</code> returns <code>t</code> if <i>x</i> is a number
which satisfies the <i>test</i>, <code>nil</code> if it is not.  <i>test</i> is not
evaluated, but <i>x</i> is.
<i>test</i> can be one of the following:
</p>
<dl compact="compact">
<dt><code>l</code></dt>
<dd><p>x &lt; 0
</p></dd>
<dt><code>le</code></dt>
<dd><p>x  0
</p></dd>
<dt><code>e</code></dt>
<dd><p>x = 0
</p></dd>
<dt><code>n</code></dt>
<dd><p>x  0
</p></dd>
<dt><code>ge</code></dt>
<dd><p>x  0
</p></dd>
<dt><code>g</code></dt>
<dd><p>x &gt; 0
</p></dd>
</dl>

<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(signp le 12) =&gt; t
(signp n 0) =&gt; nil
(signp g 'foo) =&gt; nil
</pre></div>
</dd></dl>

<p>See also the data-type predicates <code>fixp</code>, <code>floatp</code>, <code>bigp</code>,
<code>small-floatp</code>, and <code>numberp</code> ((fixp-fun)).
</p>
<p>All of these functions require that their arguments be numbers, and signal
an error if given a non-number.  They work on all types of numbers,
automatically performing any required coercions.
</p>
<dl>
<dt><a name="index-_003d"></a>Function: <strong>=</strong> <em>x y</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> and <i>y</i> are numerically equal.
</p></dd></dl>

<dl>
<dt><a name="index-greaterp"></a>Function: <strong>greaterp</strong> <em>x y &amp;rest more-args</em></dt>
<dd><p><code>greaterp</code> compares its arguments from left to right.  If any argument
is not greater than the next, <code>greaterp</code> returns <code>nil</code>.  But if the
arguments are monotonically strictly decreasing, the result is <code>t</code>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(greaterp 4 3) =&gt; t
(greaterp 4 3 2 1 0) =&gt; t
(greaterp 4 3 1 2 0) =&gt; nil
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-_003e"></a>Function: <strong>&gt;</strong> <em>x y</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> is strictly greater than <i>y</i>, and <code>nil</code>
otherwise.
</p></dd></dl>

<dl>
<dt><a name="index-_003e_003d"></a>Macro: <strong>&gt;=</strong> <em>x y</em></dt>
<dt><a name="index-_0011_001d"></a>Macro: <strong></strong> <em>x y</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> is greater than or equal to <i>y</i>, and <code>nil</code>
otherwise.
</p></dd></dl>

<dl>
<dt><a name="index-lessp"></a>Function: <strong>lessp</strong> <em>x y &amp;rest more-args</em></dt>
<dd><p><code>lessp</code> compares its arguments from left to right.  If any argument
is not less than the next, <code>lessp</code> returns <code>nil</code>.  But if the
arguments are monotonically strictly increasing, the result is <code>t</code>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(lessp 3 4) =&gt; t
(lessp 1 1) =&gt; nil
(lessp 0 1 2 3 4) =&gt; t
(lessp 0 1 3 2 4) =&gt; nil
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-_003c"></a>Function: <strong>&lt;</strong> <em>x y</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> is strictly less than <i>y</i>, and <code>nil</code>
otherwise.
</p></dd></dl>

<dl>
<dt><a name="index-_003c_003d"></a>Macro: <strong>&lt;=</strong> <em>x y</em></dt>
<dt><a name="index-_0011_001c"></a>Macro: <strong></strong> <em>x y</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> is less than or equal to <i>y</i>, and <code>nil</code>
otherwise.
</p></dd></dl>

<dl>
<dt><a name="index-_0011_001a"></a>Macro: <strong></strong> <em>x y</em></dt>
<dd><p>Returns <code>t</code> if <i>x</i> is not equal to <i>y</i>, and <code>nil</code> otherwise.
</p></dd></dl>

<a name="Arithmetic"></a>
<h3 class="section">7.2 Arithmetic</h3>

<p>All of these functions require that their arguments be numbers, and signal
an error if given a non-number.  They work on all types of numbers,
automatically performing any required coercions.
</p>
<dl>
<dt><a name="index-plus"></a>Function: <strong>plus</strong> <em>&amp;rest args</em></dt>
<dt><a name="index-_002b"></a>Function: <strong>+</strong> <em>&amp;rest args</em></dt>
<dt><a name="index-_002b_0024"></a>Function: <strong>+$</strong> <em>&amp;rest args</em></dt>
<dd><p>Returns the sum of its arguments.  If there are no arguments, it returns
0, which is the identity for this operation.
</p></dd></dl>

<dl>
<dt><a name="index-difference"></a>Function: <strong>difference</strong> <em>arg &amp;rest args</em></dt>
<dd><p>Returns its first argument minus all of the rest of its arguments.
</p></dd></dl>

<dl>
<dt><a name="index-_002d"></a>Function: <strong>-</strong> <em>arg &amp;rest args</em></dt>
<dt><a name="index-_002d_0024"></a>Function: <strong>-$</strong> <em>arg &amp;rest args</em></dt>
<dd><p>With only one argument, <code>-</code> is the same as <code>minus</code>; it
returns the negative of its argument.
With more than one argument, <code>-</code> is the same as <code>difference</code>;
it returns its first argument minus all of the rest of its arguments.
</p></dd></dl>

<dl>
<dt><a name="index-times"></a>Function: <strong>times</strong> <em>&amp;rest args</em></dt>
<dt><a name="index-_002a"></a>Function: <strong>*</strong> <em>&amp;rest args</em></dt>
<dt><a name="index-_002a_0024"></a>Function: <strong>*$</strong> <em>&amp;rest args</em></dt>
<dd><p>Returns the product of its arguments.  If there are no arguments, it
returns 1, which is the identity for this operation.
</p></dd></dl>

<dl>
<dt><a name="index-quotient"></a>Function: <strong>quotient</strong> <em>arg &amp;rest args</em></dt>
<dd><p>Returns the first argument divided by all of the rest of its arguments.
</p></dd></dl>

<dl>
<dt><a name="index-_002f_002f"></a>Function: <strong>//</strong> <em>arg &amp;rest args</em></dt>
<dt><a name="index-_002f_002f_0024"></a>Function: <strong>//$</strong> <em>arg &amp;rest args</em></dt>
<dd><p>The name of this function is written <code>//</code> rather than <code>/</code> because
<code>/</code> is the quoting character in Lisp syntax and must be doubled.
With more than one argument, <code>//</code> is the same as <code>quotient</code>;
it returns the first argument divided by all of the rest of its arguments.
With only one argument, <code>(// <i>x</i>)</code> is the same as <code>(// 1 <i>x</i>)</code>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(// 3 2) =&gt; 1       <span class="roman">;Fixnum division truncates.</span>
(// 3 2.0) =&gt; 1.5
(// 3 2.0s0) =&gt; 1.5s0
(// 4 2) =&gt; 2
(// 12. 2. 3.) =&gt; 2
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-add1"></a>Function: <strong>add1</strong> <em>x</em></dt>
<dt><a name="index-1_002b"></a>Function: <strong>1+</strong> <em>x</em></dt>
<dt><a name="index-1_002b_0024"></a>Function: <strong>1+$</strong> <em>x</em></dt>
<dd><p><code>(add1 x)</code> is the same as <code>(plus x 1)</code>.
</p></dd></dl>

<dl>
<dt><a name="index-sub1"></a>Function: <strong>sub1</strong> <em>x</em></dt>
<dt><a name="index-1_002d"></a>Function: <strong>1-</strong> <em>x</em></dt>
<dt><a name="index-1_002d_0024"></a>Function: <strong>1-$</strong> <em>x</em></dt>
<dd><p><code>(sub1 x)</code> is the same as <code>(difference x 1)</code>.  Note that the
short name may be confusing: <code>(1- x)</code> does <i>not</i> mean 1-x;
rather, it means x-1.
</p></dd></dl>

<dl>
<dt><a name="index-remainder"></a>Function: <strong>remainder</strong> <em>x y</em></dt>
<dt><a name="index-_005c"></a>Function: <strong>\</strong> <em>x y</em></dt>
<dd><p>Returns the remainder of <i>x</i> divided by <i>y</i>.
<i>x</i> and <i>y</i> may not be flonums nor small flonums.
</p></dd></dl>

<dl>
<dt><a name="index-gcd"></a>Function: <strong>gcd</strong> <em>x y</em></dt>
<dt><a name="index-_005c_005c"></a>Function: <strong>\\</strong> <em>x y</em></dt>
<dd><p>Returns the greatest common divisor of <i>x</i> and <i>y</i>.
<i>x</i> and <i>y</i> may not be flonums nor small flonums.
</p></dd></dl>

<dl>
<dt><a name="index-expt"></a>Function: <strong>expt</strong> <em>x y</em></dt>
<dt><a name="index-_005e"></a>Function: <strong>^</strong> <em>x y</em></dt>
<dt><a name="index-_005e_0024"></a>Function: <strong>^$</strong> <em>x y</em></dt>
<dd><p>Returns <i>x</i> raised to the <i>y</i>&rsquo;th power.  <i>y</i> must be a fixnum.
[I guess this is incompatible with Maclisp.]
</p></dd></dl>

<dl>
<dt><a name="index-exp"></a>Function: <strong>exp</strong> <em>x</em></dt>
<dd><p>Returns <i>e</i> raised to the <i>x</i>&rsquo;th power, where <i>e</i> is the base of natural logarithms.
</p></dd></dl>

<dl>
<dt><a name="index-log"></a>Function: <strong>log</strong> <em>x</em></dt>
<dd><p>Returns the natural logarithm of <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-sin"></a>Function: <strong>sin</strong> <em>x</em></dt>
<dd><p>Returns the sine of <i>x</i> in radians.
</p></dd></dl>

<dl>
<dt><a name="index-sind"></a>Function: <strong>sind</strong> <em>x</em></dt>
<dd><p>Returns the sine of <i>x</i> in degrees.
</p></dd></dl>

<dl>
<dt><a name="index-cos"></a>Function: <strong>cos</strong> <em>x</em></dt>
<dd><p>Returns the cosine of <i>x</i> in radians.
</p></dd></dl>

<dl>
<dt><a name="index-cosd"></a>Function: <strong>cosd</strong> <em>x</em></dt>
<dd><p>Returns the cosine of <i>x</i> in degrees.
</p></dd></dl>

<dl>
<dt><a name="index-sqrt"></a>Function: <strong>sqrt</strong> <em>x</em></dt>
<dd><p>Returns the square root of <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-atan"></a>Function: <strong>atan</strong> <em>y x</em></dt>
<dd><p>Returns the arctangent of the angle <i>y/x</i>. It always returns a
non-negative number between zero and /2.
</p></dd></dl>

<dl>
<dt><a name="index-atan2"></a>Function: <strong>atan2</strong> <em>y x</em></dt>
<dd><p>Returns the arctangent of the angle <i>y/x</i>, except that it returns a
number between -/2 and /2.
</p></dd></dl>

<dl>
<dt><a name="index-max"></a>Function: <strong>max</strong> <em>&amp;rest args</em></dt>
<dd><p><code>max</code> returns the largest of its arguments.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(max 1 3 2) =&gt; 3
</pre></div>

<p><code>max</code> requires at least one argument.
</p></dd></dl>

<dl>
<dt><a name="index-min"></a>Function: <strong>min</strong> <em>&amp;rest args</em></dt>
<dd><p><code>min</code> returns the smallest of its arguments.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(min 1 3 2) =&gt; 1
</pre></div>

<p><code>min</code> requires at least one argument.
</p></dd></dl>

<dl>
<dt><a name="index-abs"></a>Function: <strong>abs</strong> <em>x</em></dt>
<dd><p>Returns <code>|<i>x</i>|</code>, the absolute value of the number <i>x</i>.
<code>abs</code> could have been defined by:
</p>
<div class="lisp">
<pre class="lisp">(defun abs (x)
    (cond ((minusp x) (minus x))
          (t x)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-minus"></a>Function: <strong>minus</strong> <em>x</em></dt>
<dd><p>Returns the negative of <i>x</i>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(minus 1) =&gt; -1
(minus -3) =&gt; 3
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-_002adif"></a>Function: <strong>*dif</strong> <em>x y</em></dt>
<dt><a name="index-_002aplus"></a>Function: <strong>*plus</strong> <em>x y</em></dt>
<dt><a name="index-_002aquo"></a>Function: <strong>*quo</strong> <em>x y</em></dt>
<dt><a name="index-_002atimes"></a>Function: <strong>*times</strong> <em>x y</em></dt>
<dd><p>These are the internal micro-coded arithmetic functions.  There is no
reason why anyone should need to refer to these explicitly, since the
compiler knows how to generate the appropriate code for <code>plus</code>,
<code>+</code>, etc.  These names are only here for Maclisp compatibility.
</p></dd></dl>

<p>The following functions are provided to allow specific conversions of data
types to be forced, when desired.
</p>
<dl>
<dt><a name="index-fix"></a>Function: <strong>fix</strong> <em>x</em></dt>
<dd><p>Converts <i>x</i> from a flonum (or small-flonum) to an integer, by truncation.
The result is a fixnum or a bignum as appropriate.  If <i>x</i> is already
a fixnum or a bignum, it is returned unchanged.
</p></dd></dl>

<dl>
<dt><a name="index-fixr"></a>Function: <strong>fixr</strong> <em>x</em></dt>
<dd><p>Converts <i>x</i> from a flonum (or small-flonum) to an integer, by truncation.
</p></dd></dl>

<dl>
<dt><a name="index-float"></a>Function: <strong>float</strong> <em>x</em></dt>
<dd><p>Converts <i>x</i> to a flonum.  <i>x</i> may be a fixnum, a bignum, a small-flonum,
or a flonum.
</p></dd></dl>

<dl>
<dt><a name="index-small_002dfloat"></a>Function: <strong>small-float</strong> <em>x</em></dt>
<dd><p>Converts <i>x</i> to a small flonum.  <i>x</i> may be a fixnum, a bignum, a small-flonum,
or a flonum.
</p></dd></dl>


<a name="Random-Functions"></a>
<h3 class="section">7.3 Random Functions</h3>

<dl>
<dt><a name="index-random"></a>Function: <strong>random</strong> <em>&amp;optional arg (array <code>si:random-array</code>)</em></dt>
<dd><p><code>(random)</code> returns a random fixnum, positive or negative.
If <i>arg</i> is present, a fixnum between 0 and <i>arg</i>-1 inclusive is returned.
If <i>array</i> is present, the given array is used instead of the default
one (see below).
[The random algorithm should be described.]
</p></dd></dl>

<dl>
<dt><a name="index-si_003arandom_002dcreate_002darray"></a>Function: <strong>si:random-create-array</strong> <em>size offset seed &amp;optional (area <code>default-array-area</code>)</em></dt>
<dd><p>Creates, initializes and returns a random-number-generator array.
This is used for more advanced applications of the pseudo-random
number generator, in which it is desirable to have several different
controllable resettable sources of random numbers.  For the exact
meaning of the arguments, read the code.
<i>size</i> is the size of the array, <i>offset</i> is an integer less than
<i>size</i>, <i>seed</i> is a fixnum.
This calls <code>si:random-initialize</code> on the random array before returning it.
</p></dd></dl>

<dl>
<dt><a name="index-si_003arandom_002dinitialize"></a>Function: <strong>si:random-initialize</strong> <em>array</em></dt>
<dd><p><i>array</i> must be a random-number-generator array, such as
is created by <code>si:random-create-array</code>.  It reinitializes the
contents of the array from the seed (calling <code>random</code> changes
the contents of the array and the pointers, but not the seed).
</p></dd></dl>

<dl>
<dt><a name="index-si_003arandom_002darray"></a>Variable: <strong>si:random-array</strong></dt>
<dd><p>The value of <code>si:random-array</code> is the default random-number-generator array.
It is created if <code>random</code> is called and <code>si:random-array</code> is unbound.
A random-number-generator array has a leader which is a structure with
the following elements:
</p>
<dl compact="compact">
<dt><code>si:random-fill-pointer</code></dt>
<dd><p>The fill-pointer, the length of the array.
</p></dd>
<dt><code>si:random-seed</code></dt>
<dd><p>The seed from which to initialize the contents.
</p></dd>
<dt><code>si:random-pointer-1</code></dt>
<dd><p>The first pointer.
</p></dd>
<dt><code>si:random-pointer-2</code></dt>
<dd><p>The second pointer.
</p></dd>
</dl>

</dd></dl>

<a name="Logical-Operations-on-Numbers"></a>
<h3 class="section">7.4 Logical Operations on Numbers</h3>

<p>Except for <code>lsh</code> and <code>rot</code>, these functions operate on either
fixnums or bignums.  <code>lsh</code> and <code>rot</code> have an inherent word-length
limitation and hence only operate on 24-bit fixnums.  Negative numbers
are operated on in their 2&rsquo;s-complement representation.  (Negative
numbers used to be disallowed in some cases.)
</p>
<dl>
<dt><a name="index-logior"></a>Function: <strong>logior</strong> <em>&amp;rest args</em></dt>
<dd><p>Returns the bit-wise logical <i>inclusive or</i> of its arguments.
A minimum of one argument is required.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(logior 4002 67) =&gt; 4067
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-logxor"></a>Function: <strong>logxor</strong> <em>&amp;rest args</em></dt>
<dd><p>Returns the bit-wise logical <i>exclusive or</i> of its arguments.
A minimum of one argument is required.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(logxor 2531 7777) =&gt; 5246
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-logand"></a>Function: <strong>logand</strong> <em>&amp;rest args</em></dt>
<dd><p>Returns the bit-wise logical <i>and</i> of its arguments.
A minimum of one argument is required.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(logand 3456 707) =&gt; 406
(logand 3456 -100) =&gt; 3400
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-boole"></a>Function: <strong>boole</strong> <em>fn &amp;rest args</em></dt>
<dd><p><code>boole</code> is the generalization of <code>logand</code>, <code>logior</code>, and <code>logxor</code>.
<i>fn</i> should be a fixnum between 0 and 17 octal inclusive;
it controls the function which is computed.  If the binary representation
of <i>fn</i> is <i>abcd</i> (<i>a</i> is the most significant bit, <i>d</i> the least)
then the truth table for the Boolean operation is as follows:
</p>
<div class="lisp">
<pre class="lisp">       y
   | 0  1
---------
  0| a  c
x  |
  1| b  d
</pre></div>

<p>If <code>boole</code> has more than three arguments, it is associated left
to right; thus,
</p>
<div class="lisp">
<pre class="lisp">(boole fn x y z) = (boole fn (boole fn x y) z)
</pre></div>

<p>With two arguments, the result of <code>boole</code> is simply its second argument.
A minimum of two arguments is required.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(boole 1 x y) = (logand x y)
(boole 6 x y) = (logxor x y)
</pre></div>

<p><code>logand</code>, <code>logior</code>, and <code>logxor</code> are usually preferred over <code>boole</code>.
</p></dd></dl>

<dl>
<dt><a name="index-bit_002dtest"></a>Function: <strong>bit-test</strong> <em>x y</em></dt>
<dd><p><code>bit-test</code> is a predicate which returns <code>t</code> if any of
the bits designated by the 1&rsquo;s in <i>x</i> are 1&rsquo;s in <i>y</i>.
<code>bit-test</code> is implemented as a macro which expands as follows:
</p>
<div class="lisp">
<pre class="lisp">(bit-test <i>x</i> <i>y</i>) ==&gt; (not (zerop (logand <i>x</i> <i>y</i>)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-ldb_002dtest"></a>Function: <strong>ldb-test</strong> <em>ppss y</em></dt>
<dd><p><code>ldb-test</code> is a predicate which returns <code>t</code> if any of
the bits designated by the byte specifier <i>ppss</i> are 1&rsquo;s in <i>y</i>.
That is, it returns <code>t</code> if the designated field is non-zero.
<code>ldb-test</code> is implemented as a macro which expands as follows:
</p>
<div class="lisp">
<pre class="lisp">(ldb-test <i>ppss</i> <i>y</i>) ==&gt; (not (zerop (ldb <i>ppss</i> <i>y</i>)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-lsh"></a>Function: <strong>lsh</strong> <em>x y</em></dt>
<dd><p>Returns <i>x</i> shifted left <i>y</i> bits if <i>y</i> is positive or zero,
or <i>x</i> shifted right <code>|<i>y</i>|</code> bits if <i>y</i> is negative.
Zero bits are shifted in (at either end) to fill unused positions.
<i>x</i> and <i>y</i> must be fixnums.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(lsh 4 1) =&gt; 10    <span class="roman">;(octal)</span>
(lsh 14 -2) =&gt; 3
(lsh -1 1) =&gt; -2
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-ash"></a>Function: <strong>ash</strong> <em>x y</em></dt>
<dd><p>Shifts <i>x</i> arithmetically left <i>y</i> bits, or right <i>-y</i> bits,
depending on the sign of <i>y</i>.  <i>x</i> may be a fixnum or a bignum.
The sign of the result is always the same as the sign of <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-rot"></a>Function: <strong>rot</strong> <em>x y</em></dt>
<dd><p>Returns <i>x</i> rotated left <i>y</i> bits if <i>y</i> is positive or zero,
or <i>x</i> rotated right <code>|<i>y</i>|</code> bits if <i>y</i> is negative.
The rotation considers <i>x</i> as a 24-bit number (unlike Maclisp,
which considers <i>x</i> to be a 36-bit number in both the pdp-10
and Multics implementations).
<i>x</i> and <i>y</i> must be fixnums.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(rot 1 2) =&gt; 4
(rot 1 -2) =&gt; 20000000
(rot -1 7) =&gt; -1
(rot 15 24.) =&gt; 15
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-haipart"></a>Function: <strong>haipart</strong> <em>x n</em></dt>
<dd><p>Returns the high <i>n</i> bits of the binary representation of <code>|<i>x</i>|</code>,
or the low <code>|<i>n</i>|</code> bits if <i>n</i> is negative.
<i>x</i> may be a fixnum or a bignum; note that if <i>x</i> is negative
its absolute value is used.
</p></dd></dl>

<dl>
<dt><a name="index-haulong"></a>Function: <strong>haulong</strong> <em>x</em></dt>
<dd><p>This returns the number of significant bits in <i>x</i>.  <i>x</i> may be a fixnum or a bignum.
The result does not depend on the sign of <i>x</i>.
The result is the least integer not less than the base-2 logarithm of <code>|<i>x</i>|+1</code>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(haulong 0) =&gt; 0
(haulong 3) =&gt; 2
(haulong -7) =&gt; 3
</pre></div>
</dd></dl>

<a name="Byte-Manipulation-Functions"></a>
<h3 class="section">7.5 Byte Manipulation Functions</h3>
<a name="index-byte"></a>

<p>Several functions are provided for dealing with an arbitrary-width field of
contiguous bits appearing anywhere in an integer (a fixnum or a bignum).
Such a contiguous set of bits is called a <i>byte</i>.  Note that
we are not using the term <i>byte</i> to mean eight bits, but rather
any number of bits within a number.
These functions use numbers called <i>byte specifiers</i> to
<a name="index-byte-specifiers"></a>
designate a specific byte position within any word.  Byte specifiers are fixnums
whose two lowest octal digits represent the <i>size</i> of the
byte, and whose higher (usually two, but sometimes more)
octal digits represent the <i>position</i>
of the byte within a number, counting from the right in bits.  A position
of zero means that the byte is at the right end of the number.
For example, the byte-specifier 0010 (i.e., 10 octal) refers to the lowest
eight bits of a word, and the byte-specifier 1010 refers to the next eight
bits.  These byte-specifiers will be stylized below as <i>ppss</i>.
<a name="index-ppss"></a>
The maximum value of the <i>ss</i> digits is 27 (octal), since a byte must
fit in a fixnum although bytes can be loaded from and deposited into bignums.
(Bytes are always positive numbers.)
The format of byte-specifiers is taken from the pdp-10 byte instructions.
</p>
<dl>
<dt><a name="index-ldb-1"></a>Function: <strong>ldb</strong> <em>ppss num</em></dt>
<dd><p><i>ppss</i> specifies a byte of <i>num</i>, which is returned as a number,
right-justified.  The <i>ss</i> bits of the byte starting at bit <i>pp</i>
are the lowest <i>ss</i> bits in the returned value, and the rest of the
bits in the returned value are zero.  The name of the function,
<code>ldb</code>, means &quot;load byte&quot;.  <i>num</i> may be a fixnum or a bignum.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(ldb 0306 4567) =&gt; 56
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-mask_002dfield"></a>Function: <strong>mask-field</strong> <em>ppss num</em></dt>
<dd><p>This is similar to <code>ldb</code>; however, the specified byte
of <i>num</i> is returned as a number in position <i>pp</i> of
the returned word, instead of position 0 as with <code>ldb</code>.
<i>num</i> must be a fixnum.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(mask-field 0306 4567) =&gt; 560
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-dpb"></a>Function: <strong>dpb</strong> <em>byte ppss num</em></dt>
<dd><p>Returns a number which is the same as <i>num</i> except in the
bits specified by <i>ppss</i>.  The low
<i>ss</i> bits of <i>byte</i> are placed in those bits.  <i>byte</i> is interpreted as
being right-justified, as if it were the result of <code>ldb</code>.
<i>num</i> may be a fixnum or a bignum.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(dpb 23 0306 4567) =&gt; 4237
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-deposit_002dfield"></a>Function: <strong>deposit-field</strong> <em>byte ppss num</em></dt>
<dd><p>This is like <code>dpb</code>, except that <i>byte</i> is not taken to
be left-justified; the <i>ppss</i> bits of <i>byte</i> are used
for the <i>ppss</i> bits of the result, with the rest of the
bits taken from <i>num</i>.  <i>num</i> must be a fixnum.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(deposit-field 230 0306 4567) =&gt; 4237
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-_0025logldb"></a>Function: <strong>%logldb</strong> <em>ppss fixnum</em></dt>
<dd><p><code>%logldb</code> is like <code>ldb</code> except that it only loads out of fixnums and
allows a byte size of 30 (octal), i.e. the whole fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-_0025logdpb"></a>Function: <strong>%logdpb</strong> <em>byte ppss fixnum</em></dt>
<dd><p><code>%logdpb</code> is like <code>dpb</code> except that it only deposits into fixnums.
Using this to change the sign-bit will leave the result as a fixnum,
while <code>dpb</code> would produce a bignum result for arithmetic correctness.
<code>%logdpb</code> is good for manipulating fixnum bit-masks such as are used
in some internal system tables and data-structures.
</p></dd></dl>

<a name="g_t24_002dBit-Numbers"></a>
<h3 class="section">7.6 24-Bit Numbers</h3>

<p>Sometimes it is desirable to have a form of arithmetic which has no
overflow checking (which would produce bignums),
and truncates results to the word size of the machine.
In Lisp Machine Lisp, this is provided by the following set of functions.
Their answers are only correct modulo 2^24.
</p>
<p>These functions should <i>not</i> be used for &quot;efficiency&quot;;
they are probably less efficient than the functions which <i>do</i> check for
overflow.  They are intended for algorithms which require this sort of
arithmetic, such as hash functions and pseudo-random number generation.
</p>
<dl>
<dt><a name="index-_002524_002dbit_002dplus"></a>Function: <strong>%24-bit-plus</strong> <em>x y</em></dt>
<dd><p>Returns the sum of <i>x</i> and <i>y</i> modulo 2^24.  Both arguments should
be fixnums.
</p></dd></dl>

<dl>
<dt><a name="index-_002524_002dbit_002ddifference"></a>Function: <strong>%24-bit-difference</strong> <em>x y</em></dt>
<dd><p>Returns the difference of <i>x</i> and <i>y</i> modulo 2^24.  Both arguments should
be fixnums.
</p></dd></dl>

<dl>
<dt><a name="index-_002524_002dbit_002dtimes"></a>Function: <strong>%24-bit-times</strong> <em>x y</em></dt>
<dd><p>Returns the product of <i>x</i> and <i>y</i> modulo 2^24.  Both arguments should
be fixnums.
</p></dd></dl>

<a name="Double_002dPrecision-Arithmetic"></a>
<h3 class="section">7.7 Double-Precision Arithmetic</h3>

<p>These peculiar functions are useful in programs that don&rsquo;t want to use
bignums for one reason or another.
</p>
<dl>
<dt><a name="index-_0025multiply_002dfractions"></a>Function: <strong>%multiply-fractions</strong> <em>num1 num2</em></dt>
<dd><p>Returns bits 24 through 46 (the most significant half)
of the product of <i>num1</i> and <i>num2</i>.
If you call this and <code>%24-bit-times</code> on the same arguments <i>num1</i>
and <i>num2</i>, regarding them as integers, you can combine
the results into a double-precision product.
If <i>num1</i> and <i>num2</i> are regarded as fractions, <code>-1  <i>num</i> &lt; 1</code>,
<code>%multiply-fractions</code> returns 1/2 of their correct product as a fraction.
(The name of this function isn&rsquo;t too great.)
</p></dd></dl>

<dl>
<dt><a name="index-_0025divide_002ddouble"></a>Function: <strong>%divide-double</strong> <em>dividend[24:46] dividend[0:23] divisor</em></dt>
<dd><p>Divides the double-precision number given by the first two
arguments by the third argument, and returns the single-precision
quotient.  Causes an error if division by zero or if the quotient won&rsquo;t
fit in single precision.
</p></dd></dl>

<dl>
<dt><a name="index-_0025remainder_002ddouble"></a>Function: <strong>%remainder-double</strong> <em>dividend[24:46] dividend[0:23] divisor</em></dt>
<dd><p>Divides the double-precision number given by the first two
arguments by the third argument, and returns the
remainder.  Causes an error if division by zero.
</p></dd></dl>

<dl>
<dt><a name="index-_0025float_002ddouble"></a>Function: <strong>%float-double</strong> <em>high24 low24</em></dt>
<dd><p><i>high24</i> and <i>low24</i>, which must be fixnums, are concatenated
to produce a 48-bit unsigned positive integer.  A flonum containing the
same value is constructed and returned.  Note that only the 31 most-significant
bits are retained (after removal of leading zeroes.)  This function is
mainly for the benefit of <code>read</code>.
</p></dd></dl>

<a name="Strings"></a>
<h2 class="chapter">8 Strings</h2>
<a name="index-string-1"></a>

<p>Strings are a type of array which are constants (they self-evaluate)
and have as their printed representation a sequence of characters enclosed
in quote marks, for example <code>&quot;foo bar&quot;</code>.  Strings are the right data type
to use for text-processing.
</p>
<p>The functions described in this section provide a variety of
useful operations on strings.  Several of the functions actually work
on any type of 1-dimensional array and may be useful for other than string processing.
<code>art-16b</code> arrays (arrays of 16-bit positive numbers) are often used
as strings; the extra bits allow for an expanded character set.
</p>
<p>In place of a string, most of these functions will accept a symbol or a fixnum
as an argument, and will coerce it into a string.  Given a symbol, its print name,
which is a string, will be used.  Given a fixnum, a 1 character long string
containing the character designated by that fixnum will be used.
</p>
<p>Note that the length of a string is computed using <code>array-active-length</code>,
so that if a string has an array-leader, element 0 of the leader (called the
<i>fill pointer</i>) will be taken as the length.
</p>
<p>Since strings are arrays, the usual array-referencing function <code>aref</code>
is used to extract the characters of the string as fixnums.  For example,
</p>
<div class="lisp">
<pre class="lisp">(aref &quot;frob&quot; 1) =&gt; 162  <span class="roman">;lower-case r</span>
</pre></div>

<p>It is also legal to store into strings (using <code>aset</code>).
As with <code>rplaca</code> on lists, this changes the actual object; one must be careful
to understand where side-effects will propagate to.
</p>
<a name="String-Manipulation"></a>
<h3 class="section">8.1 String Manipulation</h3>

<dl>
<dt><a name="index-character"></a>Function: <strong>character</strong> <em>x</em></dt>
<dd><p><code>character</code> coerces <i>x</i> to a single character,
represented as a fixnum.  If <i>x</i> is a number, it is returned.  If
<i>x</i> is a string or an array, its first element is returned.  If
<i>x</i> is a symbol, the first character of its pname is returned.
Otherwise, an error occurs.
</p></dd></dl>

<dl>
<dt><a name="index-char_002dequal"></a>Function: <strong>char-equal</strong> <em>ch1 ch2</em></dt>
<dd><p>This is the primitive for comparing characters for equality;
many of the string functions call it.  <i>ch1</i> and <i>ch2</i>
must be fixnums.  The result is <code>t</code> if the characters are equal ignoring
case and font, otherwise <code>nil</code>.
<code>%%ch-char</code> is the byte-specifier for the portion of a character
which excludes the font information.
</p></dd></dl>

<dl>
<dt><a name="index-char_002dlessp"></a>Function: <strong>char-lessp</strong> <em>ch1 ch2</em></dt>
<dd><p>This is the primitive for comparing characters for order;
many of the string functions call it.  <i>ch1</i> and <i>ch2</i>
must be fixnums.  The result is <code>t</code> if <i>ch1</i> comes before <i>ch2</i>
ignoring case and font, otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-alphabetic_002dcase_002daffects_002dstring_002dcomparison"></a>Variable: <strong>alphabetic-case-affects-string-comparison</strong></dt>
<dd><p>This variable is normally <code>nil</code>.  If it is <code>t</code>, <code>char-equal</code>,
<code>char-lessp</code>, and the string searching and comparison functions will
distinguish between upper-case and lower-case letters.  It is alright
to bind this to <code>t</code>, but changing its global value to <code>t</code> will
break many system functions and user interfaces and so is not recommended.
</p></dd></dl>

<dl>
<dt><a name="index-string-2"></a>Function: <strong>string</strong> <em>x</em></dt>
<dd><p><code>string</code> coerces <i>x</i> into a string.  Most of the string
functions apply this to their string arguments.
If <i>x</i> is a string or an array, it is returned.  If <i>x</i> is
a symbol, its pname is returned.  If <i>x</i> is a number, a 1-character
long string containing it is returned.  Otherwise, an error occurs.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dlength"></a>Function: <strong>string-length</strong> <em>string</em></dt>
<dd><p><code>string-length</code> returns the number of characters in <i>string</i>.  This is 1
if <i>string</i> is a number, the <code>array-active-length</code>
(see (array-active-length-fun))
if <i>string</i>
is an array, or the <code>array-active-length</code> of the pname if <i>string</i> is a symbol.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dequal"></a>Function: <strong>string-equal</strong> <em>string1 string2 &amp;optional (idx1 0) (idx2 0) lim1 lim2</em></dt>
<dd><p><code>string-equal</code> compares two strings, returning <code>t</code> if
they are equal and <code>nil</code> if they are not.  The comparison ignores
the extra &quot;font&quot; bits in 16-bit strings
and ignores alphabetic case.  <code>equal</code> calls <code>string-equal</code> if
applied to two strings.
</p>
<p>The optional arguments <i>idx1</i> and <i>idx2</i> are the starting
indices into the strings.  The optional arguments <i>lim1</i> and <i>lim2</i>
are the final indices; the comparison stops just <i>before</i> the final index.
<i>lim1</i> and <i>lim2</i> default to the lengths of the strings.  These arguments are provided
so that you can efficiently compare substrings.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(string-equal &quot;Foo&quot; &quot;foo&quot;) =&gt; t
(string-equal &quot;foo&quot; &quot;bar&quot;) =&gt; nil
(string-equal &quot;element&quot; &quot;select&quot; 0 1 3 4) =&gt; t
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-_0025string_002dequal"></a>Function: <strong>%string-equal</strong> <em>string1 idx1 string2 idx2 count</em></dt>
<dd><p><code>%string-equal</code> is the microcode primitive which <code>string-equal</code> calls.
It returns <code>t</code> if the <i>count</i> characters of <i>string1</i> starting
at <i>idx1</i> are <code>char-equal</code> to the <i>count</i> characters of <i>string2</i>
starting at <i>idx2</i>, or <code>nil</code> if the characters are not equal or
if <i>count</i> runs off the length of either array.
</p>
<p>Instead of a fixnum, <i>count</i> may also be <code>nil</code>.  In this case,
<code>%string-equal</code> compares
the substring from <i>idx1</i> to <code>(string-length <i>string1</i>)</code>
against the substring from <i>idx2</i> to <code>(string-length <i>string2</i>)</code>.
If the lengths of these substrings differ, then they are not equal and
<code>nil</code> is returned.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp"><span class="roman">To compare the two strings <i>foo</i> and <i>bar</i>:</span>
(%string-equal <i>foo</i> 0 <i>bar</i> nil)
<span class="roman">To see if the string <i>foo</i> starts with the characters <code>&quot;bar&quot;</code>:</span>
(%string-equal <i>foo</i> 0 &quot;bar&quot; 0 3)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dlessp"></a>Function: <strong>string-lessp</strong> <em>string1 string2</em></dt>
<dd><p><code>string-lessp</code> compares two strings using dictionary order.
The result is <code>t</code> if <i>string1</i> is the lesser, and <code>nil</code>
if they are equal or <i>string2</i> is the lesser.
</p></dd></dl>

<dl>
<dt><a name="index-substring"></a>Function: <strong>substring</strong> <em>string start &amp;optional end area</em></dt>
<dd><p>This extracts a substring of <i>string</i>, starting at the
character specified by <i>start</i> and going up to but not including
the character specified by <i>end</i>.  <i>start</i> and <i>end</i> are
0-origin indices.  The length of the returned string is <i>end</i> minus
<i>start</i>.  If <i>end</i> is not specified it defaults to the length
of <i>string</i>.  The area in which the result is to be consed may be
optionally specified.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(substring &quot;Nebuchadnezzar&quot; 4 8) =&gt; &quot;chad&quot;
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-nsubstring"></a>Function: <strong>nsubstring</strong> <em>string start &amp;optional end area</em></dt>
<dd><p><code>nsubstring</code> is the same as <code>substring</code> except that the substring
is not copied; instead an indirect array (see (indirect-array)) is created which shares part
of the argument <i>string</i>.  Modifying one string will modify the other.
</p>
<p>Note that <code>nsubstring</code> does not necessarily use less storage than
<code>substring</code>; an <code>nsubstring</code> of any length uses the same amount of
storage as a <code>substring</code> 12 characters long.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dappend"></a>Function: <strong>string-append</strong> <em>&amp;rest strings</em></dt>
<dd><p>Any number of strings are copied and concatenated into a single string.
With a single argument, <code>string-append</code> simply copies it.
If the first argument is an array, the result will be an array of the same type.
Thus <code>string-append</code> can be
used to copy and concatenate any type of 1-dimensional array.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-append 41 &quot;foo&quot; 41) =&gt; &quot;!foo!&quot;
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dtrim"></a>Function: <strong>string-trim</strong> <em>char-list string</em></dt>
<dd><p>This returns a <code>substring</code> of <i>string</i>, with all characters
in <i>char-list</i> stripped off of the beginning and end.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-trim '(40) &quot;  Dr. No  &quot;) =&gt; &quot;Dr. No&quot;
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dleft_002dtrim"></a>Function: <strong>string-left-trim</strong> <em>char-list string</em></dt>
<dd><p>This returns a <code>substring</code> of <i>string</i>, with all characters
in <i>char-list</i> stripped off of the beginning.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dright_002dtrim"></a>Function: <strong>string-right-trim</strong> <em>char-list string</em></dt>
<dd><p>This returns a <code>substring</code> of <i>string</i>, with all characters
in <i>char-list</i> stripped off of the end.
</p></dd></dl>

<dl>
<dt><a name="index-char_002dupcase"></a>Function: <strong>char-upcase</strong> <em>ch</em></dt>
<dd><p>If <i>ch</i>, which must be a fixnum, is a lower-case alphabetic
character its upper-case form is returned; otherwise, <i>ch</i> itself is
returned.  If font information is present it is preserved.
</p></dd></dl>

<dl>
<dt><a name="index-char_002ddowncase"></a>Function: <strong>char-downcase</strong> <em>ch</em></dt>
<dd><p>If <i>ch</i>, which must be a fixnum, is a upper-case alphabetic
character its lower-case form is returned; otherwise, <i>ch</i> itself is
returned.  If font information is present it is preserved.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dupcase"></a>Function: <strong>string-upcase</strong> <em>string</em></dt>
<dd><p>Returns a copy of <i>string</i>, with all lower case alphabetic
characters replaced by the corresponding upper case characters.
</p></dd></dl>

<dl>
<dt><a name="index-string_002ddowncase"></a>Function: <strong>string-downcase</strong> <em>string</em></dt>
<dd><p>Returns a copy of <i>string</i>, with all upper case alphabetic
characters replaced by the corresponding lower case characters.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dreverse"></a>Function: <strong>string-reverse</strong> <em>string</em></dt>
<dd><p>Returns a copy of <i>string</i> with the order of characters reversed.
This will reverse a 1-dimensional array of any type.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dnreverse"></a>Function: <strong>string-nreverse</strong> <em>string</em></dt>
<dd><p>Returns <i>string</i> with the order of characters reversed,
smashing the original string, rather than creating a new one.
If <i>string</i> is a number, it is simply
returned without consing up a string.
This will reverse a 1-dimensional array of any type.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dsearch_002dchar"></a>Function: <strong>string-search-char</strong> <em>char string &amp;optional (from 0) to</em></dt>
<dd><p><code>string-search-char</code> searches through <i>string</i> starting at the index <i>from</i>,
which defaults to the beginning, and returns the index of the first
character which is <code>char-equal</code> to <i>char</i>, or <code>nil</code> if none is found.
If the <i>to</i> argument is supplied, it is used in place of <code>(string-length <i>string</i>)</code>
to limit the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-search-char 101 &quot;banana&quot;) =&gt; 1
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-_0025string_002dsearch_002dchar"></a>Function: <strong>%string-search-char</strong> <em>char string from to</em></dt>
<dd><p><code>%string-search-char</code> is the microcode primitive which <code>string-search-char</code>
and other functions call.  <i>string</i> must be an array and <i>char</i>, <i>from</i>,
and <i>to</i> must be fixnums.  Except for this lack of type-coercion, and the fact
that none of the arguments is optional, <code>%string-search-char</code> is the same as
<code>string-search-char</code>.
</p></dd></dl>

<dl>
<dt><a name="index-string_002dsearch_002dnot_002dchar"></a>Function: <strong>string-search-not-char</strong> <em>char string &amp;optional (from 0) to</em></dt>
<dd><p><code>string-search-not-char</code> searches through <i>string</i> starting at the index <i>from</i>,
which defaults to the beginning, and returns the index of the first
character which is <i>not</i> <code>char-equal</code> to <i>char</i>, or <code>nil</code> if none is found.
If the <i>to</i> argument is supplied, it is used in place of <code>(string-length <i>string</i>)</code>
to limit the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-search-char 102 &quot;banana&quot;) =&gt; 1
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dsearch"></a>Function: <strong>string-search</strong> <em>key string &amp;optional (from 0) to</em></dt>
<dd><p><code>string-search</code> searches for the string <i>key</i> in the string
<i>string</i>.  The search begins at <i>from</i>, which defaults to the
beginning of <i>string</i>.  The value returned is the index of the first
character of the first instance of <i>key</i>, or <code>nil</code> if none is
found.
If the <i>to</i> argument is supplied, it is used in place of <code>(string-length <i>string</i>)</code>
to limit the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-search &quot;an&quot; &quot;banana&quot;) =&gt; 1
(string-search &quot;an&quot; &quot;banana&quot; 2) =&gt; 3
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dsearch_002dset"></a>Function: <strong>string-search-set</strong> <em>char-list string &amp;optional (from 0) to</em></dt>
<dd><p><code>string-search-set</code> searches through <i>string</i> looking for
a character which is in <i>char-list</i>.  The search begins at the index <i>from</i>,
which defaults to the beginning.  It returns the index of the first
character which is <code>char-equal</code> to some element of <i>char-list</i>,
or <code>nil</code> if none is found.
If the <i>to</i> argument is supplied, it is used in place of <code>(string-length <i>string</i>)</code>
to limit the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-search-set '(116 117) &quot;banana&quot;) =&gt; 2
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dsearch_002dnot_002dset"></a>Function: <strong>string-search-not-set</strong> <em>char-list string &amp;optional (from 0) to</em></dt>
<dd><p><code>string-search-not-set</code> searches through <i>string</i> looking for
a character which is not in <i>char-list</i>.  The search begins at the index <i>from</i>,
which defaults to the beginning.  It returns the index of the first
character which is not <code>char-equal</code> to any element of <i>char-list</i>,
or <code>nil</code> if none is found.
If the <i>to</i> argument is supplied, it is used in place of <code>(string-length <i>string</i>)</code>
to limit the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-search-not-set '(141 142) &quot;banana&quot;) =&gt; 2
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dreverse_002dsearch_002dchar"></a>Function: <strong>string-reverse-search-char</strong> <em>char string &amp;optional from (to 0)</em></dt>
<dd><p><code>string-reverse-search-char</code> searches through <i>string</i> in reverse order, starting
from the index one less than <i>from</i>, which defaults to the length of <i>string</i>,
and returns the index of the first character which is <code>char-equal</code>
to <i>char</i>, or <code>nil</code> if none is found.  Note that the index returned
is from the beginning of the string, although the search starts from the end.
If the <i>to</i> argument is supplied, it limits the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-reverse-search-char 156 &quot;banana&quot;) =&gt; 4
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dreverse_002dsearch_002dnot_002dchar"></a>Function: <strong>string-reverse-search-not-char</strong> <em>char string &amp;optional from (to 0)</em></dt>
<dd><p><code>string-reverse-search-not-char</code> searches through <i>string</i> in reverse order, starting
from the index one less than <i>from</i>, which defaults to the length of <i>string</i>,
and returns the index of the first character which is <i>not</i> <code>char-equal</code>
to <i>char</i>, or <code>nil</code> if none is found.  Note that the index returned
is from the beginning of the string, although the search starts from the end.
If the <i>to</i> argument is supplied, it limits the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-reverse-search-not-char 101 &quot;banana&quot;) =&gt; 4
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dreverse_002dsearch"></a>Function: <strong>string-reverse-search</strong> <em>key string &amp;optional from (to 0)</em></dt>
<dd><p><code>string-reverse-search</code> searches for the string <i>key</i> in the string <i>string</i>.
The search proceeds in reverse order, starting
from the index one less than <i>from</i>, which defaults to the length of <i>string</i>,
and returns the index of the first (leftmost) character of the first instance found,
or <code>nil</code> if none is found.  Note that the index returned
is from the beginning of the string, although the search starts from the end.
The <i>from</i> condition, restated, is that the instance of <i>key</i> found
is the rightmost one whose rightmost character is before the <i>from</i>&rsquo;th character
of <i>string</i>.
If the <i>to</i> argument is supplied, it limits the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(string-reverse-search &quot;na&quot; &quot;banana&quot;) =&gt; 4
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dreverse_002dsearch_002dset"></a>Function: <strong>string-reverse-search-set</strong> <em>char-list string &amp;optional from (to 0)</em></dt>
<dd><p><code>string-reverse-search-set</code> searches through <i>string</i> in reverse order, starting
from the index one less than <i>from</i>, which defaults to the length of <i>string</i>,
and returns the index of the first character which is <code>char-equal</code>
to some element of <i>char-list</i>, or <code>nil</code> if none is found.
Note that the index returned
is from the beginning of the string, although the search starts from the end.
If the <i>to</i> argument is supplied, it limits the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">(string-reverse-search-set '(141 142) &quot;banana&quot;) =&gt; 5
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-string_002dreverse_002dsearch_002dnot_002dset"></a>Function: <strong>string-reverse-search-not-set</strong> <em>char-list string &amp;optional from (to 0)</em></dt>
<dd><p><code>string-reverse-search-not-set</code> searches through <i>string</i> in reverse order, starting
from the index one less than <i>from</i>, which defaults to the length of <i>string</i>,
and returns the index of the first character which is not <code>char-equal</code>
to any element of <i>char-list</i>, or <code>nil</code> if none is found.
Note that the index returned
is from the beginning of the string, although the search starts from the end.
If the <i>to</i> argument is supplied, it limits the extent of the search.
</p>
<div class="lisp">
<pre class="lisp">(string-reverse-search-not-set '(141 156) &quot;banana&quot;) =&gt; 0
</pre></div>
</dd></dl>

<p>See also <code>intern</code> ((intern-fun)), which given a string will return &quot;the&quot; symbol
with that print name.
</p>
<a name="I_002fO-to-Strings"></a>
<h3 class="section">8.2 I/O to Strings</h3>

<p>The special forms in this section allow you to create I/O streams which
input from or output to a string rather than a real I/O device.
See (streams) for documentation of I/O streams.
</p>
<dl>
<dt><a name="index-with_002dinput_002dfrom_002dstring"></a>Special Form: <strong>with-input-from-string</strong></dt>
<dd><p>The form
</p>
<div class="lisp">
<pre class="lisp">(with-input-from-string (<i>var string</i>)
    <i>body</i>)
</pre></div>

<p>evaluates the forms in <i>body</i> with the variable <i>var</i> bound to a stream
which reads characters from the string which is the value of the form
<i>string</i>.  The value of the special form is the value of the last
form in its body.
</p>
<p>The stream is a &quot;downward closure&quot;, so be careful what you do with it.
You cannot use it after control leaves the body, and you cannot nest
two <code>with-input-from-string</code> special forms and use both streams
since the special-variable bindings associated with the stream will
conflict.  It is done this way to avoid any consing.
</p>
<p>After <i>string</i> you may optionally specify two additional &quot;arguments&quot;.
</p>
<div class="lisp">
<pre class="lisp">(with-input-from-string (<i>var string index</i>)
    <i>body</i>)
</pre></div>

<p>uses <i>index</i> as the starting index into the string, and updates
it when it is done to the index of the first character not read (the
length of the string if all of it was read.)  Since <i>index</i> is
updated it may not be a general expression; it must be a variable
or a <code>setf</code>-able reference.  The <i>index</i> is not updated
in the event of an abnormal exit from the body, such as a <code>*throw</code>.
</p>
<p>Use of the <i>index</i> feature prevents multiple values from being
returned out of the body, currently.
</p>
<div class="lisp">
<pre class="lisp">(with-input-from-string (<i>var string index limit</i>)
    <i>body</i>)
</pre></div>

<p>uses the value of the form <i>limit</i> in place of the length of the
string if it is not <code>nil</code>.  If you want to specify a <i>limit</i>
but not an <i>index</i>, put <code>nil</code> for <i>index</i>.
</p></dd></dl>

<dl>
<dt><a name="index-with_002doutput_002dto_002dstring"></a>Special Form: <strong>with-output-to-string</strong></dt>
<dd><p>This special form provides a variety of ways to send output to a string
through an i/o stream.
</p>
<div class="lisp">
<pre class="lisp">(with-output-to-string (<i>var</i>)
  <i>body</i>)
</pre></div>

<p>evaluates the forms in <i>body</i> with <i>var</i> bound to a stream
which saves the characters output to it in a string.  The value of
the special form is the string.
</p>
<div class="lisp">
<pre class="lisp">(with-output-to-string (<i>var string</i>)
  <i>body</i>)
</pre></div>

<p>will append its output to the string which is the value of the form <i>string</i>.
(This is like the <code>string-nconc</code> function.)
The value returned is the value of the last form in the body, rather than the string.
Multiple values are not returned.  If <i>string</i> has an array-leader,
element 0 of the array-leader will be used as the fill-pointer.  If <i>string</i>
is too small to contain all the output, <code>adjust-array-size</code> will be used to
make it bigger.
</p>
<div class="lisp">
<pre class="lisp">(with-output-to-string (<i>var string index</i>)
  <i>body</i>)
</pre></div>

<p>is similar to the above except that <i>index</i> is a variable or <code>setf</code>-able
reference which contains the index of the next character to be stored into.
It must be initialized outside the <code>with-output-to-string</code> and will be updated
upon normal exit.
</p>
<p>The stream is a &quot;downward closure&quot;, so be careful what you do with it.
You cannot use it after control leaves the body, and you cannot nest
two <code>with-input-from-string</code> special forms and use both streams
since the special-variable bindings associated with the stream will
conflict.  It is done this way to avoid any consing.
</p></dd></dl>

<a name="Maclisp_002dcompatible-Functions"></a>
<h3 class="section">8.3 Maclisp-compatible Functions</h3>

<dl>
<dt><a name="index-alphalessp"></a>Function: <strong>alphalessp</strong> <em>string1 string2</em></dt>
<dd><p><code>(alphalessp <i>string1 string2</i>)</code> is equivalent to
<code>(string-lessp <i>string1 string2</i>)</code>.
</p></dd></dl>

<dl>
<dt><a name="index-getchar"></a>Function: <strong>getchar</strong> <em>string index</em></dt>
<dd><p>Returns the <i>index</i>&rsquo;th character of <i>string</i>
as a symbol.  Note that 1-origin indexing is used.  This function
is mainly for Maclisp compatibility; <code>aref</code> should be used
to index into strings (however <code>aref</code> will not coerce symbols
or numbers into strings).
</p></dd></dl>

<dl>
<dt><a name="index-getcharn"></a>Function: <strong>getcharn</strong> <em>string index</em></dt>
<dd><p>Returns the <i>index</i>&rsquo;th character of <i>string</i>
as a fixnum.  Note that 1-origin indexing is used.  This function
is mainly for Maclisp compatibility; <code>aref</code> should be used
to index into strings (however <code>aref</code> will not coerce symbols
or numbers into strings).
</p></dd></dl>

<dl>
<dt><a name="index-ascii"></a>Function: <strong>ascii</strong> <em>x</em></dt>
<dd><p><code>ascii</code> is like <code>character</code>, but returns a symbol
whose printname is the character instead of returning a fixnum.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(ascii 101) =&gt; A
(ascii 56) =&gt; /.
</pre></div>

<p>The symbol returned is interned in the <code>user</code> package.
</p></dd></dl>

<dl>
<dt><a name="index-maknam"></a>Function: <strong>maknam</strong> <em>char-list</em></dt>
<dd><p><code>maknam</code> returns
an uninterned symbol whose print-name is a string made up of the characters in <i>char-list</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(maknam '(a b 60 d)) =&gt; ab0d
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-implode"></a>Function: <strong>implode</strong> <em>char-list</em></dt>
<dd><p><code>implode</code> is like <code>maknam</code> except that the returned symbol
is interned in the current package.
</p></dd></dl>

<p>The <code>samepnamep</code> function is also provided; see (samepnamep-fun).
</p>
<a name="Formatted-Output"></a>
<h3 class="section">8.4 Formatted Output</h3>
<a name="index-formatted-output"></a>

<dl>
<dt><a name="index-format"></a>Function: <strong>format</strong> <em>destination control-string &amp;rest args</em></dt>
<dd><p><code>format</code> is used to produce formatted output.
<code>format</code> outputs the characters of <i>control-string</i>, except
that a tilde (&quot;~&quot;) introduces a directive.  The character after
the tilde, possibly preceded by arguments and modifiers, specifies
what kind of formatting is desired.  Some directives use one or more
elements of <i>args</i> to create their output.
</p>
<p>The output is sent to <i>destination</i>.  If <i>destination</i> is
<code>nil</code>, a string is created which contains the output; this string is
returned as the value of the call to <code>format</code>.  If <i>destination</i> is
a stream, the output is sent to it.  If <i>destination</i> is <code>t</code>, the
output is sent to <code>standard-output</code>.  If <i>destination</i> is a string
with an array-leader, such as would be acceptable to <code>string-nconc</code>,
the output is added to the end of that string.
</p>
<p>A directive consists of a tilde, optional decimal numeric parameters
separated by commas, optional colon (&quot;<code>:</code>&quot;) and atsign (&quot;<code>@</code>&quot;) modifiers,
and a single character indicating what kind of directive this is.
The alphabetic case of the character is ignored.
Examples of control strings:
</p>
<div class="lisp">
<pre class="lisp">&quot;~S&quot;        ; <span class="roman">This is an S directive with no parameters.</span>
&quot;~3,4:@s&quot;   ; <span class="roman">This is an S directive with two parameters, 3 and 4,</span>
            ; <span class="roman">   and both the colon and atsign flags.</span>
</pre></div>

<p>Sometimes a numeric parameter is used to specify a character,
for instance the padding character in a right- or left-justifying
operation.  In this case a single quote (&quot;<code>'</code>&quot;) followed by the
desired character may be used as a numeric argument.  For example,
you can use
</p>
<div class="lisp">
<pre class="lisp">&quot;~5,'0d&quot;
</pre></div>

<p>to print a decimal number in five columns with leading zeros.
</p>
<p>The kinds of directives will now be described.
<i>arg</i> will be used to refer to the next argument from <i>args</i>.
</p>
<dl compact="compact">
<dt><code>~D</code></dt>
<dd><p><i>arg</i>, a number, is printed as a decimal integer.
<code>~<i>n</i>D</code> uses a column width of <i>n</i>; spaces are inserted on
the left if the number requires less than <i>n</i> columns for its digits
and sign.  If the number doesn&rsquo;t fit in <i>n</i> columns, additional columns
are used as needed. <code>~<i>n</i>,<i>m</i>D</code> uses <i>m</i> as the pad character
instead of 40 (space).  If <i>arg</i> is not a number, it is printed
in <code>~A</code> format.
The <code>@</code> modifier causes the number&rsquo;s sign to be printed always; the default
is only to print it if the number is negative.
The <code>:</code> modifier causes commas to be printed between groups of three digits;
the third numeric parameter may be used to change the character used as the comma.
Thus the most general form of <code>~D</code> is <code>~<i>mincol</i>,<i>padchar</i>,<i>commachar</i>D</code>.
</p></dd>
<dt><code>~O</code></dt>
<dd><p>This is just like <code>~D</code> but prints in octal instead of decimal.
</p>
</dd>
<dt><code>~F</code></dt>
<dd><p><i>arg</i> is printed in floating point.  <code>~<i>n</i>F</code> rounds <i>arg</i> to a precision
of <i>n</i> digits.  The minimum value of <i>n</i> is 2, since a decimal point is
always printed.  If the magnitude of <i>arg</i> is too large or too small, it is printed
in exponential notation.  If <i>arg</i> is not a number, it is printed in
<code>~A</code> format.
</p>
</dd>
<dt><code>~E</code></dt>
<dd><p><i>arg</i> is printed in exponential notation.  This is identical to <code>~F</code>,
including the use of a numeric parameter to specify the number of digits,
except that the number is always printed with a trailing exponent,
even if it is within a reasonable range.
</p>
</dd>
<dt><code>~A</code></dt>
<dd><p><i>arg</i>, any Lisp object, is printed without slashification (like <code>princ</code>).
<code>~:A</code> prints <code>()</code> if <i>arg</i> is <code>nil</code>; this is useful when printing
something that is always supposed to be a list.
<code>~<i>n</i>A</code> inserts spaces on the right, if necessary, to make the
column width at least <i>n</i>.  The <code>@</code> modifier causes the spaces
to be inserted on the left rather than the right.
<code>~<i>mincol,colinc,minpad,padchar</i>A</code> is the full form of <code>~A</code>,
which allows elaborate control of the padding.
The string is padded on the right with at least <i>minpad</i> copies
of <i>padchar</i>; padding characters are then inserted <i>colinc</i> characters
at a time until the total width is at least <i>mincol</i>.
The defaults are 0 for <i>mincol</i> and <i>minpad</i>, 1 for <i>colinc</i>,
and space for <i>padchar</i>.
</p>
</dd>
<dt><code>~S</code></dt>
<dd><p>This is just like <code>~A</code>, but <i>arg</i> is printed <i>with</i> slashification
(like <code>prin1</code> rather than <code>princ</code>).
</p>
</dd>
<dt><code>~C</code></dt>
<dd><p><code>(character <i>arg</i>)</code> is printed as a keyboard character (see (%%kbd)).
Any control bits are printed first by representing them with Greek letters:
alpha (Control), beta (Meta), epsilon (Control and Meta),
lambda (Hyper), pi (Super).
If the character itself is alpha, beta, epsilon, lambda, pi, or equivalence-sign,
then it is preceded by an equivalence-sign to quote it.
</p>
<p>With the colon flag (<code>~:C</code>), the name of the control bits are spelled out
(e.g. &quot;<code>Control-Meta-F</code>&quot;), and also non-printing characters (those in the 200 to 377 range)
are represented by their names (e.g. &quot;<code>Return</code>&quot;).
</p>
<p>With both colon and atsign (<code>~:@C</code>), the colon-only format is printed, and then
if the character requires the Top, Front, or Greek key(s) to type it,
this fact is mentioned (e.g. &quot;<code> (Top-L)</code>&quot;).
</p>
<p>For all three of these formats,
if the character is not a keyboard character but a mouse &quot;character&quot;,
it is printed as &quot;Mouse-&quot;, the name of the button, &quot;-&quot;, and the number of clicks.
</p>
<p>With just an atsign (<code>~@C</code>), the character is printed in such a way that
the READ function can understand it, using &quot;<code>#/</code>&quot; or &quot;<code>#\</code>&quot;.
</p>
<p>Examples:
</p>
<div class="lisp">
<pre class="lisp">(setq a `(44 1440 403 215 611 ,(dpb 1 %%kbd-mouse 11)))
(format nil &quot;~{&lt;~C&gt;~}&quot; a)  =&gt;
  &quot;&lt;$&gt;&lt; &gt;&lt;&gt;&lt;
&gt;&lt;    &gt;&lt;Mouse-Middle-Twice&gt;&quot;
(format nil &quot;~{&lt;~:C&gt;~}&quot; a)  =&gt;
  &quot;&lt;$&gt;&lt;Control-Meta-Space&gt;&lt;Control-&gt;&lt;Return&gt;&lt;Control-Tab&gt;&lt;Mouse-Middle-Twice&gt;&quot;
(format nil &quot;~{&lt;~:@C&gt;~}&quot; a)  =&gt;
  &quot;&lt;$&gt;&lt;Control-Meta-Space&gt;&lt;Control- (Top-X)&gt;&lt;Return&gt;&lt;Control-Tab&gt;&lt;Mouse-Middle-Twice&gt;&quot;
(format nil &quot;~{&lt;~@C&gt;~}&quot; a)  =&gt;
  &quot;&lt;#//$&gt;&lt;#\SPACE&gt;&lt;#//&gt;&lt;#\RETURN&gt;&lt;#\TAB&gt;&lt;#\MOUSE-M-2&gt;&quot;
</pre></div>

</dd>
<dt><code>~%</code></dt>
<dd><p>Outputs a newline.  <code>~<i>n</i>%</code> outputs <i>n</i> newlines.
No argument is used.
</p>
</dd>
<dt><code>~&amp;</code></dt>
<dd><p>The <code>:fresh-line</code> operation is performed on the output stream.
Unless the stream knows that it is already at the front of a line,
this outputs a newline.  <code>~<i>n</i>&amp;</code> does a <code>:fresh-line</code> operation
and then outputs <i>n-1</i> newlines.
</p>
</dd>
<dt><code>~|</code></dt>
<dd><p>Outputs a formfeed.  <code>~<i>n</i>|</code> outputs <i>n</i> formfeeds.  With a <code>:</code>,
performs a <code>:clear-screen</code> operation on the output stream if the stream
supports that operation; otherwise it behaves as if no <code>:</code> were present
(outputs formfeed(s)).
</p>
</dd>
<dt><code>~X</code></dt>
<dd><p>Outputs a space.  <code>~<i>n</i>X</code> outputs <i>n</i> spaces.
</p>
</dd>
<dt><code>~~</code></dt>
<dd><p>Outputs a tilde.  <code>~<i>n</i>~</code> outputs <i>n</i> tildes.
</p>
</dd>
<dt><code>~ &lt;CR&gt;</code></dt>
<dd><p>Tilde immediately followed by a carriage return ignores the carriage return
and any whitespace at the beginning of the next line.  With a <code>:</code>, the whitespace
is left in place.  With an <code>@</code>, the carriage return is left in place.
</p>
</dd>
<dt><code>~*</code></dt>
<dd><p><i>arg</i> is ignored.  <code>~<i>n</i>*</code> ignores the next <i>n</i> arguments.
<code>~:*</code> &quot;ignores backwards&quot;; that is, it backs up in the list
of arguments so that the argument last processed will be processed
again.  <code>~:<i>n</i>*</code> backs up <i>n</i> arguments.
When within a <code>~{</code> construct, the ignoring (in either direction)
is relative to the list of arguments being processed by the iteration.
</p>
</dd>
<dt><code>~P</code></dt>
<dd><p>If <i>arg</i> is not <code>1</code>, a lower-case s is printed.  (&quot;P&quot; for &quot;plural&quot;.)
<code>~:P</code> does the same thing, after doing a <code>~:*</code>; that is, it prints
a lower-case s if the <i>last</i> argument was not 1.  <code>~@P</code> prints &quot;y&quot;
if the argument is 1, or &quot;ies&quot; if it is not.  <code>~:@P</code> does the same thing,
but backs up first.
</p>
</dd>
<dt><code>~T</code></dt>
<dd><p>Spaces over to a given column.  <code>~<i>n</i>,<i>m</i>T</code> will output
sufficient spaces to move the cursor to column <i>n</i>.  If the cursor
is already past column <i>n</i>, it will output spaces to move it to
column <i>n</i>+<i>mk</i>, for the smallest integer value <i>k</i> possible.
<i>n</i> and <i>m</i> default to <code>1</code>.  Without the colon flag, <i>n</i> and
<i>m</i> are in units of characters; with it, they are in units of pixels.
<i>Note</i>: this operation <i>only</i> works properly on streams that support
the <code>:read-cursorpos</code> and <code>:set-cursorpos</code> stream operations
(see (read-cursorpos)).  On other streams (and when <code>format</code> is creating
a string), any <code>~T</code> operation will simply output two spaces.
</p>
</dd>
<dt><code>~R</code></dt>
<dd><p>If there is no parameter, then <i>arg</i> is printed as a cardinal English number, e.g. four.
With the colon modifier, <i>arg</i> is printed as an ordinal number, e.g. fourth.
With the atsign modifier, <i>arg</i> is printed as a Roman numeral, e.g. IV.
With both atsign and colon, <i>arg</i> is printed as an old Roman numeral, e.g. IIII.
</p>
<p>If there is a parameter, then it is the radix in which to print the number.
The flags and any remaining parameters are used as for the <code>~D</code> directive.
Indeed, <code>~D</code> is the same as <code>~10R</code>.  The full form here is therefore
<code>~<i>radix</i>,<i>mincol</i>,<i>padchar</i>,<i>commachar</i>R</code>.
</p>
</dd>
<dt><code>~<i>n</i>G</code></dt>
<dd><p>&quot;Goes to&quot; the <i>n</i>th argument.  <code>~0G</code> goes back to the
first argument in <i>args</i>.  Directives after a <code>~<i>n</i>G</code>
will take sequential arguments after the one gone to.
When within a <code>~{</code> construct, the &quot;goto&quot;
is relative to the list of arguments being processed by the iteration.
This is an &quot;absolute goto&quot;; for a &quot;relative goto&quot;, see <code>~*</code>.
</p>
</dd>
<dt><code>~[<i>str0</i>~;<i>str1</i>~;<i>...</i>~;<i>strn</i>~]</code></dt>
<dd><p>This is a set of alternative control strings.  The alternatives
(called <i>clauses</i>)
are separated by <code>~;</code> and the construct is terminated by <code>~]</code>.
For example, &quot;<code>~[Siamese ~;Manx ~;Persian ~;Tortoise-Shell ~;Tiger
~;Yu-Hsiang ~]kitty</code>&quot;.  The <i>arg</i>th
alternative is selected; <code>0</code> selects the first.
If a numeric parameter is given (i.e. <code>~<i>n</i>[</code>),
then the parameter is used instead of an argument
(this is useful only if the parameter is &quot;<code>#</code>&quot;).
If <i>arg</i> is out of range no alternative is selected.
After the selected alternative has been processed, the control string
continues after the <code>~]</code>.
</p>
<p>~[<i>str0</i>~;<i>str1</i>~;<i>...</i>~;<i>strn</i>~:;<i>default</i>~] has a default case.
If the <i>last</i> <code>~;</code> used to separate clauses
is instead <code>~:;</code>, then the last clause is an &quot;else&quot; clause,
which is performed if no other clause is selected.
For example, &quot;<code>~[Siamese ~;Manx ~;Persian ~;Tortoise-Shell ~;Tiger
~;Yu-Hsiang ~:;Unknown ~] kitty</code>&quot;.
</p>
<p>~[~<i>tag00</i>,<i>tag01</i>,<i>...</i>;<i>str0</i>~<i>tag10</i>,<i>...</i>;<i>str1...</i>~]
allows the clauses to have explicit tags.  The parameters to each <code>~;</code>
are numeric tags for the clause which follows it.  That clause is processed
which has a tag matching the argument.  If <code>~:<i>a1</i>,<i>a2</i>,<i>b1</i>,<i>b2</i>,<i>...</i>;</code>
is used, then the following clause is tagged not by single values but
by ranges of values <i>a1</i> through <i>a2</i> (inclusive), <i>b1</i> through <i>b2</i>, etc.
<code>~:;</code> with no parameters may be used at the end to denote a default clause.
For example, &quot;<code>~[~'+,'-,'*,'//;operator ~'A,'Z,'a,'z;letter ~'0,'9;digit ~:;other ~]</code>&quot;.
</p>
<p><code>~:[<i>false</i>~;<i>true</i>~]</code> selects the <i>false</i> control string
if <i>arg</i> is <code>nil</code>, and selects the <i>true</i> control string otherwise.
</p>
<p><code>~@[<i>true</i>~]</code> tests the argument.  If it is not <code>nil</code>,
then the argument is not used up, but is the next one to be processed,
and the one clause is processed.
If it is <code>nil</code>, then the argument is used up, and the clause is not processed.
</p>
<div class="lisp">
<pre class="lisp">(setq prinlevel nil prinlength 5)
(format nil &quot;~@[ PRINLEVEL=~D~]~@[ PRINLENGTH=~D]&quot; prinlevel prinlength)
   =&gt;  &quot; PRINLENGTH=5&quot;
</pre></div>

</dd>
<dt><code>~;</code></dt>
<dd><p>Separates clauses in <code>~[</code> and <code>~&lt;</code> constructions.  It is undefined elsewhere.
</p>
</dd>
<dt><code>~]</code></dt>
<dd><p>Terminates a <code>~[</code>.  It is undefined elsewhere.
</p>
</dd>
<dt><code>~{<i>str</i>~}</code></dt>
<dd><p>This is an iteration construct.  The argument should be a list,
which is used as a set of arguments as if for a recursive call to <code>format</code>.
The string <i>str</i> is used repeatedly as the control string.
Each iteration can absorb as many elements of the list as it likes.
If before any iteration step the list is empty, then the iteration is terminated.
Also, if a numeric parameter <i>n</i> is given, then there will be at most <i>n</i>
repetitions of processing of <i>str</i>.
</p>
<p><code>~:{<i>str</i>~}</code> is similar, but the argument should be a list of sublists.
At each repetition step one sublist is used as the set of arguments for
processing <i>str</i>; on the next repetition a new sublist is used, whether
or not all of the last sublist had been processed.
</p>
<p><code>~@{<i>str</i>~}</code> is similar to <code>~{<i>str</i>~}</code>, but instead of
using one argument which is a list, all the remaining arguments
are used as the list of arguments for the iteration.
</p>
<p><code>~:@{<i>str</i>~}</code> combines the features of <code>~:{<i>str</i>~}</code> and <code>~@{<i>str</i>~}</code>.
All the remaining arguments
are used, and each one must be a list.
On each iteration one argument is used as a list of arguments.
</p>
<p>Terminating the repetition construct with <code>~:}</code> instead of <code>~}</code>
forces <i>str</i> to be processed at least once even if the initial
list of arguments is null (however, it will not override an explicit
numeric parameter of zero).
</p>
<p>If <i>str</i> is null, then an argument is used as <i>str</i>.  It must be a string,
and precedes any arguments processed by the iteration.  As an example,
the following are equivalent:
</p>
<div class="lisp">
<pre class="lisp">(apply (function format) (list* stream string args))
(format stream &quot;~1{~:}&quot; string args)
</pre></div>

<p>This will use <code>string</code> as a formatting string.  The <code>~1{</code> says it will
be processed at most once, and the <code>~:}</code> says it will be processed at least once.
Therefore it is processed exactly once, using <code>args</code> as the arguments.
As another example, the <code>format</code> function itself uses <code>format-error</code>
(a routine internal to the <code>format</code> package) to signal
error messages, which in turn uses <code>ferror</code>, which uses <code>format</code> recursively.
Now <code>format-error</code> takes a string and arguments, just like <code>format</code>,
but also prints some addtitional information: if the control string in <code>ctl-string</code>
actually is a string (it might be a list &ndash; see below), then it prints the string
and a little arrow showing where in the processing of the control string the
error occurred.  The variable <code>ctl-index</code> points one character after the place of
the error.
</p>

<p>This first processes the given string and arguments using <code>~1{~:}</code>, then
tabs a variable amount for printing the down-arrow, then prints the control
string between double-quotes.  The effect is something like this:
</p>

</dd>
<dt><code>~}</code></dt>
<dd><p>Terminates a <code>~{</code>.  It is undefined elsewhere.
</p>
</dd>
<dt><code>~^</code></dt>
<dd><p>This is an escape construct.  If there are no more arguments remaining
to be processed, then the immediately enclosing <code>~{</code> or <code>~&lt;</code> construct
is terminated.  (In the latter case, the <code>~&lt;</code> formatting <i>is</i> performed, but no
more clauses are processed before doing the justification.
The <code>~^</code> should appear only at the <i>beginning</i> of a <code>~&lt;</code> clause,
because it aborts the entire clause.  It may appear anywhere in a <code>~{</code> construct.)
If there is no such enclosing construct, then the entire formatting operation
is terminated.
</p>
<p>If a numeric parameter is given, then termination occurs if the parameter
is zero.  (Hence <code>~^</code> is the same as <code>~#^</code>.)  If two parameters are
given, termination occurs if they are equal.  If three are given, termination
occurs if the second is between the other two in ascending order.
</p>
<p>If <code>~^</code> is used within a <code>~:{</code> construct, then it merely terminates
the current iteration step (because in the standard case it tests for
remaining arguments of the current step only); the next iteration step
commences immediately.  To terminate the entire iteration process,
use <code>~:^</code>.
</p>
</dd>
<dt><code>~&lt;</code></dt>
<dd><p><code>~<i>mincol</i>,<i>colinc</i>,<i>minpad</i>,<i>padchar</i>&lt;<i>text</i>~&gt;</code>
justifies <i>text</i> within a field <i>mincol</i> wide.  <i>Text</i>
may be divided up into clauses with <code>~;</code>&ndash;the
spacing is evenly divided between the text segments.
With no modifiers, the leftmost text segment is left justified in the
field, and the rightmost text segment right justified;  if there is
only one, as a special case, it is right justified.
The colon modifier causes
spacing to be introduced before the first text segment;  the atsign
modifier causes spacing to be added after the last.
<i>Minpad</i>, default <code>0</code>, is the minimum number of <i>padchar</i>
(default space) padding characters to be output between each segment.
If the total width needed to satisfy these constraints is greater
than <i>mincol</i>, then <i>mincol</i> is adjusted upwards in
<i>colinc</i> increments.  <i>Colinc</i> defaults to <i>1</i>.
</p>
<div class="lisp">
<pre class="lisp">(format nil &quot;~10&lt;foo~;bar~&gt;&quot;)    =&gt;  &quot;foo    bar&quot;
(format nil &quot;~10:&lt;foo~;bar~&gt;&quot;)   =&gt;  &quot;  foo  bar&quot;
(format nil &quot;~10:@&lt;foo~;bar~&gt;&quot;)  =&gt;  &quot;  foo bar &quot;
(format nil &quot;~10&lt;foobar~&gt;&quot;)      =&gt;  &quot;    foobar&quot;
(format nil &quot;$~10,,'*&lt;~3f~&gt;&quot; 2.59023)  =&gt;  &quot;$******2.59&quot;
</pre></div>

<p>If <code>~^</code> is used within a <code>~&lt;</code> construct, then only the clauses
which were completely processed are used.  For example:
</p>
<div class="lisp">
<pre class="lisp">(format nil &quot;~15&lt;~S~;~^~S~;~^~S~&gt;&quot; 'foo)            =&gt;  &quot;            FOO&quot;
(format nil &quot;~15&lt;~S~;~^~S~;~^~S~&gt;&quot; 'foo 'bar)       =&gt;  &quot;BAR         FOO&quot;
(format nil &quot;~15&lt;~S~;~^~S~;~^~S~&gt;&quot; 'foo 'bar 'baz)  =&gt;  &quot;FOO   BAR   BAZ&quot;
</pre></div>

<p>If the first clause of a <code>~&lt;</code> is terminated with <code>~:;</code> instead of <code>~;</code>,
then it is used in a special way.  All of the clauses are processed
(subject to <code>~^</code>, of course), but the first one is omitted in
performing the spacing and padding.  When the padded result has been
determined, then if it will fit on the current line of output, it is output,
and the text for the first clause is discarded.  If, however, the padded text
will not fit on the current line, then a newline is output, then the
text for the first clause, then the padded text.  The first clause is
always processed, and so any arguments it refers to will be used;
the decision is whether to use the resulting piece of text, not whether to
process the first clause.  If the <code>~:;</code> has a numeric parameter <i>n</i>, then
the padded text must fit on the current line with <i>n</i> character positions to spare
to avoid outputting the newline.
For example, the control string <code>&quot;~%;; ~{~&lt;;; ~:1; ~S~&gt;~^,~}.~%&quot;</code> can be used to
print a list of items separated by commas, without breaking items over line boundaries,
and beginning each line with &quot;<code>;; </code>&quot;.  The argument 1 in <code>~:1;</code> accounts
for the width of the comma which will follow the justified item if it is not the last
element in the list.  If <code>~:;</code> has a second numeric parameter <i>m</i>,
then <i>m</i> is used as the width of the line, thus overriding the natural line
width of the output stream.  To make the preceding example use a line width of 50,
one would write <code>&quot;~%;; ~{~&lt;;; ~:1,30; ~S~&gt;~^,~}.~%&quot;</code>.
</p>
</dd>
<dt><code>~&gt;</code></dt>
<dd><p>Terminates a <code>~&lt;</code>.  It is undefined elsewhere.
</p></dd>
</dl>

<p>In place of a numeric parameter to a directive, you can put the letter
V, which takes an argument from <i>args</i> as a parameter to the
directive.  Normally this should be a number but it doesn&rsquo;t really have
to be.  This feature allows variable column-widths and the like.  Also,
you can use the character # in place of a parameter; it represents the
number of arguments remaining to be processed.  This is useful, for
example, for dealing with English conventions for printing lists:
</p>
<div class="lisp">
<pre class="lisp">(setq foo &quot;Items:~#[ none~; ~S~; ~S and ~S~:;~@{~#[~1; and~] ~S~^,~}~].&quot;)
(format nil foo)  =&gt;  &quot;Items: none.&quot;
(format nil foo 'foo)  =&gt;  &quot;Items: FOO.&quot;
(format nil foo 'foo 'bar)  =&gt;  &quot;Items: FOO and BAR.&quot;
(format nil foo 'foo 'bar 'baz)  =&gt;  &quot;Items: FOO, BAR, and BAZ.&quot;
(format nil foo 'foo 'bar 'baz 'quux)  =&gt;  &quot;Items: FOO, BAR, BAZ, and QUUX.&quot;
</pre></div>

<p>The user can define his own directives.  How to do this is not documented
here; read the code.  Names of user-defined directives longer than one character
may be used if they are enclosed in backslashes (e.g. <code>~4,3\GRAPH\</code>).
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(format nil &quot;foo&quot;) =&gt; &quot;foo&quot;
(setq x 5)
(format nil &quot;The answer is ~D.&quot; x) =&gt; &quot;The answer is 5.&quot;
(format nil &quot;The answer is ~3D.&quot; x) =&gt; &quot;The answer is   5.&quot;
(setq y &quot;elephant&quot;)
(format nil &quot;Look at the ~A!&quot; y) =&gt; &quot;Look at the elephant!&quot;
(format nil &quot;The character ~:@C is strange.&quot; 1003)
      =&gt; &quot;The character Meta- (Top-X) is strange.&quot;
(setq n 3)
(format nil &quot;~D item~P found.&quot; n n) =&gt; &quot;3 items found.&quot;
(format nil &quot;~R dog~:[s are~; is~] here.&quot; n (= n 1))
      =&gt; &quot;three dogs are here.&quot;
(format nil &quot;~R dog~[~1; is~:;s are~] here.&quot; n)
      =&gt; &quot;three dogs are here.&quot;
(format nil &quot;Here ~[~1;is~:;are~] ~:*~R pupp~:P.&quot; n)
      =&gt; &quot;Here are three puppies.&quot;
</pre></div>

<p><code>format</code> also allows <i>control-string</i> to be a list of strings
and lists, which is processed from left to right.  Strings are interpreted
as in the simple case.  Lists are taken as extended directives; the first
element is the directive letter, and the remaining elements are the numeric
parameters to the directive.  If the
car of a list is not a recognized directive, the list is simply evaluated
as a form; anything it writes to the <code>standard-output</code> stream will
appear in the result of <code>format</code>.
</p></dd></dl>

<dl>
<dt><a name="index-format_003aprint_002dlist"></a>Function: <strong>format:print-list</strong> <em>destination element-format list &amp;optional separator start-line options</em></dt>
<dd><p>This function provides a simpler interface for the specific
purpose of printing comma-separated lists with no list element
split across two lines.  <i>destination</i> tells where to send the output;
it can be <code>t</code>, <code>nil</code>, or a stream, as with <code>format</code>.
<i>element-format</i> is a format-control-string which tells how
to print each element of <i>list</i>; it is used as the body of a <code>&quot;~{...~}&quot;</code> construct.
<i>separator</i>, which defaults to <code>&quot;, &quot;</code> (comma, space) is a string which goes after
each element except the last.  Format-control commands are not recommended in <i>separator</i>.
<i>start-line</i>, which defaults to three spaces, is a format-control-string which
is used as a prefix at the beginning of each line of output, except the first.
Format-control commands are allowed in <i>separator</i>, but they should not swallow
arguments from <i>list</i>.  <i>options</i> is a string inserted before the opening <code>&quot;{&quot;</code>;
it defaults to the null string, but allows you to insert colon and/or atsign.
</p></dd></dl>

<p>For formatting Lisp code (as opposed to text and tables), there is
the Grind package.  See (grind).
</p>
<a name="Arrays"></a>
<h2 class="chapter">9 Arrays</h2>
<a name="index-array-1"></a>


<a name="What-Arrays-Are"></a>
<h3 class="section">9.1 What Arrays Are</h3>

<p>An <i>array</i> is a Lisp object that consists of a group of cells,
each of which may contain a Lisp object.  The individual cells are
selected by numerical <i>subscripts</i>.
<a name="index-subscript"></a>
<a name="index-types-of-arrays"></a>
</p>
<p>There are many types of arrays.  Some types of arrays can hold
Lisp objects of any type; the other types of arrays can only hold
fixnums.  The array types are known by a set of symbols symbols whose names
begin with &quot;<code>art-</code>&quot; (for ARray Type).
</p>
<dl>
<dt><a name="index-array_002dtypes-1"></a>Variable: <strong>array-types</strong></dt>
<dd><p>The value of <code>array-types</code> is a list of all of the array type symbols
such as <code>art-q</code>, <code>art-4b</code>, <code>art-string</code> and so on.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dtypes"></a>Function: <strong>array-types</strong> <em>array-type-code</em></dt>
<dd><p>An array of the array type symbols, indexed
by their internal numeric codes.
</p></dd></dl>

<dl>
<dt><a name="index-array_002delements_002dper_002dq-1"></a>Variable: <strong>array-elements-per-q</strong></dt>
<dd><p><code>array-elements-per-q</code> is an association list (see (alist)) which
associates each array type symbol with the number of array elements
stored in one word, for an array of that type.  If the value is negative,
it is instead the number of words per array element, for arrays whose
elements are more than one word long.
</p></dd></dl>

<dl>
<dt><a name="index-array_002delements_002dper_002dq"></a>Function: <strong>array-elements-per-q</strong> <em>array-type-code</em></dt>
<dd><p>This is an array, indexed by the internal codes of the array types,
containing the number of array elements stored in one word, for an
array of that type.  If the value is negative,
it is instead the number of words per array element, for arrays whose
elements are more than one word long.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dbits_002dper_002delement-1"></a>Variable: <strong>array-bits-per-element</strong></dt>
<dd><p>The value of <code>array-bits-per-element</code> is an association list (see (alist))
which associates each array type symbol with the number of
bits of unsigned number it can hold, or <code>nil</code> if it can
hold Lisp objects.  This can be used to tell whether an array
can hold Lisp objects or not.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dbits_002dper_002delement"></a>Function: <strong>array-bits-per-element</strong> <em>array-type-code</em></dt>
<dd><p>This is an array, indexed by the internal codes of the array types, containing
the number of bits per cell for unsigned numeric arrays, and <code>nil</code> for
full-Lisp-object-containing array.
</p></dd></dl>

<dl>
<dt><a name="index-array_002delement_002dsize"></a>Function: <strong>array-element-size</strong> <em>array</em></dt>
<dd><p>Given an array, returns the number of bits that fit in an element of that
array.  For non-numeric arrays, the result is 24., assuming you will be
storing unsigned fixnums in the array.
</p></dd></dl>

<p>The most commonly used type is called <code>art-q</code>.  An <code>art-q</code> array simply
holds Lisp objects of any type.
</p>
<p>Similar to the <code>art-q</code> type is the <code>art-q-list</code>.  Like the <code>art-q</code>,
its elements
may be any Lisp object.  The difference is that the <code>art-q-list</code> array &quot;doubles&quot;
as a list; the function <code>g-l-p</code> will take an <code>art-q-list</code> array and return
a list object whose elements are those of the array, and whose actual substance
is that of the array.  If you <code>rplaca</code> elements of the list, the corresponding
element of the array will change, and if you store into the array, the corresponding
element of the list will change the same way.
</p>
<p>There is a set of types called <code>art-1b, art-2b, art-4b, art-8b</code>
and <code>art-16b</code>;
these names are short for &quot;1 bit&quot;, &quot;2 bits&quot;, and so on.  Each element
of an <code>art-1b</code> array is a fixnum, and only one bit (the least significant)
is remembered in the array; all of the others are discarded.  Similarly,
in an <code>art-2b</code> array, only the two least significant bits are remembered.
So if you store a 5 into an <code>art-2b</code> array, for example, and look at it
later, you will find a 1 rather than a 5.
</p>
<p>These arrays are used when it is known beforehand that the
fixnums which will be stored are non-negative and limited in size to a
certain number of bits.  Their advantage over the <code>art-q</code> array is
that they occupy less storage, because more than one element of the
array is kept in a single machine word.  (For example, 32 elements
(decimal) of an <code>art-1b</code> array or 2 elements of an <code>art-16b</code> array
will fit into one word).
</p>
<p>Character strings are implemented by the <code>art-string</code> array
type.  This type acts similarly to the <code>art-8b</code>; its elements must be
fixnums, of which only the least significant eight bits are stored.
However, many important system functions, including <code>read</code>,
<code>print</code>, and <code>eval</code>, treat <code>art-string</code> arrays very differently from
the other kinds of arrays.  These arrays are usually called
<i>string</i>s, and an entire chapter of this manual deals with
functions which manipulate them.
</p>
<p>There are three types of arrays which exist only for the
purposes of <i>stack groups</i>; these types are called
<code>art-stack-group-head, art-special-pdl</code> and <code>art-reg-pdl</code>.  Their elements
may be any Lisp object; their use is explained in the section on
stack groups (see (stack-group)).
<a name="index-stack-group"></a>
</p>
<p>The <code>art-float</code> array type is a special purpose type whose elements
are flonums.  When storing into such an array the value will be converted to
a flonum.  The advantage of storing flonums in an <code>art-float</code> array rather
than an <code>art-q</code> array is that the numbers in an <code>art-float</code> array are
not true Lisp objects.  Instead the array remembers the numerical value, and
when it is <code>aref</code>&rsquo;ed creates a Lisp object (a flonum) to hold the value.
Because the system does special storage management for bignums and flonums
that are intermediate results the use of <code>art-float</code> arrays can save a lot
of work for the garbage-collector and hence greatly increase performance.
An intermediate result is a Lisp object passed as an argument, stored in a local variable,
or returned as the value of a function, but not stored into a global variable,
an array, or list structure.  <code>art-float</code> arrays also provide a locality
of reference advantage over <code>art-q</code> arrays containing flonums.
</p>
<a name="How-Arrays-Work"></a>
<h3 class="section">9.2 How Arrays Work</h3>

<p>The <i>dimensionality</i> of an array (or, the number of dimensions
which the array has) is the number of subscripts used to
refer to one of the elements of the array.  The dimensionality
may be any integer from one to seven, inclusively.
</p>
<p>The lowest value for any subscript is zero; the highest value
is a property of the array.  Each dimension has a size, which is
the lowest number which is too great to be used as a subscript.
For example, in a one dimensional array of five elements, the size
of the one and only dimension is five, and the acceptable
values of the subscript are zero, one, two, three, and four.
</p>
<p>The most basic primitive functions for handling arrays are:
<code>make-array</code>, which is used for the creation of arrays, <code>aref</code>,
which is used for examining the
contents of arrays, and <code>aset</code>, which
is used for storing into arrays.
</p>
<p>An array is a regular Lisp object, and it is common for an
array to be the binding of a symbol, or the car or cdr of a cons,
or, in fact, an element of an array.  Another way of handling
arrays, inherited from Maclisp, is to treat them as functions.
In this case each array has a name, which is a symbol whose function
definition is the array.  The Lisp machine supports this style by
allowing an array to be <i>applied</i> to arguments, as if it were a function.  The
arguments are treated as subscripts and the array is referenced
appropriately.  The <code>store</code> special form (see (store-fun)) is also
supported.  This form of array referencing is considered to be obsolete,
and should not be used in new programs.
</p>
<p>Here are some issues of Maclisp compatibility:
</p>
<p>Fixnum arrays do not exist (however, see the Lisp machine&rsquo;s small-positive-number
arrays).  Flonum arrays exist but you do not use them in the same way; no
declarations are required or allowed.
&quot;Un-garbage-collected&quot; arrays do not exist.
Readtables and obarrays are represented as arrays, but unlike Maclisp special
array types are not used.  See the descriptions
of <code>read</code> ((read-fun)) and <code>intern</code> ((intern-fun)) for
information about readtables and obarrays (packages).
There are no &quot;dead&quot; arrays, nor are Multics &quot;external&quot; arrays provided.
</p>
<p>The <code>arraycall</code> function is not used (see <code>aref</code>, (aref-fun).)
</p>
<p>Subscripts are always checked for validity, regardless of the value
of <code>*rset</code> and whether the code is compiled or not.
However, in a multi-dimensional array, an error is only caused
if the subscripts would have resulted in a reference to storage
outside of the array; so if you have a 2 by 7 array and refer
to an element with subscripts 3 and 1, no error will
be caused despite the fact that the reference is invalid;
but if you refer to element 1 by 100, an error will be caused.
In other words, any subscript error which is not detected
will only refer to somewhere else in your array, and not
to any other part of storage.
</p>
<p>Currently multi-dimensional arrays are stored in column-major order
rather than row-major order as in Maclisp.  This has an effect on
paging performance when using large arrays.  Row-major order means
that successive memory locations differ in the last subscript,
while column-major order means that successive memory locations differ
in the first subscript.
</p>
<p><code>loadarrays</code> and <code>dumparrays</code> are not provided.  However,
arrays can be put into &quot;QFASL&quot; files; see the section on fasloading
((fasload-fun)).
</p>
<a name="Extra-Features-of-Arrays"></a>
<h3 class="section">9.3 Extra Features of Arrays</h3>
<a name="index-array-leader"></a>

<p>Any array may have an <i>array leader</i>.  An array leader is
like a one-dimensional <code>art-q</code> array which is attached to the main array.  So
an array which has a leader acts like two arrays joined together.  It
can be stored in and examined by a special set of functions which are
analogous to those used for the main array: <code>array-leader</code> and
<code>store-array-leader</code>.  The leader is always one-dimensional, and
always can hold any kind of Lisp object, regardless of the type or
dimensionality of the array.
</p>
<p>By convention, the zeroth element of the array leader of
an array is used to hold the number of elements in the array
that are &quot;active&quot; in some sense.  When the zeroth element is used
this way, it is called a <i>fill pointer</i>.
<a name="index-fill-pointer"></a>
</p>
<p>Specifically, if a string (an array of type <code>art-string</code>) has
seven elements, but it has a fill pointer of five, then only elements
zero through four of the string are considered to be &quot;active&quot;;  the string&rsquo;s
printed representation will be five characters long, string-searching
functions will stop after the fifth element, etc.
</p>
<p>The second element is also used in conjunction with the &quot;named
structure&quot; feature; see (named-structure).
</p>
<a name="index-displaced-array"></a>
<p>The following explanation of <i>displaced arrays</i>
is probably not of interest to a beginner; the section may
be passed over without losing the continuity of the manual.
</p>
<p>Normally, an array consists of a small amount of header information,
followed by the contents of the array.  However, sometimes it is desirable
to have the header information removed from the actual contents.  One
such occasion is when the contents of the array must be located in a
special part of the Lisp Machine&rsquo;s address space, such as the area used
for the control of input/output devices.  Displaced arrays are also
used to reference certain special system tables, which are at fixed
addresses so the microcode can access them easily.
</p>
<p>If you give <code>make-array</code> a fixnum as its fourth argument,
it will create a displaced array refering to that location of virtual memory.
References to elements of the displaced array will access that part
of storage, and return the contents; the regular <code>aref</code> and
<code>aset</code> functions are used.  If the array is one whose elements
are Lisp objects, caution should be used: if the region of address
space does not contain typed Lisp objects, the integrity of the storage
system could be damaged by the garbage collector.  If the array is one
whose elements are bytes (such as an <code>art-4b</code> type), then there
is no problem.  It is important to know, in this case, that the elements
of such arrays are allocated from the right to the left within the 32-bit
words.  See the description of internal array formats on (array-format).
</p>
<a name="index-indirect-array"></a>
<a name="index-indirect-arrays"></a>
<p>It is also possible to have an array whose contents, instead
of being located at a fixed place in virtual memory, are defined
to be those of another array.  Such an array is called an <i>indirect array</i>,
and is created by giving <code>make-array</code> an array as its fourth argument.
The effects of this are simple if both arrays have the same type; the two
arrays share all elements.  An object stored in a certain element
of one can be retrieved from the corresponding element of the other.
This, by itself, is not very useful.  However, if the arrays have
different dimensionality, the manner of accessing the elements differs.
Thus, by creating a one-dimensional array of nine elements which was
indirected to a second, two-dimensional array of three elements by three,
then the elements could be accessed in either a one-dimensional or
a two-dimensional manner.  Even more complex effects can be produced if
the new array is of a different type than the old array; see the description
of internal array formats on (array-format).
</p>
<a name="index-index-offset"></a>
<p>It is also possible to create a one-dimensional indirect array
in such a way that when an attempt is made to reference it or store
into it, a constant number is added to the subscript given.  This
number is called the <i>index-offset</i>, and is specified at the time
the indirect array is created, by giving a fixnum to <code>make-array</code> as
its sixth argument.  The <code>nsubstring</code> function (see (nsubstring-fun)) creates such
arrays.
<a name="index-nsubstring-1"></a>
</p>
<a name="Basic-Array-Functions"></a>
<h3 class="section">9.4 Basic Array Functions</h3>

<dl>
<dt><a name="index-make_002darray"></a>Function: <strong>make-array</strong> <em>area type dims &amp;optional displaced-p leader index-offset named-structure</em></dt>
<dd><p>This creates and returns an array, according to various specifications.
</p>
<p>The <i>area</i> parameter specifies the area in which to allocate
the array&rsquo;s storage; if you are not concerned with areas, simply use <code>nil</code>
which as always means the default area.
</p>
<p><i>type</i> should be a symbolic name of an array type; the most
common of these is <code>art-q</code>.  The elements of the array are
initialized according to the type:  if the array is of a type whose
elements may only be fixnums or flonums, then every element of the array will
initially be <code>0</code>; otherwise, every element will initially be
<code>nil</code>.  See the description of array types on (array-type).
<a name="index-array-initialization"></a>
</p>
<p><i>dims</i> should be a list of fixnums which are the dimensions of the array;
the length of the list will be the dimensionality of the array.  For convenience,
if the dimensionality should be one, the single dimension may be provided as
a fixnum rather than a list of one fixnum.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq a (make-array nil 'art-q 5))       <span class="roman">; Create a one-d array</span>
                                         <span class="roman">;of 5 elements.</span>

(setq b (make-array nil 'art-4b '(3 4))) <span class="roman">; Create a four-bit two-d</span>
                                         <span class="roman">;array, 3 by 4.</span>
</pre></div>

<p>If <i>displaced-p</i> is not <code>nil</code>, then the array will be a <i>displaced</i>
array.  <i>displaced-p</i> may either be a fixnum, to create a regular displaced array
which refers to a certain section of virtual address space, or an array, to create
an indirect array (see (indirect-array)).
<a name="index-displaced-array-1"></a>
<a name="index-indirect-array-1"></a>
</p>
<p>If <i>leader</i> is not <code>nil</code>, then the array will be given a
leader.  If <i>leader</i> is a fixnum, the array&rsquo;s leader will be
<i>leader</i> elements long, and its elements will be initialized to
<code>nil</code>.  <i>Leader</i> may also be a list, in which case the length of
the leader is equal to that of the list, and the elements are
initialized to the elements of the list, in reverse order (i.e., the
car of the list is stored in the highest-subscripted location in the
leader).
</p>
<p>If <i>index-offset</i> is present, <i>displaced-p</i> should be an
array, and <i>index-offset</i> should be a fixnum; it is made to be the
index-offset of the created indirect array. (See (index-offset).)
<a name="index-index-offset-1"></a>
</p>
<p>If <i>named-structure</i> is not <code>nil</code>, it is a symbol to
be stored in the named-structure cell element of the array.  The array
created will be a named structure (see (named-structure).)
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(make-array nil 'art-q 5 nil 3)   <span class="roman">;;leader 3 elements long.</span>
(setq a (make-array nil 'art-1b 100 nil '(t nil)))
(array-leader a 0) =&gt; nil
(array-leader a 1) =&gt; t
</pre></div>
<a name="index-array-leader-1"></a>

<p><code>make-array</code> returns the newly-created array, and also returns, as
a second value, the number of words allocated from <i>area</i> in the process
of creating the array.
</p></dd></dl>

<dl>
<dt><a name="index-array_002ddisplaced_002dp"></a>Function: <strong>array-displaced-p</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any kind of array.
This predicate returns <code>t</code> if <i>array</i> is any kind of displaced array
(including indirect arrays).  Otherwise it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dindirect_002dp"></a>Function: <strong>array-indirect-p</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any kind of array.
This predicate returns <code>t</code> if <i>array</i> is an indirect array.
Otherwise it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dindexed_002dp"></a>Function: <strong>array-indexed-p</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any kind of array.
This predicate returns <code>t</code> if <i>array</i> is an indirect array with an index-offset.
Otherwise it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-adjust_002darray_002dsize"></a>Function: <strong>adjust-array-size</strong> <em>array new-size</em></dt>
<dd><p><i>array</i> should be a one-dimensional array.  Its size is
changed to be <i>new-size</i>.  If this results in making <i>array</i>
smaller, then the extra elements are lost; if <i>array</i> is made
bigger, the new elements are initialized in the same fashion as
<code>make-array</code> (see (make-array-fun)): either to <code>nil</code> or <code>0</code>.
[Currently there is a bug which causes initialization to zero not to work.]
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a (make-array nil 'art-q 5))
(aset 'foo a 4)
(aref a 4) =&gt; foo
(adjust-array-size a 2)
(aref a 4) =&gt; ERROR
</pre></div>

<p>If the size of the array is being increased, <code>adjust-array-size</code>
must allocate a new array somewhere; it then alters <i>array</i> so that
references to it will be made to the new array instead, by means of
an &quot;invisible pointer&quot;.  <code>adjust-array-size</code> will return this
new array if it creates one, and otherwise it will return <i>array</i>.
Be careful about using the returned result of <code>adjust-array-size</code>,
because you may end up holding two arrays which are not the same
(i.e., not <code>eq</code>) which share the same contents.
</p></dd></dl>

<dl>
<dt><a name="index-return_002darray"></a>Function: <strong>return-array</strong> <em>array</em></dt>
<dd><p>Return <i>array</i> to free storage.  If it is displaced,
this returns the pointer, not the data pointed to.  Currently
does nothing if the array is not at the end of its area.
This will eventually be renamed to <code>reclaim</code>, when
it works for other objects than arrays.
</p></dd></dl>

<dl>
<dt><a name="index-aref"></a>Function: <strong>aref</strong> <em>array &amp;rest subscripts</em></dt>
<dd><p>Returns the element of <i>array</i> selected by the <i>subscripts</i>.
The <i>subscripts</i> must be fixnums and their number must match the
dimensionality of <i>array</i>.
</p></dd></dl>

<dl>
<dt><a name="index-ar_002d1"></a>Function: <strong>ar-1</strong> <em>array i</em></dt>
<dd><p><i>array</i> should be a one-dimensional array, and <i>i</i> should be a
fixnum.  This returns the <i>i</i>&rsquo;th element of <i>array</i>.
</p></dd></dl>

<dl>
<dt><a name="index-ar_002d2"></a>Function: <strong>ar-2</strong> <em>array i j</em></dt>
<dd><p><i>array</i> should be a two-dimensional array, and <i>i</i> and <i>j</i> should be
fixnums.  This returns the <i>i</i> by <i>j</i>&rsquo;th element of <i>array</i>.
</p></dd></dl>

<dl>
<dt><a name="index-ar_002d3"></a>Function: <strong>ar-3</strong> <em>array i j k</em></dt>
<dd><p><i>array</i> should be a three-dimensional array, and <i>i</i>, <i>j</i>, and
<i>k</i> should be  fixnums.  This returns the <i>i</i> by <i>j</i> by <i>k</i>&rsquo;th
element of <i>array</i>.
</p></dd></dl>

<dl>
<dt><a name="index-aset"></a>Function: <strong>aset</strong> <em>x array &amp;rest subscripts</em></dt>
<dd><p>Stores <i>x</i> into the element of <i>array</i> selected by the <i>subscripts</i>.
The <i>subscripts</i> must be fixnums and their number must match the
dimensionality of <i>array</i>.  The returned value is <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-as_002d1"></a>Function: <strong>as-1</strong> <em>x array i</em></dt>
<dd><p><i>array</i> should be a one-dimensional array, and <i>i</i> should be a
fixnum.  <i>x</i> may be any object.  <i>x</i> is stored in the <i>i</i>&rsquo;th element
of <i>array</i>.  <code>as-1</code> returns <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-as_002d2"></a>Function: <strong>as-2</strong> <em>x array i j</em></dt>
<dd><p><i>array</i> should be a two-dimensional array, and <i>i</i> and <i>j</i> should be
fixnums.  <i>x</i> may be any object.  <i>x</i> is stored in the <i>i</i> by <i>j</i>&rsquo;th
element of <i>array</i>.  <code>as-2</code> returns <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-as_002d3"></a>Function: <strong>as-3</strong> <em>x array i j k</em></dt>
<dd><p><i>array</i> should be a three-dimensional array, and <i>i</i>, <i>j</i>, and
<i>k</i> should be fixnums.  <i>x</i> may be any object.  <i>x</i> is stored in
the <i>i</i> by <i>j</i> by <i>k</i>&rsquo;th element of <i>array</i>.  <code>as-3</code> returns
<i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-aloc"></a>Function: <strong>aloc</strong> <em>array &amp;rest subscripts</em></dt>
<dd><p>Returns a locative pointer to the element-cell of <i>array</i> selected by
the <i>subscripts</i>.  The <i>subscripts</i> must be fixnums and their
number must match the dimensionality of <i>array</i>.
</p></dd></dl>

<dl>
<dt><a name="index-ap_002d1"></a>Function: <strong>ap-1</strong> <em>array i</em></dt>
<dd><p><i>array</i> should be a one-dimensional array whose elements contain Lisp
objects, and <i>i</i> should be a
fixnum.  This returns a locative pointer to the <i>i</i>&rsquo;th element of
<i>array</i>.  See the explanation of locatives, (locative).
</p></dd></dl>

<dl>
<dt><a name="index-ap_002d2"></a>Function: <strong>ap-2</strong> <em>array i j</em></dt>
<dd><p><i>array</i> should be a two-dimensional array whose elements contain Lisp
objects, and <i>i</i> and <i>j</i>
should be  fixnums.  This returns a locative pointer to the <i>i</i> by
<i>j</i>&rsquo;th element of <i>array</i>.  See the explanation of locatives, (locative).
</p></dd></dl>

<dl>
<dt><a name="index-ap_002d3"></a>Function: <strong>ap-3</strong> <em>array i j k</em></dt>
<dd><p><i>array</i> should be a three-dimensional array whose elements contain Lisp
objects, and <i>i</i>, <i>j</i>, and
<i>k</i> should be  fixnums.  This returns a locative pointer to the
<i>i</i> by <i>j</i> by <i>k</i>&rsquo;th element of <i>array</i>.
See the explanation of locatives, (locative).
</p></dd></dl>

<p>The compiler turns <code>aref</code> into <code>ar-1</code>, <code>ar-2</code>, etc. according
to the number of subscripts specified, turns <code>aset</code> into <code>as-1</code>,
<code>as-2</code>, etc., and turns <code>aloc</code> into <code>ap-1</code>, <code>ap-2</code>, etc.
For arrays with more than 3 dimensions the compiler uses the slightly less
efficient form since the special routines only exist for 1, 2, and 3 dimensions.
There is no reason for any program to call <code>ar-1</code>, <code>as-1</code>, <code>ar-2</code>, etc.
explicitly; they are documented because there used to be such a reason, and
many existing programs use these functions.  New programs should use <code>aref</code>,
<code>aset</code>, and <code>aloc</code>.
</p>
<dl>
<dt><a name="index-arraycall-1"></a>Function: <strong>arraycall</strong> <em>ignored array &amp;rest subscripts</em></dt>
<dd><p><code>(arraycall nil <i>array</i> <i>sub1</i> <i>sub2</i>...)</code> is the same
as <code>(aref <i>array</i> <i>sub1</i> <i>sub2</i>...)</code>.  It exists for
Maclisp compatibility.
</p></dd></dl>

<dl>
<dt><a name="index-get_002dlist_002dpointer_002dinto_002darray"></a>Function: <strong>get-list-pointer-into-array</strong> <em>array-ref</em></dt>
<dd><p>The argument <i>array-ref</i> is ignored, but should be a reference
to an <code>art-q-list</code> array by applying the array to subscripts (rather
than by <code>aref</code>).  This returns a list object which
is a portion of the &quot;list&quot; of the array, beginning with the last
element of the array which has been referenced.
</p></dd></dl>

<dl>
<dt><a name="index-g_002dl_002dp"></a>Function: <strong>g-l-p</strong> <em>array</em></dt>
<dd><p><i>array</i> should be an <code>art-q-list</code> array.  This returns
a list which shares the storage of <i>array</i>.  The <code>art-q-list</code>
type exists so that <code>g-l-p</code> can be used.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a (make-array nil 'art-q-list 4))
(aref a 0) =&gt; nil
(setq b (g-l-p a)) =&gt; (nil nil nil nil)
(rplaca b t)
b =&gt; (t nil nil nil)
(aref a 0) =&gt; t
(aset 30 a 2)
b =&gt; (t nil 30 nil)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-get_002dlocative_002dpointer_002dinto_002darray"></a>Function: <strong>get-locative-pointer-into-array</strong> <em>array-ref</em></dt>
<dd><p><code>get-locative-pointer-into-array</code> is
similar to <code>get-list-pointer-into-array</code>, except that it returns a
locative, and doesn&rsquo;t require the array to be <code>art-q-list</code>.
</p></dd></dl>

<dl>
<dt><a name="index-arraydims"></a>Function: <strong>arraydims</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any array; it also may be a symbol whose
function cell contains an array, for Maclisp compatibility
(see (maclisp-array)).
It returns a list whose first element is the symbolic name of
the type of <i>array</i>, and whose remaining elements are its dimensions.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a (make-array nil 'art-q '(3 5)))
(arraydims a) =&gt; (art-q 3 5)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-array_002ddimensions"></a>Function: <strong>array-dimensions</strong> <em>array</em></dt>
<dd><p><code>array-dimensions</code> returns a list whose elements are the dimensions
of <i>array</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a (make-array nil 'art-q '(3 5)))
(array-dimensions a) =&gt; (3 5)
</pre></div>

<p>Note: the list returned by <code>(array-dimensions <i>x</i>)</code> is
equal to the cdr of the list returned by <code>(arraydims <i>x</i>)</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002din_002dbounds_002dp"></a>Function: <strong>array-in-bounds-p</strong> <em>array &amp;rest subscripts</em></dt>
<dd><p>This function checks whether the <i>subscripts</i> are all
legal subscripts for <i>array</i>, and returns <code>t</code> if they
are; otherwise it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dlength"></a>Function: <strong>array-length</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any array.  This returns the total number
of elements in <i>array</i>.  For a one-dimensional array,
this is one greater than the maximum allowable subscript.
(But if fill pointers are being used, you may want to use
<code>array-active-length</code> (see (array-active-length-fun))).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(array-length (make-array nil 'art-q 3)) =&gt; 3
(array-length (make-array nil 'art-q '(3 5)))
                =&gt; 17  <span class="roman">;octal, which is 15. decimal</span>
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-array_002d_002f_0023_002ddims"></a>Function: <strong>array-/#-dims</strong> <em>array</em></dt>
<dd><p>Returns the dimensionality of <i>array</i>.  Note that the name of the
function includes a &quot;#&quot;, which must be slashified if you want to be
able to compile your program with the compiler running in Maclisp.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(array-/#-dims (make-array nil 'art-q '(3 5))) =&gt; 2
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-array_002ddimension_002dn"></a>Function: <strong>array-dimension-n</strong> <em>n array</em></dt>
<dd><p><i>array</i> may be any kind of array, and <i>n</i> should be a fixnum.
If <i>n</i> is between 1 and the dimensionality of <i>array</i>,
this returns the <i>n</i>&rsquo;th dimension of <i>array</i>.  If <i>n</i> is <code>0</code>,
it returns the length of the leader of <i>array</i>; if <i>array</i> has no
leader it returns <code>nil</code>.  If <i>n</i> is any other value, it
returns <code>nil</code>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setq a (make-array nil 'art-q '(3 5) nil 7))
(array-dimension-n 1 a) =&gt; 3
(array-dimension-n 2 a) =&gt; 5
(array-dimension-n 3 a) =&gt; nil
(array-dimension-n 0 a) =&gt; 7
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-array_002dtype"></a>Function: <strong>array-type</strong> <em>array</em></dt>
<dd><p>Returns the symbolic type of <i>array</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(setq a (make-array nil 'art-q '(3 5)))
(array-type a) =&gt; art-q
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-fillarray"></a>Function: <strong>fillarray</strong> <em>array x</em></dt>
<dd><p>Note: for the present, all arrays concerned must be one-dimensional.
</p>
<p><i>array</i> may be any type of array, or, for Maclisp
compatibility, a symbol whose function cell contains an array.  There
are two forms of this function, depending on the type of <i>x</i>.
</p>
<p>If <i>x</i> is a list, then <code>fillarray</code> fills up <i>array</i> with
the elements of <i>list</i>.  If <i>x</i> is too short to fill up all of
<i>array</i>, then the last element of <i>x</i> is used to fill the
remaining elements of <i>array</i>.  If <i>x</i> is too long, the extra
elements are ignored.
</p>
<p>If <i>x</i> is an array (or, for Maclisp compatibility, a symbol
whose function cell contains an array), then the elements of <i>array</i> are
filled up from the elements of <i>x</i>.  If <i>x</i> is too small, then
the extra elements of <i>array</i> are not affected.
</p>
<p><code>fillarray</code> returns <i>array</i>.
</p></dd></dl>

<dl>
<dt><a name="index-listarray"></a>Function: <strong>listarray</strong> <em>array &amp;optional limit</em></dt>
<dd><p>Note: for the present, all arrays concerned must be one-dimensional.
</p>
<p><i>array</i> may be any type of array, or, for Maclisp
compatibility, a symbol whose function cell contains an array.
<code>listarray</code> creates and returns a list whose elements are those of
<i>array</i>.  If <i>limit</i> is present, it should be a fixnum, and only
the first <i>limit</i> (if there are more than that many) elements of
<i>array</i> are used, and so the maximum length of the returned list is
<i>limit</i>.
</p></dd></dl>

<dl>
<dt><a name="index-copy_002darray_002dcontents"></a>Function: <strong>copy-array-contents</strong> <em>from to</em></dt>
<dd><p><i>from</i> and <i>to</i> must be arrays.  The contents of <i>from</i>
is copied into the contents of <i>to</i>, element by element.
<i>Presently the first subscript varies fastest
in multi-dimensional arrays (opposite from Maclisp).</i>
If <i>to</i> is shorter than <i>from</i>,
the excess is ignored.  If <i>from</i> is shorter than
<i>to</i>, the rest of <i>to</i> is filled with <code>nil</code> if it
is a q-type array or 0 if it is a numeric array or 200 if it is a string.
<code>t</code> is always returned.
</p>
<p>Note that even if <i>from</i> or <i>to</i> has a leader, the whole array
is used; the convention with leader element 0 being the &quot;active&quot; length
of the array is not used by this function.
</p></dd></dl>

<dl>
<dt><a name="index-copy_002darray_002dportion"></a>Function: <strong>copy-array-portion</strong> <em>from-array from-start from-end to-array to-start to-end</em></dt>
<dd><p>The portion of the array <i>from-array</i> with indices greater than or
equal to <i>from-start</i> and less than <i>from-end</i> is copied into
the portion of the array <i>to-array</i> with indices greater than or
equal to <i>to-start</i> and less than <i>to-end</i>, element by element.
If there are more elements in <i>to-array</i>, the extra elements are filled as
in <code>copy-array-contents</code>.
<code>t</code> is always returned.
</p></dd></dl>

<a name="Array-Leaders"></a>
<h3 class="section">9.5 Array Leaders</h3>
<a name="index-array-leader-2"></a>

<p>Array leaders were introduced at the beginning of the chapter.
This section presents various functions which operate on array leaders.
</p>
<dl>
<dt><a name="index-array_002dhas_002dleader_002dp"></a>Function: <strong>array-has-leader-p</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any array.  This predicate returns <code>t</code> if <i>array</i>
has a leader; otherwise it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dleader_002dlength"></a>Function: <strong>array-leader-length</strong> <em>array</em></dt>
<dd><p><i>array</i> may be any array.  This returns the length of <i>array</i>&rsquo;s leader
if it has one, or <code>nil</code> if it does not.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dleader"></a>Function: <strong>array-leader</strong> <em>array i</em></dt>
<dd><p><i>array</i> should be an array with a leader, and <i>i</i> should be a
fixnum.  This returns the <i>i</i>&rsquo;th element of <i>array</i>&rsquo;s leader.
This is analogous to <code>aref</code>.
</p></dd></dl>

<dl>
<dt><a name="index-store_002darray_002dleader"></a>Function: <strong>store-array-leader</strong> <em>x array i</em></dt>
<dd><p><i>array</i> should be an array with a leader, and <i>i</i> should be a
fixnum.  <i>x</i> may be any object.  <i>x</i> is stored in the <i>i</i>&rsquo;th element
of <i>array</i>&rsquo;s leader.  <code>store-array-leader</code> returns <i>x</i>.
This is analogous to <code>aset</code>.
</p></dd></dl>

<dl>
<dt><a name="index-ap_002dleader"></a>Function: <strong>ap-leader</strong> <em>array i</em></dt>
<dd><p><i>array</i> should be an array with a leader, and <i>i</i> should be a
fixnum.  This returns a locative pointer to the <i>i</i>&rsquo;th element of
<i>array</i>&rsquo;s leader.  See the explanation of locatives, (locative).
This is analogous to <code>aloc</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dactive_002dlength"></a>Function: <strong>array-active-length</strong> <em>array</em></dt>
<dd><p>If <i>array</i> does not have a fill pointer, then this returns whatever
<code>(array-length <i>array</i>)</code> would have.  If <i>array</i> does have a
fill pointer, <code>array-active-length</code> returns it.  See the general
explanation of the use of fill pointers, which is at the beginning of
this section.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dpush"></a>Function: <strong>array-push</strong> <em>array x</em></dt>
<dd><p><i>array</i> must be a one-dimensional array which has a fill pointer, and <i>x</i> may
be any object.  <code>array-push</code> attempts to store <i>x</i> in the element
of the array designated by the fill pointer, and increase the fill pointer
by one.  If the fill pointer does not designate an element of the array (specifically,
when it gets too big), it is unaffected and <code>array-push</code> returns <code>nil</code>;
otherwise, the two actions (storing and incrementing) happen uninterruptibly,
and <code>array-push</code> returns the <i>former</i> value of the fill pointer
(one less than the one it leaves in the array).  If the array is of type
<code>art-q-list</code>, an operation similar to <code>nconc</code> has taken place,
in that the element has been added to the list by changing the cdr of
the formerly last element.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dpush_002dextend"></a>Function: <strong>array-push-extend</strong> <em>array x</em></dt>
<dd><p><code>array-push-extend</code> is just like <code>array-push</code> except
that if the fill pointer gets too large, the array is grown
to fit the new element; i.e. it never &quot;fails&quot; the way <code>array-push</code> does,
and so never returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-array_002dpop"></a>Function: <strong>array-pop</strong> <em>array</em></dt>
<dd><p><i>array</i> must be a one-dimensional array which has a fill pointer.
The fill pointer is decreased by one, and the array element
designated by the new value of the fill pointer is returned.
If the new value does not designate any element of the array
(specifically, if it has reached zero), an error is caused.
The two operations (decrementing and array referencing) happen
uninterruptibly.  If the array is of type <code>art-q-list</code>, an operation
similar to <code>nbutlast</code> has taken place.
</p></dd></dl>

<dl>
<dt><a name="index-list_002darray_002dleader"></a>Function: <strong>list-array-leader</strong> <em>array &amp;optional limit</em></dt>
<dd><p><i>array</i> may be any type of array, or, for Maclisp
compatibility, a symbol whose function cell contains an array.
<code>list-array-leader</code> creates and returns a list whose elements are those of
<i>array</i>&rsquo;s leader.  If <i>limit</i> is present, it should be a fixnum, and only
the first <i>limit</i> (if there are more than that many) elements of
<i>array</i>&rsquo;s leader are used, and so the maximum length of the returned list is
<i>limit</i>. If <i>array</i> has no leader, <code>nil</code> is returned.
</p></dd></dl>

<dl>
<dt><a name="index-copy_002darray_002dcontents_002dand_002dleader"></a>Function: <strong>copy-array-contents-and-leader</strong> <em>from to</em></dt>
<dd><p>This is just like <code>copy-array-contents</code> (see (copy-array-contents-fun)), but the leaders
of <i>from</i> and <i>to</i> are also copied.
</p></dd></dl>

<a name="Maclisp-Array-Compatibility"></a>
<h3 class="section">9.6 Maclisp Array Compatibility</h3>

<p>Note: the functions in this section should not be used in new
programs.
</p>
<p>In Maclisp, arrays are usually kept on the <code>array</code> property
of symbols, and the symbols are used instead of the arrays.  In order
to provide some degree of compatibility for this manner of using
arrays, the <code>array</code>, <code>*array</code>, and <code>store</code> functions are
provided, and when arrays are applied to arguments, the arguments are
treated as subscripts and <code>apply</code> returns the corresponding element
of the array.  However, the <code>*rearray</code>, <code>loadarrays</code>, and
<code>dumparrays</code> functions are not provided.  Also, <code>flonum</code>,
<code>readtable</code>, and <code>obarray</code> type arrays are not supported.
</p>
<dl>
<dt><a name="index-array-2"></a>Function: <strong>array</strong> <em>&amp;quote symbol type &amp;eval &amp;rest dims</em></dt>
<dd><p>This creates an <code>art-q</code> type array in <code>default-array-area</code>
with the given dimensions.  (That is, <i>dims</i> is given
to <code>make-array</code> as its third argument.)  <i>type</i> is ignored.
If <i>symbol</i> is <code>nil</code>, the array is returned; otherwise,
the array is put in the function cell of <i>symbol</i>, and <i>symbol</i>
is returned.
</p></dd></dl>

<dl>
<dt><a name="index-_002aarray"></a>Function: <strong>*array</strong> <em>symbol type &amp;rest dims</em></dt>
<dd><p>This is just like <code>array</code>, except that all of the arguments
are evaluated.
</p></dd></dl>

<dl>
<dt><a name="index-store"></a>Function: <strong>store</strong> <em>&amp;quote array-ref x</em></dt>
<dd><p><i>x</i> may be any object; <i>array-ref</i> should be a form which
references an array by calling it as a function (<code>aref</code> forms are not
acceptable).  First <i>x</i> is evaluated, then <i>array-ref</i> is
evaluated, and then the value of <i>x</i> is stored into the array cell
which was referenced by the evaluation of <i>array-ref</i>.
</p></dd></dl>

<dl>
<dt><a name="index-xstore"></a>Function: <strong>xstore</strong> <em>x array-ref</em></dt>
<dd><p>This is just like <code>store</code>, but it is not
a special form; this is because the arguments are in the other
order.  This function only exists for the compiler to compile the
<code>store</code> special form, and should never be used by programs.
</p></dd></dl>

<a name="Closures"></a>
<h2 class="chapter">10 Closures</h2>
<a name="index-closure-1"></a>

<p>A <i>closure</i> is a type of Lisp functional object useful
for implementing certain advanced access and control structures.
Closures give the programmer more explicit control over the
environment, by allowing him to &quot;save up&quot; the environment created
by the entering of a dynamic contour (i.e. a <code>lambda</code>, <code>do</code>,
<code>prog</code>, <code>progv</code>, <code>let</code>, or any of several other special
forms), and then use that environment
elsewhere, even after the contour has been exited.
</p>
<a name="What-a-Closure-Is"></a>
<h3 class="section">10.1 What a Closure Is</h3>

<p>There is a view of lambda-binding which we will use in this
section because it makes it easier to explain what closures do.  In
this view, when a variable is bound, a new value cell is created for it.
The old value cell is saved away somewhere and is inaccessible.  Any
references to the variable will get the contents of the new value cell,
and any <code>setq</code>&rsquo;s will change the contents of the new value cell.
When the binding is undone, the new value cell goes away, and the old
value cell, along with its contents, is restored.
</p>
<p>For example, consider the following sequence of Lisp forms:
</p>
<div class="lisp">
<pre class="lisp">(setq a 3)

((lambda (a)
    (print (+ a 6)))
 10)

(print a)
</pre></div>

<p>Initially there is a value cell for <code>a</code>, and the <code>setq</code> form makes
the contents of that value cell be <code>3</code>.  Then the
<code>lambda</code>-combination is evaluated.  <code>a</code> is bound to <code>10</code>: the old
value cell, which still contains a <code>3</code>, is saved away, and a new
value cell is created with <code>10</code> as its contents.  The reference to
<code>a</code> inside the <code>lambda</code> expression evaluates to the current binding
of <code>a</code>, which is the contents of its current value cell, namely
<code>10</code>.  So <code>16</code> is printed.  Then the binding is undone, discarding
the new value cell, and restoring the old value cell which still
contains a <code>3</code>.  The final <code>print</code> prints out a <code>3</code>.
</p>
<p>The form <code>(closure <i>var-list</i> <i>function</i>)</code>, where
<i>var-list</i> is a list of variables and <i>function</i> is any function,
creates and returns a closure.  When this closure is applied to some
arguments, all of the value cells of the variables on <i>var-list</i> are
saved away, and the value cells that those variables had <i>at the time
<code>closure</code> was called</i> are made to be the value cells of
the symbols.  Then <i>function</i> is applied to the argument.  (This paragraph
is somewhat complex, but it completely describes the operation of closures;
if you don&rsquo;t understand it, come back and read it again.)
</p>
<p>Here is another, lower level explanation.  The closure object
stores several things inside of it.  First, it saves the <i>function</i>.
Secondly, for each variable in <i>var-list</i>, it remembers what that
variable&rsquo;s value cell was when the closure was created.
Then when the closure is called as a function, it first temporarily restores
the value cells it has remembered, and then applies <i>function</i> to the
same arguments to which the closure itself was applied.
</p>
<p>Now, if we evaluate the form
</p>
<div class="lisp">
<pre class="lisp">(setq a
      ((lambda (x)
               (closure '(x) (function car)))
       3))
</pre></div>

<p>what happens is that a new value cell is created for <code>x</code>, and its
contents is a fixnum <code>3</code>.  Then a closure is created, which remembers
the function <code>car</code>, the symbol <code>x</code>, and that value cell.
Finally the old value cell of <code>x</code> is restored, and the closure is
returned.  Notice that the new value cell is still around, because
it is still known about by the closure.  When the closure is applied,
this value cell will be restored and the value of <code>x</code> will be <code>3</code>.
</p>
<p>Because of the way closures are implemented, the variables
to be closed over must not get turned into &quot;local variables&quot; by the compiler.
Therefore, all such variables should be declared special.
</p>
<p>In the Lisp Machine&rsquo;s implementation of closures, lambda-binding
never really allocates any storage to create new value cells.  Value
cells are only created (sometimes) by the <code>closure</code> function itself.
Thus, implementors of large systems need not worry about storage allocation
overhead from this mechanism if they are not using closures.  See the section
on internal formats.
</p>
<p>Lisp Machine closures are not closures in the true sense,
as they do not save the whole variable-binding environment; however,
most of that environment is irrelevant, and the explicit
declaration of which variables are to be closed allows the
implementation to have high efficiency.
They also allow the programmer to explicitly choose for each variable
whether it is to be bound at the point of call or
bound at the point of definition (e.g., creation of the closure), a choice
which is not conveniently available in other languages.  In addition the
program is clearer because the intended effect of the closure is made
manifest by listing the variables to be affected.
</p>
<a name="Examples-of-the-Use-of-Closures"></a>
<h3 class="section">10.2 Examples of the Use of Closures</h3>

<p>This section gives some examples of things that can be done easily
and elegantly with closures, which would be difficult to do without them.
</p>
<p>We will start with a simple example of a generator.  A <i>generator</i>
is a kind of function which is called successively to obtain successive elements
of a sequence.
We will implement a function <code>make-list-generator</code>, which takes a list,
and returns a generator which will return successive
elements of the list.  When it gets to the end it should return <code>nil</code>.
</p>
<p>The problem is that in between calls to the generator, the generator
must somehow remember where it is up to in the list.  Since all of its
bindings are undone when it is exited, it cannot save this information in
a bound variable.  It could save it in a global variable, but the problem
is that if we want to have more than one list generator at a time, they
will all try to use the same global variable and get in each other&rsquo;s way.
</p>
<p>Here is how we can use closures to solve the problem:
</p>
<div class="lisp">
<pre class="lisp">(defun make-list-closure (l)
    (closure '(l)
             (function (lambda ()
                               (prog1 (car l)
                                      (setq l (cdr l)))))))
</pre></div>

<p>Now we can make as many list generators as we like; they won&rsquo;t get
in each other&rsquo;s way because each has its own value cell for <code>l</code>.
Each of these value cells was created when the <code>make-list-closure</code>
function was entered, and the value cells are remembered by the closures.
</p>

<a name="Function-Descriptions"></a>
<h3 class="section">10.3 Function Descriptions</h3>

<dl>
<dt><a name="index-closure-2"></a>Function: <strong>closure</strong> <em>var-list function</em></dt>
<dd><p>This creates and returns a closure of <i>function</i> over the variables
in <i>var-list</i>.  Note that all variables on <i>var-list</i>
must be declared special if the function is to compile correctly.
</p></dd></dl>

<dl>
<dt><a name="index-symeval_002din_002dclosure"></a>Function: <strong>symeval-in-closure</strong> <em>closure symbol</em></dt>
<dd><p>This returns the binding of <i>symbol</i> in the environment of <i>closure</i>;
that is, it returns what you would get if you restored the value cells
known about by <i>closure</i> and then evaluated <i>symbol</i>.
This allows you to &quot;look around inside&quot; a closure.
</p></dd></dl>

<dl>
<dt><a name="index-set_002din_002dclosure"></a>Function: <strong>set-in-closure</strong> <em>closure symbol x</em></dt>
<dd><p>This sets the binding of <i>symbol</i> in the environment of <i>closure</i>
to <i>x</i>; that is, it does what would happen if you restored the value cells
known about by <i>closure</i> and then set <i>symbol</i> to <i>x</i>.
This allows you to change the contents of the value cells known about
by a closure.
</p></dd></dl>

<dl>
<dt><a name="index-let_002dclosed"></a>Macro: <strong>let-closed</strong></dt>
<dd><p>When using closures, it is very common to bind a set of variables with
initial values, and then make a closure over those variables.  Furthermore
the variables must be declared as &quot;special&quot; for the compiler.  <code>let-closed</code>
expands into a form which does all of this.  It is best described by example:
</p>
<div class="lisp">
<pre class="lisp">(let-closed ((a 5) b (c 'x))
   (function (lambda () ...)))

<span class="roman">expands into</span>

(local-declare ((special a b c))
   (let ((a 5) b (c 'x))
      (closure '(a b c)
         (function (lambda () ...)))))
</pre></div>
</dd></dl>


<a name="Stack-Groups"></a>
<h2 class="chapter">11 Stack Groups</h2>
<a name="index-stack-group-1"></a>

<p>A <i>stack group</i> (usually abbreviated &quot;SG&quot;) is a type of Lisp
object useful for implementation of certain advanced control structures
such as coroutines and generators.  A stack group represents a
computation and its internal state, including the Lisp stack.
At any time, the computation being
performed by the Lisp Machine is associated with one stack group,
called the <i>current</i> or <i>running</i> stack group.  The operation of
making some stack group be the current stack group is called a
<i>resumption</i> or a <i>stack group switch</i>; the running stack group is
said to have <i>resumed</i> the new stack group.  The <i>resume</i> operation
has two parts: first, the state of the running computation is saved
away inside the current stack group, and secondly the state saved in
the new stack group is restored, and the new stack group is made
current.  Then the computation of the new stack group resumes its
course.
</p>
<p>The stack group remembers all functions which
were active at the time of the resumption (that is, the running
function, its caller, its caller&rsquo;s caller, etc.), and where
in each function the computation was up to.  In other words,
the entire control stack (or regular pdl) is saved.  In addition,
the bindings that were present are saved also; that is, the environment
stack (or special pdl) is saved.  When the state of the current
stack group is saved away, all of its bindings are undone,
and when the state is restored, the bindings are put back.
Note that although bindings are temporarily undone, unwind-protect
handlers are <i>not</i> run (see <code>let-globally</code>).
</p>
<p>There are several ways that a resumption can happen.  First of all,
there are several Lisp functions, described below, which resume some
other stack group.  When some stack group (call it <code>c</code>) calls such a
function, it is suspended in the state of being in the middle of a call
to that function.  When someone eventually resumes <code>c</code>, the function
will return.  The arguments to these functions and the returned values
can therefore be used to pass information back and forth between stack
groups.  Secondly, if an error is signalled, the current stack group
resumes an error handler stack group, which handles the error in some
way.  Thirdly, a <i>sequence break</i> can happen, which  transfers
control to a special stack group called the <i>scheduler</i> (see (scheduler)).
</p>
<p>Note: the following discussion of resumers is incomplete, and the
way they work is being changed anyway.
</p>
<a name="index-resumer"></a>
<p>Each stack group has a <i>resumer</i>.  <i>c</i>&rsquo;s resumer is some other
stack group, which essentially is the last stack group to resume <i>c</i>.
This is not completely right, however, because some resume-forms set the
resumed stack group&rsquo;s resumer, and some don&rsquo;t.  So <i>c</i>&rsquo;s resumer is actually
the last stack group to resume <i>c</i> by means of one of the types of
resume-form which does set the resumer.
</p>
<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup_002dprevious_002dstack_002dgroup"></a>Variable: <strong>si:%current-stack-group-previous-stack-group</strong></dt>
<dd><p>The binding of this variable is the resumer of the current stack group.
</p></dd></dl>

<p>There are currently four kinds of resume-forms:
</p>
<dl compact="compact">
<dt><span class="roman">1)</span></dt>
<dd><p>If <i>c</i> calls <i>s</i> as a function with an argument <i>x</i>, then <i>s</i> is resumed,
and the object transmitted is <i>x</i>.  <i>s</i>&rsquo;s resumer is now <i>c</i>.
</p></dd>
<dt><span class="roman">2)</span></dt>
<dd><p>If <i>c</i> evaluates <code>(stack-group-return <i>x</i>)</code>, then its resumer
is resumed, and the object transmitted is <i>x</i>.  The resumer&rsquo;s resumer
is not affected.
</p></dd>
<dt><span class="roman">3)</span></dt>
<dd><p>If <i>c</i> evaluates <code>(stack-group-resume <i>s</i> <i>x</i>)</code>, then
<i>c</i> is resumed, and the object transmitted is <i>x</i>.  <i>c</i>&rsquo;s resumer
is not affected.  (This is not currently implemented.)
</p></dd>
<dt><span class="roman">4)</span></dt>
<dd><p>If the initial function of <i>c</i> attempts to return a value <i>x</i>,
the regular kind of Lisp function return cannot take place, since
the function did not have any caller (it got there when the stack group
was initialized).  So instead of returning, its resumer is resumed, and
the value transmitted is <i>x</i>.  The resumer&rsquo;s resumer is not affected.
<i>c</i> is left in a state from which it cannot be resumed again; any
attempt to resume it would signal an error.
</p></dd>
</dl>

<p>There is one other way a stack group can be resumed.  If the
running stack group <i>c</i> gets a microcode trap, then the error handler
stack group is resumed.  The object transmitted is <code>nil</code>, and the
error handler&rsquo;s resumer is set to <i>c</i>.  This kind of resuming will
only happen to the error handler, so regular programs should not see
it.
</p>
<a name="What-is-Going-On-Inside"></a>
<h3 class="section">11.1 What is Going On Inside</h3>

<p>The stack group itself holds a great deal of state information.
First of all, it contains the control stack, or &quot;regular PDL&quot;.  The
control stack is what you are shown by the backtracing commands of the
error handler (currently the Control-B and Meta-B commands); it
remembers the function which is running, its caller, its caller&rsquo;s
caller, and so on, and remembers the point of execution of each function
(i.e. the &quot;return addresses&quot; of each function).
Secondly, it contains the environment stack, or &quot;special PDL&quot;.
This contains all of the values saved by <code>lambda</code>-binding.  Finally,
it contains various internal state information (contents of machine
registers and so on).
</p>
<p>When one stack group resumes a second, the first thing that
happens is that (some of) the state of the processor is saved in the
first stack group.  Next, all of the bindings in effect are undone;
each stack group has its own environment, and the bindings done in one
stack group do not affect another stack group at all.  Then the second
stack group&rsquo;s bindings are restored, its machine state is restored, and
the second stack group proceeds from where it left off.  While these
things are happening, the transmitted object is passed into the second
stack group, and optionally the second stack group&rsquo;s resumer is made
to be the first stack group.
</p>

<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup"></a>Variable: <strong>si:%current-stack-group</strong></dt>
<dd><p>The value of <code>si:%current-stack-group</code> is the stack group which is
currently running.  A program can use this variable to get its hands
on its own stack group.
</p></dd></dl>

<dl>
<dt><a name="index-make_002dstack_002dgroup"></a>Function: <strong>make-stack-group</strong> <em>name &amp;optional options</em></dt>
<dd><p>This creates and returns a new stack group.  <i>name</i> may be any symbol; it is used
to identify and print the stack group.  Each option is a keyword followed by
a value for that option; any number of options may be given, including zero.
The options are not too useful; most calls to
<code>make-stack-group</code> don&rsquo;t have any options at all.
The options are:
</p>
<dl compact="compact">
<dt><code>:sg-area</code></dt>
<dd><p>The area in which to create the stack group structure itself.
Defaults to <code>default-array-area</code>.
</p></dd>
<dt><code>:regular-pdl-area</code></dt>
<dd><p>The area in which to create the regular PDL.  Note that this
may not be any area; only certain areas may hold regular PDL,
because accessing a regular PDL as memory must go through special
microcode which checks an internal cache called the <i>pdl buffer</i>.
Defaults to <code>error-linear-pdl-area</code>.
</p></dd>
<dt><code>:special-pdl-area</code></dt>
<dd><p>The area in which to create the special PDL.
Defaults to <code>default-array-area</code>.
</p></dd>
<dt><code>:regular-pdl-size</code></dt>
<dd><p>Length of the regular PDL to be created.  Defaults to 3000.
</p></dd>
<dt><code>:special-pdl-size</code></dt>
<dd><p>Length of the special PDL to be created.  Defaults to 400.
</p></dd>
<dt><code>:car-sym-mode</code></dt>
<dd><p>The &quot;error mode&quot; which determines the action taken when there
is an attempt to apply <code>car</code> to a symbol.  This, and the other
&quot;error mode&quot; options, are documented with the fucntions <code>car</code>
and <code>cdr</code>.  Defaults to <code>1</code>.
</p></dd>
<dt><code>:car-num-mode</code></dt>
<dd><p>As above, for applying <code>car</code> to a number.  Defaults to 0.
</p></dd>
<dt><code>:cdr-sym-mode</code></dt>
<dd><p>As above, for applying <code>cdr</code> to a symbol.  Defaults to 1.
</p></dd>
<dt><code>:cdr-num-mode</code></dt>
<dd><p>As above, for applying <code>cdr</code> to a number.  Defaults to 0.
</p></dd>
<dt><code>:swap-sv-on-call-out</code></dt>
<dt><code>:swap-sv-of-sg-that-calls-me</code></dt>
<dt><code>:trap-enable</code></dt>
<dd><p>This determines what to do if a microcode error occurs.
If it is <code>1</code> the system tries to handle the error;
if it is <code>0</code> the machine halts.  Defaults to 1.
</p></dd>
<dt><code>:safe</code></dt>
<dd><p>If <code>1</code> (the default), a strict call-return discipline among
stack-groups is enforced.  If <code>0</code>, no restriction on stack-group
switching is imposed.
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-stack_002dgroup_002dpreset"></a>Function: <strong>stack-group-preset</strong> <em>stack-group function &amp;rest arguments</em></dt>
<dd><p>This sets up <i>stack-group</i> so that when it is resumed,
<i>function</i> will be applied to <i>arguments</i> within the stack group.
Both stacks are made empty.
<code>stack-group-preset</code> is used to initialize a stack group just after it is made,
but it may be done to any stack group at any time.
</p></dd></dl>

<dl>
<dt><a name="index-stack_002dgroup_002dreturn"></a>Function: <strong>stack-group-return</strong> <em>x</em></dt>
<dd><p>Let <i>s</i> be the current stack group&rsquo;s resumer;
<code>stack-group-return</code> will resume <i>s</i>, transmitting
the value <i>x</i>.  <i>s</i>&rsquo;s resumer is not affected.
</p></dd></dl>

<dl>
<dt><a name="index-stack_002dgroup_002dresume"></a>Function: <strong>stack-group-resume</strong> <em>s x</em></dt>
<dd><p><code>stack-group-resume</code>
will resume <i>s</i>, transmitting the object <i>x</i>.  <i>s</i>&rsquo;s
resumer is not affected.  This function is not currently implemented.
</p></dd></dl>


<a name="Locatives"></a>
<h2 class="chapter">12 Locatives</h2>
<a name="index-locative-1"></a>

<a name="Cells-and-Locatives"></a>
<h3 class="section">12.1 Cells and Locatives</h3>
<a name="index-cell"></a>

<p>A <i>locative</i> is a type of Lisp object used as a <i>pointer</i>
to a <i>cell</i>.  Locatives are inherently a more &quot;low level&quot; construct
than most Lisp objects; they require some knowledge of the nature of
the Lisp implementation.  Most programmers will never need them.
</p>
<p>A cell is a machine word which contains a (pointer to a) Lisp object.
A symbol has five cells: the print name cell, the value cell, the
function cell, the property list cell, and the package cell.  The value
cell holds (a pointer to) the binding of the symbol, and so on.
Also, an array leader of length <i>n</i> has <i>n</i> cells, and
an array of <i>n</i> elements has <i>n</i> cells provided the array is
not a numeric array.  However, a numeric array contains a different
kind of cell, which cannot be pointed to by a locative.
</p>
<p>There are a set of functions which create locatives to
cells; the functions are documented with the kind of object to
which they create a pointer.  See <code>ap-1</code>, <code>ap-leader</code>,
<code>car-location</code>, <code>value-cell-location</code>, etc.  The macro <code>locf</code>
(see (locf-fun))
can be used to convert a form which accesses a cell to one which
creates a locative pointer to that cell: for example,
</p>
<div class="lisp">
<pre class="lisp">(locf (fsymeval x)) ==&gt; (function-cell-location x)
</pre></div>

<a name="Functions-Which-Operate-on-Locatives"></a>
<h3 class="section">12.2 Functions Which Operate on Locatives</h3>

<p>Either of the functions <code>car</code> and <code>cdr</code>
(see (car-fun))
may be given a locative, and will return the contents of the cell at
which the locative points.
</p>
<div class="lisp">
<pre class="lisp"><span class="roman">For example,</span>
(car (value-cell-location x))
<span class="roman">is the same as</span>
(symeval x)
</pre></div>

<p>Similarly, either of the functions <code>rplaca</code> and <code>rplacd</code> may
be used to store an object into the cell at which a locative
points.
</p>
<div class="lisp">
<pre class="lisp"><span class="roman">For example,</span>
(rplaca (value-cell-location x) y)
<span class="roman">is the same as</span>
(set x y)
</pre></div>

<p>If you mix locatives and lists, then it matters whether you use <code>car</code>
and <code>rplaca</code> or <code>cdr</code> and <code>rplacd</code>,
and care is required.  For example, this function takes
advantage of <code>value-cell-location</code> to cons up a list in forward
order without special-case code.  The first time through the loop,
the <code>rplacd</code> is equivalent to <code>(setq res ...)</code>; on later times
through the loop the <code>rplacd</code> tacks an additional cons onto the end of the list.
</p>
<div class="lisp">
<pre class="lisp">(defun sort-of-mapcar (fcn lst)
  (do ((lst lst (cdr lst))
       (res nil)
       (loc (value-cell-location 'res)))
      ((null lst) res)
    (rplacd loc
            (setq loc (ncons (funcall fcn (car lst)))))))
</pre></div>

<p>You might expect this not to work if it was compiled and <code>res</code>
was not declared special, since non-special compiled variables are
not represented as symbols.  However, the compiler arranges for
it to work anyway.
</p>
<a name="Subprimitives"></a>
<h2 class="chapter">13 Subprimitives</h2>
<a name="index-subprimitives"></a>

<p>Subprimitives are functions which are not intended to be used by
the average program, only by &quot;system programs&quot;.  They allow one to
manipulate the environment at a level lower than normal Lisp.
Subprimitives usually have names which start with a <code>%</code> character.
The &quot;primitives&quot; described in other sections of the manual typically
use subprimitives to accomplish their work.  The subprimitives take
the place of machine language in other systems, to some extent.
Subprimitives are normally hand-coded in microcode.
</p>
<p>Subprimitives by their very nature cannot do full checking.
Improper use of subprimitives can destroy the environment.
</p>
<a name="Data-Types-1"></a>
<h3 class="section">13.1 Data Types</h3>

<dl>
<dt><a name="index-data_002dtype-2"></a>Function: <strong>data-type</strong> <em>arg</em></dt>
<dd><p><code>data-type</code> returns a symbol which is the name
for the internal data-type of the &quot;pointer&quot; which represents <i>arg</i>.
Note that some types as seen by the user are not distinguished from each other
at this level, and some user types may be represented by more than one
internal type.
</p>
<dl compact="compact">
<dt><code>si:dtp-symbol</code></dt>
<dd><p>The object is a symbol.
</p></dd>
<dt><code>si:dtp-fix</code></dt>
<dd><p>The object is a fixnum; the numeric value is contained immediately in the pointer field.
</p></dd>
<dt><code>si:dtp-small-flonum</code></dt>
<dd><p>The object is an immediate small floating-point number.
</p></dd>
<dt><code>si:dtp-extended-number</code></dt>
<dd><p>The object is a flonum or a bignum.  This value will be used for future numeric
types.
</p></dd>
<dt><code>si:dtp-list</code></dt>
<dd><p>The object is a cons.
</p></dd>
<dt><code>si:dtp-locative</code></dt>
<dd><p>The object is a locative pointer.
</p></dd>
<dt><code>si:dtp-array-pointer</code></dt>
<dd><p>The object is an array.
</p></dd>
<dt><code>si:dtp-fef-pointer</code></dt>
<dd><p>The object is a fef.
</p></dd>
<dt><code>si:dtp-u-entry</code></dt>
<dd><p>The object is a microcode entry.
</p></dd>
<dt><code>si:dtp-closure</code></dt>
<dd><p>The object is a closure.
</p></dd>
<dt><code>si:dtp-stack-group</code></dt>
<dd><p>The object is a stack-group.
</p></dd>
<dt><code>si:dtp-instance</code></dt>
<dd><p>The object is an &quot;active object&quot;.  These are not documented yet.
</p></dd>
<dt><code>si:dtp-entity</code></dt>
<dd><p>The same as <code>dtp-closure</code> except it is a kind of &quot;active object&quot;.
These are not documented yet.
</p></dd>
<dt><code>si:dtp-select-method</code></dt>
<dd><p>Another type associated with &quot;active objects&quot; and not documented yet.
</p></dd>
<dt><code>si:dtp-header</code></dt>
<dd><p>An internal type used to mark the first word of a multi-word structure.
</p></dd>
<dt><code>si:dtp-array-header</code></dt>
<dd><p>An internal type used in arrays.
</p></dd>
<dt><code>si:dtp-symbol-header</code></dt>
<dd><p>An internal type used to mark the first word of a symbol.
</p></dd>
<dt><code>si:dtp-instance-header</code></dt>
<dd><p>An internal type used to mark the first word of an instance.
</p></dd>
<dt><code>si:dtp-null</code></dt>
<dd><p>Nothing to do with <code>nil</code>.  This is used in unbound value and function cells.
</p></dd>
<dt><code>si:dtp-trap</code></dt>
<dd><p>The zero data-type, which is not used.  This hopes to detect microcode errors.
</p></dd>
<dt><code>si:dtp-free</code></dt>
<dd><p>This type is used to fill free storage, to catch wild references.
</p></dd>
<dt><code>si:dtp-external-value-cell-pointer</code></dt>
<dd><p>An &quot;invisible pointer&quot; used for external value cells,
which are part of the closure mechanism (see (closure)).
and used by compiled code to address value and function cells.
</p></dd>
<dt><code>si:dtp-header-forward</code></dt>
<dd><p>An &quot;invisible pointer&quot; used to indicate that the structure containing
it has been moved elsewhere.  The &quot;header word&quot; of the structure is
replaced by one of these invisible pointers.  See the function <code>structure-forward</code>
((structure-forward-fun)).
</p></dd>
<dt><code>si:dtp-body-forward</code></dt>
<dd><p>An &quot;invisible pointer&quot; used to indicate that the structure containing
it has been moved elsewhere.  This points to the word containing
the header-forward, which points to the new copy of the structure.
</p></dd>
<dt><code>si:dtp-one-q-forward</code></dt>
<dd><p>An &quot;invisible pointer&quot; used to indicate that the single cell containing
it has been moved elsewhere.
</p></dd>
<dt><code>si:dtp-gc-forward</code></dt>
<dd><p>This is used by the copying garbage collector to flag old objects that
have already been copied.
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-q_002ddata_002dtypes-1"></a>Variable: <strong>q-data-types</strong></dt>
<dd><p>The value of <code>q-data-types</code> is a list of all of the symbolic
names for data types described above under <code>data-type</code>.
(the symbols whose print names begin
with &quot;<code>dtp-</code>&quot;)
</p></dd></dl>

<dl>
<dt><a name="index-q_002ddata_002dtypes"></a>Function: <strong>q-data-types</strong> <em>type-code</em></dt>
<dd><p>An array, indexed by the internal numeric data-type code,
which contains the corresponding symbolic names.
</p></dd></dl>

<a name="Creating-Objects"></a>
<h3 class="section">13.2 Creating Objects</h3>

<dl>
<dt><a name="index-make_002dlist-1"></a>Function: <strong>make-list</strong> <em>area size</em></dt>
<dd><p>This function makes a cdr-coded list of <code>nil</code>s of a
specified length in a specified area.
<i>area</i> is which area to create it in, which may be either a fixnum
or a symbol whose value will be used.  <i>size</i> is the number
of words to be allocated.  Each word has cdr code <i>cdr-next</i>,
except for the last which has <i>cdr-nil</i>.
</p>
<p>This function is to be used only for making lists.  If
making a &quot;structure&quot; (any data type that has a header), use one
of the two functions below.  This is because the two classes of object
must be created in different storage regions, for the sake of
system storage conventions and the garbage collector.
</p></dd></dl>

<dl>
<dt><a name="index-_0025allocate_002dand_002dinitialize"></a>Function: <strong>%allocate-and-initialize</strong> <em>data-type header-type header second-word area size</em></dt>
<dd><p>This is the subprimitive for creating most structured-type objects.
<i>area</i> is the area in which it is to be created, as a fixnum or a symbol.
<i>size</i> is the number of words to be allocated.  The value returned
points to the first word allocated, and has data-type <i>data-type</i>.
Uninterruptibly, the words allocated are initialized so that storage
conventions are preserved at all times.  The first word, the header,
is initialized to have <i>header-type</i> in its data-type field
and <i>header</i> in its pointer field.  The second word is initialized
to <i>second-word</i>.  The remaining words are initialized to <code>nil</code>.
The cdr codes are initialized as in <code>make-list</code>, currently.
</p></dd></dl>

<dl>
<dt><a name="index-_0025allocate_002dand_002dinitialize_002darray"></a>Function: <strong>%allocate-and-initialize-array</strong> <em>header data-length leader-length area size</em></dt>
<dd><p>This is the subprimitive for creating arrays, called only by <code>make-array</code>.
It is different from <code>%allocate-and-initialize</code> because arrays have
a more complicated header structure.
</p></dd></dl>

<dl>
<dt><a name="index-structure_002dforward"></a>Function: <strong>structure-forward</strong> <em>old-object new-object</em></dt>
<dd><p>This causes references to <i>old-object</i> to actually reference
<i>new-object</i>, by storing invisible pointers in <i>old-object</i>.
It returns <i>old-object</i>.
</p></dd></dl>

<dl>
<dt><a name="index-forward_002dvalue_002dcell"></a>Function: <strong>forward-value-cell</strong> <em>from-symbol to-symbol</em></dt>
<dd><p>This alters <i>from-symbol</i> so that it always has the same value
as <i>to-symbol</i>, by sharing its value cell.  A <i>one-q-forward</i>
invisible pointer is stored into <i>from-symbol</i>&rsquo;s value cell.
Do not do this when <i>from-symbol</i> is <code>lambda</code>-bound, as
the microcode does not bother to check for that case (doing so would
make binding slower).
</p></dd></dl>

<a name="Pointer-Manipulation"></a>
<h3 class="section">13.3 Pointer Manipulation</h3>

<p>It should again be emphasized that improper use of these functions
can destroy the Lisp environment, primarily because of interactions
between the garbage collector and  the illegal pointers that
can be created by these sub-primitives.
</p>

<dl>
<dt><a name="index-_0025data_002dtype"></a>Function: <strong>%data-type</strong> <em>x</em></dt>
<dd><p>Returns the data-type field of <i>x</i>, as a fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-_0025pointer"></a>Function: <strong>%pointer</strong> <em>x</em></dt>
<dd><p>Returns the pointer field of <i>x</i>, as a fixnum.  For most
types, this is dangerous since the garbage collector can copy the object
and change its address.
</p></dd></dl>

<dl>
<dt><a name="index-_0025make_002dpointer"></a>Function: <strong>%make-pointer</strong> <em>data-type pointer</em></dt>
<dd><p>This makes up a pointer, with <i>data-type</i> in the data-type
field and <i>pointer</i> in the pointer field, and returns it.  This is
most commonly used for changing the type of a pointer.  Do not use this
to make pointers which are not allowed to be in the machine, such as
<code>dtp-null</code>, invisible pointers, etc.
</p></dd></dl>

<dl>
<dt><a name="index-_0025make_002dpointer_002doffset"></a>Function: <strong>%make-pointer-offset</strong> <em>data-type pointer offset</em></dt>
<dd><p>This returns a pointer with <i>data-type</i> in the data-type
field, and <i>pointer</i> plus <i>offset</i> in the pointer field.  The
types of the arguments are not checked, their pointer fields are simply
added together.  This is useful for constructing locative pointers
into the middle of an object.  However, note that it is illegal to
have a pointer to untyped data, such as the inside of a FEF or
a numeric array.
</p></dd></dl>

<dl>
<dt><a name="index-_0025pointer_002ddifference"></a>Function: <strong>%pointer-difference</strong> <em>pointer-1 pointer-2</em></dt>
<dd><p>Returns a fixnum which is <i>pointer-1</i> minus <i>pointer-2</i>.
No type checks are made.  For the result to be meaningful, the two pointers
must point into the same object, so that their difference cannot change
as a result of garbage collection.
</p></dd></dl>

<dl>
<dt><a name="index-_0025find_002dstructure_002dheader"></a>Function: <strong>%find-structure-header</strong> <em>pointer</em></dt>
<dd><p>This subprimitive finds the structure into which
<i>pointer</i> points, by searching backward for a header.
It is a basic low-level function used by such things as the
garbage collector.
<i>pointer</i> is normally a locative, but its data-type is ignored.
Note that it is illegal to point into an &quot;unboxed&quot; portion of
a structure, for instance the middle of a numeric array.
</p>
<p>In structure space, the &quot;containing structure&quot; of a pointer
is well-defined by system storage conventions.  In list space,
it is considered to be the contiguous, cdr-coded segment of
list surrounding the location pointed to.  If a cons of the list
has been copied out by <code>rplacd</code>, the contiguous list includes
that pair and ends at that point.
</p></dd></dl>

<dl>
<dt><a name="index-_0025find_002dstructure_002dleader"></a>Function: <strong>%find-structure-leader</strong> <em>pointer</em></dt>
<dd><p>This is identical to <code>%find-structure-header</code>, except that if the
structure is an array with a leader, this returns a locative pointer
to the leader-header, rather than returning the array-pointer itself.
Thus the result of <code>%find-structure-leader</code> is always the lowest
address in the structure.  This is the one used internally by the garbage collector.
</p></dd></dl>

<dl>
<dt><a name="index-_0025structure_002dboxed_002dsize"></a>Function: <strong>%structure-boxed-size</strong> <em>object</em></dt>
<dd><p>Returns the number of &quot;boxed Q&rsquo;s&quot; in <i>object</i>.  This is the number
of words at the front of the structure which contain normal Lisp objects.
Some structures, for example FEFs and numeric arrays, containing additional
&quot;unboxed Q&rsquo;s&quot; following their &quot;boxed Q&rsquo;s&quot;.
Note that the boxed size of a PDL (either regular or special) does not
include Q&rsquo;s above the current top of the PDL.  These locations are boxed
but their contents is considered garbage, and is not protected by the
garbage collector.
</p></dd></dl>

<dl>
<dt><a name="index-_0025structure_002dtotal_002dsize"></a>Function: <strong>%structure-total-size</strong> <em>object</em></dt>
<dd><p>Returns the total number of words occupied by the representation
of <i>object</i>.
</p></dd></dl>

<a name="Special-Memory-Referencing"></a>
<h3 class="section">13.4 Special Memory Referencing</h3>

<dl>
<dt><a name="index-_0025store_002dconditional"></a>Function: <strong>%store-conditional</strong> <em>pointer old new</em></dt>
<dd><p>This is the basic locking primitive.  <i>pointer</i> points to
a cell which is uninterruptibly read and written.  If the contents of
the cell is <code>eq</code> to <i>old</i>, then it is replaced by <i>new</i> and
<code>t</code> is returned.  Otherwise, <code>nil</code> is returned and the contents
of the cell is not changed.
</p></dd></dl>

<p>The following four functions are for I/O programming.
</p>
<dl>
<dt><a name="index-_0025unibus_002dread"></a>Function: <strong>%unibus-read</strong> <em>address</em></dt>
<dd><p>Returns the contents of the register at the specified Unibus
address, as a fixnum.  You must specify a full 18-bit address.  This
is guaranteed to read the location only once.  Since the Lisp
Machine Unibus does not support byte operations, this always references
a 16-bit word, and so <i>address</i> will normally be an even number.
</p></dd></dl>

<dl>
<dt><a name="index-_0025unibus_002dwrite"></a>Function: <strong>%unibus-write</strong> <em>address data</em></dt>
<dd><p>Writes the 16-bit number <i>data</i> at the specified Unibus
address, exactly once.
</p></dd></dl>

<dl>
<dt><a name="index-_0025xbus_002dread"></a>Function: <strong>%xbus-read</strong> <em>io-offset</em></dt>
<dd><p>Returns a fixnum which is the low 24 bits of the contents
of the register at the specified Xbus address.  <i>io-offset</i> is
an offset into the I/O portion of Xbus physical address space.
This is guaranteed to read the location exactly once.
</p></dd></dl>

<dl>
<dt><a name="index-_0025xbus_002dwrite"></a>Function: <strong>%xbus-write</strong> <em>io-offset data</em></dt>
<dd><p>Writes the pointer field of <i>data</i>, which should be a fixnum,
into the register at the specified Xbus address.
The high eight bits of the word written are always zero.
<i>io-offset</i> is
an offset into the I/O portion of Xbus physical address space.
This is guaranteed to write the location exactly once.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dcontents_002doffset"></a>Function: <strong>%p-contents-offset</strong> <em>base-pointer offset</em></dt>
<dd><p>This checks the cell pointed to by <i>base-pointer</i> for
a forwarding pointer.  Having followed forwarding pointers to the
real structure pointed to, it adds <i>offset</i> to the resulting
forwarded <i>base-pointer</i> and returns the contents of that location.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dcontents_002das_002dlocative"></a>Function: <strong>%p-contents-as-locative</strong> <em>pointer</em></dt>
<dd><p>Given a pointer to a memory location containing a pointer which isn&rsquo;t
allowed to be &quot;in the machine&quot; (typically an invisible pointer)
this function returns the contents of the location as a <code>dtp-locative</code>.  I.e.
it changes the disallowed data type to locative so that you can safely
look at it and see what it points to.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dcontents_002das_002dlocative_002doffset"></a>Function: <strong>%p-contents-as-locative-offset</strong> <em>base-pointer offset</em></dt>
<dd><p>This checks the cell pointed to by <i>base-pointer</i> for
a forwarding pointer.  Having followed forwarding pointers to the
real structure pointed to, it adds <i>offset</i> to the resulting
forwarded <i>base-pointer</i>, fetches the contents of that location,
and returns it with the data type changed to <code>dtp-locative</code> in case
it was a type which isn&rsquo;t allowed to be &quot;in the machine&quot; (typically
an invisible pointer).  This is used, for example, to analyze the
<code>dtp-external-value-cell-pointer</code> pointers in a FEF, which are
used by the compiled code to reference value cells and function cells
of symbols.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002dcontents"></a>Function: <strong>%p-store-contents</strong> <em>pointer value</em></dt>
<dd><p><i>value</i> is stored into the data-type and pointer
fields of the location addressed by <i>pointer</i>.  The cdr-code
and flag-bit fields remain unchanged.  <i>value</i> is returned.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002dcontents_002doffset"></a>Function: <strong>%p-store-contents-offset</strong> <em>value base-pointer offset</em></dt>
<dd><p>This checks the cell pointed to by <i>base-pointer</i> for
a forwarding pointer.  Having followed forwarding pointers to the
real structure pointed to, it adds <i>offset</i> to the resulting
forwarded <i>base-pointer</i>, and stores <i>value</i> into the data-type and pointer
fields of that location.  The cdr-code
and flag-bit fields remain unchanged.  <i>value</i> is returned.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002dtag_002dand_002dpointer"></a>Function: <strong>%p-store-tag-and-pointer</strong> <em>pointer miscfields pntrfield</em></dt>
<dd><p>Creates a <i>Q</i> by taking 8 bits from <i>miscfields</i>
and 24 bits from <i>pntrfield</i>, and stores that into the
location addressed by <i>pointer</i>.  The low 5 bits of <i>miscfields</i>
become the data-type, the next bit becomes the flag-bit, and the
top two bits become the cdr-code.  This is a good
way to store a forwarding pointer from one structure
to another (for example).
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dldb"></a>Function: <strong>%p-ldb</strong> <em>ppss pointer</em></dt>
<dd><p>This is like <code>ldb</code> but gets a byte from the location
addressed by <i>pointer</i>.  Note that
you can load bytes out of the data type etc. bits, not just
the pointer field, and that the word loaded out of need not
be a fixnum.  The result returned is always a fixnum, unlike
<code>%p-contents</code> and friends.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dldb_002doffset"></a>Function: <strong>%p-ldb-offset</strong> <em>ppss base-pointer offset</em></dt>
<dd><p>This checks the cell pointed to by <i>base-pointer</i> for
a forwarding pointer.  Having followed forwarding pointers to the
real structure pointed to, the byte specified by <i>ppss</i> is
loaded from the contents of the location addressed by the forwarded
<i>base-pointer</i> plus <i>offset</i>, and returned as a fixnum.
This is the way to reference byte fields within a structure
without violating system storage conventions.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002ddpb"></a>Function: <strong>%p-dpb</strong> <em>value ppss pointer</em></dt>
<dd><p>The <i>value</i>, a fixnum, is stored into the byte selected
by <i>ppss</i> in the word addressed by <i>pointer</i>.  <code>nil</code> is returned.
You can use this to alter data types, cdr codes, etc.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002ddpb_002doffset"></a>Function: <strong>%p-dpb-offset</strong> <em>value ppss base-pointer offset</em></dt>
<dd><p>This checks the cell pointed to by <i>base-pointer</i> for
a forwarding pointer.  Having followed forwarding pointers to the
real structure pointed to, the <i>value</i> is stored into the byte specified by <i>ppss</i> in
the location addressed by the forwarded
<i>base-pointer</i> plus <i>offset</i>.  <code>nil</code> is returned.
This is the way to alter unboxed data within a structure
without violating system storage conventions.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dmask_002dfield"></a>Function: <strong>%p-mask-field</strong> <em>ppss pointer</em></dt>
<dd><p>This is similar to <code>%p-ldb</code>, except that the selected
byte is returned in its original position within the word instead
of right-aligned.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dmask_002dfield_002doffset"></a>Function: <strong>%p-mask-field-offset</strong> <em>ppss base-pointer offset</em></dt>
<dd><p>This is similar to <code>%p-ldb-offset</code>, except that the selected
byte is returned in its original position within the word instead
of right-aligned.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002ddeposit_002dfield"></a>Function: <strong>%p-deposit-field</strong> <em>value ppss pointer</em></dt>
<dd><p>This is similar to <code>%p-dpb</code>, except that the selected
byte is stored from the corresponding bits of <i>value</i> rather than
the right-aligned bits.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002ddeposit_002dfield_002doffset"></a>Function: <strong>%p-deposit-field-offset</strong> <em>value ppss base-pointer offset</em></dt>
<dd><p>This is similar to <code>%p-dpb-offset</code>, except that the selected
byte is stored from the corresponding bits of <i>value</i> rather than
the right-aligned bits.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dpointer"></a>Function: <strong>%p-pointer</strong> <em>pointer</em></dt>
<dd><p>Extracts the pointer field of the contents of the
location addressed by <i>pointer</i> and returns
it as a fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002ddata_002dtype"></a>Function: <strong>%p-data-type</strong> <em>pointer</em></dt>
<dd><p>Extracts the data-type field of the contents of the
location addressed by <i>pointer</i> and returns
it as a fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dcdr_002dcode"></a>Function: <strong>%p-cdr-code</strong> <em>pointer</em></dt>
<dd><p>Extracts the cdr-code field of the contents of the
location addressed by <i>pointer</i> and returns
it as a fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dflag_002dbit"></a>Function: <strong>%p-flag-bit</strong> <em>pointer</em></dt>
<dd><p>Extracts the flag-bit field of the contents of the
location addressed by <i>pointer</i> and returns
it as a fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002dpointer"></a>Function: <strong>%p-store-pointer</strong> <em>pointer value</em></dt>
<dd><p>Clobbers the pointer field of the location
addressed by <i>pointer</i> to <i>value</i>, and returns <i>value</i>.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002ddata_002dtype"></a>Function: <strong>%p-store-data-type</strong> <em>pointer value</em></dt>
<dd><p>Clobbers the data-type field of the location
addressed by <i>pointer</i> to <i>value</i>, and returns <i>value</i>.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002dcdr_002dcode"></a>Function: <strong>%p-store-cdr-code</strong> <em>pointer value</em></dt>
<dd><p>Clobbers the cdr-code field of the location
addressed by <i>pointer</i> to <i>value</i>, and returns <i>value</i>.
</p></dd></dl>

<dl>
<dt><a name="index-_0025p_002dstore_002dflag_002dbit"></a>Function: <strong>%p-store-flag-bit</strong> <em>pointer value</em></dt>
<dd><p>Clobbers the flag-bit field of the location
addressed by <i>pointer</i> to <i>value</i>, and returns <i>value</i>.
</p></dd></dl>

<dl>
<dt><a name="index-_0025stack_002dframe_002dpointer"></a>Function: <strong>%stack-frame-pointer</strong></dt>
<dd><p>Returns a locative pointer to its caller&rsquo;s stack frame.  This
function is not defined in the interpreted Lisp environment; it only works
from compiled code.  Since it turns into a &quot;misc&quot; instruction,
the &quot;caller&rsquo;s stack frame&quot; really means &quot;the frame for the FEF
that executed the <code>%stack-frame-pointer</code> instruction&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-bind"></a>Function: <strong>bind</strong> <em>locative value</em></dt>
<dd><p>[This will be renamed to <code>%bind</code> in the future.]
Binds the cell pointed to by <i>locative</i> to <i>x</i>, in
the caller&rsquo;s environment. This
function is not defined in the interpreted Lisp environment; it only works
from compiled code.  Since it turns into an instruction,
the &quot;caller&rsquo;s environment&quot; really means &quot;the binding block for the FEF
that executed the <code>bind</code> instruction&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-_0025halt"></a>Function: <strong>%halt</strong></dt>
<dd><p>Stops the machine.
</p></dd></dl>

<a name="The-Paging-System"></a>
<h3 class="section">13.5 The Paging System</h3>


<p>[Someday this will discuss how it works.]
</p>
<dl>
<dt><a name="index-si_003awire_002dpage"></a>Function: <strong>si:wire-page</strong> <em>address &amp;optional (wire-p <code>t</code>)</em></dt>
<dd><p>If <i>wire-p</i> is <code>t</code>, the page containing <i>address</i> is <i>wired-down</i>; that is,
it cannot be paged-out.  If <i>wire-p</i> is <code>nil</code>, the page ceases to be wired-down.
</p></dd></dl>

<dl>
<dt><a name="index-si_003aunwire_002dpage"></a>Function: <strong>si:unwire-page</strong> <em>address</em></dt>
<dd><p><code>(si:unwire-page <i>address</i>)</code> is the same as <code>(si:wire-page <i>address</i>)</code>.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025change_002dpage_002dstatus"></a>Function: <strong>si:%change-page-status</strong> <em>virtual-address swap-status access-status-and-meta-bits</em></dt>
<dd><p>The page hash table entry for the page containing <i>virtual-address</i>
is found and altered as specified.  <code>t</code> is returned if it was found,
<code>nil</code> if it was not (presumably the page is swapped out.)  <i>swap-status</i>
and <i>access-status-and-meta-bits</i> can be <code>nil</code> if those fields are not
to be changed.  This doesn&rsquo;t make any error checks; you can really
screw things up if you call it with the wrong arguments.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025compute_002dpage_002dhash"></a>Function: <strong>si:%compute-page-hash</strong> <em>virtual-address</em></dt>
<dd><p>This makes the hashing function for the page hash table
available to the user.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025create_002dphysical_002dpage"></a>Function: <strong>si:%create-physical-page</strong> <em>physical-address</em></dt>
<dd><p>This is used when adjusting the size of real memory available
to the machine.  It adds an entry for the page frame at <i>physical-address</i>
to the page hash table, with virtual address -1, swap status flushable,
and map status 120 (read only).  This doesn&rsquo;t make error checks; you
can really screw things up if you call it with the wrong arguments.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025delete_002dphysical_002dpage"></a>Function: <strong>si:%delete-physical-page</strong> <em>physical-address</em></dt>
<dd><p>If there is a page in the page frame at <i>physical-address</i>,
it is swapped out and its entry is deleted from the page hash table,
making that page frame unavailable for swapping in of pages in the
future.  This doesn&rsquo;t make error checks; you
can really screw things up if you call it with the wrong arguments.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025disk_002drestore"></a>Function: <strong>si:%disk-restore</strong> <em>high-16-bits low-16-bits</em></dt>
<dd><p>Loads virtual memory from the partition named by the catenation of
the two 16-bit arguments, and starts executing it.  The name <code>0</code>
refers to the default load (the one the machine loads when it is
started up).
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025disk_002dsave"></a>Function: <strong>si:%disk-save</strong> <em>physical-mem-size high-16-bits low-16-bits</em></dt>
<dd><p>Copies virtual memory into the partition named by the catenation
of the two 16-bit arguments (<code>0</code> means the default), then restarts
the world, as if it had just been restored.  The <i>physical-mem-size</i>
argument should come from <code>%sys-com-memory-size</code> in <code>system-communication-area</code>.
</p></dd></dl>

<a name="Microcode-Variables"></a>
<h3 class="section">13.6 Microcode Variables</h3>

<p>The following variables&rsquo; values actually reside in the scratchpad memory
of the processor.  They are put there by <code>dtp-one-q-forward</code> invisible
pointers.  The values of these variables are used by the microcode.
</p>
<dl>
<dt><a name="index-_0025microcode_002dversion_002dnumber"></a>Variable: <strong>%microcode-version-number</strong></dt>
<dd><p>This is the version number of the currently-loaded microcode, obtained
from the version number of the microcode source file.
</p></dd></dl>

<dl>
<dt><a name="index-sys_003a_0025number_002dof_002dmicro_002dentries"></a>Variable: <strong>sys:%number-of-micro-entries</strong></dt>
<dd><p>Size of <code>micro-code-entry-area</code> and related areas.  Currently the
data-type is missing from this number.
</p></dd></dl>

<dl>
<dt><a name="index-default_002dcons_002darea"></a>Variable: <strong>default-cons-area</strong></dt>
<dd><p>The area number of the default area in which new data are to be consed.
This is normally <code>working-storage-area</code>.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025initial_002dfef"></a>Variable: <strong>si:%initial-fef</strong></dt>
<dd><p>The function which is called when the machine starts up.
Normally <code>si:lisp-top-level</code>.
</p></dd></dl>

<dl>
<dt><a name="index-_0025error_002dhandler_002dstack_002dgroup"></a>Variable: <strong>%error-handler-stack-group</strong></dt>
<dd><p>The stack group which receives control when a microcode-detected error
occurs.  This stack group cleans up, signals the appropriate condition,
or enters the debugger.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup-1"></a>Variable: <strong>si:%current-stack-group</strong></dt>
<dd><p>The stack group which is currently running.
</p></dd></dl>

<dl>
<dt><a name="index-_0025initial_002dstack_002dgroup"></a>Variable: <strong>%initial-stack-group</strong></dt>
<dd><p>The stack group in which the machine starts up.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup_002dstate"></a>Variable: <strong>si:%current-stack-group-state</strong></dt>
<dd><p>The <code>sg-state</code> of the currently-running stack group.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup_002dprevious_002dstack_002dgroup-1"></a>Variable: <strong>si:%current-stack-group-previous-stack-group</strong></dt>
<dd><p>The resumer of the currently-running stack group.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup_002dcalling_002dargs_002dpointer"></a>Variable: <strong>si:%current-stack-group-calling-args-pointer</strong></dt>
<dd><p>The argument list of the currently-running stack group.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025current_002dstack_002dgroup_002dcalling_002dargs_002dnumber"></a>Variable: <strong>si:%current-stack-group-calling-args-number</strong></dt>
<dd><p>The number of arguments to the currently-running stack group.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025trap_002dmicro_002dpc"></a>Variable: <strong>si:%trap-micro-pc</strong></dt>
<dd><p>The microcode address of the most recent error trap.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dfirst_002dlevel_002dmap_002dreloads"></a>Variable: <strong>si:%count-first-level-map-reloads</strong></dt>
<dd><p>The number of times the first-level virtual-memory map was invalid
and had to be reloaded from the page hash table.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dsecond_002dlevel_002dmap_002dreloads"></a>Variable: <strong>si:%count-second-level-map-reloads</strong></dt>
<dd><p>The number of times the second-level virtual-memory map was invalid
and had to be reloaded from the page hash table.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dpdl_002dbuffer_002dread_002dfaults"></a>Variable: <strong>si:%count-pdl-buffer-read-faults</strong></dt>
<dd><p>The number of read references to the pdl buffer which happened
as virtual memory references which trapped.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dpdl_002dbuffer_002dwrite_002dfaults"></a>Variable: <strong>si:%count-pdl-buffer-write-faults</strong></dt>
<dd><p>The number of read references to the pdl buffer which happened
as virtual memory references which trapped.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dpdl_002dbuffer_002dmemory_002dfaults"></a>Variable: <strong>si:%count-pdl-buffer-memory-faults</strong></dt>
<dd><p>The number of virtual memory references which trapped in case
they should have gone to the pdl buffer, but turned out to be
real memory references after all (and therefore were needlessly
slowed down.)
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002ddisk_002dpage_002dreads"></a>Variable: <strong>si:%count-disk-page-reads</strong></dt>
<dd><p>The number of pages read from the disk.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002ddisk_002dpage_002dwrites"></a>Variable: <strong>si:%count-disk-page-writes</strong></dt>
<dd><p>The number of pages written to the disk.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002ddisk_002derrors"></a>Variable: <strong>si:%count-disk-errors</strong></dt>
<dd><p>The number of recoverable disk errors.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dfresh_002dpages"></a>Variable: <strong>si:%count-fresh-pages</strong></dt>
<dd><p>The number of fresh (newly-consed) pages created in core,
which would have otherwise been read from the disk.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025aging_002drate"></a>Variable: <strong>si:%aging-rate</strong></dt>
<dd><p>The number of age steps per disk read or write.  This parameter
controls how long a page must remain unreferenced before it is
evicted from main memory.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002daged_002dpages"></a>Variable: <strong>si:%count-aged-pages</strong></dt>
<dd><p>The number of times the page ager set an age trap on a page, to determine
whether it was being referenced.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025count_002dage_002dflushed_002dpages"></a>Variable: <strong>si:%count-age-flushed-pages</strong></dt>
<dd><p>The number of times the page ager saw that a page still had an age trap
and hence made it &quot;flushable&quot;, a candidate for eviction from main memory.
</p></dd></dl>

<dl>
<dt><a name="index-_0025mar_002dlow"></a>Variable: <strong>%mar-low</strong></dt>
<dd><p>A fixnum which is the inclusive lower bound of the region of virtual
memory subject to the MAR feature.
</p></dd></dl>

<dl>
<dt><a name="index-_0025mar_002dhigh"></a>Variable: <strong>%mar-high</strong></dt>
<dd><p>A fixnum which is the inclusive upper bound of the region of virtual
memory subject to the MAR feature.
</p></dd></dl>

<dl>
<dt><a name="index-_0025self"></a>Variable: <strong>%self</strong></dt>
<dd><p>The instance which has just been called.  (See (instance).)
</p></dd></dl>

<dl>
<dt><a name="index-_0025method_002dclass"></a>Variable: <strong>%method-class</strong></dt>
<dd><p>The class in which the current method was found.  (See (method).)
</p></dd></dl>

<dl>
<dt><a name="index-inhibit_002dscheduling_002dflag"></a>Variable: <strong>inhibit-scheduling-flag</strong></dt>
<dd><p>If non-<code>nil</code>, no process other than the current process can
run.
</p></dd></dl>

<dl>
<dt><a name="index-inhibit_002dscavenging_002dflag"></a>Variable: <strong>inhibit-scavenging-flag</strong></dt>
<dd><p>If non-<code>nil</code>, the scavenger is turned off.  The scavenger is
the quasi-asynchronous portion of the garbage collector,
which normally runs during consing operations.
</p></dd></dl>

<a name="Areas"></a>
<h2 class="chapter">14 Areas</h2>
<a name="index-area-1"></a>


<p>[Note: this chapter will be completely rewritten in the next edition
of this manual, to reflect the existence of the garbage collector.
The present chapter is very incomplete.]
</p>
<p>Storage in the Lisp machine is divided into <i>areas</i>.
Each area contains related objects, of any type.  Areas are intended to give the
user control over the paging behavior of his program, among other
things.  By putting related data together, locality can be greatly
increased.  Whenever a new object is created, for instance with <code>cons</code>,
the area to be used can optionally be specified.  There is a default
Working Storage area which collects those objects which the user has
not chosen to control explicitly.
</p>
<p>Areas also give the user a handle to control the garbage
collector.  Some areas can be declared to be &quot;static&quot;, which means that
they change slowly and the garbage collector should not attempt to
reclaim any space in them.  This can eliminate a lot of useless
copying.  All pointers out of a static area can be collected into an
&quot;exit vector&quot;, eliminating any need for the garbage collector to look
at that area.  As an important example, an English-language dictionary
can be kept inside the Lisp without adversely affecting the speed of
garbage collection.  A &quot;static&quot; area can be explicitly
garbage-collected at infrequent intervals when it is believed that that
might be worthwhile.
</p>
<p>Each area can potentially have a different storage discipline,
a different paging algorithm, and even a different data representation.
The microcode will dispatch on an attribute of the area at the
appropriate times.  The structure of the machine makes the performance
cost of these features negligible; information about areas is stored
in extra bits in the memory mapping hardware where it can be quickly
dispatched on by the microcode.  These dispatches usually have to be
done anyway to make the garbage collector work, and to implement
invisible pointers.
</p>
<p>Since the garbage collector is not yet implemented, the features
mentioned in the previous two paragraphs are not either.  Also, with
the implementation of the garbage collector will come a new, more sophisticated
area scheme.  The two most visible effects of the new scheme will be
that garbage will be collected, and that areas will be able to shrink
and grow.  When this happens, it will be documented; stay tuned.  Most of this
chapter will become inoperative at this time, so don&rsquo;t depend on it.
</p>
<p>Each area has a name and a number.  The name is a symbol whose value
is the number.  The number is an index into various internal tables.  Normally
the name is treated as a special variable, so the number is what is given
as an argument to a function that takes an area as an argument.
Thus, areas are not Lisp objects.
</p>
<p>The following variables hold the areas most often used:
</p>
<dl>
<dt><a name="index-default_002dcons_002darea-1"></a>Variable: <strong>default-cons-area</strong></dt>
<dd><p>The value of this variable is the number of the area to which all of the creators
of conses (<code>cons, xcons, list, append</code>, etc.) use by default.
It is initially the number of <code>working-storage-area</code>.
Note that you can either bind this variable or use functions such as
<code>cons-in-area</code> (see (cons-in-area-fun)) which take an area as an explicit argument.
</p></dd></dl>

<dl>
<dt><a name="index-default_002darray_002darea"></a>Variable: <strong>default-array-area</strong></dt>
<dd><p>The value of this variable is the number of the area which
<code>make-array</code> uses by default.  It is initially the number of
<code>working-storage-area</code>.
</p></dd></dl>

<dl>
<dt><a name="index-make_002darea"></a>Function: <strong>make-area</strong> <em>&amp;rest keywords</em></dt>
<dd><p>Creates a new area, whose name and attributes are specified by the keywords.
You must specify a symbol as a name; the symbol will be <code>setq</code>&rsquo;ed to
the area-number of the new area, and that number will also be returned.
The arguments are taken in pairs, the first being a keyword and the second
a &quot;value&quot; for that keyword.  The following keywords exist:
</p>
<dl compact="compact">
<dt><code>:name</code></dt>
<dd><p>A symbol which will be the name of the area.  This item is required.
</p></dd>
<dt><code>:size</code></dt>
<dd><p>The maximum allowed size of the area, in words.  Defaults to infinite.
</p></dd>
<dt><code>:region-size</code></dt>
<dd><p>The approximate size, in words, for regions within this area.  The default
is the area size if a <code>:size</code> argument was given, otherwise a suitable
medium size.  Note that if you specify <code>:size</code> and not <code>:region-size</code>,
the area will have exactly one region.
</p></dd>
<dt><code>:representation</code></dt>
<dd><p>The type of object to be contained in the area&rsquo;s initial region.
The argument to this keyword can be <code>:list</code>, <code>:structure</code>, or a numeric code.
<code>:structure</code> is the default.
</p></dd>
<dt><code>:gc</code></dt>
<dd><p>The type of garbage-collection to be employed.  The choices are <code>:dynamic</code>
(which is the default) and <code>:static</code>.  <code>:static</code> means that the area will
not be copied by the garbage collector, and nothing in the area or pointed to by
the area will ever be reclaimed.
</p></dd>
<dt><code>:read-only</code></dt>
<dd><p>With an argument of <code>t</code>, causes the area to be made <i>read-only</i>.
</p></dd>
<dt><code>:pdl</code></dt>
<dd><p>With an argument of <code>t</code>, makes the area suitable for storing
regular-pdls of stack-groups.  This is a special attribute due to the
pdl-buffer hardware.
</p></dd>
<dt><code>:compact-cons</code></dt>
<dd><p>With an argument of <code>t</code>, enables the <i>at present unimplemented</i>
feature that <code>cons</code> will create cdr-coded list-structure when possible.
</p></dd>
<dt><code>sys:%%region-map-bits</code></dt>
<dd><p>Lets you specify the <i>map bits</i> explicitly, overriding the specification
from the other keywords.  This is for special hacks only.
</p></dd>
<dt><code>sys:%%region-space-type</code></dt>
<dd><p>Lets you specify the <i>space type</i> explicitly, overriding the specification
from the other keywords.  This is for special hacks only.
</p></dd>
<dt><code>sys:%%region-scavenge-enable</code></dt>
<dd><p>Lets you override the scavenge-enable bit explicitly.  Don&rsquo;t mess with this!
</p></dd>
</dl>

<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(make-area ':name 'foo-area
           ':gc ':dynamic
           ':representation ':list)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-area_002dlist"></a>Variable: <strong>area-list</strong></dt>
<dd><p>The value of <code>area-list</code> is a list of the names of all existing areas.
This list shares storage with the internal area name table, so you should
not change it.
</p></dd></dl>

<dl>
<dt><a name="index-_0025area_002dnumber"></a>Function: <strong>%area-number</strong> <em>pointer</em></dt>
<dd><p>Returns the number of the area to which <i>pointer</i> points, or <code>nil</code> if
it does not point within any known area.  The data-type of <i>pointer</i>
is ignored.
</p></dd></dl>

<dl>
<dt><a name="index-_0025region_002dnumber"></a>Function: <strong>%region-number</strong> <em>pointer</em></dt>
<dd><p>Returns the number of the region to which <i>pointer</i> points, or <code>nil</code> if
it does not point within any known region.  The data-type of <i>pointer</i>
is ignored.  Regions will be explained later.
</p></dd></dl>

<p>We will now list those areas with which the user may need to be concerned.
This section will be expanded later.
</p>
<dl>
<dt><a name="index-area_002dname-1"></a>Variable: <strong>area-name</strong></dt>
<dd><p>Indexed by area number.  Contains the area&rsquo;s name (a symbol).
</p></dd></dl>

<dl>
<dt><a name="index-area_002dname"></a>Function: <strong>area-name</strong></dt>
<dd><p>The function definition of <code>area-name</code> is an array of area names,
indexed by area numbers.
</p></dd></dl>

<dl>
<dt><a name="index-working_002dstorage_002darea"></a>Variable: <strong>working-storage-area</strong></dt>
<dd><p>This is the normal value of <code>default-cons-area</code> and <code>default-array-area</code>.
Most working data are consed in this area.
</p></dd></dl>

<dl>
<dt><a name="index-permanent_002dstorage_002darea"></a>Variable: <strong>permanent-storage-area</strong></dt>
<dd><p>This is to be used for &quot;permanent&quot; data, which will (almost) never become
garbage.  Unlike <code>woring-storage-area</code>, the contents of this area
are not continually copied by the garbage collector.
</p></dd></dl>

<dl>
<dt><a name="index-sys_003ap_002dn_002dstring"></a>Variable: <strong>sys:p-n-string</strong></dt>
<dd><p>Print names are stored here.
</p></dd></dl>

<dl>
<dt><a name="index-sys_003anr_002dsym"></a>Variable: <strong>sys:nr-sym</strong></dt>
<dd><p>This contains most of the symbols in the Lisp world, except <code>t</code> and <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-macro_002dcompiled_002dprogram"></a>Variable: <strong>macro-compiled-program</strong></dt>
<dd><p>FEFs are put here by the compiler and by <code>fasload</code>.
</p></dd></dl>

<a name="The-Compiler"></a>
<h2 class="chapter">15 The Compiler</h2>
<a name="index-compiler"></a>

<a name="The-Basic-Operations-of-the-Compiler"></a>
<h3 class="section">15.1 The Basic Operations of the Compiler</h3>

<p>The purpose of the Lisp compiler is to convert Lisp functions
into programs in the Lisp Machine&rsquo;s instruction set, so that they
will run more quickly and take up less storage.  Compiled functions
are represented in Lisp by FEFs (Function
Entry Frames), which contain machine code as well as various other information.
The format of FEFs and the instruction set are explained in (section-fef-format).
</p>
<p>There are three ways to invoke the compiler from the Lisp
Machine.  First, you may have an interpreted function in the Lisp
environment which you would like to compile.  The function <code>compile</code>
is used to do this.  Second, you may have code in an editor buffer
which you would like to compile.  The EINE editor has commands
to read code into Lisp and compile it.
Third, you may have a program (a group of function definitions and other forms) written in a
file on the file system.  The compiler can translate this file into a
QFASL file.  Loading in the QFASL file is like reading in the source
file, except that the functions in the source file will be compiled.
The <code>qc-file</code> function is used for translating source files into QFASL files.
</p>

<a name="How-to-Invoke-the-Compiler"></a>
<h3 class="section">15.2 How to Invoke the Compiler</h3>

<dl>
<dt><a name="index-compile"></a>Function: <strong>compile</strong> <em>symbol</em></dt>
<dd><p><i>symbol</i> should be defined as an interpreted function (its definition
should be a lambda-expression).  The compiler converts the lambda-expression
into a FEF, saves the lambda-expression as the <code>:previous-expr-definition</code>
and <code>:previous-definition</code> properties of <i>symbol</i>, and changes <i>symbol</i>&rsquo;s
definition to be the FEF.  (See <code>fset-carefully</code>, (fset-carefully-fun).
(Actually, if <i>symbol</i> is not defined as a lambda-expression,
<code>compile</code> will try to find a lambda-expression in the <code>:previous-expr-definition</code>
property of <i>symbol</i> and use that instead.)
</p></dd></dl>

<dl>
<dt><a name="index-uncompile"></a>Function: <strong>uncompile</strong> <em>symbol</em></dt>
<dd><p>If <i>symbol</i> is not defined as an interpreted function and it
has a <code>:previous-expr-definition</code> property, then <code>uncompile</code>
will restore the function cell from the value of the property.
This &quot;undoes&quot; the effect of <code>compile</code>.
</p></dd></dl>

<dl>
<dt><a name="index-qc_002dfile"></a>Function: <strong>qc-file</strong> <em>filename &amp;optional output-file load-flag in-core-flag package</em></dt>
<dd><p>The file <i>filename</i> is given to the compiler, and the output of the
compiler is written to a file whose name is <i>filename</i> except with an
FN2 of &quot;QFASL&quot;.  The input format for files to the compiler is
described on (compiler-input-section).
Macro definitions and <code>special</code> declarations created during
the compilation will be undone when the compilation is
finished.
</p>
<p>The optional arguments allow certain modifications to this procedure.
<i>output-file</i> lets you change where the output is written.
<i>package</i> lets you specify in what package the source file is to
be read.  Normally the system knows, or asks interactively,
and you need not supply this argument.
<i>load-flag</i> and <i>in-core-flag</i> are incomprehensible; you don&rsquo;t
want to use them.
</p></dd></dl>

<dl>
<dt><a name="index-qc_002dfile_002dload"></a>Function: <strong>qc-file-load</strong> <em>filename</em></dt>
<dd><p><code>qc-file-load</code> compiles a file and then loads it in.
</p></dd></dl>

<p>See also the <code>disassemble</code> function ((disassemble-fun)), which lists the instructions
of a compiled function in symbolic form.
</p>
<p>The compiler can also be run in Maclisp on ITS.  On the MIT-AI
machine, type :LISPM1;QCMP.  It will type out &quot;READY&quot; and leave you
at a Maclisp top level.  Then type <code>(qc-file <i>filename</i>)</code>,
expressing <i>filename</i> in Maclisp form.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(qc-file '((lispm) foo &gt;))
</pre></div>

<a name="Input-to-the-Compiler"></a>
<h3 class="section">15.3 Input to the Compiler</h3>
<a name="index-input-to-the-compiler"></a>

<p>The purpose of <code>qc-file</code> is to take a file and produce
a translated version which does the same thing as the original except
that the functions are compiled.  <code>qc-file</code> reads through the input
file, processing the forms in it one by one.  For each form, suitable
binary output is sent to the QFASL file so that when the QFASL file is
loaded the effect of that source form will be reproduced.  The differences
between source files and QFASL files are that QFASL files are in a compressed
binary form which reads much faster (but cannot be edited), and that
function definitions in QFASL files have been translated from S-expressions
to FEFs.
</p>
<p>So, if the source contains a <code>(defun ...)</code> form at top
level, then when the QFASL file is loaded, the function will be defined
as a compiled function.  If the source file contains a form which is
not of a type known specially to the compiler, then that form will be
output &quot;directly&quot; into the QFASL file, so that when the QFASL file is
loaded that form will be evaluated.  Thus, if the source file contains
<code>(setq x 3)</code>, then the compiler will put in the QFASL file
instructions to set <code>x</code> to <code>3</code> at load time.
</p>
<p>However, sometimes we want to put things in the file
that are not merely meant to be translated into QFASL form.
One such occasion is top level macro definitions; the macros
must actually get defined within the compiler in order that the
compiler be able to expand them at compile time.  So when a macro
form is seen, it should (sometimes) be evaluated at compile time,
and should (sometimes) be put into the QFASL file.
</p>
<p>Another thing we sometimes want to put in a file is
compiler declarations.  These are forms which should be evaluated
at compile time to tell the compiler something.  They should
not be put into the QFASL file.
</p>
<p>Therefore, a facility exists to allow the user to tell
the compiler just what to do with a form.  One might want a form
to be:
</p>
<dl compact="compact">
<dt><span class="roman">Put into the QFASL file (translated), or not.</span></dt>
<dt><span class="roman">Evaluated within the compiler, or not.</span></dt>
<dt><span class="roman">Evaluated if the file is read directly into Lisp, or not.</span></dt>
</dl>

<p>Two forms are recognized by the compiler to allow this.  The less
general but Maclisp compatible one is <code>declare</code>; the completely
general one is <code>eval-when</code>.
</p>
<p>An <code>eval-when</code> form looks like
</p>
<div class="lisp">
<pre class="lisp">(eval-when <i>times-list</i>
           <i>form1</i>
           <i>form2</i>
           ...)
</pre></div>

<p>The <i>times-list</i> may contain any of the symbols <code>load</code>, <code>compile</code>,
or <code>eval</code>.
If <code>load</code> is present, the <i>form</i>s are written into the QFASL file
to be evaluated when the QFASL file is loaded (except that <code>defun</code> forms
will put the compiled definition into the QFASL file instead).
If <code>compile</code> is present, the <i>form</i>s are evaluated in the compiler.
If <code>eval</code> is present, the <i>form</i>s are evaluated when read into Lisp;
this is because <code>eval-when</code> is defined as a special form in Lisp.  (The
compiler ignores <code>eval</code> in the <i>times-list</i>.)
For example, <code>(eval-when (compile eval) (macro foo (x) (cadr x)))</code>
would define <code>foo</code> as a macro in the compiler and when the file
is read in interpreted, but not when the QFASL file is fasloaded.
</p>
<p>For the rest of this section, we will use lists such as are
given to <code>eval-when</code>, e.g. <code>(load eval)</code>, <code>(load compile)</code>, etc.
to describe when forms are evaluated.
</p>
<p>A <code>declare</code> form looks like <code>(declare <i>form1 form2</i> ...)</code>.
<code>declare</code> is defined in Lisp as a special form which does nothing;
so the forms within a <code>declare</code> are not evaluated at <code>eval</code> time.
The compiler does the following upon finding <i>form</i> within
a <code>declare</code>:  if <i>form</i> is a call to either <code>special</code>
or <code>unspecial</code>, <i>form</i> is treated as <code>(load compile)</code>;
otherwise it is treated as <code>(compile)</code>.
</p>
<p>If a form is not enclosed in an <code>eval-when</code> nor a <code>declare</code>,
then the times at which it will be evaluated depend on the form.
The following table summarizes at what times evaluation will take
place for any given form seen at top level by the compiler.
</p>
<dl compact="compact">
<dt><code>(eval-when <i>times-list</i> <i>form1</i> ...)</code></dt>
<dd><p><i>times-list</i>
</p></dd>
<dt><code>(declare (special ...)) <span class="roman">or</span> (declare (unspecial ...))</code></dt>
<dd><p><code>(load compile)</code>
</p></dd>
<dt><code>(declare <i>anything-else</i>)</code></dt>
<dd><p><code>(compile)</code>
</p></dd>
<dt><code>(special ...) <span class="roman">or</span> (unspecial ...)</code></dt>
<dd><p><code>(load compile eval)</code>
</p></dd>
<dt><code>(macro ...) <span class="roman">or</span> (defstruct ...)</code></dt>
<dd><p><code>(load compile eval)</code>
</p></dd>
<dt><code>(comment ...)</code></dt>
<dd><p>Ignored
</p></dd>
<dt><code>(begf ...) <span class="roman">or</span> (endf ...)</code></dt>
<dd><p>Ignored but may one day put something in the QFASL file.
</p></dd>
<dt><code>(compiler-let ((<i>var val</i>) ...) <i>body</i>...)</code></dt>
<dd><p>At <code>(compile eval)</code> time, processes the body with the indicated
variable bindings in effect.  Does nothing at <code>load</code> time.
</p></dd>
<dt><code>(local-declare (<i>decl decl ...</i>) <i>body</i>...)</code></dt>
<dd><p>Processes the <i>body</i> in its normal fashion, with the indicated
declarations added to the front of the list which is the value
of <code>local-declarations</code>.
</p></dd>
<dt><code><i>anything-else</i></code></dt>
<dd><p><code>(load eval)</code>
</p></dd>
</dl>

<p>Sometimes a macro wants to return more than one form
for the compiler top level to see (and to be evaluated).  The following
facility is provided for such macros.  If a form
</p>
<div class="lisp">
<pre class="lisp">(progn (quote compile) <i>form1</i> <i>form2</i> ...)
</pre></div>

<p>is seen at the compiler top level, all of the <i>form</i>s are processed as if they had been at
compiler top level.  (Of course, in the interpreter they
will all be evaluated, and the <code>(quote compile)</code> will harmlessly
evaluate to the symbol <code>compile</code> and be ignored.)
</p>
<dl>
<dt><a name="index-eval_002dwhen"></a>Special Form: <strong>eval-when</strong></dt>
<dd><p>An <code>eval-when</code> form looks like
</p>
<div class="lisp">
<pre class="lisp">(eval-when <i>times-list</i> <i>form1</i> <i>form2</i> ...)
</pre></div>

<p>If one of the element of <i>times-list</i> is the symbol <code>eval</code>, then
the <i>form</i>s are evaluated; otherwise <code>eval-when</code> does nothing.
</p>
<p>But when seen by the compiler, this special form does the special things described above.
</p></dd></dl>

<dl>
<dt><a name="index-declare"></a>Special Form: <strong>declare</strong></dt>
<dd><p><code>declare</code> does nothing, and returns the symbol <code>declare</code>.
</p>
<p>But when seen by the compiler, this special form does the special things described above.
</p></dd></dl>

<a name="Compiler-Declarations"></a>
<h3 class="section">15.4 Compiler Declarations</h3>

<p>This section describes functions meant to be called during
compilation, and variables meant to be set or bound during compilation,
by using <code>declare</code> or <code>local-declare</code>.
</p>
<dl>
<dt><a name="index-local_002ddeclare"></a>Special Form: <strong>local-declare</strong></dt>
<dd><p>A <code>local-declare</code> form looks like
</p>
<div class="lisp">
<pre class="lisp">(local-declare (<i>decl1</i> <i>decl2</i> ...)
   <i>form1</i>
   <i>form2</i>
   ...)
</pre></div>

<p>Each <i>decl</i> is consed onto the list <code>local-declarations</code> while
the <i>form</i>s are being evaluated (in the interpreter) or compiled
(in the compiler).  There are two uses for this.  First, it can be
used to pass information from outer macros to inner macros.  Secondly,
the compiler will specially interpret certain <i>decl</i>s as local
declarations, which only apply to the compilations of the <i>form</i>s.
It understands the following forms:
</p>
<dl compact="compact">
<dt><code>(special <i>var1 var2 ...</i>)</code></dt>
<dd><p>The variables <i>var1</i>, <i>var2</i>, etc. will be treated as special
variables during the compilation of the <i>form</i>s.
</p></dd>
<dt><code>(unspecial <i>var1 var2 ...</i>)</code></dt>
<dd><p>The variables <i>var1</i>, <i>var2</i>, etc. will be treated as local
variables during the compilation of the <i>form</i>s.
</p></dd>
<dt><code>(macro <i>name</i> lambda (x) <i>body</i>)</code></dt>
<dd><p><i>name</i> will be defined as a macro during the compilation
of the <i>form</i>s.  Note that the <code>cddr</code> of this item
is a function.
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-special"></a>Special Form: <strong>special</strong></dt>
<dd><p><code>(special <i>var1</i> <i>var2</i> ...)</code> causes the variables to
be declared to be &quot;special&quot; for the compiler.
</p></dd></dl>

<dl>
<dt><a name="index-unspecial"></a>Special Form: <strong>unspecial</strong></dt>
<dd><p><code>(unspecial <i>var1</i> <i>var2</i> ...)</code> removes any &quot;special&quot; declarations
of the variables for the compiler.
</p></dd></dl>

<p>The next three declarations are primarily for Maclisp compatibility.
</p>
<dl>
<dt><a name="index-_002aexpr"></a>Special Form: <strong>*expr</strong></dt>
<dd><p><code>(*expr <i>sym1</i> <i>sym2</i> ...)</code> declares <i>sym1</i>, <i>sym2</i>, etc.
to be names of functions.  In addition it prevents these functions from appearing
in the list of functions referenced but not defined printed at the end of the compilation.
</p></dd></dl>

<dl>
<dt><a name="index-_002alexpr"></a>Special Form: <strong>*lexpr</strong></dt>
<dd><p><code>(*lexpr <i>sym1</i> <i>sym2</i> ...)</code> declares <i>sym1</i>, <i>sym2</i>, etc.
to be names of functions.  In addition it prevents these functions from appearing
in the list of functions referenced but not defined printed at the end of the compilation.
</p></dd></dl>

<dl>
<dt><a name="index-_002afexpr"></a>Special Form: <strong>*fexpr</strong></dt>
<dd><p><code>(*fexpr <i>sym1</i> <i>sym2</i> ...)</code> declares <i>sym1</i>, <i>sym2</i>, etc.
to be names of special forms.  In addition it prevents these names from appearing
in the list of functions referenced but not defined printed at the end of the compilation.
</p></dd></dl>

<p>There are some advertised variables whose compile-time values affect
the operation of the compiler.  The user may set these variables by
including in his file forms such as
</p>
<div class="lisp">
<pre class="lisp">(declare (setq open-code-map-switch t))
</pre></div>

<dl>
<dt><a name="index-run_002din_002dmaclisp_002dswitch"></a>Variable: <strong>run-in-maclisp-switch</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, the compiler will try to warn the
user about any constructs which will not work in Maclisp.  By no means
will all Lisp machine system functions not built in to Maclisp be
cause for warnings;  only those which could not be written by the user
in Maclisp (for example, <code>*catch</code>, <code>make-array</code>,
<code>value-cell-location</code>, etc.).  Also, lambda-list keywords such as
<code>&amp;optional</code> and initialized <code>prog</code> variables will be
mentioned.  This switch also inhibits the warnings for obsolete Maclisp functions.
The default value of this variable is <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-obsolete_002dfunction_002dwarning_002dswitch"></a>Variable: <strong>obsolete-function-warning-switch</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, the compiler will try to warn
the user whenever an &quot;obsolete&quot; Maclisp-compatibility function such as
<code>maknam</code> or <code>samepnamep</code> is used.  The default value is <code>t</code>.
</p></dd></dl>

<dl>
<dt><a name="index-allow_002dvariables_002din_002dfunction_002dposition_002dswitch"></a>Variable: <strong>allow-variables-in-function-position-switch</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, the compiler allows the use of
the name of a variable in function position to mean that the
variable&rsquo;s value should be <code>funcall</code>&rsquo;d.  This is for compatibility
with old Maclisp programs.  The default value of this variable is
<code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-open_002dcode_002dmap_002dswitch"></a>Variable: <strong>open-code-map-switch</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, the compiler will attempt
to produce inline code for the mapping functions (<code>mapc</code>, <code>mapcar</code>, etc.,
but not <code>mapatoms</code>) if the function being mapped is an anonymous
lambda-expression.  This allows that function to reference
the local variables of the enclosing function without the need for special
declarations.
The generated code is also more efficient.  The default value is T.
</p></dd></dl>

<dl>
<dt><a name="index-all_002dspecial_002dswitch"></a>Variable: <strong>all-special-switch</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, the compiler regards all variables
as special, regardless of how they were declared.  This provides full
compatibility with the interpreter at the cost of efficiency.
The default is <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-inhibit_002dstyle_002dwarnings_002dswitch"></a>Variable: <strong>inhibit-style-warnings-switch</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, all compiler style-checking is
turned off.  Style checking is used to issue obsolete function
warnings and won&rsquo;t-run-in-Maclisp warnings, and other sorts of
warnings.  The default value is <code>nil</code>.  See also the
<code>inhibit-style-warnings</code> macro, which acts on one level only of an
expression.
</p></dd></dl>

<dl>
<dt><a name="index-retain_002dvariable_002dnames_002dswitch"></a>Variable: <strong>retain-variable-names-switch</strong></dt>
<dd><p>This controls whether the generated FEFs remember the names of the variables
in the function; such information is useful for debugging
(the <code>arglist</code> function uses it, see (arglist-fun)), but it increases
the size of the QFASL file and the FEFs created.  The variable
may be any of
</p>
<dl compact="compact">
<dt><code>nil</code></dt>
<dd><p>No names are saved.
</p></dd>
<dt><code>args</code></dt>
<dd><p>Names of arguments are saved.
</p></dd>
<dt><code>all</code></dt>
<dd><p>Names of arguments and <code>&amp;aux</code> variables are saved.
</p></dd>
</dl>

<p>The default value of this symbol is <code>args</code>, and it should usually be
left that way.
</p></dd></dl>

<dl>
<dt><a name="index-compiler_002dlet"></a>Macro: <strong>compiler-let</strong></dt>
<dd><p><code>(compiler-let ((<i>variable value</i>)...) <i>body</i>...)</code>,
syntactically identical to <code>let</code>, allows
compiler switches to be bound locally at compile time, during the
processing of the <i>body</i> forms.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(compiler-let ((open-code-map-switch nil))
          (map (function (lambda (x) ...)) foo))
</pre></div>

<p>will prevent the compiler from open-coding the <code>map</code>.
When interpreted, <code>compiler-let</code> is equivalent to <code>let</code>.  This
is so that global switches which affect the behavior of macro
expanders can be bound locally.
</p></dd></dl>

<dl>
<dt><a name="index-inhibit_002dstyle_002dwarnings"></a>Macro: <strong>inhibit-style-warnings</strong></dt>
<dd><p><code>(inhibit-style-warnings <i>form</i>)</code>
prevents the compiler from performing style-checking on the top level
of <i>form</i>.  Style-checking will still be done on the arguments of <i>form</i>.
Both obsolete function warnings and won&rsquo;t-run-in-Maclisp warnings are
done by means of the style-checking mechanism, so, for example,
</p>
<div class="lisp">
<pre class="lisp">(setq bar (inhibit-style-warnings (value-cell-location foo)))
</pre></div>

<p>will not warn that <code>value-cell-location</code> will not work in Maclisp,
but
</p>
<div class="lisp">
<pre class="lisp">(inhibit-style-warnings (setq bar (value-cell-location foo)))
</pre></div>

<p>will warn, since <code>inhibit-style-warnings</code> applies only to the top
level of the form inside it (in this case, to the <code>setq</code>).
</p></dd></dl>

<a name="Compiler-Source_002dLevel-Optimizers"></a>
<h3 class="section">15.5 Compiler Source-Level Optimizers</h3>

<p>The compiler stores optimizers for source code on property lists so as
to make it easy for the user to add them.  An optimizer can be used to
transform code into an equivalent but more efficient form (for
example, <code>(eq <i>obj</i> nil)</code> is transformed into <code>(null <i>obj</i>)</code>,
which can be compiled better).  An optimizer can also be used to
tell the compiler how to compile a special form.  For example,
in the interpreter <code>do</code> is a special form, implemented by a function
which takes quoted arguments and calls <code>eval</code>.  In the compiler,
<code>do</code> is expanded in a macro-like way by an optimizer, into
equivalent Lisp code using <code>prog</code>, <code>cond</code>, and <code>go</code>, which
the compiler understands.
</p>
<p>The compiler finds the optimizers to apply to a form by looking for
the <code>compiler:optimizers</code> property of the symbol which is the
<code>car</code> of the form.  The value of this property should be a list of
optimizers, each of which must be a function of one argument.  The
compiler tries each optimizer in turn, passing the form to be
optimized as the argument.  An optimizer which returns the original
form unchanged (and <code>eq</code> to the argument) has &quot;done nothing&quot;, and
the next optimizer is tried.  If the optimizer returns anything else,
it has &quot;done something&quot;, and the whole process starts over again.
This is somewhat like a Markov algorithm.  Only after all the optimizers
have been tried and have done nothing is an ordinary macro definition
processed.  This is so that the macro definitions, which will be seen
by the interpreter, can be overridden for the compiler by an optimizer.
</p>
<a name="Files-that-Maclisp-Must-Compile"></a>
<h3 class="section">15.6 Files that Maclisp Must Compile</h3>

<p>Certain programs are intended to be run both in Maclisp and in Lisp
Machine Lisp.  These files need some special conventions.  For example,
such Lisp Machine constructs as <code>&amp;aux</code> and <code>&amp;optional</code> must not be
used.  In addition, <code>eval-when</code> must not be used, since only the Lisp
Machine compiler knows about it.  All <code>special</code> declarations must be
enclosed in <code>declare</code>s, so that the Maclisp compiler will see them.
It is suggested that you turn on <code>run-in-maclisp-switch</code>
in such files, which will warn you about a lot of bugs.
</p>
<p>The macro-character combination &quot;#Q&quot; causes the object that
follows it to be visible only when compiling for the Lisp Machine.
The combination &quot;#M&quot; causes the  following object to be visible
only when compiling for Maclisp.  These work only on subexpressions
of the objects in the file, however.  To conditionalize top-level objects,
put the macros <code>if-for-lispm</code> and
<code>if-for-maclisp</code> around them.  (You can only put these around
a single object.)  The <code>if-for-lispm</code> macro turns off <code>run-in-maclisp-switch</code>
within its object, preventing spurious warnings from the compiler.
The <code>#Q</code> macro-character does not do this, since it can be used
to conditionalize any S-expression, not just a top-level form.
</p>
<p>There are actually three possible cases of compiling: you may
be compiling on the Lisp Machine for the Lisp Machine; you may
be compiling in Maclisp for the Lisp Machine (with :LISPM1;QCMP);
or you may be compiling in Maclisp for Maclisp (with COMPLR).
(You can&rsquo;t compile for Maclisp on the Lisp Machine because there isn&rsquo;t a Lisp
Machine Lisp version of COMPLR.)  To allow a file to detect any
of these conditions it needs to, the following macros are provided:
</p>
<dl>
<dt><a name="index-if_002dfor_002dlispm"></a>Macro: <strong>if-for-lispm</strong></dt>
<dd><p>If <code>(if-for-lispm <i>form</i>)</code> is seen at the top level of
the compiler, <i>form</i> is passed to the compiler top level if
the output of the compiler is a QFASL file intended for the Lisp Machine.
If the Lisp Machine interpreter sees this it will evaluate <i>form</i>
(the macro expands into <i>form</i>).
</p></dd></dl>

<dl>
<dt><a name="index-if_002dfor_002dmaclisp"></a>Macro: <strong>if-for-maclisp</strong></dt>
<dd><p>If <code>(if-for-maclisp <i>form</i>)</code> is seen at the top level of
the compiler, <i>form</i> is passed to the compiler top level if
the output of the compiler is a FASL file intended for Maclisp
(e.g. if the compiler is COMPLR).
If the Lisp Machine interpreter sees this it will ignore it
(the macro expands into <code>nil</code>).
</p></dd></dl>

<dl>
<dt><a name="index-if_002dfor_002dmaclisp_002delse_002dlispm"></a>Macro: <strong>if-for-maclisp-else-lispm</strong></dt>
<dd><p>If <code>(if-for-maclisp-else-lispm <i>form1</i> <i>form2</i>)</code> is seen at the top level of
the compiler, <i>form1</i> is passed to the compiler top level if
the output of the compiler is a FASL file intended for Maclisp;
otherwise <i>form2</i> is passed to the compiler top level.
</p></dd></dl>

<dl>
<dt><a name="index-if_002din_002dlispm"></a>Macro: <strong>if-in-lispm</strong></dt>
<dd><p>On the Lisp Machine, <code>(if-in-lispm <i>form</i>)</code> causes <i>form</i>
to be evaluated; in Maclisp, <i>form</i> is ignored.
</p></dd></dl>

<dl>
<dt><a name="index-if_002din_002dmaclisp"></a>Macro: <strong>if-in-maclisp</strong></dt>
<dd><p>In Maclisp, <code>(if-in-maclisp <i>form</i>)</code> causes <i>form</i>
to be evaluated; on the Lisp Machine, <i>form</i> is ignored.
</p></dd></dl>

<p>When you have two definitions of one function, one conditionalized
for one machine and one for the other, indent the first &quot;<code>(defun</code>&quot;
by one space, and the editor will put both function definitions together
in the same file-section.
</p>
<p>In order to make sure that those macros and macro-characters are
defined when reading the file into the Maclisp compiler, you must
make the file start with a prelude, which will have no effect
when you compile on the real machine.  The prelude can
be found in &quot;AI: LMDOC; .COMPL PRELUD&quot;; this will also define
most of the standard Lisp Machine macros and reader macros in Maclisp, including
<code>defmacro</code> and the backquote facility.
</p>
<p>Another useful facility is the form <code>(status feature lispm)</code>,
which evaluates to <code>t</code> when evaluated on the Lisp machine and to <code>nil</code>
when evaluated in Maclisp.
</p>

<a name="Macros"></a>
<h2 class="chapter">16 Macros</h2>
<a name="index-macros"></a>

<a name="Introduction-to-Macros"></a>
<h3 class="section">16.1 Introduction to Macros</h3>

<p>If <code>eval</code> is handed a list whose <i>car</i> is a symbol, then <code>eval</code>
inspects the definition of the symbol to find out what to do.  If the
definition is a <i>cons</i>, and the <i>car</i> of the <i>cons</i> is the symbol
<code>macro</code>, then the definition (i.e. that cons) is called a <i>macro</i>.
The <i>cdr</i> of the <i>cons</i> should be a function of one argument.
<code>eval</code> applies the function to the form it was originally given.
Then it takes whatever is returned, and evaluates that in lieu of the
original form.
</p>
<p>Here is a simple example.  Suppose the definition of the symbol <code>first</code> is
</p>
<div class="lisp">
<pre class="lisp">(macro lambda (x)
         (list 'car (cadr x)))
</pre></div>

<p>This thing is a macro: it is a <i>cons</i> whose <i>car</i> is the symbol <code>macro</code>.
What happens if we try to evaluate a form <code>(first '(a b c))</code>?  Well,
<code>eval</code> sees that it has a list whose <i>car</i> is a symbol (namely,
<code>first</code>), so it looks at the definition of the symbol and sees that
it is a <i>cons</i> whose <i>car</i> is <code>macro</code>; the definition is a macro.
<code>eval</code> takes the <i>cdr</i> of the cons,
which is a lambda expression, and <i>applies</i> it to the
original form that <code>eval</code> was handed.
So it applies <code>(lambda (x) (list 'car (cadr x)))</code>
to <code>(first '(a b c))</code>.  <code>x</code> is bound to <code>(first '(a b c))</code>,
<code>(cadr x)</code> evaluates to <code>'(a b c)</code>, and <code>(list 'car (cadr x))</code>
evaluates to <code>(car '(a b c))</code>, which is what the function returns.
<code>eval</code> now evaluates this new form in place of the original form.
<code>(car '(a b c))</code> returns <code>a</code>, and so the result is that
<code>(first '(a b c))</code> returns <code>a</code>.
</p>
<p>What have we done?  We have defined a macro called <code>first</code>.  What
the macro does is to <i>translate</i> the form to some other form.  Our
translation is very simple&ndash;it just translates forms that look like
<code>(first <i>x</i>)</code> into <code>(car <i>x</i>)</code>, for any form <i>x</i>.
We can do much more
interesting things with macros, but first we will show how
to define a macro.
</p>
<p>Macros are normally defined using the <code>macro</code> special form.
A macro definition looks like this:
</p>
<div class="lisp">
<pre class="lisp">(macro <i>name</i> (<i>arg</i>)
    <i>body</i>)
</pre></div>

<p>To define our <code>first</code> macro, we would say
</p>
<div class="lisp">
<pre class="lisp">(macro first (x)
    (list 'car (cadr x)))
</pre></div>

<p>Here are some more simple examples of macros.  Suppose we want
any form that looks like <code>(addone <i>x</i>)</code> to be translated into
<code>(plus 1 <i>x</i>)</code>.  To define a macro to do this we would say
</p>
<div class="lisp">
<pre class="lisp">(macro addone (x)
   (list 'plus '1 (cadr x)))
</pre></div>

<p>Now say we wanted a macro which would translate <code>(increment <i>x</i>)</code>
into <code>(setq <i>x</i> (1+ <i>x</i>)</code>.  This would be:
</p>
<div class="lisp">
<pre class="lisp">(macro increment (x)
    (list 'setq (cadr x) (list '1+ (cadr x))))
</pre></div>

<p>Of course, this macro is of limited usefulness.  The reason is that the
form in the <i>cadr</i> of the <code>increment</code> form had better be a symbol.
If you tried <code>(increment (car x))</code>, it would be translated into
<code>(setq (car x) (1+ (car x)))</code>, and <code>setq</code> would complain.
</p>
<p>You can see from this discussion that macros are very different
from functions.  A function would not be able to tell what kind of subforms
are around in a call to itself; they get evaluated before the functions
ever sees them.  However, a macro gets to look at the whole form and see
just what is going on there.  Macros are <i>not</i> functions; if <code>first</code>
is defined as a macro, it is not meaningful to apply <code>first</code> to arguments.
A macro does not take arguments at all; it takes a <i>Lisp form</i> and turns
it into another <i>Lisp form</i>.
</p>
<p>The purpose of functions is to <i>compute</i>; the purpose of
macros is to <i>translate</i>.  Macros are used for a variety of purposes, the
most common being extensions to the Lisp language.  For example, Lisp
is powerful enough to express many different control structures, but it
does not provide every control structure anyone might ever possibly
want.  Instead, if a user wants some kind of control structure with a
syntax that is not provided, he can  translate it into some form that
Lisp <i>does</i> know about.
</p>
<p>For example, someone might want a limited iteration construct
which increments a symbol by one until it exceeds a limit (like the
FOR statement of the BASIC language).  He might want it to look like
</p>
<div class="lisp">
<pre class="lisp">(for a 1 100 (print a) (print (* a a)))
</pre></div>

<p>To get this, he could write a macro to translate it into
</p>
<div class="lisp">
<pre class="lisp">(do a 1 (1+ a) (&gt; a 100) (print a) (print (* a a)))
</pre></div>

<p>A macro to do this could be defined with
</p>
<div class="lisp">
<pre class="lisp">(macro for (x)
  (cons 'do
        (cons (cadr x)
              (cons (caddr x)
                    (cons (list '1+ (cadr x))
                          (cons (list '&gt; (cadr x) (cadddr x))
                                (cddddr x)))))))
</pre></div>

<p>Now he has defined his own new control structure primitive, and it
will act just as if it were a special form provided by Lisp itself.
</p>
<a name="Aids-for-Defining-Macros"></a>
<h3 class="section">16.2 Aids for Defining Macros</h3>

<p>The main problem with the definition for the <code>for</code> macro is
that it is verbose and clumsy.  If it is that hard to write a macro
to do a simple specialized iteration construct, one would wonder how
anyone would write macros of any real sophistication.
</p>
<p>There are two things that make the definition so inelegant.
One is that the programmer must write things like &quot;<code>(cadr x)</code>&quot;
and &quot;<code>(cddddr x)</code>&quot; to refer to the parts of the form he wants
to do things with.  The other problem is that the long chains of calls
to the <code>list</code> and <code>cons</code> functions are very hard to read.
</p>
<p>Two features are provided to solve these two problems.
The <code>defmacro</code> macro solves the former, and the &quot;backquote&quot; (&quot;<code>`</code>&quot;)
reader macro solves the latter.
</p>
<a name="Defmacro"></a>
<h4 class="subsection">16.2.1 Defmacro</h4>
<a name="index-macro_002ddefining-macros"></a>

<p>Instead of referring to the parts of our form by &quot;<code>(cadr x)</code>&quot;
and such, we would like to give names to the various pieces of the form,
and somehow have the <code>(cadr x)</code> automatically generated.  This is done
by a macro called <code>defmacro</code>.  It is easiest to explain what <code>defmacro</code> does
by showing an example. Here is how you would write the <code>for</code> macro
using <code>defmacro</code>:
</p>
<div class="lisp">
<pre class="lisp">(defmacro for (var lower upper . body)
  (cons 'do
        (cons var
              (cons lower
                    (cons (list '1+ var)
                          (cons (list '&gt; var upper)
                                body))))))
</pre></div>

<p>The <code>(var lower upper . body)</code> is a <i>pattern</i> to match against
the body of the macro (to be more precise, to match against the <i>cdr</i>
of the argument to the macro).  <code>defmacro</code> tries to match the two
lists
</p>
<div class="lisp">
<pre class="lisp">(var lower upper . body)
<span class="roman">and</span>
(a 1 100 (print a) (print (* a a)))
</pre></div>

<p><code>var</code> will get bound to the symbol <code>a</code>, <code>lower</code> to the fixnum <code>1</code>,
<code>upper</code> to the fixnum <code>100</code>, and <code>body</code> to the list
<code>((print a) (print (* a a)))</code>.  Then inside the body of the <code>defmacro</code>,
<code>var, lower, upper,</code> and <code>body</code> are variables, bound to the matching
parts of the macro form.
</p>
<dl>
<dt><a name="index-defmacro"></a>Macro: <strong>defmacro</strong></dt>
<dd><p><code>defmacro</code> is a general purpose macro-defining macro.  A <code>defmacro</code>
form looks like
</p>
<div class="lisp">
<pre class="lisp">(defmacro <i>name</i> <i>pattern</i> . <i>body</i>)
</pre></div>

<p>The <i>pattern</i> may be anything made up out of symbols and conses.
It is matched against the body of the macro form; both <i>pattern</i>
and the form are <i>car</i>&rsquo;ed and <i>cdr</i>&rsquo;ed identically, and whenever
a symbol is hit in <i>pattern</i>, the symbol is bound to the corresponding
part of the form.  All of the symbols in <i>pattern</i> can be used
as variables within <i>body</i>.  <i>name</i> is the name of the macro
to be defined.  <i>body</i> is evaluated with these bindings in effect,
and is returned to the evaluator.
</p></dd></dl>

<p>Note that the pattern need not be a list the way a lambda-list must.
In the above example, the pattern was a &quot;dotted list&quot;, since the symbol
<code>body</code> was supposed to match the <i>cddddr</i> of the macro form.
If we wanted a new iteration form, like <code>for</code> except that it
our example would look like
</p>
<div class="lisp">
<pre class="lisp">(for a (1 100) (print a) (print (* a a)))
</pre></div>

<p>(just because we thought that was a nicer syntax), then we could
do it merely by modifying the pattern of the <code>defmacro</code> above;
the new pattern would be <code>(var (lower upper) . body)</code>.
</p>
<p>Here is how we would write our other examples using <code>defmacro</code>:
</p>
<div class="lisp">
<pre class="lisp">(defmacro first (the-list)
    (list 'car the-list))

(defmacro addone (form)
   (list 'plus '1 form))

(defmacro increment (symbol)
   (list 'setq symbol (list '1+ symbol)))
</pre></div>

<p>All of these were very simple macros and have very simple patterns,
but these examples show that we can replace the <code>(cadr x)</code> with a
readable mnemonic name such as <code>the-list</code> or <code>symbol</code>, which
makes the program clearer.
</p>
<p>There is another version of <code>defmacro</code> which defines
displacing macros (see (displacing-macro)).
<code>defmacro</code> has other, more complex features; see (defmacro-hair).
</p>
<a name="Backquote"></a>
<h4 class="subsection">16.2.2 Backquote</h4>

<p>Now we deal with the other problem: the long strings of calls
to <code>cons</code> and <code>list</code>.  For this we must introduce some <i>reader
macros</i>.  Reader macros are not the same as normal macros, and they
are not described in this chapter; see (reader).
</p>
<p>The backquote facility is used by giving a backquote character (&quot;<code>`</code>&quot;,
ASCII code 140 octal), followed by a form.  If the form does not contain
any use of the comma macro-character, the form will simply be quoted.  For example,
</p>
<div class="lisp">
<pre class="lisp"> '(a b c) ==&gt; (a b c)
 `(a b c) ==&gt; (a b c)
</pre></div>

<p>So in the simple cases, backquote is just like the regular single-quote
macro.  The way to get it to do interesting things is to include a use
of the comma somewhere inside of the form following the backquote.
The comma is followed by a form, and that form gets evaluated even
though it is inside the backquote.  For example,
</p>
<div class="lisp">
<pre class="lisp">(setq b 1)
`(a b c)  ==&gt; (a b c)
`(a ,b c) ==&gt; (a 1 c)
</pre></div>

<p>In other words, backquote quotes everything <i>except</i> things preceeded by
a comma; those things get evaluated.
</p>
<p>When the reader sees the <code>`(a ,b c)</code> it is actually generating
a form such as <code>(list 'a b 'c)</code>.  The actual form generated may use <code>list</code>,
<code>cons</code>, <code>append</code>, or whatever might be a good idea; you should
never have to concern yourself with what it actually turns into.  All you
need to care about is what it evaluates to.
</p>
<p>This is generally found to be pretty confusing by most people; the best way
to explain further seems to be with examples.  Here is how we would write our
three simple macros using both the <code>defmacro</code> and backquote facilities.
</p>
<div class="lisp">
<pre class="lisp">(defmacro first (the-list)
    `(car ,the-list))

(defmacro addone (form)
   `(plus 1 ,form))

(defmacro increment (symbol)
   `(setq ,symbol (1+ ,symbol)))
</pre></div>

<p>To finally demonstrate how easy it is to define macros with these two facilities,
here is the final form of the <code>for</code> macro.
</p>
<div class="lisp">
<pre class="lisp">(defmacro for (var lower upper . body)
  `(do ,var ,lower (1+ ,var) (&gt; ,var ,upper) . ,body))
</pre></div>

<p>Look at how much simpler that is than the original definition.  Also,
look how closely it resembles the code it is producing.  The functionality
of the <code>for</code> really stands right out when written this way.
</p>

<p>If a comma inside a backquote form is followed by an &quot;atsign&quot;
character (&quot;<code>@</code>&quot;), it has a special meaning.  The &quot;<code>,@</code>&quot; should
be followed by a form whose value is a <i>list</i>; then each of the elements
of the list are put into the list being created by the backquote.  In other
words, instead of generating a call to the <code>cons</code> function, backquote
generates a call to <code>append</code>.  For example, if <code>a</code> is bound to
<code>(x y z)</code>, then <code>`(1 ,a 2)</code> would evaluate to <code>(1 (x y z) 2)</code>,
but <code>`(1 ,@a 2)</code> would evaluate to <code>`(1 x y z 2)</code>.
</p>
<p>Here is an example of a macro definition that uses the &quot;<code>,@</code>&quot;
construction.  Suppose you wanted to extend Lisp by adding a kind of
special form called <code>repeat-forever</code>, which evaluates all of its
subforms repeatedly.  One way to implement this would be to expand
</p>
<div class="lisp">
<pre class="lisp">(repeat-forever <i>form1</i> <i>form2</i> <i>form3</i>)
</pre></div>

<p>into
</p>
<div class="lisp">
<pre class="lisp">(prog ()
    a <i>form1</i>
      <i>form2</i>
      <i>form3</i>
      (go a))
</pre></div>

<p>You could define the macro by
</p>
<div class="lisp">
<pre class="lisp">(macro repeat-forever body
       `(prog ()
            a ,@body
              (go a)))
</pre></div>

<p>Advanced macro writers sometimes write &quot;macro-defining macros&quot;:
forms which expand into forms which, when evaluated, define macros.  In
such macros it is often useful to use nested backquote constructs.  The
following example illustrates the use of nested backquotes in the
writing of macro-defining macros.
</p>
<p>This example is a very simple version of <code>defstruct</code> (see (defstruct-fun)).
You should first understand the basic description of <code>defstruct</code> before
proceeding with this example.  The <code>defstruct</code> below does not accept
any options, and only allows the simplest kind of items; that is, it only
allows forms like
</p>
<div class="lisp">
<pre class="lisp">(defstruct (<i>name</i>)
     <i>item1</i>
     <i>item2</i>
     <i>item3</i>
     <i>item4</i>
     ...)
</pre></div>

<p>We would like this form to expand into
</p>
<div class="lisp">
<pre class="lisp">(progn
 (defmacro <i>item1</i> (x)
      `(aref ,x 1))
 (defmacro <i>item2</i> (x)
      `(aref ,x 2))
 (defmacro <i>item3</i> (x)
      `(aref ,x 3))
 (defmacro <i>item4</i> (x)
      `(aref ,x 4))
 ...)
</pre></div>

<p>Here is the macro to perform the expansion:
</p>
<div class="lisp">
<pre class="lisp">(defmacro defstruct ((name) . items)
     (do ((item-list items (cdr item-list))
          (ans nil)
          (i 0 (1+ i)))
         ((null item-list)
          (cons 'progn (nreverse ans)))
       (setq ans
             (cons `(defmacro ,(car item-list) (x)
                           `(aref ,x ,',i))
                   ans))))
</pre></div>

<p>The interesting part of this definition is the body of
the (inner) <code>defmacro</code> form: <code>`(aref ,x ,',i)</code>.
Instead of using this backquote construction, we could have
written <code>(list 'aref x ,i)</code>; that is, the &quot;<code>,',</code>&quot;
acts like a comma which matches the outer backquote, while
the &quot;<code>,</code>&quot; preceeding the &quot;<code>x</code>&quot; matches with the inner
backquote.  Thus, the symbol <code>i</code> is evaluated when the
<code>defstruct</code> form is expanded, whereas the symbol <code>x</code> is
evaluated when the accessor macros are expanded.
</p>
<p>Backquote can be useful in situations other than the writing
of macros.  Whenever there is a piece of list structure to be consed
up, most of which is constant, the use of backquote can make the
program considerably clearer.
</p>
<a name="Aids-for-Debugging-Macros"></a>
<h3 class="section">16.3 Aids for Debugging Macros</h3>

<dl>
<dt><a name="index-mexp"></a>Function: <strong>mexp</strong></dt>
<dd><p><code>mexp</code> goes into a loop in which it reads forms and sequentially
expands them, printing out the result of each expansion.  It terminates
when it reads an atom (anything that is not a cons).  If you type
in a form which is not a macro form, there will be no expansions
and so it will not type anything out, but just prompt you for
another form.  This allows you to see what your macros are
expanding into, without actually evaluating the result of the expansion.
</p></dd></dl>

<a name="Displacing-Macros"></a>
<h3 class="section">16.4 Displacing Macros</h3>
<a name="index-displacing-macros"></a>

<p>Every time the the evaluator sees a macro form, it must
call the macro to expand the form.  If this expansion always
happens the same way, then it is wasteful to expand the whole
form every time it is reached; why not just expand it once?
A macro is passed the macro form itself, and so it can change
the car and cdr of the form to something else by using <code>rplaca</code>
and <code>rplacd</code>!  This way the first time the macro is expanded,
the expansion will be put where the macro form used to be, and the
next time that form is seen, it will already be expanded.  A macro that
does this is called a <i>displacing macro</i>, since it displaces
the macro form with its expansion.
</p>
<p>The major problem with this is that the Lisp form
gets changed by its evaluation.  If you were to write a program
which used such a macro, call <code>grindef</code> to look at it,
then run the program and call <code>grindef</code> again, you would
see the expanded macro the second time.  Presumably the reason
the macro is there at all is that it makes the program look nicer;
we would like to prevent the unnecessary expansions, but still let
<code>grindef</code> display the program in its more attractive form.
This is done with the function <code>displace</code>.
</p>
<dl>
<dt><a name="index-displace"></a>Function: <strong>displace</strong> <em>form expansion</em></dt>
<dd><p><i>form</i> must be a list.
<code>displace</code> replaces the car and cdr of <i>form</i> so
that it looks like:
</p>
<div class="lisp">
<pre class="lisp">(si:displaced <i>original-form</i> <i>expansion</i>)
</pre></div>

<p><i>original-form</i> is equal to <i>form</i> but has a different
top-level cons so that the replacing mentioned above doesn&rsquo;t
affect it.  <code>si:displaced</code> is a macro, which returns
the caddr of its own macro form.  So when the <code>si:displaced</code>
form is given to the evaluator, it &quot;expands&quot; to <i>expansion</i>.
<code>displace</code> returns <i>expansion</i>.
</p></dd></dl>

<p>The grinder knows specially about <code>si:displaced</code> forms,
and will grind such a form as if it had seen the original-form
instead of the <code>si:displaced</code> form.
</p>
<p>So if we wanted to rewrite our <code>addone</code> macro as a displacing
macro, instead of writing
</p>
<div class="lisp">
<pre class="lisp">(macro addone (x)
   (list 'plus '1 (cadr x)))
</pre></div>

<p>we would write
</p>
<div class="lisp">
<pre class="lisp">(macro addone (x)
   (displace x (list 'plus '1 (cadr x))))
</pre></div>

<p>Of course, we really want to use <code>defmacro</code> to define
most macros.  Since there is no way to get at the original macro form itself
from inside the body of a <code>defmacro</code>, another version of it is
provided:
</p>
<dl>
<dt><a name="index-defmacro_002ddisplace"></a>Macro: <strong>defmacro-displace</strong></dt>
<dd><p><code>defmacro-displace</code> is just like <code>defmacro</code> except that
it defines a displacing macro, using the <code>displace</code> function.
</p></dd></dl>

<p>Now we can write the displacing version of <code>addone</code> as
</p>
<div class="lisp">
<pre class="lisp">(defmacro-displace addone (form)
   (list 'plus '1 form))
</pre></div>

<p>All we have changed in this example is the <code>defmacro</code> into
<code>defmacro-displace</code>.  <code>addone</code> is now a displacing macro.
</p>
<a name="Advanced-Features-of-Defmacro"></a>
<h3 class="section">16.5 Advanced Features of Defmacro</h3>

<p>(To be supplied.)
</p>
<p>(The basic matter is that you can use <code>&amp;optional</code> and <code>&amp;rest</code>
with <code>defmacro</code>.  The interactions between <code>&amp;optional</code>&rsquo;s initialization,
and the fact that the &quot;lambda-list&quot; in <code>defmacro</code> can be arbitrary
list structure are not clear.  If you need to use this feature, try it out.)
</p>
<a name="Functions-to-Expand-Macros"></a>
<h3 class="section">16.6 Functions to Expand Macros</h3>

<p>The following two functions are provided to allow
the user to control expansion of macros; they are often
useful for the writer of advanced macro systems.
</p>
<dl>
<dt><a name="index-macroexpand_002d1"></a>Function: <strong>macroexpand-1</strong> <em>form &amp;optional compilerp</em></dt>
<dd><p>If <i>form</i> is a macro form, this expands it (once)
and returns the expanded form.  Otherwise it just
returns <i>form</i>.  If <code>compilerp</code> is <code>t</code>, <code>macroexpand-1</code>
will search the compiler&rsquo;s list of intenally defined macros
(<code>sys:macrolist</code>) for a definition, as well as the function cell
of the <i>car</i> of <i>form</i>.  <i>compilerp</i> defaults to <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-macroexpand"></a>Function: <strong>macroexpand</strong> <em>form &amp;optional compilerp</em></dt>
<dd><p>If <i>form</i> is a macro form, this expands it repeatedly
until it is not a macro form, and returns the final expansion.
Otherwise, it just returns <i>form</i>.  <i>compilerp</i> has the
same meaning as in <code>macroexpand-1</code>.
</p></dd></dl>


<a name="Defstruct"></a>
<h2 class="chapter">17 Defstruct</h2>
<a name="index-structures"></a>
<a name="index-defstruct"></a>
<a name="index-macro-defining-macros"></a>

<a name="Introduction-to-Structure-Macros"></a>
<h3 class="section">17.1 Introduction to Structure Macros</h3>

<p><code>defstruct</code> provides a facility in Lisp for creating and
using aggregate datatypes with named elements.  These are like
&quot;structures&quot; in PL/I, or &quot;records&quot; in PASCAL.  In the last chapter we
saw how to use macros to extend the control structures of Lisp; here we
see how they can be used to extend Lisp&rsquo;s data structures as well.
</p>
<p>To explain the basic idea, assume you were writing a Lisp
program that dealt with space ships.  In your program, you want to
represent a space ship by a Lisp object of some kind.  The interesting
things about a space ship, as far as your program is concerned, are
its position (X and Y), velocity (X and Y), and mass.  How do you
represent a space ship?
</p>
<p>Well, the representation could be a 5-list of the x-position,
y-position, and so on.  Equally well it could be an array of five
elements, the zeroth being the x-position, the first being the
y-position, and so on.  The  problem with both of these representations
is that the &quot;elements&quot; (such as x-position) occupy places in the object
which are quite arbitrary, and hard to remember (Hmm, was the mass the
third or the fourth element of the array?).  This would make programs
harder to write and read.  What we would like to see are names, easy to
remember and to understand.  If the symbol <code>foo</code> were bound to a
representation of a space ship, then
</p>
<div class="lisp">
<pre class="lisp">(ship-x-position foo)
</pre></div>

<p>could return its x-position, and
</p>
<div class="lisp">
<pre class="lisp">(ship-y-position foo)
</pre></div>

<p>its y-position, and so forth.  <code>defstruct</code> does just this.
</p>
<p><code>defstruct</code> itself is a macro which defines a structure.  For the
space ship example above, we might define the structure by saying:
</p>
<div class="lisp">
<pre class="lisp">(defstruct (ship)
     ship-x-position
     ship-y-position
     ship-x-velocity
     ship-y-velocity
     ship-mass)
</pre></div>

<p>(This is a very simple case of <code>defstruct</code>; we will see the general form
later.)  The evaluation of this form does several things.  First, it
defines <code>ship-x-position</code> to be a macro which expands into an <code>aref</code>
form; that is, <code>(ship-x-position foo)</code> would turn into <code>(aref foo 0)</code>.  All of
the &quot;elements&quot; are defined to refer to sequentially increasing
elements of the array, e.g., <code>(ship-mass foo)</code> would turn into <code>(aref foo
4)</code>.  So a ship is really implemented as an array, although that fact
is kept hidden.  These macros are called the <i>accessor macros</i>, as they
are used to access elements of the structure.
</p>
<p><code>defstruct</code> will also define <code>make-ship</code> to be a macro which
expands into a call to <code>make-array</code> which will create an array of the
right size (namely, 5 elements).  So <code>(setq x (make-ship))</code> will make a
new ship, and <span class="roman">x</span> will be bound to it.  This macro is called the
<i>constructor macro</i>, because it constructs a new structure.
</p>
<p>We also want to be able to change the contents of a structure.
To do this, we use the <code>setf</code> macro
(see (setf-fun)), as follows (for example):
</p>
<div class="lisp">
<pre class="lisp">(setf (ship-x-position x) 100)
</pre></div>

<p>Here <span class="roman">x</span> is bound to a ship, and after the evaluation of the <code>setf</code>
form, the <code>ship-x-position</code> of that ship will be 100.  The way this
works is that the <code>setf</code> form expands into <code>(aset 100 x 0)</code>; again, this
is invisible to the programmer.
</p>
<p>By itself, this simple example provides a powerful structure
definition tool.  But, in fact, <code>defstruct</code> has many other features.  First
of all, we might want to specify what kind of Lisp object to use for the
&quot;implementation&quot; of the structure.  The example above implemented a &quot;ship&quot;
as an array, but <code>defstruct</code> can also implement structures as array-leaders
and as lists.  (For array-leaders, the accessor macros expand into calls
to <code>array-leader</code>, and for lists, to <code>car, cadr, caddr,</code> and so on.)
</p>
<p>Most structures are implemented as arrays.  Lists take slightly less
storage, but elements near the end of a long list are slower to access.
Array leaders allow you to have a homogeneous aggregate (the array)
and a heterogeneous aggregate with named elements (the leader) tied
together into one object.
</p>
<p><code>defstruct</code> allows you to specify to the constructor
macro what the various elements of the structure should be initialized
to.  It also lets you give, in the <code>defstruct</code> form, default values
for the initialization of each element.
</p>
<a name="Setf-and-Locf"></a>
<h3 class="section">17.2 Setf and Locf</h3>

<p>In Lisp, for each function to <i>access</i> (read) any piece of
information, there is almost always a corresponding function to
<i>update</i> (write) it as well.  For example, <code>symeval</code> accesses a
symbol&rsquo;s value cell, and <code>set</code> updates it.  <code>array-leader</code> accesses
the contents of an array leader element, and <code>store-array-leader</code>
updates it.  The knowledge of how these functions correspond is accessible through
a macro called <code>setf</code>.
</p>
<p><code>setf</code> is particularly useful in combination with structure-accessing
macros, such as those created with <code>defstruct</code>, because the knowledge of the
representation of the structure is embedded inside the macro, and the programmer
shouldn&rsquo;t have to know what it is in order to alter an element of the structure.
</p>
<dl>
<dt><a name="index-setf"></a>Macro: <strong>setf</strong></dt>
<dd><p><code>setf</code> takes a form which <i>accesses</i> something, and &quot;inverts&quot;
it to produce a corresponding form to <i>update</i> the thing.  The
form for <code>setf</code> is
</p>
<div class="lisp">
<pre class="lisp">(setf <i>access-form</i> <i>value</i>)
</pre></div>

<p>It expands into an update form, which stores the result of evaluating
the form <i>value</i> into the place referenced by the <i>access-form</i>.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(setf (array-leader foo 3) 'bar)
                ===&gt; (store-array-leader 'bar foo 3)
(setf a 3) ===&gt; (setq a 3)
(setf (plist 'a) '(foo bar)) ===&gt; (setplist 'a '(foo bar))
(setf (aref q 2) 56) ===&gt; (aset 56 q 2)
(setf (cadr w) x) ===&gt; (rplaca (cdr w) x)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-locf"></a>Macro: <strong>locf</strong></dt>
<dd><p><code>locf</code> takes a form which <i>accesses</i> some cell, and produces
a corresponding form to create a locative pointer to that cell.
The form for <code>locf</code> is
</p>
<div class="lisp">
<pre class="lisp">(locf <i>access-form</i>)
</pre></div>

<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(locf (array-leader foo 3)) ===&gt; (ap-leader foo 3)
(locf a) ===&gt; (value-cell-location 'a)
(locf (plist 'a)) ===&gt; (property-cell-location 'a)
(locf (aref q 2)) ===&gt; (aloc q 2)
</pre></div>
</dd></dl>

<p>Both <code>setf</code> and <code>locf</code> work by means of property lists.
When the form <code>(setf (aref q 2) 56)</code> is expanded, <code>setf</code> looks
for the <code>setf</code> property of the symbol <code>aref</code>.  The value of the
<code>setf</code> property of a symbol should be a <i>cons</i> whose <i>car</i>
is a pattern to be matched with the <i>access-form</i>, and whose <code>cdr</code>
is the corresponding <i>update-form</i>, with the symbol <code>si:val</code> in
the place of the value to be stored.  The <code>setf</code> property of <code>aref</code>
is a <i>cons</i> whose <i>car</i> is <code>(aref array . subscripts)</code> and whose
<i>cdr</i> is <code>(aset si:val array . subscripts)</code>.  If the transformation which
<code>setf</code> is to do cannot be expressed as a simple pattern, an arbitrary
function may be used.  When the form <code>(setf (foo bar) baz)</code>
is being expanded, if the <code>setf</code> property of <code>foo</code> is a symbol,
the function definition of that symbol will be applied to two arguments,
<code>(foo bar)</code> and <code>baz</code>, and the result will be taken to be the
expansion of the <code>setf</code>.
</p>
<p>Similarly, the <code>locf</code> function
uses the <code>locf</code> property, whose value is analogous.  For example, the <code>locf</code> property
of <code>aref</code> is a <i>cons</i> whose <i>car</i> is <code>(aref array . subscripts)</code>
and whose <i>cdr</i> is <code>(aloc array . subscripts)</code>.  There is no <code>si:val</code>
in the case of <code>locf</code>.
</p>
<p>As a special case, <code>setf</code> and <code>locf</code> allow a variable as the reference.
In this case they turn into <code>setq</code> and <code>value-cell-location</code>, respectively.
</p>
<p>For the sake of efficiency, the code produced by <code>setf</code> and <code>locf</code>
does not preserve order of evaluation of the argument forms.  This is only a problem
is the argument forms have interacting side-effects.  In addition, the value produced
by <code>setf</code> is dependant on the structure type and is not guaranteed; <code>setf</code>
should be used for side effect only.
</p>
<a name="How-to-Use-Defstruct"></a>
<h3 class="section">17.3 How to Use Defstruct</h3>

<dl>
<dt><a name="index-defstruct-1"></a>Macro: <strong>defstruct</strong></dt>
<dd><p>A call to <code>defstruct</code> looks like:
</p>
<div class="lisp">
<pre class="lisp">(defstruct (<i>name</i> <i>option-1</i> <i>option-2</i> ...)
           <i>item-1</i>
           <i>item-2</i>
           ...)
</pre></div>

<p><i>name</i> must be a symbol; it is the name of the structure.
It is used for many different things, explained below.
</p>
<p><i>option-n</i> may be either a symbol (which should be one of the recognized
option names, listed below) or a list (whose <i>car</i> should be one of the
option names and the rest of which should be &quot;arguments&quot; to the option).
</p>
<p><i>item-n</i> may be in any of three forms:
</p>
<div class="lisp">
<pre class="lisp"><span class="roman">(1)</span> <i>item-name</i>
<span class="roman">(2)</span> <code>(<i>item-name</i> <i>default-init</i>)</code>
<span class="roman">(3)</span> ((<i>item-name-1</i> <i>byte-spec-1</i> <i>default-init-1</i>)
        (<i>item-name-2</i> <i>byte-spec-2</i> <i>default-init-2</i>)
                ...)
</pre></div>

<p><i>item-name</i> must always be a symbol, and each <i>item-name</i> is
defined as an access macro.  Each <i>item</i> allocates one entry of
the physical structure, even though in form (3) several access macros
are defined.
</p>
<p>In form (1), <i>item-name</i> is simply defined as a macro to
return the corresponding element of the structure.  The constructor macro will
initialize that entry to <code>nil</code> (or <code>0</code> in a numeric array)
by default.  In form (2), the access macro
is defined the same way, but the default initialization is provided by
the user of <code>defstruct</code>.
</p>
<p>In form (3), several access macros are defined, and each one
refers to the single structure element allocated for this <i>item</i>.
However, if <i>byte-spec</i> is a fixnum, the access macros will <code>ldb</code> that
byte from the entry (see the function <code>ldb</code>, (ldb-fun)).
<i>byte-spec</i> may also be <code>nil</code>, in which case the usual form of
access macro is defined, returning the entire entry in the structure.
Note that it is possible to define two or more different overlapping
byte fields.  (If more than one of these has a <i>default-init</i> the
results of initializing the entry are undefined and unpredictable.)  For
example, if the third <i>item</i> of a call to <code>defstruct</code> were
</p>
<div class="lisp">
<pre class="lisp">        ((foo-high-byte 1010)
         (foo-low-byte 0010)
         (foo-whole-thing nil))
</pre></div>

<p>then <code>(foo-high-byte foo)</code> would expand to <code>(ldb 1010 (aref foo
2))</code>, and <code>(foo-whole-thing foo)</code> would expand to <code>(aref foo 2)</code>.
</p>
<p>Form (3) can also be used if you want to have an element with more
than one access macro.  By putting <code>((foo nil) (bar nil))</code>, both <code>foo</code>
and <code>bar</code> will be defined identically.
</p></dd></dl>

<a name="Options-to-Defstruct"></a>
<h3 class="section">17.4 Options to Defstruct</h3>

<p>Note that options which take no arguments may be given as just a symbol,
instead of a list.
</p>
<dl compact="compact">
<dt><code>:array</code></dt>
<dd><p>The structure should be implemented as an array.  This is the default.
(No arguments.)
</p></dd>
<dt><code>:array-leader</code></dt>
<dd><p>The structure should implemented as be an array-leader. (No arguments.)
</p></dd>
<dt><code>:list</code></dt>
<dd><p>The structure should be implemented as a list. (No arguments.)
</p></dd>
<dt><code>:grouped-array</code></dt>
<dd><p>See (grouped-array).
</p></dd>
<dt><code>:times</code></dt>
<dd><p>Used by grouped arrays.  See (grouped-array).
</p></dd>
<dt><code>:size</code></dt>
<dd><p>Takes one argument, a symbol.  The symbol gets <i>set</i> to the size of the
structure, at load-time (not compile-time).
</p></dd>
<dt><code>:size-macro</code></dt>
<dd><p>One argument, a symbol.  The symbol gets defined as a macro,
which expands into the size of the structure.
</p></dd>
<dt><code>:constructor</code></dt>
<dd><p>One argument, a symbol which will be the name of the constructor macro.
If the option is not present, the name of the constructor will be
made by concatenating <code>&quot;make-&quot;</code> with the <i>name</i> of the structure.
If the argument is <code>nil</code>, do not define any constructor macro.
</p></dd>
<dt><code>:named</code></dt>
<dd><p>No argument.  This causes the constructor to
create named structure arrays (and thus may not be used with the <code>:list</code> option)
and automatically allocate the appropriate slot in the structure and
put the name of the structure there as the named-structure symbol.
</p></dd>
<dt><code>:default-pointer</code></dt>
<dd><p>One argument.  The access macros will be defined in such
a way that if they are called on no &quot;arguments&quot;, the argument
to the <code>:default-pointer</code> option will be used instead.  (Normally, access macros
will signal an error if their &quot;argument&quot; is missing.)
</p></dd>
<dt><code>:make-array</code></dt>
<dd><p>One argument, arguments to the <code>make-array</code> function.  See below.
</p></dd>
<dt><code>:include</code></dt>
<dd><p>One argument, the name of a structure.  The structure being defined will
start out the same as that structure, with some additional elements
added at the end.
</p></dd>
</dl>

<a name="Using-the-Constructor-Macro"></a>
<h3 class="section">17.5 Using the Constructor Macro</h3>

<p>If the argument to the <code>:constructor</code> option is <code>nil</code>, no
constructor macro is defined.  But otherwise, <code>defstruct</code> creates a
constructor macro, which will create an instance of the
structure.  This section explains how the constructor macro interprets
its &quot;arguments&quot;.
</p>
<p>A call to a constructor macro, in general, has the form
</p>
<div class="lisp">
<pre class="lisp">(<i>name-of-constructor-macro</i>
        <i>symbol-1</i> <i>form-1</i>
        <i>symbol-2</i> <i>form-2</i>
        ...)
</pre></div>

<p>Each <i>symbol</i> may be either a name of an <i>item</i> of the structure,
or a specially recognized keyword.  All <i>form</i>s are evaluated.
</p>
<p>If <i>symbol</i> is the name of an <i>item</i>, then that element
of the created structure will be initialized to the value of <i>form</i>.
If no <i>symbol</i> is present for a given item, then the item will be
initialized in accordance with the default initialization specified
in the call to <code>defstruct</code>.  If the <code>defstruct</code> itself also
did not specify any initialization, the element will be initialized
to <code>nil</code>, unless the structure is implemented by a <i>numeric array</i>,
in which case it will be initialized to <code>0</code>.
(In other words, the initialization specified to the constructor
overrides the initialization specified to <code>defstruct</code>.)
</p>
<p>There are two symbols which are specially recognized by the
constructor.  One is <code>:make-array</code>, which should only be used for <i>array</i>
and <i>array-leader</i> type structures.  The value of <i>form</i> is used as the
argument list to the <code>make-array</code> function call created by the constructor.
This way, you can specify the area in which you wish the structure to
be created, the type of the array to be created, and so on.  Of
course, if you provided <i>all</i> of the arguments to <code>make-array</code>, the
constructor would not be able to do its job; so the constructor overrides
your specifications of certain elements.  If the structure is <i>array</i>
type, your specification of the array&rsquo;s dimensions (the third argument to
<code>make-array</code>) is ignored; if it is of <i>array-leader</i> type, the array-leader
argument (the fifth argument to <code>make-array</code>) is ignored.  Also, in both
cases the named-structure argument (the seventh argument to
<code>make-array</code>) is ignored.  They are ignored because it is the constructor
macro&rsquo;s job to fill them in.  If the list you provide is shorter than the number
of arguments to <code>make-array</code>, it will be as if you had given the missing
elements as <code>nil</code>.  Similarly, if your list is too long, the extra elements
will be ignored.  If you do not provide the <code>:make-array</code> keyword
at all, the arguments default from the value of the <code>:make-array</code>
option to <code>defstruct</code>.  If you did not even provide that, the
default argument lists are:
</p>
<dl compact="compact">
<dt><span class="roman">For <i>array</i>s:</span></dt>
<dd><p><code>(default-array-area 'art-q <i>whatever</i> nil nil nil <i>whatever</i>)</code>
</p></dd>
<dt><span class="roman">For <i>array-leader</i>s:</span></dt>
<dd><p><code>(default-array-area 'art-q  0 nil <i>whatever</i> nil <i>whatever</i>)</code>
</p></dd>
</dl>

<p>The second keyword recognized by the constructor is <code>:times</code>,
which should only be used for <code>grouped-arrays</code>.  Its value is the number
of repetitions of the structure in the grouped-array.  If <code>:times</code> is not
provided, it defaults from the <code>:times</code> option of <code>defstruct</code>.  If you did
not even provide that, the default is 1.
</p>
<a name="Grouped-Arrays"></a>
<h3 class="section">17.6 Grouped Arrays</h3>

<p>The grouped array feature allows you to store several
instances of a structure side-by-side within an array.  This feature
is somewhat limited, and requires that the structure be implemented as an array,
that it not have any <code>:include</code> option, and that it not be a
named structure.
</p>
<p>The accessor macros are defined to take a &quot;first argument&quot; which
should be a fixnum, and is the index into the array of where this
instance of the structure starts.  It should be a multiple of the size
of the structure, for things to make sense.
</p>
<p>Note that the &quot;size&quot; of the structure (as given in the <code>:size</code> symbol
and the <code>:size-macro</code>) is the number of elements in <i>one</i> instance of the structure;
the actual length of the array is the product of the size of the structure and the
number of instances.  The number of instances to be created by the creator
macro is given as the argument to the <code>:times</code> or <code>:grouped-array</code> option, or
the <code>:times</code> keyword of the constructor macro (see below).
</p>
<a name="Named-Structures"></a>
<h3 class="section">17.7 Named Structures</h3>
<a name="index-named_002dstructure"></a>

<p>The <i>named structure</i> feature provides a very simple form of
user-defined data type.  Any array may be made a named structure, although
usually the <code>:named</code> option of <code>defstruct</code> is used to create named
structures.  The principle advantages to a named structure are that it has
a more informative printed representation than a normal array and that
the <code>describe</code> function knows how to give a detailed description of it.
Because of these improved user-interface features it is recommended that
&quot;system&quot; data structures be implemented with named structures.
</p>
<p>Another kind of user-defined data type, more advanced but less
efficient, is provided by the <i>actor</i> feature (see (actor)).
</p>
<p>A named structure has an associated symbol, called its &quot;named
structure symbol&quot;, which represents what user-defined type it is an
instance of; the <code>typep</code> function, applied to the named structure,
will return this symbol.  If the array has a leader, then the symbol is
found in element 1 of the leader; otherwise it is found in element 0 of
the array.  (Note: if a numeric-type array is to be a named structure,
it must have a leader, since a symbol cannot be stored in any element
of a numeric array.)
</p>
<p>The named structure symbol should be defined as a function.  The functions
which know about named structures will apply this function to
several arguments. The first is a &quot;keyword&quot; symbol to
identify the calling function, and the second is the named structure
itself.  The rest of the arguments passed depend on the caller; any
named structure function should have a &quot;<code>&amp;rest</code>&quot; parameter to
absorb any extra arguments that might be passed.  Just what
the function is expected to do depends on the keyword it is passed
as its first argument.  The following are the keywords defined at present:
</p>
<dl compact="compact">
<dt><code>:which-operations</code></dt>
<dd><p>Should return a list of the names of the operations the function handles.
</p></dd>
<dt><code>:print</code></dt>
<dd><p>The arguments are <code>:print</code>, the named structure, the stream to output to,
the current depth in
list-structure, and <code>t</code> if slashification is enabled (<code>prin1</code>
versus <code>princ</code>).  The printed representation of the named structure
should be output to the stream.  If the named structure symbol
is not defined as a function, or <code>:print</code> is not in its
<code>:which-operations</code> list, the printer will default to a reasonable
printed representation.
</p></dd>
<dt><code>:describe</code></dt>
<dd><p>The arguments are <code>:describe</code> and the named structure.  It should
output a description of itself to <code>standard-output</code>.  If the named
structure symbol is not defined as a function, or <code>:describe</code> is not
in its <code>:which-operations</code> list, the describe system will
check whether the named structure was created by using the <code>:named</code>
option of <code>defstruct</code>; if so, the names and values of the structure&rsquo;s
fields will be enumerated.
</p></dd>
</dl>

<p>The following functions operate on named structures.
</p>
<dl>
<dt><a name="index-named_002dstructure_002dp"></a>Function: <strong>named-structure-p</strong> <em>x</em></dt>
<dd><p>This predicate returns <code>t</code> if <i>x</i> is a named structure; otherwise
it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-named_002dstructure_002dsymbol"></a>Function: <strong>named-structure-symbol</strong> <em>x</em></dt>
<dd><p><i>x</i> should be a named structure.  This returns <i>x</i>&rsquo;s named structure
symbol: if <i>x</i> has an array leader, element 1 of the leader is returned,
otherwise element 0 of the array is returned.
</p></dd></dl>

<dl>
<dt><a name="index-make_002darray_002dinto_002dnamed_002dstructure"></a>Function: <strong>make-array-into-named-structure</strong> <em>array</em></dt>
<dd><p><i>array</i> is made to be a named structure, and is returned.
</p></dd></dl>

<dl>
<dt><a name="index-named_002dstructure_002dinvoke"></a>Function: <strong>named-structure-invoke</strong> <em>str op &amp;rest args</em></dt>
<dd><p><i>str</i> should be a named structure, and <i>op</i> should be a keyword
symbol.  The function definition of the named structure symbol is called
with appropriate arguments.
</p></dd></dl>


<a name="The-I_002fO-System"></a>
<h2 class="chapter">18 The I/O System</h2>
<a name="index-input-and-output"></a>

<p>The Lisp Machine provides a powerful and flexible system for
performing input and output to peripheral devices.  To allow device
independent I/O (that is, to allow programs to be written in a general
way so that the program&rsquo;s input and output may be connected with any
device), the Lisp Machine I/O system provides the concept of an &quot;I/O
stream&quot;.  What streams are, the way they work, and the functions to create and
manipulate streams, are described in this chapter.  This chapter also
describes the Lisp &quot;I/O&quot; operations <code>read</code> and <code>print</code>, and the
printed representation they use for Lisp objects.
</p>
<a name="The-Character-Set"></a>
<h3 class="section">18.1 The Character Set</h3>
<a name="index-character-set"></a>

<p>The Lisp Machine normally represents characters as fixnums.
The mapping between these numbers and the characters is listed here.
The mapping is similar to ASCII, but somewhat modified to allow the use
of the so-called SAIL extended graphics, while avoiding certain
ambiguities present in ITS.  For a long time ITS treated the Backspace,
Control-H, and Lambda keys on the keyboard identically as
character code 10 octal; this problem is avoided from the start in the
Lisp Machine&rsquo;s mapping.
</p>
<p>Fundamental characters are eight bits wide.  Those less than
200 octal (with the 200 bit off) and only those are printing graphics;
when output to a device they are assumed to print a character and move
the &quot;cursor&quot; one character position to the right.  (All software provides
for variable-width fonts, so the term &quot;character position&quot; shouldn&rsquo;t
be taken too literally.)
</p>
<p>Characters in the range of 200 to 237 inclusive are used for
special characters.  Character 200 is a &quot;null character&quot;, and is not
used for anything much.  Characters 201 to 215 correspond
to the special keys on the keyboard such as Form and Call.
The rest of this group is reserved for future expansion.
</p>
<p>The remaining characters are used for control operations.
The characters 240 to 247 inclusively mean &quot;Switch to font 0&quot;, &quot;Switch
to font 1&quot;, etc.  The rest of this group is reserved for future
expansion.
</p>
<p>In some contexts, a fixnum can hold both a character code
and a font number for that character.  The following byte
specifiers are defined:
</p>
<dl>
<dt><a name="index-_0025_0025ch_002dchar"></a>Variable: <strong>%%ch-char</strong></dt>
<dd><p>The value of <code>%%ch-char</code> is a byte specifier for the field
of a fixnum character which holds the character code.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025ch_002dfont"></a>Variable: <strong>%%ch-font</strong></dt>
<dd><p>The value of <code>%%ch-font</code> is a byte specifier for the field
of a fixnum character which holds the font number.
</p></dd></dl>

<a name="index-keyboard-characters"></a>
<p>Characters read in from the keyboard include a character
code and the Control and Meta bits.  The following byte specifiers
are provided:
</p>
<a name="index-_0025_0025kbd-fields"></a>
<dl>
<dt><a name="index-_0025_0025kbd_002dchar"></a>Variable: <strong>%%kbd-char</strong></dt>
<dd><p>The value of <code>%%kbd-char</code> is a byte specifier for the field
of a keyboard character which holds the normal eight-bit character code.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025kbd_002dcontrol"></a>Variable: <strong>%%kbd-control</strong></dt>
<dd><p>The value of <code>%%kbd-char</code> is a byte specifier for the bit
of a keyboard character which is 1 if either Control key was held down.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025kbd_002dmeta"></a>Variable: <strong>%%kbd-meta</strong></dt>
<dd><p>The value of <code>%%kbd-char</code> is a byte specifier for the field
of a keyboard character which is 1 if either Meta key was held down.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025kbd_002dcontrol_002dmeta"></a>Variable: <strong>%%kbd-control-meta</strong></dt>
<dd><p>The value of <code>%%kbd-char</code> is a byte specifier for the two-bit field
of a keyboard character
whose low bit is the Control bit, and whose high bit is the Meta bit.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025kbd_002dmouse"></a>Variable: <strong>%%kbd-mouse</strong></dt>
<dd><p>The value of <code>%%kbd-mouse</code> is a byte specifier for the bit in a keyboard character
which indicates that the character is not really a character,
but a signal from the mouse.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025kbd_002dmouse_002dbutton"></a>Variable: <strong>%%kbd-mouse-button</strong></dt>
<dd><p>The value of <code>%%kbd-mouse-button</code> is a byte specifier for the field in a mouse signal
which says which button was clicked.  The value is <code>0</code>, <code>1</code>, or <code>2</code> for
the left, middle, and right buttons, respectively.
</p></dd></dl>

<dl>
<dt><a name="index-_0025_0025kbd_002dmouse_002dn_002dclicks"></a>Variable: <strong>%%kbd-mouse-n-clicks</strong></dt>
<dd><p>The value of <code>%%kbd-mouse-n-clicks</code>
is a byte specifier for the field in a mouse signal
which says how many times the button was clicked.
The value is one less than the number of times the button was clicked.
</p></dd></dl>

<p>Since the Control and Meta bits are not part of the fundamental 8-bit character
codes, there is no way to express keyboard input in terms of simple
character codes.  However, there is a convention which many programs
accept for encoding keyboard input into character codes:  if a
character has its Control bit on, prefix it with an Alpha; if a
character has its Meta bit on, prefix it with a Beta; if a character
has both its Control and Meta bits on, prefix it with an Epsilon.
To get an Alpha, Beta, Epsilon, or Equivalence into the string,
quote it by prefixing it with an Equivalence.
</p>
<pre class="verbatim">@c 000 center-dot (@centerDot{})             040 space       100 @@           140 `
@c 001 down arrow (@downArrow{})             041 !           101 A           141 a
@c 002 alpha (@alpha{})                  042 &quot;           102 B           142 b
@c 003 beta (@beta{})                   043 #           103 C           143 c
@c 004 and-sign (@andSign{})               044 $           104 D           144 d
@c 005 not-sign (@notSign{})               045 %           105 E           145 e
@c 006 epsilon (@epsilon{})                046 &amp;           106 F           146 f
@c 007 pi (@pi{})                     047 '           107 G           147 g
@c 010 lambda (@lambda{})                 050 (           110 H           150 h
@c 011 gamma (@delta{})                  051 )           111 I           151 i
@c 012 delta (@delta{})                  052 *           112 J           152 j
@c 013 uparrow (@uparrow{})                053 +           113 K           153 k
@c 014 plus-minus (@plusMinus{})             054 ,           114 L           154 l
@c 015 circle-plus (@delta{})            055 -           115 M           155 m
@c 016 infinity (@infinity{})               056 .           116 N           156 n
@c 017 partial delta (@partialDelta{})          057 /           117 O           157 o
@c 020 left horseshoe (@leftHorseshoe{})         060 0           120 P           160 p
@c 021 right horseshoe (@delta{})        061 1           121 Q           161 q
@c 022 up horseshoe (@upHorseshoe{})           062 2           122 R           162 r
@c 023 down horseshoe (@downHorseshoe{})         063 3           123 S           163 s
@c 024 universal quantifier (@universalQuantifier{})   064 4           124 T           164 t
@c 025 existential quantifier (@existentialQuantifier{}) 065 5           125 U           165 u
@c 026 circle-X (@circleX{})               066 6           126 V           166 v
@c 027 double-arrow (@doubleArrow{})           067 7           127 W           167 w
@c 030 left arrow (@leftArrow{})             070 8           130 X           170 x
@c 031 right arrow (@rightArrow{})            071 9           131 Y           171 y
@c 032 not-equals (@notEquals{})             072 :           132 Z           172 z
@c 033 diamond (altmode) ()      073 ;           133 [           173 @{
@c 034 less-or-equal (@lessOrEqual{})          074 &lt;           134 \           174 |
@c 035 greater-or-equal (@greaterOrEqual{})       075 =           135 ]           175 @}
@c 036 equivalence (@equivalence{})            076 &gt;           136 ^           176 ~
@c 037 or (@or{})                     077 ?           137 _           177 @circlePlus{}
@c 200 null character             210 bs          240 switch to font 0
@c 201 break                      211 tab         241 switch to font 1
@c 202 clear                      212 line        242 switch to font 2
@c 203 call                       213 vt          243 switch to font 3
@c 204 escape (NOT altmode!)      214 form        244 switch to font 4
@c 205 backnext                   215 return      245 switch to font 5
@c 206 help                                       246 switch to font 6
@c 207 rubout                                     247 switch to font 7
@c 216-237 reserved for future special keys
@c 250-377 reserved for future control operations
</pre><div align="center">The Lisp Machine Character Set
</div>
<a name="Printed-Representation"></a>
<h3 class="section">18.2 Printed Representation</h3>

<p>People cannot deal directly with Lisp objects, because the
objects live inside the machine.  In order to let us get at and talk
about Lisp objects, Lisp provides a representation of objects in the
form of printed text; this is called the <i>printed representation</i>.
This is what you have been seeing in the examples throughout this manual.
Functions such as <code>print</code>, <code>prin1</code>,  and <code>princ</code> take a Lisp
object, and send the characters of its printed representation to a
stream.  These functions (and the internal functions they call) are
known as the <i>printer</i>.  The <code>read</code> function takes characters from a stream,
interprets them as a printed representation of a Lisp object, builds a
corresponding object and returns it; it and its subfunctions are known as the <i>reader</i>.
</p>
<p>This section describes in detail what the printed
representation is for any Lisp object, and just what <code>read</code> does.
For the rest of the chapter, the phrase &quot;printed representation&quot; will
be abbreviated as &quot;p.r.&quot;.
</p>
<a name="What-the-Printer-Produces"></a>
<h4 class="subsection">18.2.1 What the Printer Produces</h4>
<a name="index-printer"></a>

<p>The printed representation of an object depends on its
type.  In this section, we will consider each type of object
and explain how it is printed.
</p>
<a name="index-slashification"></a>
<p>Printing is done either with or without <i>slashification</i>.
The non-slashified version is nicer looking in general, but
if you give it to <code>read</code> it won&rsquo;t do the right thing.
The slashified version is carefully set up so that <code>read</code>
will be able to read it in.  The primary effects of slashification
are that special characters used with other than their
normal meanings (e.g., a parenthesis appearing in the name
of a symbol) are preceeded by slashes or cause the name of the
symbol to be enclosed in vertical bars, and that symbols which
are not from the current package get printed out with their
package prefixes (a package prefix looks like a string followed
by a colon).
</p>
<p>For a fixnum: if the fixnum is negative, the printed representation
begins with a minus sign (&quot;<code>-</code>&quot;).  Then, the value of the variable <code>base</code>
is examined.  If <code>base</code> is a positive fixnum, the number is printed
out in that base (<code>base</code> defaults to 8); if it is a symbol with
a <code>:princ-function</code> property, the value of the property will be
funcalled on two arguments: <code>minus</code> of the fixnum to be printed,
and the stream to which to print it; otherwise the value of <code>base</code> is invalid.
This is a hook to allow output in Roman numerals and the like.
Finally, if <code>base</code> equals 10. and the variable <code>*nopoint</code> is
<code>nil</code>, a decimal point is printed out.  Slashification does
not affect the printing of fixnums.
</p>
<dl>
<dt><a name="index-base"></a>Variable: <strong>base</strong></dt>
<dd><p>The value of <code>base</code> is a number which is the radix in which fixnums
are printed, or a symbol with a <code>:princ-function</code> property.
The initial value of <code>base</code> is 8.
</p></dd></dl>

<dl>
<dt><a name="index-_002anopoint"></a>Variable: <strong>*nopoint</strong></dt>
<dd><p>If the value of <code>*nopoint</code> is <code>nil</code>, a trailing decimal point
is printed when a fixnum is printed out in base 10.  This allows
the numbers to be read back in correctly even if <code>ibase</code>
is not 10. at the time of reading.  If <code>*nopoint</code> is non-<code>nil</code>,
the trailing decimal points are suppressed.  The initial value of
<code>*nopoint</code> is <code>nil</code>.
</p></dd></dl>

<p>For a symbol: if slashification is off, the p.r. is simply the successive
characters of the print-name of the symbol. If slashification is on,
two changes must be made.  First, the symbol might require a package prefix
in order that <code>read</code> work correctly, assuming that the package into which
<code>read</code> will read the symbol is the one in which it is being printed.
See the section on packages ((package)) for an explanation
of the package name prefix.
Secondly, if the p.r. would not read in as a symbol at all (that is, if
the print-name looks like a number, or contains special characters),
then the p.r. must have some quoting for those characters, either
by the use of slashes (&quot;/&quot;) before each special character,
or by the use of vertical bars (&quot;|&quot;) around the whole name.
The decision whether quoting is required is done using the readtable,
so it is always accurate provided that <code>readtable</code> has the same value when
the output is read back in as when it was printed.
</p>
<p>For a string: if slashification is off, the p.r. is simply the
successive characters of the string.  If slashification is on, the
string is printed between double quotes, and any characters inside the
string which need to be preceeded by slashes will be.   Normally these
are just double-quote and slash.  Incompatibly with Maclisp, carriage
return is <i>not</i> ignored inside strings and vertical bars.
</p>
<a name="index-named_002dstructure-1"></a>
<p>For an array which is a named structure: if the array has a
named structure symbol which is defined as a function, then that
function is called on five arguments: the symbol <code>:print</code>, the
object itself, the stream to print to, the current <i>depth</i> of list
structure (see below), and whether slashification is enabled.  A
suitable printed representation should be sent to the stream.  This
allows a user to define his own p.r. for his named structures;
examples can be found in the named structure section (see
(named-structure)).  If the named structure symbol does not have a
function definition, the printed-representation is like that for
random data-types: a number sign and a less than sign, the named
structure symbol, the numerical address of the array, and a greater
than sign.
</p>
<p>Other arrays: the p.r. starts with a number sign and
a less-than sign.  Then the &quot;<code>art-</code>&quot; symbol for the array
type is printed.  Next the dimensions of the array are printed, separated
by hyphens.  This is followed by a space, the machine address of the
array, and a greater-than sign.
</p>
<p>Conses:  The p.r. for conses tends to favor <i>lists</i>.  It
starts with an open-parenthesis.  Then, the <i>car</i> of the cons is
printed, and the <i>cdr</i> of the cons is examined.  If it is <code>nil</code>, a
close parenthesis is printed.  If it is anything else but a cons, space
dot space followed by that object is printed.  If it is a cons, we
print a space and start all over (from the point <i>after</i> we printed
the open-parenthesis) using this new cons.  Thus, a list is printed as
an open-parenthesis, the p.r.&rsquo;s of its elements separated by spaces, and a
close-parenthesis.
</p>
<p>Thus, the usual printed representations such as <code>(a b (foo bar) c)</code>
are printed.
</p>
<p>The following additional feature is provided for the p.r. of conses:
as a list is printed, <code>print</code> maintains the length of the list so far,
and the depth of recursion of printing lists.  If the length exceeds the
value of the variable <code>prinlength</code>, <code>print</code> will terminate the printed
representation of the list with an ellipsis (three periods) and a close-parenthesis.
If the depth of recursion exceeds the value of the variable <code>prinlevel</code>,
then the list will be printed as &quot;**&quot;.  These two features allow a kind of abbreviated
printing which is more concise and suppresses detail.  Of course, neither
the ellipsis nor the &quot;**&quot; can be interpreted by <code>read</code>, since the relevant information
is lost.
</p>
<dl>
<dt><a name="index-prinlevel"></a>Variable: <strong>prinlevel</strong></dt>
<dd><p><code>prinlevel</code> can be set to the maximum number of nested
lists that can be printed before the printer will give up and just print a
&quot;**&quot;.  If it is <code>nil</code>, which it is initially, any number of nested
lists can be printed.  Otherwise, the value of <code>prinlevel</code> must be a fixnum.
</p></dd></dl>

<dl>
<dt><a name="index-prinlength"></a>Variable: <strong>prinlength</strong></dt>
<dd><p><code>prinlength</code> can be set to the maximum number of elements of a list
that will be printed before the printer will give up and print a &quot;<code>...</code>&quot;.
If it is <code>nil</code>, which it is initially, any length list may be
printed.  Otherwise, the value of <code>prinlength</code> must be a fixnum.
</p></dd></dl>

<p>For any other data type: the p.r. starts with a number sign and
a less-than sign (&quot;<code>&lt;</code>&quot;), the &quot;<code>dtp-</code>&quot; symbol for this datatype, a space, and
the machine address of the object.  Then, if the object is a microcoded
function, compiled function, or stack group, its name
is printed.  Finally a greater-than sign (&quot;<code>&gt;</code>&quot;) is printed.
</p>
<p>None of the p.r.&rsquo;s beginning with a number sign can be read back in,
nor, in general, can anything produced by named structure functions.
Just what <code>read</code> accepts is the topic of the next section.
</p>
<a name="What-The-Reader-Accepts"></a>
<h4 class="subsection">18.2.2 What The Reader Accepts</h4>
<a name="index-reader"></a>

<p>The purpose of the reader is to accept characters,
interpret them as the p.r. of a Lisp object, and return
a corresponding Lisp object.  The reader cannot accept
everything that the printer produces; for example, the
p.r.&rsquo;s of arrays (other than strings), compiled code
objects, closures, stack groups etc. cannot be read in.
However, it has many features which are not seen in the
printer at all, such as more flexibility, comments, and
convenient abbreviations for frequently-used unwieldy constructs.
</p>
<p>This section shows what kind of p.r.&rsquo;s the reader understands,
and explains the readtable, reader macros, and various features
provided by <code>read</code>.
</p>
<p>The reader understands the p.r&rsquo;s of fixnums in a way
more general than is employed by the printer.  Here is a complete
description of the format for fixnums.
</p>
<p>Let a <i>simple fixnum</i> be a string of digits, optionally
preceeded by a plus sign or a minus sign, and optionally followed by a
trailing decimal point.  A simple fixnum will be interpreted by
<code>read</code> as a fixnum.  If the trailing decimal point is present, the
digits will be interpreted in decimal radix; otherwise, they will be
considered as a number whose radix is the value of the variable
<code>ibase</code>.
</p>
<dl>
<dt><a name="index-ibase"></a>Variable: <strong>ibase</strong></dt>
<dd><p>The value of <code>ibase</code> is a number which is the radix in which
fixnums are read.  The initial value of <code>ibase</code> is 8.
</p></dd></dl>

<p><code>read</code> will also understand a simple fixnum,
followed by an underscore (&quot;_&quot;) or a circumflex (&quot;^&quot;),
followed by another simple fixnum.  The two simple fixnums
will be interpreted in the usual way,
then the character in between indicates an operation to be
performed on the two fixnums.  The underscore indicates a binary
&quot;left shift&quot;; that is, the fixnum to its left is doubled the
number of times indicated by the fixnum to its right.  The circumflex
multiplies the fixnum to its left by <code>ibase</code> the number of
times indicated by the fixnum to its right. Examples:  <code>645_6</code>
means <code>64500</code> (in octal) and <code>645^3</code> means <code>645000</code>.
</p>
<p>Here are some examples of valid representations
of fixnums to be given to <code>read</code>:
</p>
<div class="lisp">
<pre class="lisp">4
23456.
-546
+45^+6
2_11
</pre></div>

<p>A string of letters, numbers, and &quot;extended alphabetic&quot;
characters is recognized by the reader as a symbol, provided
it cannot be interpreted as a number.
When the reader sees one, it <i>interns</i> it on a <i>package</i>
(see (package) for an explanation of interning and the package system).
Symbols may start with digits; you could even
have one named &quot;-345T&quot;; <code>read</code> will accept this as a symbol
without complaint.  If you want to put strange characters (such as
lower-case letters, parentheses, or reader macro characters) inside the name of a symbol,
put a slash before the strange characters. If you want to have a symbol
whose print-name looks like a number, put a slash before some character
in the name.  You can also enclose the name of a symbol in vertical bars,
which quotes all characters inside, except vertical bars and slashes, which
must be quoted with slash.
</p>
<div class="lisp">
<pre class="lisp">Examples of symbols:
</pre><pre class="lisp">foo
bar/(baz/)
34w23
|Frob Sale|
</pre></div>

<p>The reader will also recognize strings, which should be
surrounded by double-quotes.  If you want to put a double-quote or
a slash inside a string, preceed it by a slash.
</p>
<div class="lisp">
<pre class="lisp">Examples of strings:
</pre><pre class="lisp">&quot;This is a typical string.&quot;
&quot;That is known as a /&quot;cons cell/&quot; in Lisp.&quot;
</pre></div>

<p>When <code>read</code> sees an open parenthesis, it knows that
the p.r. of a cons is coming, and calls itself recursively to
get the elements of the cons or the list that follows.  Any of
the following are valid:
</p>
<div class="lisp">
<pre class="lisp">(foo . bar)
(foo bar baz)
(foo . (bar . (baz . nil)))
(foo bar . quux)
</pre></div>

<p>The first is a cons, whose car and cdr are both symbols.  The second
is a list, and the third is exactly the same as the second (although
<code>print</code> would never produce it).  The fourth is a &quot;dotted list&quot;;
the cdr of the last cons cell (the second one) is not <code>nil</code>, but
<code>quux</code>.
<a name="index-dotted-list"></a>
</p>
<p>Whenever the reader sees any of the above, it creates new cons
cells; it never returns existing list structure.  This contrasts
with the case for symbols, as very often <code>read</code> returns symbols
that it found on the package rather than creating new symbols
itself.  Symbols are the only thing that work this way.
</p>
<p>The dot that separates the 2 elements of a dotted-pair
p.r. for a cons is only recognized if it is surrounded by delimiters.
Thus dot may be freely used within print-names of symbols and within numbers.
</p>
<a name="Sharp_002dsign-Abbreviations"></a>
<h4 class="subsection">18.2.3 Sharp-sign Abbreviations</h4>

<p>The reader&rsquo;s syntax includes several abbreviations introduced by sharp sign (<code>#</code>).
These take the general form of a sharp sign, a second character which identifies
the syntax, and following arguments.  Here are the currently-defined sharp-sign
constructs; more are likely to be added in the future.
</p>
<dl compact="compact">
<dt><code>#/</code></dt>
<dd><p><code>#/<i>x</i></code> reads in as the number which is the character code for the
character <i>x</i>.  For example, <code>#/a</code> is equivalent to <code>141</code> but clearer
in its intent.  This is the recommended way to include character constants
in your code.  Note that the slash causes this construct to be parsed correctly
by the editors, Emacs and Eine.
</p>
<p>The character can be modified with control and meta bits by inserting one or more special
characters between the <code>#</code> and the <code>/</code>.  <code>#/<i>x</i></code> generates control-<i>x</i>.
<code>#/<i>x</i></code> generates meta-<i>x</i>.  <code>#/<i>x</i></code> generates super-<i>x</i>.
<code>#/<i>x</i></code> generates hyper-<i>x</i>.  These can be combined, for instance
<code>#/&amp;</code> generates super-meta-ampersand.  Also, <code>#/<i>x</i></code> is an abbreviation
for <code>#/<i>x</i></code>.
</p></dd>
<dt><code>#\</code></dt>
<dd><p><code>#\<i>name</i></code> reads in as the number which is the character code
for the non-printing character symbolized by <i>name</i>.  (In the Lisp-machine
compatible Maclisp environment, Lisp-machine character code is used if the
file is being compiled for the Lisp machine, or ascii character code if the
result is intended to be used in Maclisp.)
</p>
<p>The following character names are recognized: <code>break, clear, esc, tab, alt,
form, vt, rubout, bs, call, return, line, back-next, help, space</code>.  These are the same as
are written on the keys.  The abbreviations <code>cr</code> for <code>return</code> and <code>sp</code>
for <code>space</code> are accepted and generally used.
[There are a lot more characters as well as these; I&rsquo;ll refrain from documenting
them until things settle down.  Here is the list:
<code>clear-input, escape, clear-screen, quote, hold-output, stop-output,
abort, resume, status, delete, end, i, ii, iii, iv, hand-up, hand-down,
hand-left, hand-right, system, network, lambda, gamma, delta, uparrow,
plus-minus, circle-plus, integral, null, backspace</code>.]
</p>
<p>The character can be modified with control and meta bits by inserting special
characters as with <code>#/</code>.
</p>
<p>The names <code>mouse-1-1, mouse-2-1, mouse-3-1, mouse-1-2, mouse-2-2, <span class="roman">and</span> mouse-3-2</code>
represent the special characters sometimes used to represent clicking on the
mouse buttons.
</p></dd>
<dt><code>#^</code></dt>
<dd><p><code>#^<i>x</i></code> is exactily like <code>#/<i>x</i></code> if the input is being
read by the Lisp machine or being compiled to run on the Lisp machine;
it generates control-<i>x</i>.
In Maclisp <i>x</i> is converted to upper case and the xored with 100 (octal).
Thus <code>#^<i>x</i></code> always generates the fixnum returned by <code>tyi</code> if
the user holds down the control key and types <i>x</i>.
(In Maclisp <code>#/<i>x</i></code> sets the bit set by the control key when the TTY is
open in FIXNUM mode.)
</p></dd>
<dt><code>#'</code></dt>
<dd><p><code>#'<i>foo</i></code> is an abbreviation for <code>(function <i>foo</i>)</code>.
<i>foo</i> is the p.r. of any object.
</p></dd>
<dt><code>#,</code></dt>
<dd><p><code>#,<i>foo</i></code> evaluates <i>foo</i> (the p.r. of a Lisp form) at read
time, unless the compiler is doing the reading, in which case it is arranged
that <i>foo</i> will be evaluated when the QFASL file is loaded.  This is a way,
for example, to include in your code complex list-structure constants which cannot
be written with <code>quote</code>.  Note that the reader does not put <code>quote</code>
in front of the result of the evaluation.  You must do this yourself if you
want it, typically by using the <code>'</code> macro-character.
</p></dd>
<dt><code>#.</code></dt>
<dd><p><code>#.<i>foo</i></code> evaluates <i>foo</i> (the p.r. of a lisp form) at read
time, regardless of who is doing the reading.
</p></dd>
<dt><code>#O</code></dt>
<dd><p><code>#O <i>number</i></code> reads <i>number</i> in octal regardless of the
setting of <code>ibase</code>.  Actually, any S-expression can be prefixed
by <code>#O</code>; it will be read with <code>ibase</code> bound to 8.
</p></dd>
<dt><code>#R</code></dt>
<dd><p><code>#<i>radix</i>R <i>number</i></code> reads <i>number</i> in radix <i>radix</i> regardless
of the setting of <code>ibase</code>.  As with <code>#O</code>, any S-expression
can be prefixed by <code>#<i>radix</i>R</code>; it will be read with <code>ibase</code>
bound to <i>radix</i>.  <i>radix</i> must consist of only digits, and
it is read in decimal.
</p>
<p>For example, <code>#3R102</code> is another way of writing <code>11.</code>
and <code>#11R32</code> is another way of writing <code>35.</code>
</p></dd>
<dt><code>#X</code></dt>
<dd><p><code>#X <i>number</i></code> reads <i>number</i> in radix 16. (hexadecimal)
regardless of the setting if <i>ibase</i>.  As with <code>#O</code> and <code>#R</code>,
any S-expression can be prefixed by <code>#X</code>.
</p></dd>
<dt><code>#Q</code></dt>
<dd><p><code>#Q <i>foo</i></code> reads as <i>foo</i> if the input is being read by the
Lisp machine or being compiled to run on the Lisp machine, otherwise it
reads as nothing (white space).
</p></dd>
<dt><code>#M</code></dt>
<dd><p><code>#M <i>foo</i></code> reads as <i>foo</i> if the input is being read into Maclisp
or compiled to run in Maclisp, otherwise it reads as nothing (white space).
</p></dd>
<dt><code>#N</code></dt>
<dd><p><code>#N <i>foo</i></code> reads as <i>foo</i> if the input is being read into NIL
or compiled to run in NIL, otherwise it reads as nothing (white space).
Also, during the reading of <i>foo</i>,
the reader temporarily defines various NIL-compatible sharp-sign
abbreviations (such as <code>#!</code> and <code>#&quot;</code>) in order to parse
the form correctly, even though its not going to be evaluated.
</p>
<p>For details on NIL syntax see the NIL manual.
</p></dd>
<dt><code>#+</code></dt>
<dd><p>This abbreviation provides a read-time conditionalization facility similar
to, but more general than, that provided by <code>#M</code>, <code>#N</code> and <code>#Q</code>.  It is used
as <code>#+<i>feature</i> <i>form</i></code>.  If <i>feature</i> is a symbol, then this is
read as <i>form</i> if <code>(status feature <i>feature</i>)</code> is <code>t</code>.
If <code>(status feature <i>feature</i>)</code> is <code>nil</code>, then this is read as whitespace.
Alternately, <i>feature</i> may be a boolean expression composed of <code>and</code>, <code>or</code>, and
<code>not</code> operators and symbols representing items which may appear on the
<code>(status features)</code> list.
<code>(or lispm amber)</code> represents evaluation of the predicate
<code>(or (status feature lispm) (status feature amber))</code>
in the read-time environment.
</p>
<p>For example, <code>#+lispm <i>form</i></code> makes <i>form</i> exist if being read by the Lisp machine,
and is thus equivalent to <code>#Q <i>form</i></code>.  Similarly, <code>#+maclisp <i>form</i></code> is equivalent
to <code>#M <i>form</i></code>.  <code>#+(or lispm nil) <i>form</i></code> will make <i>form</i> exist on either
the Lisp machine or in NIL.  Note that items may be added to the <code>(status features)</code>
list by means of <code>(sstatus feature <i>feature</i>)</code>, thus allowing the user to selectively
interpret or compile pieces of code by parameterizing this list.
</p></dd>
<dt><code>#-</code></dt>
<dd><p><code>#-<i>feature</i> <i>form</i></code> is equivalent to <code>#+(not <i>feature</i>) <i>form</i></code>.
</p></dd>
<dt><code>##</code></dt>
<dd><p>This is an obsolete form of <code>#/</code>.  You write <code>##</code> followed by a space,
followed by the character whose character code you want.
</p></dd>
</dl>


<a name="The-Readtable"></a>
<h4 class="subsection">18.2.4 The Readtable</h4>

<p>(To be supplied.)
</p>
<a name="Reader-Macros"></a>
<h4 class="subsection">18.2.5 Reader Macros</h4>

<p>(To be supplied.)
</p>
<a name="Input-Functions"></a>
<h3 class="section">18.3 Input Functions</h3>

<dl>
<dt><a name="index-read"></a>Function: <strong>read</strong> <em>&amp;optional stream eof-option</em></dt>
<dd><p><code>read</code> reads in the printed representation of a Lisp object
from <i>stream</i>, builds a corresponding Lisp object, and returns
the object.  If the end-of-file is reached before a valid object starts,
it returns <i>eof-option</i> instead.  If the end-of-file is reached
in the middle of an object, e.g. inside parentheses, an error is signalled.
<i>stream</i> defaults to the value of <code>standard-input</code>,
and <i>eof-option</i> defaults to <code>nil</code>.
</p>
<p>In order to allow compatibility with Maclisp, the arguments are
interpreted in a slightly more complicated way.  If the <i>stream</i> is
<code>nil</code>, then the value of <code>standard-input</code> is used.  If <i>stream</i>
is <code>t</code>, the value of <code>terminal-io</code> is used.
</p>
<p>Maclisp allows the two arguments to be interchanged, but the
Lisp machine does not.
</p></dd></dl>

<dl>
<dt><a name="index-read_002dpreserve_002ddelimiters"></a>Variable: <strong>read-preserve-delimiters</strong></dt>
<dd><p>Certain printed-representations given to <code>read</code>, notably those of symbols
and numbers, require a delimiting character after them.  (Lists do not, because
the matching close parenthesis serves to mark the end of the list.)
Normally <code>read</code> will throw away the delimiting character if it is &quot;whitespace&quot;,
but will preserve it (with a <code>:untyi</code> stream operation) if the character is
syntactically meaningful, since it may be the start of the next S-expression.
</p>
<p>If <code>read-preserve-delimiters</code> is bound to <code>t</code> around a call to <code>read</code>,
no delimiting characters will be thrown away, even if they are whitespace.
This may be useful for certain reader macros or special syntaxes.
</p></dd></dl>

<p>There is an array called the readtable (see (readtable)) which
is used to control the reader.  It contains information about the syntax
of each character.  Initially it is set up to give the standard Lisp
meanings to all the characters, but the user can change them to make
the reader usable as a lexical analyzer for a wide variety of input
formats or languages.  It is also possible to have several readtables
describing different syntax and to switch from one to another by
binding the symbol <code>readtable</code>.
</p>
<p>The format of the readtable is not yet documented herein.
</p>
<dl>
<dt><a name="index-readtable"></a>Variable: <strong>readtable</strong></dt>
<dd><p>The value of <code>readtable</code> is the current readtable.
</p></dd></dl>

<dl>
<dt><a name="index-tyi"></a>Function: <strong>tyi</strong> <em>&amp;optional stream eof-option</em></dt>
<dd><p><code>tyi</code> inputs one character from <i>stream</i> and returns it.
The arguments are the same as for <code>read</code>, except that <i>eof-option</i>
may not be <code>nil</code>; it instead defaults to <code>-1</code> for &quot;Maclisp compatibility&quot;.
</p></dd></dl>

<dl>
<dt><a name="index-readline"></a>Function: <strong>readline</strong> <em>&amp;optional stream eof-option</em></dt>
<dd><p><code>readline</code> reads in a line of text, terminated by a newline.
It returns the line as a character string, <i>without</i> the newline character.
This function is usually used to get a line of input from the user.
The arguments are the same as for <code>read</code>.
</p></dd></dl>

<dl>
<dt><a name="index-readch"></a>Function: <strong>readch</strong> <em>&amp;optional stream eof-option</em></dt>
<dd><p><code>readch</code> is just like <code>tyi</code>, except that instead of returning
a fixnum character, it returns a symbol whose print name is the character
read in.
</p>
<a name="index-character-object"></a>
<p>This is just like a Maclisp &quot;character object&quot;.  The symbol
is interned, on the <code>user</code> package.
The arguments are the same as for <code>read</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tyipeek"></a>Function: <strong>tyipeek</strong> <em>&amp;optional peek-type stream eof-option</em></dt>
<dd><p>What <code>tyipeek</code> does depends on the <i>peek-type</i>, which
defaults to <code>nil</code>.  With a <i>peek-type</i> of <code>nil</code>,
<code>tyipeek</code> returns the next character to be read from
<i>stream</i>, without actually removing it from the input stream.
The next time input is done from <i>stream</i> the character will still
be there; in general, <code>(= (tyipeek) (tyi))</code> is <code>t</code>.
</p>
<p>If <i>peek-type</i> is a fixnum less than 1000 octal, then <code>tyipeek</code>
reads characters from <i>stream</i> until it gets one equal to <i>peek-type</i>.
That character is not removed from the input stream.
</p>
<p>If <i>peek-type</i> is <code>t</code>, then <code>tyipeek</code> skips over input characters
until the start of the printed representation of a Lisp object is reached.
As above, the last character (the one that starts an object)
is not removed from the input stream.
</p>
<p>The form of <code>tyipeek</code> supported by Maclisp in which <i>peek-type</i>
is a fixnum not less than 1000 octal is not supported, since the readtable
formats of the Maclisp reader and the Lisp Machine reader are quite different.
</p>
<p>The <i>stream</i> and <i>eof-option</i> arguments are the same as for <code>read</code>.
</p></dd></dl>

<p>Note that all of these functions will echo their input if used on an
interactive stream (one which supports the <code>:rubout-handler</code>
operation; see below.)  The functions that input more than one
character at a time (<code>read</code>, <code>readline</code>) allow the input to be
edited using rubout.  <code>tyipeek</code> echoes all of the characters that
were skipped over if <code>tyi</code> would have echoed them; the character not
removed from the stream is not echoed either.
</p>
<dl>
<dt><a name="index-readlist"></a>Function: <strong>readlist</strong> <em>char-list</em></dt>
<dd><p><i>char-list</i> is a list of characters.  The characters may
be represented by anything that the function <code>character</code> accepts:
fixnums, strings, or symbols.  The characters are given successively
to the reader, and the Lisp object built by the reader is returned.
Macro characters and so on will all take effect.
</p></dd></dl>

<dl>
<dt><a name="index-read_002dfrom_002dstring"></a>Function: <strong>read-from-string</strong> <em>string &amp;optional eof-option (idx 0)</em></dt>
<dd><p>The characters of <i>string</i> are given successively
to the reader, and the Lisp object built by the reader is returned.
Macro characters and so on will all take effect.
</p>
<p><i>eof-option</i> is what to return if the end of the string is reached,
as with other reading functions.  <i>idx</i> is the index in the string
of the first character to be read.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(read-from-string &quot;(a b c)&quot;) =&gt; (a b c)
</pre></div>
</dd></dl>

<a name="Output-Functions"></a>
<h3 class="section">18.4 Output Functions</h3>

<dl>
<dt><a name="index-prin1"></a>Function: <strong>prin1</strong> <em>x &amp;optional stream</em></dt>
<dd><p><code>prin1</code> outputs the printed representation of <i>x</i> to
<i>stream</i>, with slashification (see (slashification)).
<i>stream</i> defaults to the value of <code>standard-output</code>.
If <i>stream</i> is <code>nil</code>, the value of <code>standard-output</code>
is used.  If it is <code>t</code>, the value of <code>terminal-io</code> is used.
If it is a list of streams, then the output is performed to all
of the streams (this is not implemented yet).
</p></dd></dl>

<dl>
<dt><a name="index-prin1_002dthen_002dspace"></a>Function: <strong>prin1-then-space</strong> <em>x &amp;optional stream</em></dt>
<dd><p><code>prin1-then-space</code> is like <code>prin1</code> except that output
is followed by a space.
</p></dd></dl>

<dl>
<dt><a name="index-print"></a>Function: <strong>print</strong> <em>x &amp;optional stream</em></dt>
<dd><p><code>print</code> is just like <code>prin1</code> except that output
is preceeded by a newline and followed by a space.
</p></dd></dl>

<dl>
<dt><a name="index-princ"></a>Function: <strong>princ</strong> <em>x &amp;optional stream</em></dt>
<dd><p><code>princ</code> is just like <code>prin1</code> except that the
output is not slashified.
</p></dd></dl>

<dl>
<dt><a name="index-tyo"></a>Function: <strong>tyo</strong> <em>char &amp;optional stream</em></dt>
<dd><p><code>tyo</code> outputs the character <i>char</i> to <i>stream</i>.
The <i>stream</i> argument is the same as for <code>prin1</code>.
</p></dd></dl>

<dl>
<dt><a name="index-terpri"></a>Function: <strong>terpri</strong> <em>&amp;optional stream</em></dt>
<dd><p><code>terpri</code> outputs a newline character to <code>stream</code>.
The <i>stream</i> argument is the same as for <code>prin1</code>.
</p></dd></dl>

<p>The <code>format</code> function (see (format-fun)) is very useful for producing
nicely formatted text.  It can do anything any of the above functions
can do, and it makes it easy to produce good looking messages and such.
</p>
<p>The <code>grindef</code> function is useful for formatting Lisp programs.
See (grindef-fun).
</p>
<dl>
<dt><a name="index-cursorpos"></a>Function: <strong>cursorpos</strong> <em>&amp;optional arg1 arg2</em></dt>
<dd><p>This function exists primarily for Maclisp compatibility.  Usually
it is preferable to call the TV routines directly.  <code>cursorpos</code>
only operates on <code>console-io-pc-ppr</code> and does not work if
a different font than the default is being used.  The Maclisp Newio
feature where one of the arguments to <code>cursorpos</code> can be a file
is not supported.
</p>
<p><code>(cursorpos)</code> =&gt; <code>(<i>line . column</i>)</code>, the current
cursor position.
</p>
<p><code>(cursorpos <i>line column</i>)</code> moves the cursor to that position.
It returns <code>t</code> if it succeeds and <code>nil</code> if it doesn&rsquo;t.
</p>
<p><code>(cursorpos <i>op</i>)</code> performs a special operation coded by <i>op</i>,
and returns <code>t</code> if it succeeds and <code>nil</code> if it doesn&rsquo;t.
<i>op</i> is tested by string comparison, it is not a keyword.
</p>
<dl compact="compact">
<dt><code>F</code></dt>
<dd><p>Moves one space to the right.
</p></dd>
<dt><code>B</code></dt>
<dd><p>Moves one space to the left.
</p></dd>
<dt><code>D</code></dt>
<dd><p>Moves one line down.
</p></dd>
<dt><code>U</code></dt>
<dd><p>Moves one line up.
</p></dd>
<dt><code>C</code></dt>
<dd><p>Clears the piece of paper.
</p></dd>
<dt><code>T</code></dt>
<dd><p>Homes up (moves to the top left corner).
</p></dd>
<dt><code>E</code></dt>
<dd><p>Clear from the cursor to the end of the piece of paper.
</p></dd>
<dt><code>L</code></dt>
<dd><p>Clear from the cursor to the end of the line.
</p></dd>
<dt><code>K</code></dt>
<dd><p>Clear the character position at the cursor.
</p></dd>
<dt><code>X</code></dt>
<dd><p>B then K.
</p></dd>
<dt><code>Z</code></dt>
<dd><p>Home down (moves to the bottom left corner).
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-exploden"></a>Function: <strong>exploden</strong> <em>x</em></dt>
<dd><p><code>exploden</code> returns a list of characters (as fixnums) which
are the characters that would be typed out by <code>(princ <i>x</i>)</code>
(i.e. the unslashified printed representation of <i>x</i>).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(exploden '(+ /12 3)) =&gt; (50 53 40 61 62 40 63 51)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-explodec"></a>Function: <strong>explodec</strong> <em>x</em></dt>
<dd><p><code>explodec</code> returns a list of characters represented by character
objects which are the characters that would be typed out by
<code>(princ <i>x</i>)</code> (i.e. the unslashified printed representation of <i>x</i>).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(explodec '(+ /12 3)) =&gt; ( /( + /  /1 /2 /  /3 /) )
</pre></div>

<p>(Note that there are slashified spaces in the above list.)
</p></dd></dl>

<dl>
<dt><a name="index-explode"></a>Function: <strong>explode</strong> <em>x</em></dt>
<dd><p><code>explode</code> returns a list of characters represented by character
objects which are the characters that would be typed out by
<code>(prin1 <i>x</i>)</code> (i.e. the slashified printed representation of <i>x</i>).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(explode '(+ /12 3)) =&gt; ( /( + /  // /1 /2 /  /3 /) )
</pre></div>

<p>(Note that there are slashified spaces in the above list.)
</p></dd></dl>

<dl>
<dt><a name="index-flatsize"></a>Function: <strong>flatsize</strong> <em>x</em></dt>
<dd><p><code>flatsize</code> returns the number of characters in the slashified printed representation
of <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-flatc"></a>Function: <strong>flatc</strong> <em>x</em></dt>
<dd><p><code>flatc</code> returns the number of characters in the unslashified printed representation
of <i>x</i>.
</p></dd></dl>

<dl>
<dt><a name="index-stream_002dcopy_002duntil_002deof"></a>Function: <strong>stream-copy-until-eof</strong> <em>from-stream to-stream &amp;optional leader-size</em></dt>
<dd><p><code>stream-copy-until-eof</code> inputs characters from <i>from-stream</i>
and outputs them to <i>to-stream</i>, until it reaches the end-of-file
on the <i>from-stream</i>.  For example, if <code>x</code> is bound to a stream
for a file opened for input, then <code>(stream-copy-until-eof x terminal-io)</code>
will print the file on the console.
</p>
<p>If <i>from-stream</i> supports the <code>:line-in</code> operation and <i>to-stream</i>
supports the <code>:line-out</code> operation, then <code>stream-copy-until-eof</code> will
use those operations instead of <code>:tyi</code> and <code>:tyo</code>, for greater
efficiency.  <i>leader-size</i>  will be passed as the argument to the
<code>:line-out</code> operation.
</p></dd></dl>

<a name="I_002fO-Streams"></a>
<h3 class="section">18.5 I/O Streams</h3>

<a name="What-Streams-Are"></a>
<h4 class="subsection">18.5.1 What Streams Are</h4>

<p>Many programs accept input characters and produce output characters.
The method for performing input and output to one device is very different
from the method for some other device.  We would like our programs to be able
to use any device available, but without each program having to know about
each device.
</p>
<p>In order to solve this problem, we introduce the concept of
a <i>stream</i>.  A stream is a source and/or sink of characters.
A set of <i>operations</i> is available with every stream; operations include
things like &quot;output a character&quot; and &quot;input a character&quot;.  The way to perform
an operation to a stream is the same for all streams, although what happens
inside the stream is very different depending on what kind of a stream it is.
So all a program has to know is how to deal with streams.
</p>
<p>A stream is a functional object; that is, it is something that
you can apply to arguments.  The first argument given to a stream is a
symbol which is the name of the operation you wish to perform.  The
rest of the arguments depend on what operation you are doing.
</p>
<p>Some streams can only do input, some can only do output, and some can
do both.  Some operations are only supported by some streams.  Also,
there are some operations which the stream may not support by itself,
but will work anyway, albeit slowly, because the &quot;stream default handler&quot; can handle
them.  If you have a stream, there is an operation called
<code>:which-operations</code> that will return a list of the names of all of
the operations that are supported &quot;natively&quot; by the stream.  <i>All</i>
streams support <code>:which-operations</code>, and so it isn&rsquo;t in the list
itself.
</p>
<a name="General-Purpose-Stream-Operations"></a>
<h4 class="subsection">18.5.2 General Purpose Stream Operations</h4>

<p>Here are some simple operations.  Listed are the name of the
operation, what arguments it takes, and what it does.
</p>
<dl compact="compact">
<dt><code>:tyo</code></dt>
<dd><p>Takes one argument, which is a character.  The stream will output
that character.  For example, if <code>s</code> is bound to a stream, then the form
</p>
<div class="lisp">
<pre class="lisp">(funcall s ':tyo 102)
</pre></div>

<p>will output a &quot;B&quot; to the stream.
</p></dd>
<dt><code>:tyi</code></dt>
<dd><p>Takes one optional argument, described later.  The stream will
input one character and return it.  For example, if the next character
to be read in by the stream is a &quot;C&quot;, then the form
</p>
<div class="lisp">
<pre class="lisp">(funcall s ':tyi)
</pre></div>

<p>will return 103.  Note that the <code>:tyi</code> operation will not
&quot;echo&quot; the character in any fashion; it just does the input.  The
<code>tyi</code> function (see (tyi-fun)) will do echoing
when reading from the terminal.  The argument to the <code>:tyi</code>
operation tells the stream what to do if it gets to the end of the
file.  If the argument is not provided or is <code>nil</code>, the stream will
return <code>nil</code> at the end of file.  Otherwise it will signal an error,
and print out the argument as the error message.
</p></dd>
<dt><code>:untyi</code></dt>
<dd><p>Takes one argument, which is a character.  The stream will
remember that character, and the next time a character is input, it
will return the saved character.  In other words, <code>:untyi</code> means
&quot;stuff this character back into the input source&quot;.  For example,
</p>
<div class="lisp">
<pre class="lisp">(funcall s ':untyi 120)
(funcall s ':tyi) ==&gt; 120
</pre></div>

<p>This operation is used by <code>read</code>, and any stream which supports <code>:tyi</code>
must support <code>:untyi</code> as well.  Note that you are only allowed to <code>:untyi</code>
one character before doing a <code>:tyi</code>, and you aren&rsquo;t allowed to <code>:untyi</code> a different
character than the last character you read from the stream.  Some streams implement
<code>:untyi</code> by saving the character, while others implement it by backing up
the pointer to a buffer.
</p></dd>
<dt><code>:which-operations</code></dt>
<dd><p>Takes no arguments.  It returns a list of the operations
supported &quot;natively&quot; by the stream.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(funcall s ':which-operations)
   ==&gt; (:tyi :tyo :untyi :line-out :listen)
</pre></div>
</dd>
</dl>

<p>Any stream must either support <code>:tyo</code>, or support both
<code>:tyi</code> and <code>:untyi</code>.  There are several other, more advanced input
and output operations which will work on any stream that can do input
or output (respectively).  Some streams support these operations
themselves; you can tell by looking at the list returned by the
<code>:which-operations</code> operation.  Others will be handled by the &quot;stream
default handler&quot; even if the stream does not know about the operation
itself.  However, in order for the default handler to do one of the
more advanced output operations, the stream must support <code>:tyo</code>, and
for the input operations the stream must support <code>:tyi</code> (and
<code>:untyi</code>).
</p>
<p>Here is the list of such operations:
</p>
<dl compact="compact">
<dt><code>:listen</code></dt>
<dd><p>On an interactive device, the <code>:listen</code> operation returns non-<code>nil</code>
if there are any input characters immediately available, or <code>nil</code> if there
is no immediately available input.  On a non-interactive device, the
operation always returns <code>nil</code>, by virtue of the default handler.
The main purpose of
<code>:listen</code> is to test whether the user has hit a key, perhaps
trying to stop a program in progress.
</p></dd>
<dt><code>:fresh-line</code></dt>
<dd><p>An output operation which takes no arguments.  It tells
the stream that it should position itself at the beginning of a new line;
if the stream is already at the beginning of a fresh line it will do nothing,
otherwise it will output a newline.  For streams which don&rsquo;t support this,
the default handler will always output a newline.
</p></dd>
<dt><code>:string-out</code></dt>
<dd><p>An output operation which takes one required argument, a string to output.
The characters of the string are successively output to the stream.  This operation
is provided for two reasons; first, it saves the writing of a loop which is used
very often, and second, some streams can perform this operation much more
efficiently than the equivalent <code>:tyo</code> operations.  The <code>:string-out</code>
operation also takes two optional arguments, which are a range of characters
withing the string to output; the second argument is the index of the
first character to output
(defaulting to <code>0</code>),
and the third is one greater than the index of the last character to output
(defaulting to the length of the string).
Callers need not pass these arguments, but all streams that handle
<code>:string-out</code> must check for them and interpret them appropriately.
If the stream
doesn&rsquo;t support <code>:string-out</code> itself, the default hander will turn it
into a bunch of <code>:tyo</code>s.
</p></dd>
<dt><code>:line-out</code></dt>
<dd><p>An output operation which takes one argument, a string.
The characters of the string, followed by a newline character, are output
to the stream.  If the stream
doesn&rsquo;t support <code>:line-out</code> itself, the default hander will turn it
into a bunch of <code>:tyo</code>s.
</p></dd>
<dt><code>:line-in</code></dt>
<dd><p>An input operation which takes one argument.  The stream
should input one line from the input source, and return it as a string
with the newline character stripped off.  Many streams will have a string which
is used as a buffer for lines.  If this string itself is returned, there
would be problems caused if the caller of the stream attempted
to save the string away somewhere, because the contents of the string
would change when the next line was read in.  In order to solve this
problem, the string must be copied. On the other hand, some streams
don&rsquo;t reuse the string, and it would be wasteful to copy it on every
<code>:line-in</code> operation.  This problem is solved by using the argument
to <code>:line-in</code>.  If the argument is <code>nil</code>, the stream will not
bother to copy the string, and the caller should not rely on the contents
of that string after the next operation on the stream.  If the argument
is <code>t</code>, the stream will make a copy.  If the argument is a fixnum, <i>n</i>,
then the stream will make a copy with an array leader <i>n</i> elements
long.  (This is used by the editor, which represents lines of buffers
as strings with additional information in their array-leaders, to
eliminate an extra copy operation.)
If the stream reaches the end-of-file while reading in characters,
it will return the characters it has read in as a string, and return
a second value of <code>t</code>.  The caller of the stream should therefore
arrange to receive the second value, and check it to see whether the string
returned was a whole line or just the trailing characters after the last newline
in the input source.
</p></dd>
<dt><code>:clear-input</code></dt>
<dd><p>Takes no arguments.  The stream will clear any buffered
input.  If the stream does not handle this, the default handler
will ignore it.
</p></dd>
<dt><code>:clear-output</code></dt>
<dd><p>Takes no arguments.  The stream will clear any buffered
output.  If the stream does not handle this, the default handler
will ignore it.
</p></dd>
<dt><code>:finish</code></dt>
<dd><p>Takes no arguments.  It returns when the currently pending
I/O operation is completed.  It does not do anything itself; it is just used
to await completion of an operation.  If the stream does not handle this,
the default handler will ignore it.
</p></dd>
<dt><code>:force-output</code></dt>
<dd><p>Takes no arguments.  It causes any buffered output
to be sent to the device.  If the stream does not handle this,
the default handler will ignore it.
</p></dd>
<dt><code>:close</code></dt>
<dd><p>This takes an optional argument, which you usually don&rsquo;t supply.
The stream is &quot;closed&quot;, and no
further operations should be performed on it.  However, it is all right
to <code>:close</code> a closed stream.  If the stream does not handle <code>:close</code>, the
default handler will ignore it.
</p>
<p>With an argument of <code>:abort</code>, we are abnormally exiting from the use of this stream.
If the stream is outputting to a file, and has not been closed already, the
stream&rsquo;s newly-created file will be deleted; it will be as if it was never
opened in the first place.
</p>
</dd>
<dt><code>:tyi-no-hang</code></dt>
<dd><p>Just like <code>:tyi</code> except that if it would be neccesary to wait in order to get
the character, returns <code>nil</code> instead.  This lets the caller efficiently
check for input being available and get the input if there is any.
</p></dd>
</dl>

<a name="Special-Purpose-Stream-Operations"></a>
<h4 class="subsection">18.5.3 Special Purpose Stream Operations</h4>

<p>There are several other defined operations which the default
handler cannot deal with; if the stream does not support the operation itself,
then an attempt to use it will signal an error.  These are:
</p>
<dl compact="compact">
<dt><code>:read-pointer</code></dt>
<dd><p>This is supported by the file stream (see (file-stream)).
It takes no arguments, and returns the position that the stream is up to in the file,
as a number of characters.
</p></dd>
<dt><code>:name</code></dt>
<dd><p>This is supported by the file stream.  It returns the name of the file
open on the stream, as a string.
</p></dd>
<dt><code>:rubout-handler</code></dt>
<dd><p>This is supported by interactive streams such as the <code>tv-terminal-stream</code>, and is described
in its own section below (see (rubout-handler)).
</p></dd>
<dt><code>:untyo-mark</code></dt>
<dd><p>This is used by <code>grind</code> if the output stream supports it.
It takes no arguments.  The stream
should return some object which indicates where output has gotten up to in
the stream.
</p></dd>
<dt><code>:untyo</code></dt>
<dd><p>This is used by <code>grind</code> in conjunction with <code>:untyo-mark</code>.
It takes one argument, which is something returned by the <code>:untyo-mark</code>
operation of the stream.  The stream should back up output to the point
at which the object was returned.
</p></dd>
<dt><code>:read-cursorpos</code></dt>
<dd><p>This operation is supported by piece-of-paper streams (see <code>tv-make-stream</code>,
(tv-make-stream-fun)).  It returns two values: the current <i>x</i> and <i>y</i> positions
of the cursor.  It takes one argument, which is a symbol indicating
in what units <i>x</i> and <i>y</i> should be; the symbols <code>:pixel</code>
and <code>:character</code> are understood.  This operation, and <code>:set-cursorpos</code>,
are used by the <code>format</code> <code>&quot;~T&quot;</code> request (see (format-t-operation)),
which is why <code>&quot;~T&quot;</code>
doesn&rsquo;t work on all streams.  Any stream that supports this operation must
support <code>:set-cursorpos</code> as well.
</p></dd>
<dt><code>:set-cursorpos</code></dt>
<dd><p>This operation is supported by the same streams that support
<code>:read-cursorpos</code>.  It sets the position of the cursor.  It takes
three arguments: a symbol indicating the units (just like
<code>:read-cursorpos</code>), the new <i>x</i> position, and the new <i>y</i>
position.
</p></dd>
<dt><code>:pc-ppr</code></dt>
<dd><p>Takes no arguments.  Returns the <i>piece of paper</i> on which the stream
displays.  Non-TV streams don&rsquo;t support this operation.
</p></dd>
<dt><code>:clear-screen</code></dt>
<dd><p>Takes no arguments.  Erases the screen area on which this stream displays.
Non-TV streams don&rsquo;t support this operation.
</p></dd>
</dl>

<a name="Standard-Streams"></a>
<h4 class="subsection">18.5.4 Standard Streams</h4>

<p>There are several variables whose values are streams used by many
functions in the Lisp system.  These variables and their uses are listed here.
By convention, variables which are expected to hold a stream capable of input
have names ending with <code>-input</code>, and similarly for output.  Those expected
to hold a bidirectional stream have names ending with <code>-io</code>.
</p>
<dl>
<dt><a name="index-standard_002dinput"></a>Variable: <strong>standard-input</strong></dt>
<dd><p>In the normal Lisp top-level loop, input is read from
<code>standard-input</code> (that is, whatever stream is the value of
<code>standard-input</code>).  Many input functions, including <code>tyi</code> and
<code>read</code>, take a stream argument which defaults to <code>standard-input</code>.
</p></dd></dl>

<dl>
<dt><a name="index-standard_002doutput"></a>Variable: <strong>standard-output</strong></dt>
<dd><p>In the normal Lisp top-level loop, output is sent to
<code>standard-output</code> (that is, whatever stream is the value of
<code>standard-output</code>).  Many output functions, including <code>tyo</code> and
<code>print</code>, take a stream argument which defaults to <code>standard-output</code>.
</p></dd></dl>

<dl>
<dt><a name="index-error_002doutput"></a>Variable: <strong>error-output</strong></dt>
<dd><p>The value of <code>error-output</code> is a stream to which error messages
should be sent.  Normally this is the same as <code>standard-output</code>,
but <code>standard-output</code> might be bound to a file and <code>error-output</code>
left going to the terminal.
[This seems not be used by things which ought to use it.]
</p></dd></dl>

<dl>
<dt><a name="index-query_002dio"></a>Variable: <strong>query-io</strong></dt>
<dd><p>The value of <code>query-io</code> is a stream which should be used when
asking questions of the user.  The question should be output to this
stream, and the answer read from it.  The reason for this is that when
the normal input to a program may be coming from a file, questions such
as &quot;Do you really want to delete all of the files in your directory??&quot; should
be sent elsewhere (usually directly to the user).
[This seems not be used by things which ought to use it.]
</p></dd></dl>

<dl>
<dt><a name="index-terminal_002dio"></a>Variable: <strong>terminal-io</strong></dt>
<dd><p>The value of <code>terminal-io</code> is always the stream which connects to the user&rsquo;s
console.  For someone using the Lisp Machine from its keyboard and TV, the value
will be <code>tv-terminal-stream</code>.  The default values of the above four variables
are streams which simply take whatever operations they are given and pass them
on to whatever stream is the value of <code>terminal-io</code>.  No user program
should ever change the value of <code>terminal-io</code>.  A program which wants
(for example) to divert output to a file should do so by binding the value
of <code>standard-output</code>; that way error messages sent to <code>error-output</code>
can still get to the user by going through <code>terminal-io</code>, which is usually
what is desired.
</p></dd></dl>

<dl>
<dt><a name="index-make_002dsyn_002dstream"></a>Function: <strong>make-syn-stream</strong> <em>symbol</em></dt>
<dd><p><code>make-syn-stream</code> creates and returns a &quot;synonym stream&quot;.  Any operations
sent to this stream will be redirected to the stream
which is the value of <i>symbol</i>.
</p>
<p><code>standard-input</code>, <code>standard-output</code>, <code>error-output</code>, and
<code>query-io</code> are initially bound to synonym streams which
use the value of <code>terminal-io</code>.
</p></dd></dl>

<a name="Making-Your-Own-Stream"></a>
<h4 class="subsection">18.5.5 Making Your Own Stream</h4>


<p>Here is a sample output stream, which accepts characters and conses
them onto a list.
</p>
<div class="lisp">
<pre class="lisp">(defun list-output-stream (op &amp;optional arg1 &amp;rest rest)
    (selectq op
        (:tyo
         (setq the-list (cons arg1 the-list)))
        (:which-operations '(:tyo))
        (otherwise
         (multiple-value-call
          (stream-default-handler (function list-output-stream)
                                  op arg1 rest)))))
</pre></div>

<p>The lambda-list for a stream must always have one required parameter (<code>op</code>),
one optional parameter (<code>arg1</code>), and a rest parameter (<code>rest</code>).
This allows an arbitrary number of arguments to be passed to the
default handler.
This is an output stream, and so it supports the <code>:tyo</code> operation.
Note that all streams must support <code>:which-operations</code>.
If the operation is not one that the stream understands (e.g. <code>:string-out</code>),
it calls the <code>stream-default-handler</code>.  The calling of the default handler
is <i>required</i>, since the willingness to accept <code>:tyo</code> indicates to the caller
that <code>:string-out</code> will work.  The <code>multiple-value-call</code>
(see (multiple-value-call-fun)) is used so that if the default
handler returns multiple values, the stream will return all of them.
</p>
<p>Here is a typical input stream, which generates successive characters
of a list.
</p>
<div class="lisp">
<pre class="lisp">(defun list-input-stream (op &amp;optional arg1 &amp;rest rest)
  (selectq op
    (:tyi
     (cond ((not (null untyied-char))
            (prog1 untyied-char (setq untyied-char nil)))
           ((null the-list)
            (or arg1
                (ferror nil &quot;You got to the end of the stream.&quot;)))
           (t (prog1 (car the-list)
                     (setq the-list (cdr the-list))))))
    (:untyi
     (setq untyied-char arg1))
    (:which-operations '(:tyi :untyi))
    (otherwise
     (multiple-value-call
      (stream-default-handler (function list-input-stream)
                              op arg1 rest)))))
</pre></div>

<p>The important things to note are that <code>:untyi</code> must be supported,
and that the stream must check for having reached the end of the information,
and do the right thing with the argument to the <code>:tyi</code> operation.
</p>
<p>The above stream uses a free variable (<code>the-list</code>) to hold
the list of characters, and another one (<code>untyied-char</code>) to hold
the <code>:untyi</code>ed character (if any).
You might want to have several instances of this type of
stream, without their interfering with one another.  This is a typical
example of the usefulness of closures in defining streams.  The following
function will take a list, and return a stream which generates successive
characters of that list.
</p>
<div class="lisp">
<pre class="lisp">(defun make-a-list-input-stream (list)
   (let-closed ((list list) (untyied-char nil))
       (function list-input-stream)))
</pre></div>

<dl>
<dt><a name="index-stream_002ddefault_002dhandler"></a>Function: <strong>stream-default-handler</strong> <em>stream op arg1 rest</em></dt>
<dd><p><code>stream-default-handler</code> tries to handle
the <i>op</i> operation on <i>stream</i>, given arguments
of <i>arg1</i> and the elements of <i>rest</i>.  The exact action
taken for each of the defined operations is explained with
the documentation on that operation, above.:
</p></dd></dl>

<a name="Accessing-Files"></a>
<h3 class="section">18.6 Accessing Files</h3>

<p>As of this writing, the Lisp Machine uses the A.I. PDP-10&rsquo;s
file system to read and write files.  The A.I. machine is accessed
through the Chaos network.  When the Lisp Machine is started, it will
tell you whether it has successfully connected to the file system.  The
function <code>si:file-use-chaos</code> (not documented in this manual) allows
you to initiate a connection to the file system server, and to control
which machine is used as a file system.
</p>
<p>At present, there may be no more than one file open for reading
and one file open for writing at a time.
</p>
<p>All of the functions herein are subject to change, and in general
you shouldn&rsquo;t belive too much of this.  However, it does describe the existing
software.
</p>
<dl>
<dt><a name="index-with_002dopen_002dfile"></a>Special Form: <strong>with-open-file</strong></dt>
<dd><p><code>(with-open-file (<i>s</i> <i>fn</i> <i>options</i>) <i>body1</i> <i>body2</i>...)</code>
[needs to be documented.  Discourage direct use of <code>open</code>.]
</p></dd></dl>

<dl>
<dt><a name="index-open"></a>Function: <strong>open</strong> <em>filename options</em></dt>
<dd><p>This is the function for accessing files.  It returns a stream which is
connected to the specified file.  Unlike Maclisp, the <code>open</code> function
only creates streams for <i>files</i>; other streams are created by other functions.
</p>
<p><i>filename</i> is the name of the file to be opened; it must be a string.
Currently, files are stored on ITS and <i>filename</i> must be an ITS file name.
If an ITS error (such as file not found) occurs when opening the file,
a Lisp error is signalled.
</p>
<p><i>options</i> is either a single symbol or a (possibly-null) list of symbols.
The following option symbols are recognized:
</p>
<dl compact="compact">
<dt><code>:in, :read</code></dt>
<dd><p>Select opening for input (the default).
</p></dd>
<dt><code>:out, :write, :print</code></dt>
<dd><p>Select opening for output; a new file is to be created.
</p></dd>
<dt><code>:fixnum</code></dt>
<dd><p>Select binary mode, otherwise character mode is
used.  Note that fixnum mode uses 16-bit binary words
and is not compatible with Maclisp fixnum mode which uses 36-bit words.
</p></dd>
<dt><code>:ascii</code></dt>
<dd><p>The opposite of :fixnum.  This is the default.
</p></dd>
<dt><code>:single, :block</code></dt>
<dd><p>Ignored for compatibility with Maclisp.
</p></dd>
</dl>

<p>For example, evaluating any of the forms
</p>
<div class="lisp">
<pre class="lisp">(open &quot;info;dir &gt;&quot; ':in)
(open &quot;INFO;DIR &gt;&quot; '(:read))
(open &quot;DIR &gt; INFO;&quot; ':read)
</pre></div>

<p>will open the file &quot;AI: INFO; DIR &gt;&quot;, and return an input stream which will
return successive characters of the file, and support the following operations:
<code>:tyi, :untyi, :clear,
:close, :name,</code> and <code>:line-in</code>.
When the caller is finished with the
stream, it should close the file by using the <code>:close</code> operation or
the <code>close</code> function.
</p>
<p>Opening a file output stream creates a new file with specified name
(calling it &quot;_LSPM_ OUTPUT&quot; until it has been successfully closed)
and returns a stream which supports the following operations:
<code>:tyo, :close, :finish, :read-pointer, :name, :line-out, <span class="roman">and</span> :string-out</code>.
</p></dd></dl>

<dl>
<dt><a name="index-close"></a>Function: <strong>close</strong> <em>stream</em></dt>
<dd><p>The <code>close</code> function simply performs the <code>:close</code> operation on <i>stream</i>.
</p></dd></dl>

<a name="Other-File-Operations"></a>
<h4 class="subsection">18.6.1 Other File Operations</h4>

<dl>
<dt><a name="index-file_002dcommand"></a>Function: <strong>file-command</strong> <em>&amp;rest strings</em></dt>
<dd><p>This concatenates all of the <i>strings</i> and sends the result
as a command to the PDP-10 FILE job.  It returns the string
which is the FILE program&rsquo;s response, except that if the response
was empty, it returns <code>nil</code>.  The returned string is special
and will be clobbered by the next file operation,
so you should copy it (with <code>string-append</code>, see (string-append-fun))
if you want to save it.
</p></dd></dl>

<dl>
<dt><a name="index-file_002dcommand_002dcareful"></a>Function: <strong>file-command-careful</strong> <em>&amp;rest strings</em></dt>
<dd><p>This is the same as <code>file-command</code>, but if the string returned
from the FILE program is not empty, it signals an error, using
that string as the error-message.
</p></dd></dl>

<dl>
<dt><a name="index-file_002derror"></a>Variable: <strong>file-error</strong></dt>
<dd><p>When an error such as &quot;File Not Found&quot; or &quot;No Such Directory&quot; occurs,
(i.e. errors due to the current state of the file system), then
instead of directly calling <code>error</code>, the file-access functions
apply the value of <code>file-error</code> to the arguments upon which <code>error</code> would
have been called.  In fact, the default binding of <code>file-error</code>
is to the symbol <code>error</code>.  However, this convention allows flexibility
in such programs as EINE, which may want to handle such errors
specially.
</p>
<p>This little feature is recognized as an inelegant kludge, which
will be repaired when the error system is more fully developed.
</p></dd></dl>

<dl>
<dt><a name="index-file_002derror_002dstatus"></a>Function: <strong>file-error-status</strong> <em>filename</em></dt>
<dd><p>This tries to open the file <i>filename</i>.  If it gets an
error, it returns the ITS error code, which will always
be a small positive fixnum; otherwise it returns <code>nil</code>.
In any case it leaves the file closed.
</p></dd></dl>

<dl>
<dt><a name="index-file_002dmapped_002dopen"></a>Function: <strong>file-mapped-open</strong> <em>filename &amp;optional (write-p <code>nil</code>)</em></dt>
<dd><p>Tells the pdp10 FILE program to map the specified file
into its address space for random access, searching, etc.
This is used in the present implementation of multi-sectioned files.
<code>file-mapped-open</code> returns a stream to read from the file
if <i>write-p</i> is <code>nil</code>, or write to it if <i>write-p</i> is <code>t</code>.
The stream will apply only to the subrange of the file set by
the latest <code>mapset</code> or <code>finddef</code> command given to the FILE job.
On reading, when you get to the end of the range, it is considered
the end-of-file.  Giving another <code>mapset</code> or <code>finddef</code> command will
make it start reading from a different range.  To skip
the rest of a range, do another <code>mapset</code> or <code>finddef</code>
and do a <code>:clear</code> operation on the stream.
To set the range with <code>mapset</code>, do <code>(file-command &quot;mapset <i>start</i> <i>size</i>&quot;)</code>
where <i>start</i> and <i>size</i> are numbers converted to decimal.
To set the range to <code>foo</code>&rsquo;s definition, do <code>(file-command &quot;finddef &quot; &quot;foo&quot;)</code>.
</p></dd></dl>

<dl>
<dt><a name="index-file_002dqfasl_002dp"></a>Function: <strong>file-qfasl-p</strong> <em>filename</em></dt>
<dd><p>If the file is a QFASL file, return <code>t</code>; otherwise return <code>nil</code>.
This works by checking the file itself, not the name; if opening
the file gives an ITS error, an error is signalled.
</p></dd></dl>

<dl>
<dt><a name="index-file_002dexists_002dp"></a>Function: <strong>file-exists-p</strong> <em>pathname</em></dt>
<dd><p>Returns <code>nil</code> if the file <i>pathname</i> does not exist.  If it
does exist, returns <code>:qfasl</code> if it is a QFASL file, and otherwise <code>t</code>.
</p></dd></dl>

<a name="File-Name-Manipulation"></a>
<h4 class="subsection">18.6.2 File Name Manipulation</h4>

<dl>
<dt><a name="index-file_002dexpand_002dpathname"></a>Function: <strong>file-expand-pathname</strong> <em>filename</em></dt>
<dd><p>This defaults the FN2 to &quot;&gt;&quot;, and any other unspecified components
from the current default filename. It then sets up the current default
filename to be the resulting filename, and returns it.  This will
always return the filename in a canonical form.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(file-expand-pathname &quot;lispm;foo&quot;) =&gt; &quot;AI: LISPM; FOO &gt;&quot;
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-file_002ddefault_002dfn2"></a>Function: <strong>file-default-fn2</strong> <em>filename fn2</em></dt>
<dd><p>If <i>filename</i> does not specify its FN2 component, this returns
a filename whose FN2 is <i>fn2</i>, and whose other components are from
<i>filename</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(file-default-fn2 &quot;lispm;foo&quot; &quot;bar&quot;) =&gt; &quot;AI: LISPM; FOO BAR&quot;
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-file_002dset_002dfn2"></a>Function: <strong>file-set-fn2</strong> <em>filename fn2</em></dt>
<dd><p>Returns a filename whose FN2 is <i>fn2</i>, and whose other components
are from <i>filename</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(file-set-fn2 &quot;lispm;foo &gt;&quot; &quot;qfasl&quot;) =&gt; &quot;AI: LISPM; FOO QFASL&quot;
</pre></div>
</dd></dl>

<a name="Rubout-Handling"></a>
<h3 class="section">18.7 Rubout Handling</h3>

<p>The rubout handler is a feature of all interactive streams, that is, streams
which connect to terminals.  Its purpose is to allow the user to edit
minor mistakes in typein.  At the same time, it is not supposed to
get in the way; input is to be seen by Lisp as soon as a syntactically complete
form has been typed.  The rubout handler also provides a few
commands to do things like clear the screen.
</p>
<p>The rubout handler will eventually provide the same editing commands
as the editor, but at this writing they have not yet been conjoined.
</p>
<p>The basic way that the rubout handler works is as follows.  When
an input function that reads an &quot;object&quot;, such as <code>read</code> or <code>readline</code>
but not <code>tyi</code>, is called to read from a stream which has <code>:rubout-handler</code>
in its <code>:which-operations</code> list, that function &quot;enters&quot; the rubout handler.
It then goes ahead <code>:tyi</code>&rsquo;ing characters from the stream.  Because control
is inside the rubout handler, the stream will echo these characters so the user
can see what he is typing.  (Normally echoing is considered to be a higher-level
function outside of the province of streams, but when the higher-level function
tells the stream to enter the rubout handler it is also handing it the responsibility
for echoing).  The rubout handler is also saving all these characters in a buffer,
for reasons disclosed in the following paragraph.
When the function, <code>read</code> or whatever, decides it has enough
input, it returns and control &quot;leaves&quot; the rubout handler.  That was the easy case.
</p>
<p>If the user types a rubout, a <code>*throw</code> is done, out of all recursive levels
of <code>read</code>, reader macros, and so forth, back to the point where the rubout
handler was entered.  Also the rubout is echoed by erasing from the screen
the character which was rubbed out.  Now the <code>read</code> is tried over again,
re-reading all the characters which had been typed and not rubbed out, not echoing
them this time.  When the saved characters have been exhausted, additional input is read
from the user in the usual fashion.
</p>
<p>The effect of this is a complete separation of the functions of rubout
handling and parsing, while at the same time mingling the execution of
these two functions in such a way that input is always &quot;activated&quot; at
just the right time.  It does mean that the parsing function (in the
usual case, <code>read</code> and all macro-character definitions) must be
prepared to be thrown through at any time and should not have
non-trivial side-effects.
</p>
<p>If an error occurs while inside the rubout handler, the error message is printed
and the buffered input is redisplayed.  The user can then type as he wishes;
the input will be reparsed from the beginning in the usual fashion
after he rubs out the characters which caused the error.
</p>
<p>The rubout handler also recognizes the special characters Clear, Form, and VT.
Form clears the screen and echoes back the buffered input.  Clear is like
hitting enough rubouts to flush all the buffered input.  VT is like Form
in that it echoes back the input, but it does not clear the screen.
</p>
<p>If a Control or Meta character is typed to the rubout handler, the rubout
handler beeps and ignores the character.  In the future control and meta
characters will be usable for editing the input.  Control-Z, however, is
usually intercepted by the <code>kbd-tyi-hook</code> and causes control to be thrown
to top-level.  Note that when not inside the rubout handler, Control and
Meta characters are passed through as input like ordinary characters.
</p>
<p>The way that the rubout handler is entered is complicated, since a
<code>*catch</code> must be established.  The variable <code>si:rubout-handler</code> is
non-<code>nil</code> if the current process is inside the rubout handler.  This is
used to handle recursive calls to <code>read</code> from inside reader macros and the
like.  If <code>si:rubout-handler</code> is <code>nil</code>, and the stream being read from
has <code>:rubout-handler</code> in its <code>:which-operations</code>, functions such as
<code>read</code> send the <code>:rubout-handler</code> operation to the stream with arguments
of a list of options, the function, and its arguments.  The rubout handler
initializes itself and establishes its <code>*catch</code>, then calls back to the
specified function.  If you look at the code in <code>read</code>, you will see some
magic hair which is used to make sure that multiple values pass back through
all this correctly.  This will eventually become unnecessary.
</p><dl>
<dt><a name="index-si_003arubout_002dhandler"></a>Variable: <strong>si:rubout-handler</strong></dt>
<dd><p><code>t</code> if control is inside the rubout handler in this process.
</p></dd></dl>

<p>Each option in the list of options given as the first argument to the <code>:rubout-handler</code>
stream operation consists of a list whose first element is one of the following
keywords and whose remaining elements are &quot;arguments&quot; to that keyword.
</p>
<dl compact="compact">
<dt><code>(:full-rubout <i>val</i>)</code></dt>
<dd><p>If the user rubs out all the characters he typed, then control will be returned
from the rubout handler immediately.  In the absence of this option, the rubout
handler would simply wait for more characters to be typed in.  Two values
are returned; the first is <code>nil</code> and the second is <i>val</i>.
</p></dd>
<dt><code>(:pass-through <i>char1</i> <i>char2</i>...)</code></dt>
<dd><p>The characters <i>char1</i>, <i>char2</i>, etc. are not to be treated as special
by the rubout handler.  You can use this to override the default processing
of characters such as Clear.
</p></dd>
<dt><code>(:prompt <i>function</i>)</code></dt>
<dt><code>(:reprompt <i>function</i>)</code></dt>
<dd><p>When it is time for the user to be prompted, <i>function</i> is called with
two arguments.  The first is a stream it may print on; the second is the
character which caused the need for prompting, e.g. <code>#\clear</code> or <code>#\form</code>, or <code>nil</code>
if the rubout handler was just entered.
</p>
<p>The difference between <code>:prompt</code> and <code>:reprompt</code> is that the latter does
not call the prompt function when the rubout handler is first entered.
</p></dd>
</dl>

<a name="Special-I_002fO-Devices"></a>
<h3 class="section">18.8 Special I/O Devices</h3>

<p>-&gt; pointers to separate chapter on TV, keyboard, and mouse.
</p>
<p>-&gt; pointer to separate chapter on Chaos net
</p>
<p>-&gt; how to use whatever else ought to go in here
</p>
<a name="Packages"></a>
<h2 class="chapter">19 Packages</h2>
<a name="index-package"></a>

<a name="The-Need-for-Multiple-Contexts"></a>
<h3 class="section">19.1 The Need for Multiple Contexts</h3>

<p>A Lisp program is a collection of function definitions.
The functions are known by their names, and so each must have its
own name to identify it.  Clearly a programmer must not use the same
name for two different functions.
</p>
<p>The Lisp machine consists of a huge Lisp environment, in which many
programs must coexist. All of the &quot;operating system&quot;, the compiler, the
EINE editor, and a wide variety of programs are provided in the initial
environment.  Furthermore, every program which the user uses during
his session must be loaded into the same environment.  Each of these
programs is composed of a group of functions; apparently each function
must have its own distinct name to avoid conflicts.  For example, if
the compiler had a function named <code>pull</code>, and the user loaded a program
which had its own function named <code>pull</code>, the compiler&rsquo;s <code>pull</code> would be
redefined, probably breaking the compiler.
</p>
<p>It would not really be possible to prevent these conflicts,
since the programs are written by many different people who could
never get together to hash out who gets the privilege of using
a specific name such as <code>pull</code>.
</p>
<p>Now, if we are to enable two programs to coexist in the Lisp
world, each with its own function <code>pull</code>, then each program must have
its own symbol named &quot;<code>pull</code>&quot;, because there can&rsquo;t be two function
definitions on the same symbol.  This means that separate &quot;name
spaces&quot;&ndash;mappings between names and symbols&ndash;must be provided for
them.  The package system is designed to do just that.
</p>
<p>Under the package system,  the author of a program or a group
of closely related programs identifies them together as a &quot;package&quot;.
The package system associates a distinct name space with each package.
</p>
<p>Here is an example: suppose there are two programs named <code>chaos</code>
and <code>arpa</code>, for handling the Chaos net and Arpanet respectively.  The
author of each program wants to have a function called <code>get-packet</code>,
which reads in a packet from the network (or something).  Also, each
wants to have a function called <code>allocate-pbuf</code>, which allocates the
packet buffer.  Each &quot;get&quot; routine first allocates a packer buffer,
and then reads bits into the buffer; therefore, each version of
<code>get-packet</code> should call the respective version of <code>allocate-pbuf</code>.
</p>
<p>Without the package system, the two programs could not coexist
in the same Lisp environment.  But the package feature can be used to
provide a separate name space for each program.  What is required is
to declare a package named <code>chaos</code> to contain the Chaos net program, and
another package <code>arpa</code> to hold the Arpanet program.  When the Chaos net
program is read into the machine, its symbols would be entered in the
<code>chaos</code> package&rsquo;s name space.  So when the Chaos net program&rsquo;s
<code>get-packet</code> referred to <code>allocate-pbuf</code>, the <code>allocate-pbuf</code> in the <code>chaos</code>
name space would be found, which would be the <code>allocate-pbuf</code> of the
Chaos net program&ndash;the right one.  Similarly, the Arpanet program&rsquo;s
<code>get-packet</code> would be read in using the <code>arpa</code> package&rsquo;s name space and
would refer to the Arpanet program&rsquo;s <code>allocate-pbuf</code>.
</p>
<p>An additional function of packages is to remember the names of
the files which constitute each program, making it easy to ask to load
or recompile all of them at once.
</p>
<p>To understand what is going on here, you should keep in mind
how Lisp reading and loading works.  When a file is gotten into the
Lisp machine, either by being read or by being fasloaded, the file itself
obviously cannot contain Lisp objects; it contains printed representations
of those objects.  When the reader encounters a printed representation of a symbol,
it calls <code>intern</code> to look up that string in some name space and find
a corresponding symbol to return.  The package system arranges that the correct
name space is used whenever a file is loaded.
</p>
<a name="The-Organization-of-Name-Spaces"></a>
<h3 class="section">19.2 The Organization of Name Spaces</h3>

<p>We could simply let every name space be implemented as one
obarray, e.g. one big table of symbols.  The problem with this is
that just about every name space wants to include the whole
Lisp language: <code>car</code>, <code>cdr</code>, and so on should be available to every
program.  We would like to share the main Lisp system between
several name spaces without making many copies.
</p>
<p>Instead of making each name space be one big array,
we arrange packages in a tree.  Each package has a
&quot;superpackage&quot; or &quot;parent&quot;, from which it &quot;inherits&quot; symbols.  Also,
each package has a table, or &quot;obarray&quot;, of its own additional
symbols.  The symbols belonging to a package are simply those in the
package&rsquo;s own obarray, followed by those belonging to the
superpackage.  The root of the tree of packages is the package called
<code>global</code>, which has no superpackage.  <code>global</code> contains <code>car</code> and <code>cdr</code> and
all the rest of the standard Lisp system.  In our example, we might
have two other obarrays called <code>chaos</code> and <code>arpa</code>, each of which would
have <code>global</code> as its parent.  Here is a picture of the resulting tree
structure:
</p>
<div class="lisp">
<pre class="lisp">                    global
                       |
          /----------------------------\
          |                            |
        chaos                         arpa
</pre></div>

<p>In order to make the sharing of the <code>global</code> package work, the
<code>intern</code> function is made more complicated than in basic Lisp.  In
addition to the string or symbol to intern, it must be told which
package to do it in.  First it searches for a symbol with the
specified name in the obarray of the specified package.  If nothing is
found there, <code>intern</code> looks at its superpackage, and then at the
superpackage&rsquo;s superpackage, and so on, until the name is found or a
root package such as <code>global</code> is reached.
When <code>intern</code> reaches the root package, and doesn&rsquo;t find the symbol there either,
it decides that there is no symbol known with that name, and adds a
symbol to the originally specified package.
</p>
<p>Since you don&rsquo;t normally want to worry about specifying
packages, <code>intern</code> normally uses the &quot;current&quot; package, which is the
value of the symbol <code>package</code>.  This symbol serves the purpose of the
symbol <code>obarray</code> in Maclisp.
</p>
<p>Here&rsquo;s how that works in the above example.  When the Chaos
net program is read into the Lisp world, the current package would be
the <code>chaos</code> package.  Thus all of the symbols in the Chaos net program
would be interned on the <code>chaos</code> package.  If there is a reference to
some well known global symbol such as <code>append</code>, <code>intern</code> would look for
&quot;<code>append</code>&quot; on the <code>chaos</code> package, not find it, look for &quot;<code>append</code>&quot; on
<code>global</code>, and find the regular Lisp <code>append</code> symbol, and return that.  If,
however, there is a reference to a symbol which the user made up
himself (say it is called <code>get-packet</code>), the first time he uses it,
<code>intern</code> won&rsquo;t find it on either <code>chaos</code> nor <code>global</code>.  So <code>intern</code> will make
a new symbol named <code>get-packet</code>, and install it on the <code>chaos</code> package.
When <code>get-packet</code> is refered to later in the Chaos net program, <code>intern</code>
will find <code>get-packet</code> on the <code>chaos</code> package.
</p>
<p>When the Arpanet program is read in, the current package would
be <code>arpa</code> instead of <code>chaos</code>.  When the ArpaNet program refers
to <code>append</code>, it gets the <code>global</code> one; that is, it shares the same one
that the Chaos net program got.  However, if it refers to <code>get-packet</code>,
it will <i>not</i> get the same one the Chaos net program got, because
the <code>chaos</code> package is not being searched.  Rather, the <code>arpa</code> and <code>global</code>
packages are getting searched.  So <code>intern</code> will create a new <code>get-packet</code>
and install it on the <code>arpa</code> package.
</p>
<p>So what has happened is that there are two <code>get-packet</code>s: one for
<code>chaos</code> and one for <code>arpa</code>.  The two programs are loaded together without name
conflicts.
</p>
<a name="Shared-Programs"></a>
<h3 class="section">19.3 Shared Programs</h3>

<p>Now, a very important feature of the Lisp machine is that of
&quot;shared programs&quot;; if one person writes a function to, say, print
numbers in Roman numerals, any other function can call it to print
Roman numerals.  This contrasts sharply with PDP-10 system programs,
in which Roman numerals have been independently reimplemented several
times (and the ITS filename parser several dozen times).
</p>
<p>For example, the routines to manipulate a robot arm might be a
separate program, residing in a package named <code>arm</code>.  If we
have a second program called <code>blocks</code> (the blocks world, of course)
which wanted to manipulate the arm, it would want to call functions
which are defined on the <code>arm</code> obarray, and therefore not in <code>blocks</code>&rsquo;s
own name space.  Without special provision, there would be no way for
any symbols not in the <code>blocks</code> name space to be part of any <code>blocks</code>
functions.
</p>
<p>The colon character (&quot;<code>:</code>&quot;) has a special meaning to the Lisp
reader.  When the reader sees a colon preceeded by the name of a package,
it will read in the next Lisp object with <code>package</code> bound to that package.
The way <code>blocks</code> would
call a function named <code>go-up</code> defined in <code>arm</code> would be by asking to call
<code>arm:go-up</code>, because <code>&quot;go-up</code> would be interned on the <code>arm</code> package.
What <code>arm:go-up</code> means precisely is &quot;The symbol named <code>go-up</code> in
the name space of the package <code>arm</code>.&quot;
</p>
<p>Similarly, if the <code>chaos</code> program wanted to refer to the <code>arpa</code>
program&rsquo;s <code>allocate-pbuf</code> function (for some reason), it would simply
call <code>arpa:allocate-pbuf</code>.
</p>
<p>An important question which should occur at this point is how
the names of packages are associated with their obarrays and other
data.  This is done by means of the &quot;refname-alist&quot; which each package
has.  This alist associates strings called <i>reference names</i> or <i>refnames</i>
with the packages they
name.  Normally, a package&rsquo;s refname-alist contains an entry for each
subpackage, associating the subpackage with its name.  In addition,
every package has its own name defined as a refname, referring to
itself.  However, the user can add any other refnames, associating
them with any packages he likes.  This is useful when multiple versions
of a program are loaded into different packages.  Of course, each
package inherits its superpackage&rsquo;s refnames just as it does symbols.
</p>
<p>In our example, since <code>arm</code> is a subpackage of <code>global</code>, the name
<code>arm</code> is on <code>global</code>&rsquo;s refname-alist, associated with the <code>arm</code> package.
Since <code>blocks</code> is also a subpackage of <code>global</code>, when <code>arm:go-up</code> is seen
the string &quot;<code>arm</code>&quot; is found on <code>global</code>&rsquo;s refname alist.
</p>
<p>When you want to refer to a symbol in a package which you and
your superpackages have no refnames for&ndash;say, a subpackage named <code>foo</code>
of a package named <code>bar</code> which is under <code>global</code>&ndash;you can use multiple
colons.  For example, the symbol <code>finish</code> in that package <code>foo</code> could be
referred to as <code>foo:bar:finish</code>.  What happens here is that the second
name, <code>bar</code>, is interpreted as a refname in the context of the package
<code>foo</code>.
</p>
<a name="Declaring-Packages"></a>
<h3 class="section">19.4 Declaring Packages</h3>
<a name="index-declaring-packages"></a>
<a name="index-package-declarations"></a>

<p>Before any package can be referred to or loaded, it must be declared.
This is done with the special form <code>package-declare</code>, which tells the package system
all sorts of things, including the name of the package, the place in the
package hierarchy for the new package to go, its estimated size, the
files which belong in it, and some of the symbols which belong in it.
</p>
<p>Here is a sample declaration:
</p>
<div class="lisp">
<pre class="lisp">(package-declare foo global 1000
       ((&quot;lispm;foo qfasl&quot;)
        (&quot;lispm;bar qfasl&quot;)
        (&quot;lispm;barmac &gt;&quot; defs))
       (shadow array-push adjust-array-size)
       (extern foo-entry))
</pre></div>

<p>What this declaration says is that a package named <code>foo</code> should be
created as an inferior of <code>global</code>, the package which contains advertised
global symbols.  Its obarray should initially be large enough to hold 1000
symbols, though it will grow automatically if that isn&rsquo;t enough.
Unless there is a specific reason to do otherwise, you should make all
of your packages direct inferiors of <code>global</code>.  The size you give is
increased slightly to be a good value for the hashing algorithm used.
</p>
<p>After the size comes the &quot;file-alist&quot;.  The files in the <code>foo</code> package
are &quot;lispm;foo&quot; and &quot;lispm;bar&quot;, both of which should be compiled, and
&quot;lispm;barmac&quot;, which should be read in as a text file.  In addition,
&quot;barmac&quot; is marked as a DEFS file, which means that the latest version of
&quot;barmac&quot; must always be loaded before attempting to compile or load any of
the other files.
Typically a DEFS file contains macro definitions, compiler declarations,
structure definitions, and the like.
All the source files should start with
</p>
<div class="lisp">
<pre class="lisp">(pkg-contained-in &quot;foo&quot;)
</pre></div>

<p>to help detect processing them in the wrong package.  Soon it will
automatically cause them to be processed in the right package, even if
copied under strange names.  (NOTE: <code>pkg-contained-in</code> IS NOT IMPLEMENTED YET!
DON&rsquo;T USE IT!)
</p>
<p>Finally, the <code>foo</code> package &quot;shadows&quot; <code>array-push</code> and <code>adjust-array-size</code>,
and &quot;externs&quot; <code>foo-entry</code>.  What shadowing means is that the <code>foo</code> package
should have its own versions of those symbols, rather than inheriting
its superpackage&rsquo;s versions.  Symbols by these names will be added to the <code>foo</code>
package even though there are symbols on <code>global</code> already with those names.
This allows the <code>foo</code> package to redefine
those functions for itself without redefining them in the <code>global</code>
package for everyone else.  What externing means is that the <code>foo</code>
package is allowed to redefine <code>foo-entry</code> as inherited from the <code>global</code>
package, so that it <i>is</i> redefined for everybody.  If <code>foo</code> attempts to
redefine a function such as <code>car</code> which is present in the <code>global</code> package
but neither shadowed nor externed, confirmation from the user will be
requested.
</p>
<p>Note that externing doesn&rsquo;t actually put any symbols into the <code>global</code>
package.  It just asserts permission to redefine symbols already there.
This is deliberate; the intent is to enable the maintainers of the
<code>global</code> package to keep control over what symbols are present in it.
Because inserting a new symbol into the <code>global</code> package can cause trouble
to unsuspecting programs which expect that symbol to be private, this is
not supposed to be done in a decentralized manner by programs written by
one user and used by another unsuspecting user.
Here is an example of the trouble that could be caused:
if there were two user programs, each with a function named <code>move-square</code>,
and <code>move-square</code> were put on the <code>global</code> package, all of a sudden
the two functions would share the same symbol, resulting in a name conflict.
While all the definitions of the functions in <code>global</code> are actually
supplied by subpackages which extern them (<code>global</code> contains no files of
its own), the list of symbol names is centralized in one place, the file
&quot;ai: lispm2; global &gt;&quot;, and this file is not changed without notifying everyone,
and updating the <code>global</code> documentation.
</p>
<p>Certain other things may be found in the declarations of various internal system
packages.  They are arcane and needed only to compensate for the fact
that parts of those packages are actually loaded before the package
system is.  They should not be needed by any user package.
</p>
<p>Your package declarations should go into separate files containing
only package declarations.  Group them however you like, one to a file
or all in one file.  Such files can be read with <code>load</code>.  It doesn&rsquo;t
matter what package you load them into, so use <code>user</code>, since that has to
be safe.
</p>
<p>If the declaration for a package is read in twice, no harm is done.
If you edit the size to replace it with a larger one, the package will
be expanded.  If you change the file-alist, the new one will replace the
old.  At the moment, however, there is no way to change the list of
shadowings or externals;  such changes will be ignored.  Also, you can&rsquo;t
change the superpackage.  If you edit the superpackage name and read the
declaration in again, you will create a new, distinct package without
changing the old one.
</p>
<dl>
<dt><a name="index-package_002ddeclare"></a>Macro: <strong>package-declare</strong></dt>
<dd><p>The <code>package-declare</code> macro is used to declare a package to the package
system.  Its form is:
</p>
<div class="lisp">
<pre class="lisp">(package-declare <i>name</i> <i>superpackage</i> <i>size</i> <i>file-alist</i> <i>option-1</i> <i>option-2</i> ...)
</pre></div>

<p>The interpretation of the declaration is complicated; see (declaring-packages).
</p></dd></dl>

<a name="Packages-and-Writing-Code"></a>
<h3 class="section">19.5 Packages and Writing Code</h3>

<p>The unsophisticated user need never be aware of the existence of
packages when writing his programs.  He should just load all of his
programs into the package <code>user</code>, which is also what console type-in is
interned in.  Since all the functions which users are likely to need are
provided in the <code>global</code> package, which is <code>user</code>&rsquo;s superpackage, they are
all available.  In this manual, functions which are not on the <code>global</code>
package are documented with colons in their names, so typing the name
the way it is documented will work.
</p>
<p>However, if you are writing a generally useful tool, you should
put it in some package other than <code>user</code>,
so that its internal functions will not conflict with
names other users use.  Whether for this reason or for any other, if you
are loading your programs into packages other than <code>user</code> there are
special constructs that you will need to know about.
</p>
<p>One time when you as the programmer must be aware of the existence of
packages is when you want to use a function or variable in another
package.  To do this, write the name of the package, a colon, and then
the name of the symbol, as in <code>eine:ed-get-defaulted-file-name</code>.  You will
notice that symbols in other packages print out that way, too.
Sometimes you may need to refer to a symbol in a package whose superior
is not <code>global</code>.  When this happens, use multiple colons, as in
<code>foo:bar:ugh</code>, to refer to the symbol <code>ugh</code> in the package named <code>bar</code> which
is under the package named <code>foo</code>.
</p>
<p>Another time that packages intrude is when you use a &quot;keyword&quot;: when
you check for <code>eq</code>ness against a constant symbol, or pass a constant
symbol to someone else who will check for it using <code>eq</code>.  This includes
using the symbol as either argument to <code>get</code>.  In such cases, the usual
convention is that the symbol should reside in the <code>user</code> package,
rather than in the package with which its meaning is associated.  To
make it easy to specify <code>user</code>, a colon before a symbol, as in <code>:select</code>,
is equivalent to specifying <code>user</code> by name, as in <code>user:select</code>.
Since the <code>user</code> package has no subpackages, putting symbols into it will not cause
name conflicts.
</p>
<p>Why is this convention used?  Well, consider the function
<code>tv-define-pc-ppr</code>, which takes any number of keyword arguments.
For example,
</p>
<div class="lisp">
<pre class="lisp">(tv-define-pc-ppr &quot;foo&quot; (list tvfont) 'vsp 6 'sideways-p t)
</pre></div>

<p>specifies, after the two peculiar mandatory arguments, two options with
names <code>vsp</code> and <code>sideways-p</code> and values <code>6</code> and <code>t</code>.  The file containing this
function&rsquo;s definition is in the <code>system-internals</code> package, but the
function is available to everyone without the use of a colon prefix
because the symbol <code>tv-define-pc-ppr</code> is itself inherited from <code>global</code>.
But all the keyword names, such as <code>vsp</code>, are short and should not have
to exist in <code>global</code>.  However, it would be a shame if all callers of
<code>tv-define-pc-ppr</code> had to specify <code>system-internals</code>: before the name of
each keyword.  After all, those callers can include programs loaded into
<code>user</code>, which should by rights not have to know about packages at all.
Putting those keywords in the <code>user</code> package solves this problem.
The correct way to type the above form would be
</p>
<div class="lisp">
<pre class="lisp">(tv-define-pc-ppr &quot;foo&quot; (list tvfont) ':vsp 6 ':sideways-p t)
</pre></div>

<p>Exactly when should a symbol go in <code>user</code>?  At least, all symbols
which the user needs to be able to pass as an argument to any function
in <code>global</code> must be in <code>user</code> if they aren&rsquo;t themselves in <code>global</code>.
Symbols used as keywords for arguments by any function should usually
be in <code>user</code>, to keep things consistent.  However, when a program uses a
specific property name to associate its own internal memoranda with
symbols passed in from outside, the property name should belong to the
program&rsquo;s package, so that two programs using the same property name
in that way don&rsquo;t conflict.
</p>
<a name="Shadowing"></a>
<h3 class="section">19.6 Shadowing</h3>

<p>Suppose the user doesn&rsquo;t like the system <code>nth</code> function;  he
might be a former <code>interlisp</code> user, and expecting a completely
different meaning from it.  Were he to say <code>(defun nth ---)</code> in his
program (call it <code>interloss</code>) he would clobber the <code>global</code> symbol
named &quot;<code>nth</code>&quot;, and so affect the &quot;<code>nth</code>&quot; in everyone else&rsquo;s name
space. (Actually, if he had not &quot;externed&quot; the symbol &quot;<code>nth</code>&quot;, the
redefinition would be caught and the user would be warned.)
</p>
<p>In order to allow the <code>interloss</code> package to have its own <code>(defun nth
---)</code> without interfering with the rest of the Lisp environment, it
must &quot;shadow&quot; out the global symbol &quot;<code>nth</code>&quot; by putting a new symbol
named &quot;<code>nth</code>&quot; on its own obarray.  Normally, this is done by writing
<code>(shadow nth)</code> in the declaration of the <code>interloss</code> package.  Since
<code>intern</code> looks on the subpackage&rsquo;s obarray before <code>global</code>, it will find
the programmer&rsquo;s own <code>nth</code>, and never the global one.  Since the global
one is now impossible to see, we say it has been &quot;shadowed.&quot;
</p>
<p>Having shadowed <code>nth</code>, if it is sometimes necessary to refer to the
global definition, this can be done by writing <code>global:nth</code>.  This works
because the refname <code>global</code> is defined in the <code>global</code> package as a name
for the <code>global</code> package.  Since <code>global</code> is the superpackage of the
<code>interloss</code> package, all refnames defined by <code>global</code>, including <code>&quot;global&quot;</code>,
are available in <code>interloss</code>.
</p>
<a name="Packages-and-Interning"></a>
<h3 class="section">19.7 Packages and Interning</h3>

<p>The function <code>intern</code> allows you to specify a package as the second
argument.  It can be specified either by giving the package object
itself, or by giving a string or symbol which is the name of the
package.  <code>intern</code> returns three values.  The first is the interned symbol.  The
second is <code>t</code> if the symbol is old (was already present, not just added to
the obarray).  The third is the package in which the symbol was actually
found.  This can be either the specified package or one of its
superiors.
</p>
<p>When you don&rsquo;t specify the second argument to <code>intern</code>, the current
package, which is the value of the symbol <code>package</code>, is used.  This
happens, in particular, when you call <code>read</code>.  Bind the symbol <code>package</code>
temporarily to the desired package, before calling things which call
<code>intern</code>, when you want to specify the package.  When you do this, the
function <code>pkg-find-package</code>, which converts a string into the package it
names, may be useful.  While most functions that use packages will do
this themselves, it is better to do it only once when <code>package</code> is bound.
The function <code>pkg-goto</code> sets <code>package</code> to a package specified by a string.
You shouldn&rsquo;t usually need to do this, but it can be useful to &quot;put
the keyboard inside&quot; a package when you are debugging.
</p>
<dl>
<dt><a name="index-package-1"></a>Variable: <strong>package</strong></dt>
<dd><p>The value of <code>package</code> is the current package; many functions which
take packages as optional arguments default to the value of <code>package</code>,
including <code>intern</code> and related functions.
</p></dd></dl>

<dl>
<dt><a name="index-pkg_002dgoto"></a>Function: <strong>pkg-goto</strong> <em>&amp;optional pkg</em></dt>
<dd><p><i>pkg</i> may be a package or the name of a package.
<i>pkg</i> is made the current package.  It defaults to the <code>user</code> package.
</p></dd></dl>

<dl>
<dt><a name="index-pkg_002dbind"></a>Macro: <strong>pkg-bind</strong></dt>
<dd><p>The form of the <code>pkg-bind</code> macro is <code>(pkg-bind <i>pkg</i> . <i>body</i>)</code>.
<i>pkg</i> may be a package or a package name.  The forms of the <i>body</i>
are evaluated sequentially with the variable <code>package</code> bound to <i>pkg</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(pkg-bind &quot;eine&quot;
          (read-from-string function-name))
</pre></div>
</dd></dl>

<p>There are actually four forms of the <code>intern</code> function:  regular <code>intern</code>,
<code>intern-soft</code>, <code>intern-local</code>, and <code>intern-local-soft</code>.  <code>-soft</code> means that the
symbol should not be added to the package if there isn&rsquo;t already one;
in that case, all three values are <code>nil</code>.  <code>-local</code> means that the
superpackages should not be searched.  Thus, <code>intern-local</code> can be used to
cause shadowing.  <code>intern-local-soft</code> is a good low-level primitive for
when you want complete control of what to search and when to add symbols.
All four forms of <code>intern</code> return the same three values, except that
the <code>soft</code> forms return <code>nil nil nil</code> when
the symbol isn&rsquo;t found.
</p>
<dl>
<dt><a name="index-intern-1"></a>Function: <strong>intern</strong> <em>string &amp;optional (pkg <code>package</code>)</em></dt>
<dd><p><code>intern</code> searches <i>pkg</i> and its superpackages sequentially, looking
for a symbol whose print-name is equal to <i>string</i>.  If it finds
such a symbol, it returns three values: the symbol, <code>t</code>, and the package
on which the symbol is interned.  If it does not find one, it
creates a new symbol with a print name of <i>string</i>, and
returns the new symbol, <code>nil</code>, and <i>pkg</i>.
</p></dd></dl>

<dl>
<dt><a name="index-intern_002dlocal"></a>Function: <strong>intern-local</strong> <em>string &amp;optional (pkg <code>package</code>)</em></dt>
<dd><p><code>intern</code> searches <i>pkg</i> (but <i>not</i> its superpackages), looking
for a symbol whose print-name is equal to <i>string</i>.  If it finds
such a symbol, it returns three values: the symbol, <code>t</code>, and <i>pkg</i>
If it does not find one, it
creates a new symbol with a print name of <i>string</i>, and
returns the new symbol, <code>nil</code>, and <i>pkg</i>.
</p></dd></dl>

<dl>
<dt><a name="index-intern_002dsoft"></a>Function: <strong>intern-soft</strong> <em>string &amp;optional (pkg <code>package</code>)</em></dt>
<dd><p><code>intern</code> searches <i>pkg</i> and its superpackages sequentially, looking
for a symbol whose print-name is equal to <i>string</i>.  If it finds
such a symbol, it returns three values: the symbol, <code>t</code>, and the package
on which the symbol is interned.  If it does not find one, it returns
<code>nil</code>, <code>nil</code>, and <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-intern_002dlocal_002dsoft"></a>Function: <strong>intern-local-soft</strong> <em>string &amp;optional (pkg <code>package</code>)</em></dt>
<dd><p><code>intern</code> searches <i>pkg</i> (but <i>not</i> its superpackages), looking
for a symbol whose print-name is equal to <i>string</i>.  If it finds
such a symbol, it returns three values: the symbol, <code>t</code>, and <i>pkg</i>
If it does not find one, it returns <code>nil</code>, <code>nil</code>, and <code>nil</code>.
</p></dd></dl>

<p>Each symbol remembers which package it belongs to.  While you can
intern a symbol in any number of packages, the symbol will only remmeber
one:  normally, the first one it was interned in, unless you clobber it.
This package is available as <code>(cdr (package-cell-location <i>symbol</i>))</code>.
If the value is <code>nil</code>, the symbol believes that it is uninterned.
</p>
<p>The printer also implicitly uses the value of <code>package</code> when
printing symbols.  If slashification is on, the printer tries to print
something such that if it were given back to the reader, the same object would be produced.
If a symbol which is not in the current name space were just printed as
its print name and read back in, the reader would intern it on the wrong
package, and return the wrong symbol.  So the printer figures out the right
colon prefix so that if the symbol&rsquo;s printed representation were read back
in to the same package, it would be interned correctly.  The prefixes
only printed if slashification is on, i.e. <code>prin1</code> prints them
and <code>princ</code> does not.
</p>
<dl>
<dt><a name="index-remob"></a>Function: <strong>remob</strong> <em>symbol &amp;optional package</em></dt>
<dd><p><code>remob</code> removes <i>symbol</i> from <i>package</i> (the names means &quot;REMove from OBarray&quot;).
<i>symbol</i> itself is unaffected, but <code>intern</code> will no longer find
it on <i>package</i>.  <code>remob</code> is always &quot;local&quot;, in that it removes only from the specified
package and not from any superpackages.  It returns <code>t</code> if the symbol was
found to be removed. <i>package</i> defaults to the contents of the symbol&rsquo;s
package cell, the package it is actually in.  (Sometimes a symbol
can be in other packages also, but this is unusual.)
</p></dd></dl>

<dl>
<dt><a name="index-mapatoms"></a>Function: <strong>mapatoms</strong> <em>function &amp;optional (package <code>package</code>) (superiors-p <code>t</code>)</em></dt>
<dd><p><i>function</i> should be a function of one argument.  <code>mapatoms</code> applies
<i>function</i> to all of the symbols in <i>package</i>.  If <i>superiors-p</i> is
<code>t</code>, then the function is also applies to all symbols in <i>package</i>&rsquo;s
superpackages.  Note that the function will be applied to shadowed symbols
in the superpackages, even though they are not in <i>package</i>&rsquo;s name space.
If that is a problem, <i>function</i> can try applying <code>intern</code>
in <i>package</i> on each symbol it gets, and ignore it if it is not <code>eq</code>
to the result of <code>intern</code>; this measure is rarely needed.
</p></dd></dl>

<dl>
<dt><a name="index-mapatoms_002dall"></a>Function: <strong>mapatoms-all</strong> <em>function &amp;optional (package &quot;<code>global</code>&quot;)</em></dt>
<dd><p><i>function</i> should be a function of one argument.
<code>mapatoms-all</code> applies <i>function</i> to all of the symbols
in <i>package</i> and all of <i>package</i>&rsquo;s subpackages.  Since
<i>package</i> defaults to the <code>global</code> package, this
normally gets at all of the symbols in all packages.
It is used by such functions as <code>apropos</code> and <code>who-calls</code> (see (apropos-fun))
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(mapatoms-all
  (function
    (lambda (x)
      (and (alphalessp 'z x)
           (print x)))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-pkg_002dcreate_002dpackage"></a>Function: <strong>pkg-create-package</strong> <em>name &amp;optional (super <code>package</code>) (size <code>200</code>)</em></dt>
<dd><p><code>pkg-create-package</code> creates and returns a new package.  Usually packages are created
by <code>package-declare</code>, but sometimes it is useful to create
a package just to use as a hash table for symbols, or for some other
reason.
</p>
<p>If <i>name</i> is a list, its first element is taken as the package name
and the second as the program name; otherwise, <i>name</i> is taken as both.
In either case, the package name and program name are coerced to strings.
<i>super</i> is the superpackage for this package; it may be <code>nil</code>,
which is useful if you only want the package as a hash table, and don&rsquo;t
want it to interact with the rest of the package system.  <i>size</i> is
the size of the package; as in <code>package-declare</code> it is rounded up
to a &quot;good&quot; size for the hashing algorithm used.
</p></dd></dl>

<dl>
<dt><a name="index-pkg_002dkill"></a>Function: <strong>pkg-kill</strong> <em>pkg</em></dt>
<dd><p><i>pkg</i> may be either a package or the name of a package.  The package
should have a superpackage and no subpackages.  <code>pkg-kill</code> takes
the package off its superior&rsquo;s subpackage list and refname alist.
</p></dd></dl>

<dl>
<dt><a name="index-pkg_002dfind_002dpackage"></a>Function: <strong>pkg-find-package</strong> <em>x &amp;optional (create-p <code>nil</code>) (under &quot;<code>global</code>&quot;)</em></dt>
<dd><p><code>pkg-find-package</code> tries to interpret <i>x</i> as a package.
Most of the functions whose descriptions say &quot;... may be either
a package or the name of a package&quot; call <code>pkg-find-package</code> to interpret
their package argument.
</p>
<p>If <i>x</i> is a package, <code>pkg-find-package</code> returns it.
Otherwise it should be a symbol or string, which is taken to be
the name of a package.  The name is looked up on the refname
alists of <code>package</code> and its superpackages, the same as if it had
been typed as part of a colon prefix.  If this finds the package, it
is returned.  Otherwise, <i>create-p</i> controls what happens.
If <i>create-p</i> is <code>nil</code>, an error is signalled.  Otherwise,
a new package is created, and installed as an inferior of <i>under</i>.
</p></dd></dl>

<p>A package is implemented as a structure, created by <code>defstruct</code>.
The following accessor macros are available on the <code>global</code> package:
</p>
<dl compact="compact">
<dt><code>pkg-name</code></dt>
<dd><p>The name of the package, as a string.
</p></dd>
<dt><code>pkg-refname-alist</code></dt>
<dd><p>The refname alist of the package, associating strings with packages.
</p></dd>
<dt><code>pkg-super-package</code></dt>
<dd><p>The superpackage of the package.
</p></dd>
</dl>

<a name="Status-Information"></a>
<h3 class="section">19.8 Status Information</h3>

<p>The current package&ndash;where your type-in is being interned&ndash;is
always the value of the symbol <code>package</code>.  A package is a named
structure which prints out nicely, so examining the value of
<code>package</code> is the best way to find out what the current package is.
Normally, it should be <code>user</code>, except when inside
compilation or loading of a file belonging to some other package.
</p>
<p>To get more information on the current package or any other, use the
function <code>pkg-describe</code>.  Specify either a package object or a string
which is a refname for the desired package as the argument.  This will
print out everything except a list of all the symbols in the package.
If you want <i>that</i>, use <code>(mapatoms 'print <i>package</i> nil)</code>.
<code>describe</code> of a package will call <code>pkg-describe</code>.
</p>
<a name="Packages_002c-Loading_002c-and-Compilation"></a>
<h3 class="section">19.9 Packages, Loading, and Compilation</h3>

<p>It&rsquo;s obvious that every file has to be loaded into the right package
to serve its purpose.  It may not be so obvious that every file must be
compiled in the right package, but it&rsquo;s just as true.  Luckily, this
usually happens automatically.
</p>
<p>When you have mentioned a file in a package&rsquo;s file-alist, requesting
to compile that file with <code>qc-file</code> or loading it with <code>load</code> automatically
selects that package to perform the operation.  This is done by
inverting the package-to-file correspondence described by the
file-alists and remembering the inversion in the form of <code>:package</code>
properties on symbols in the <code>files</code> package (the symbol representing the
file is <code>(intern (file-expand-pathname <i>filename</i>) &quot;files&quot;))</code>.
</p>
<p>The system can get the package of a source file from its &quot;editor
property list&quot;.  For instance, you can put at the front of your file
a line such as &quot;; -*- Mode:Lisp; Package:System-Internals -*-&quot;.  The
compiler puts the package into the QFASL file.
If a file is not mentioned in a package&rsquo;s file-alist and doesn&rsquo;t
have such a package specification in it, the system loads it into
the current package, and tells you what it did.
</p>
<p>To compile or load all of the files of a package, you can use the
<code>pkg-load</code> function (see (pkg-load-fun)), which uses the file-alist from the package
declaration.
</p>
<a name="Subpackages"></a>
<h3 class="section">19.10 Subpackages</h3>

<p>Usually, each independent program occupies one package, which is
directly under <code>global</code> in the hierarchy.  But large programs, such as
Macsyma, are usually made up of a number of sub-programs, which are
maintained by a small number of people.  We would like each
sub-program to have its own name space, since the program as a whole
has too many names for anyone to remember.  So, we can make each
sub-program into its own package.  However, this practice requires
special care.
</p>
<p>It is likely that there will be a fair number of functions and
symbols which should shared by all of the sub-programs of Macsyma.
These symbols should reside in a package named <code>macsyma</code>, which would be
directly under <code>global</code>.
Then, each part of <code>macsyma</code> (which might be called <code>sin</code>,
<code>risch</code>, <code>input</code>, and so on) would have its own package, with the <code>macsyma</code>
package as its superpackage.  To do this, first declare the <code>macsyma</code>
package, and then declare the <code>risch</code>, <code>sin</code>, etc. packages, specifying
<code>macsyma</code> as the superpackage for each of them.  This way, each
sub-program gets its own name space.  All of these declarations would probably
be in a together in a file called something like &quot;macpkg&quot;.
</p>
<p>However, to avoid a subtle pitfall (described in detail in the
appendix), it is necessary that the <code>macsyma</code> package itself contain no
files;  only a set of symbols specified at declaration time.  This
list of symbols is specified using <code>shadow</code> in the declaration of the
<code>macsyma</code> package.  At the same time, the file-alist specified in the
declaration must be <code>nil</code> (otherwise, you will not be allowed to create
the subpackages).  The symbols residing in the <code>macsyma</code> package can
have values and definitions, but these must all be supplied by files
in <code>macsyma</code>&rsquo;s subpackages (which must &quot;<code>extern</code>&quot; those symbols as
necessary).  Note that this is exactly the same treatment that <code>global</code>
receives:  all its functions are actually defined in files which are
loaded into <code>system-internals (si), compiler</code>, etc.
</p>
<p>To demonstrate the full power and convenience of
this scheme, suppose there were a second huge program called <code>owl</code> which
also had a subprogram called <code>input</code> (which, presumably, does all of the
<code>input</code>ting for <code>owl</code>), and one called <code>database</code>.  Then a picture of the
hierarchy of packages would look like this:
</p>
<div class="lisp">
<pre class="lisp">                        global
                           |
                /--------------------------------\
                |                                |
             macsyma                            owl
                |                                |
 -----------------------------           -------------------------
  | | |      |       |       |           |         |         | | |
(others)   risch    sin    input       input   database      (others)
</pre></div>

<p>Now, the <code>risch</code> program and the <code>sin</code> program both do integration, and
so it would be natural for each to have a function called <code>integrate</code>.
From inside <code>sin</code>, <code>sin's</code> <code>integrate</code> would be referred to as &quot;<code>integrate</code>&quot;
(no prefix needed), while <code>risch's</code> would be referred to as
&quot;<code>risch:integrate</code>&quot;.  Similarly, from inside <code>risch</code>, <code>risch's</code> own
<code>integrate</code> would be called &quot;<code>integrate</code>&quot;, whereas <code>sin's</code> would be referred
to as &quot;<code>sin:integrate</code>&quot;.
</p>
<p>If <code>sin</code>&rsquo;s <code>integrate</code> were a recursive function, the implementor would
be referring to it from within <code>sin</code> itself, and would be happy that he
need not type out &quot;<code>sin:integrate</code>&quot; every time; he can just say
&quot;<code>integrate</code>&quot;.
</p>
<p>From inside the <code>macsyma</code> package or any of its other sub-packages,
the two functions would be referred to as &quot;<code>sin:integrate</code>&quot; and as
&quot;<code>risch:integrate</code>&quot;.  From
anywere else in the hierarchy, they would have to be called
&quot;<code>macsyma:sin:integrate</code>&quot; and &quot;<code>macsyma:risch:integrate</code>&quot;.
</p>
<p>Similarly, assume that each of the <code>input</code> packages has a function
called <code>get-line</code>.  From inside <code>macsyma</code> or any of <code>macsyma's</code> subprograms
(other than <code>input</code>), the relevant function would be called
<code>input:get-line</code>, and the irrelevant one <code>owl:input:get-line</code>.  The
converse is true for <code>owl</code> and its sub-programs.  Note that there is no
problem arising from the fact that both <code>owl</code> and <code>macsyma</code> have
subprograms of the same name (<code>input</code>).
</p>
<p>You might also want to put Macsyma&rsquo;s <code>get-line</code> function on
the <code>macsyma</code> package.  Then, from anywehere inside Macsyma, the function
would be called <code>get-line</code>; from the <code>owl</code> package and subpackages
it could be referred to as <code>macsyma:get-line</code>.
</p>
<a name="Initialization-of-the-Package-System"></a>
<h3 class="section">19.11 Initialization of the Package System</h3>

<p>This section describes how the package system is initialized
when generating a new software release of the Lisp Machine system;
none of this should affect users.
</p>
<p>When the world begins to be loaded, there is no package system.
There is one &quot;obarray&quot;, whose format is different from that used by
the package system.  After sufficiently much of the Lisp environment
is present for it to be possible to initialize the package system,
that is done.  At that time, it is necessary to split the symbols of
the old-style obarray up among the various initial packages.
</p>
<p>The first packages created by initialization are the most important
ones:  <code>global</code>, <code>system</code>, <code>user</code>, and <code>system-internals</code>.
All of the symbols already
present are placed in one of those packages.  By default, a symbol
goes into <code>system-internals</code>.  Only those placed on special lists go
into one of the others.  These lists are the file &quot;AI: LISPM2; GLOBAL &gt;&quot; of
symbols which belong in <code>global</code>, the file &quot;AI: LISPM2; SYSTEM &gt;&quot; which
go in <code>system</code>, and the file &quot;AI: LISPM2; KWDPKG &gt;&quot; of symbols
which belong in <code>user</code> (at the moment, these are actually loaded into
<code>global</code>, because not everything has been converted to use colons where
necessary).
</p>
<p>After the four basic packages exist, the package system&rsquo;s
definition of <code>intern</code> is installed, and packages exist.  Then, the
other initial packages <code>format</code>, <code>compiler</code>, <code>eine</code>, etc. are declared and
loaded using <code>package-declare</code> and <code>pkg-load</code>, in almost the normal
manner.  The exception is that a few of the symbols present before
packages exist really belong in one of these packages.  Their package
declarations contain calls to <code>forward</code> and <code>borrow</code>, which exist only for
this purpose and are meaningful only in package declarations, and are used
to move the symbols as appropriate.  These declarations are kept in
the file &quot;AI: LISPM; PKGDCL &gt;&quot;.
</p>
<dl>
<dt><a name="index-globalize"></a>Function: <strong>globalize</strong> <em>&amp;rest symbols</em></dt>
<dd><p>Sometimes it will be discovered that a symbol which ought to be in
<code>global</code> is not there, and the file defining it has already been loaded,
thus mistakenly creating a symbol with that name in a package which
ought just to inherit the one from <code>global</code>.  When this happens, you can
correct the situation by doing <code>(globalize &quot;<i>symbol-name</i>&quot;)</code>.  This
function creates a symbol with the desired name in <code>global</code>, merges
whatever value, function definition, and properties can be found on
symbols of that name together into the new symbol (complaining if
there are conflicts), and forwards those slots of the existing symbols
to the slots of the new one using one-q-forward pointers, so that they
will appear to be one and the same symbol as far as value, function
definition, and property list are concerned.  They cannot all be made
<code>eq</code> to each other, but <code>globalize</code> does the next-best thing:  it takes
an existing symbol from <code>user</code>, if there is one, to put it in <code>global</code>.
Since people who check for <code>eq</code> are normally supposed to specify <code>user</code>
anyway, they will not perceive any effect from moving the symbol from
<code>user</code> into <code>global</code>.
</p>
<p>If <code>globalize</code> is given a symbol instead of a string as argument,
the exact symbol specified is put into <code>global</code>.  You can use this when
a symbol in another package, which should have been inherited from
<code>global</code>, is being checked for with <code>eq</code>&ndash;as long as there are not <i>two</i>
different packages doing so.  But, if the symbol is supposed to be in
<code>global</code>, there usually should not be.
</p></dd></dl>

<a name="Initial-Packages"></a>
<h3 class="section">19.12 Initial Packages</h3>

<p>The initially present packages include:
</p>
<dl compact="compact">
<dt><code>global</code></dt>
<dd><p>Contains advertised global functions.
</p></dd>
<dt><code>user</code></dt>
<dd><p>Used for interning the user&rsquo;s type-in.  Contains all keyword symbols.
</p></dd>
<dt><code>sys <span class="roman">or</span> system</code></dt>
<dd><p>Contains various internal global symbols
used by various system programs.
</p></dd>
<dt><code>si <span class="roman">or</span> system-internals</code></dt>
<dd><p>Contains subroutines of many advertised
system functions.  <code>si</code> is a subpackage of <code>sys</code>.
</p></dd>
<dt><code>compiler</code></dt>
<dd><p>Contains the compiler and fasload.  <code>compiler</code> is a subpackage
of <code>sys</code>.
</p></dd>
<dt><code>eine</code></dt>
<dd><p>Contains the Eine editor.
</p></dd>
<dt><code>chaos</code></dt>
<dd><p>Contains the Chaos net controller.
</p></dd>
<dt><code>supdup</code></dt>
<dd><p>Contains the Supdup program.
</p></dd>
<dt><code>peek</code></dt>
<dd><p>Contains the Peek program.
</p></dd>
<dt><code>format</code></dt>
<dd><p>Contains the function <code>format</code> and its associated subfunctions.
</p></dd>
</dl>

<p>Packages which are used for special sorts of data:
</p>
<dl compact="compact">
<dt><code>fonts</code></dt>
<dd><p>Contains the names of all fonts.
</p></dd>
<dt><code>files</code></dt>
<dd><p>Contains the file-symbols of all files.
Many properties are kept on these symbols to remember information
about files which are in use.
</p></dd>
<dt><code>format</code></dt>
<dd><p>Contains the keywords for <code>format</code>, as well as the code.
</p></dd>
</dl>

<p>Here is a picture depicting the inital package hierarchy:
</p>
<div class="lisp">
<pre class="lisp">                           global
                             |
  /-----------------------------------------------------------\
  |     |     |         |        |       |       |      |     |
user  eine  chaos    system    supdup  format  fonts  files  peek
                        |
                /--------------\
                |              |
         system-internals    compiler
</pre></div>

<a name="Multiple-Instantiations-of-a-Program"></a>
<h3 class="section">19.13 Multiple Instantiations of a Program</h3>

<p>This isn&rsquo;t finished yet, which is why we don&rsquo;t say how to do
any of this.
</p>
<p>Suppose a maintainer of EINE (the Lisp Machine editor) has
made some changes to EINE, and would like to debug them.  He has a
problem: if he reads in the new version, which presumably may be full
of bugs, then he will not be able to do any editing!  This would be
annoying, since the editor is very useful.
</p>
<p>We would like both the regular and the experimental versions
of the editor to <i>both</i> be loaded into the Lisp world.  In order for two
definitions of each editor function to coexist, we need to load the
new version into a separate package, which must have a different name
(not named &quot;<code>eine</code>&quot;, like the package the original editor is in).  If
the test version&rsquo;s package is called &quot;<code>test-eine</code>&quot;, then the user can
try it by calling <code>(test-eine:ed)</code>, and edit it using <code>(ed)</code>.
</p>
<p>However, there is a problem to be faced.  The editor redefines
a few entry-point functions (<code>ed</code>, <code>edprop</code>, etc) which reside in <code>global</code>.
If the test editor redefined them, the whole point of the separate
package would be lost.  So, the <code>test-eine</code> package must <code>shadow</code> all the
symbols which the regular <code>eine</code> package <code>extern</code>s.
</p>
<p>Further complications are needed to make it possible to test
one program using another instead of by hand.  Suppose that there is a
program named <code>random</code> residing in its own package, and containing a
function named <code>number</code>.  Suppose that we have a debugged program <code>dp</code>
(Dissociated Press) which uses <code>random:number</code>.  And now, we have
written a new version of <code>random</code> and want to test it using <code>dp</code>, without
installing it and breaking system tools which use <code>random</code>.  What we
want to do is to load in a test version of <code>random</code>, <code>test-random</code>, and
also a <code>test-dp</code> which will refer to it, to test it with.
</p>
<p>This can be done if we can make the <code>test-dp</code> package
take references to <code>random</code> as references to the <code>test-random</code>
package.  All this takes is
an entry on <code>test-dp</code>&rsquo;s refname-alist, associating the name &quot;<code>random</code>&quot;
with the <code>test-random</code> package.  Then, when <code>random:number</code> is seen in the
course of reading in the old <code>dp</code> program into <code>test-dp</code>,
<code>test-random:number</code> will actually be used.  Note that normally <code>test-dp</code>
wouldn&rsquo;t have an entry on its own refname-alist for &quot;<code>random</code>&quot;;  it
would inherit the association from <code>global</code>.  We are actually
&quot;shadowing&quot; in <code>test-dp</code> the definition of &quot;<code>random</code>&quot; as a package refname
which is present in <code>global</code>.  Here is what we will get.
</p>
<div class="lisp">
<pre class="lisp">                            global  [random -&gt; random]
                               |
      /-----------------------------------------------\
      |        |                      |               |
     dp  =&gt;  random                test-dp  =&gt;      test-random
                           [random -&gt; test-random]
</pre></div>

<p>(&quot;=&gt;&quot; indicates who calls whom;  &quot;-&gt;&quot; indicates a refname).
</p>
<p>So far, every package has had its own name as a refname for
itself.  A test package, however, shouldn&rsquo;t have its actual name as a
refname for itself, but the name its program expects:  &quot;<code>random</code>&quot;, not
&quot;<code>test-random</code>&quot;.  This is necessary to handle test packages with
subpackages right, together with shadowing.  In fact every package has
a &quot;program name&quot; as well as a &quot;name&quot;.  For ordinary packages, they are
the same, but for a test package, the program name is identical to
that of the original package.
</p>
<p>Suppose we have the Macsyma program with all of its sub-packages as
described above. Further assume that the <code>input</code> sub-program&rsquo;s author
has his own symbol named <code>simp</code>, and he calls <code>macsyma:simp</code>
in various places to get the
one in the <code>macsyma</code> package.  Now, say someone wants to load an
experimental <code>macsyma</code> into the machine: he would name the new obarray
<code>test-macsyma</code> or something.  In order to assure that the reference to
<code>macsyma:simp</code> is properly resolved, the refname-alist of <code>test-macsyma</code>
must contain <code>test-macsyma</code> under the name <code>macsyma</code>.  This, finally,
is the reason why each package has a reference to itself on its refname-alist.
</p>

<a name="Files"></a>
<h2 class="chapter">20 Files</h2>
<a name="index-file"></a>

<p>This chapter explains how the Lisp Machine system interacts
with files and the file system.  It explains how to keep your
programs in files and how to get them into the Lisp environment,
how they relate to packages, how they are divided into sections,
and how they are seen by EINE (the editor).
</p>
<p>Eventually, Lisp Machines will be able to support
their own file sytems, or use a special purpose &quot;File Computer&quot;
over the Chaosnet.  At the moment, the prototype Lisp Machine
uses the A.I. PDP-10 file system.  To allow it
to access the PDP-10 (which is not yet attached to the Chaosnet),
a special program must be run on the PDP-10, which is invoked
by typing <code>:lmio;file</code> to DDT.
</p>
<p>A <i>pathname</i> or <i>filename</i> is a string of characters
which identifies a file in the file system.  On the existing file
system, a pathname looks like
</p>
<p>&quot;<i>device</i>: <i>directory</i>; <i>fn1</i> <i>fn2</i>&quot;
</p>
<p>It is assumed that the reader of this document is familiar with the
meanings of these pathnames, and the use of &quot;&gt;&quot; as the <i>fn2</i> in a
pathname.  Unlike Maclisp, Lisp Machine functions usually take
filenames as a character string, rather then as a list.  Most functions understand pathnames
in which some components are not specified.  For example, in the
string <code>&quot;lispm;qmod&quot;</code>, the <i>device</i> and <i>fn2</i> are not specified.
</p>
<a name="Functions-for-Loading-Programs"></a>
<h3 class="section">20.1 Functions for Loading Programs</h3>

<a name="Functions-for-Loading-Single-Files"></a>
<h4 class="subsection">20.1.1 Functions for Loading Single Files</h4>

<dl>
<dt><a name="index-load"></a>Function: <strong>load</strong> <em>pathname &amp;optional pkg</em></dt>
<dd><p>This function loads the file <i>pathname</i> into the Lisp environment.
If the file is a QFASL file, it calls <code>fasload</code>; otherwise
it calls <code>readfile</code>.  <i>pkg</i> should be a package or the name of a package, and if
it is given it is used as the current package when the file
is read in.  Usually it is not given; when it is not supplied
explicitly, <code>load</code> tries to figure out what package to use
by calling <code>pkg-find-file-package</code>.  If the FN2 is not
specified in <i>pathname</i>, <code>load</code> first tries appending
the <i>fn2</i> <code>&quot;qfasl&quot;</code>, and then tries the <i>fn2</i> <code>&quot;&gt;&quot;</code>
if the <code>&quot;qfasl&quot;</code> file is not found.
</p></dd></dl>

<dl>
<dt><a name="index-readfile"></a>Function: <strong>readfile</strong> <em>pathname</em></dt>
<dd><p><code>readfile</code> sequentially reads and evaluates forms
from the file <i>pathname</i>, in the current package.
</p></dd></dl>

<dl>
<dt><a name="index-fasload"></a>Function: <strong>fasload</strong> <em>pathname</em></dt>
<dd><p><code>fasload</code> reads in and processes a QFASL file,
in the current package.  That is, it defines functions
and performs other actions as directed by the specifications
inserted in the file by the compiler.
</p></dd></dl>

<a name="Loading-and-Compiling-Whole-Packages"></a>
<h4 class="subsection">20.1.2 Loading and Compiling Whole Packages</h4>

<p>Because each package has a file-alist, it is possible to request that
the files of a package be compiled or loaded, as needed.  This is done
with the <code>pkg-load</code> function, which takes as arguments a package and a
list of keywords (or one keyword) specifying the precise nature of the
operation.  For example, <code>(pkg-load &quot;eine&quot; ':compile)</code> would recompile and
reload the files of the <code>eine</code> package, such as require it.
</p>
<dl>
<dt><a name="index-pkg_002dload"></a>Function: <strong>pkg-load</strong> <em>package &amp;optional keywords</em></dt>
<dd><p>This function loads and/or compiles the files of a package.  <i>package</i>
may be a package or a package name; <i>keywords</i> should be one of the
keyword symbols below or a list of keywords.  The keywords control
what <code>pkg-load</code> does.
</p>
<p>The keywords defined include:
</p>
<dl compact="compact">
<dt><code>:confirm</code></dt>
<dd><p>Ask for confirmation before doing it (this is the default);
</p></dd>
<dt><code>:noconfirm</code></dt>
<dd><p>Don&rsquo;t ask for confirmation
</p></dd>
<dt><code>:compile</code></dt>
<dd><p>Compile files before loading;
</p></dd>
<dt><code>:nocompile</code></dt>
<dd><p>Do not compile (this is the default);
</p></dd>
<dt><code>:load</code></dt>
<dd><p>Load files (the default);
</p></dd>
<dt><code>:noload</code></dt>
<dd><p>Don&rsquo;t load (but compile, if that was specified);
</p></dd>
<dt><code>:selective</code></dt>
<dd><p>Ask about each file;
</p></dd>
<dt><code>:complete</code></dt>
<dd><p>Don&rsquo;t ask about each file (the default);
</p></dd>
<dt><code>:reload</code></dt>
<dd><p>Compile or load even files which appear not to need it;
</p></dd>
<dt><code>:noreload</code></dt>
<dd><p>Only process files which have newer versions on disk (the default);
</p></dd>
<dt><code>:recursive</code></dt>
<dd><p>Also process packages this one refers to;
</p></dd>
<dt><code>:defs</code></dt>
<dd><p>Process only DEFS files.
</p></dd>
</dl>

<p>See also <code>recompile-world</code> ((recompile-world-fun)).
</p></dd></dl>

<a name="Processes"></a>
<h2 class="chapter">21 Processes</h2>
<a name="index-process"></a>
<a name="index-multiprocessing"></a>
<a name="index-wait"></a>

<p><i>Processes</i> are used to implement multi-processing.
Several computations can be executed &quot;concurrently&quot; by placing
each in a separate process.  A computation in a process may
also <i>wait</i> for something to happen, during which time it
does not execute at all.
</p>
<p>A <i>process</i> is a Lisp structure with the following components:
</p>
<dl compact="compact">
<dt><code>process-name</code></dt>
<dd><p>The name of the process, as a string.  This string is only used
for the process&rsquo;s printed representation, and for programs
to print out; it can be anything reasonably mnemonic.
</p></dd>
<dt><code>process-stack-group</code></dt>
<dd><p>The stack group currently associated with this process.  When the process
is run, this stack group will be resumed.  See below.
</p></dd>
<dt><code>process-wait-function</code></dt>
<dd><p>A function, applied to the argument list in the process&rsquo;s <code>process-wait-argument-list</code>
to determine whether the process is runnable.  The function should return <code>nil</code>
if the process is not ready to run.
</p></dd>
<dt><code>process-wait-argument-list</code></dt>
<dd><p>The arguments to which the <code>process-wait-function</code> is applied.
</p></dd>
<dt><code>process-whostate</code></dt>
<dd><p>The reason this process is waiting, as a string.  This is only
used for display by the who-line or various programs; it can
be anything reasonably mnemonic.
</p></dd>
<dt><code>process-job</code></dt>
<dd><p>The job associated with this process, or <code>nil</code> if the process
is not associated with any job.  See the chapter on jobs ((job)).
</p></dd>
<dt><code>process-initial-stack-group</code></dt>
<dd><p>The function <code>process-preset</code> (see (process-preset-fun))
will make the <code>process-stack-group</code> be this stack group.
</p></dd>
</dl>

<a name="index-scheduler"></a>
<p>At any time there is a set of <i>active processes</i>.  Each active
process is either trying to run, or waiting for some condition to become true.
The active
processes are managed by a special stack group called the <i>scheduler</i>,
which repeatedly cycles through the active processes, determining
for each process whether it is ready to be run, or whether it is
waiting.  The scheduler determines whether a process is ready to run by applying the process&rsquo;s
<i>wait-function</i> to its <i>wait-argument-list</i>.  If the
wait-function returns a non-<code>nil</code> value, then the process is ready to run;
otherwise, it is waiting.  If the process is ready to run,
the scheduler resumes the <code>process-stack-group</code> of the process.
For example, if a process were waiting for input from the keyboard,
its wait-function might be <code>kbd-char-available</code>, which returns
non-<code>nil</code> if there is a character available from the keyboard.
Since <code>kbd-char-available</code> takes no arguments, the wait-argument-list
of the process would be <code>nil</code>.
</p>
<p>When a process&rsquo;s wait-function returns non-<code>nil</code>, the scheduler
will resume its stack group and let it proceed.  The process is now the
<i>current process</i>, that is, the one process that is running
on the machine.  The scheduler sets the variable <code>current-process</code>
to it.  It will remain the current process and continue to
run until either it decides to wait, or a <i>sequence break</i> occurs.
A process can wait for some condition to become true by calling
<code>process-wait</code> (see (process-wait-fun)),
which will set up its wait-function and wait-argument-list accordingly,
and resume the scheduler stack group.  A sequence break is a kind of interrupt
that is generated by the Lisp system for any of a variety of reasons;
when it occurs, the scheduler is resumed.  In either case, the scheduler
will continue cycling through the active processes.
This way, each process that is ready to run will get its share of
time in which to execute.
</p>
<p>Note: Sequence breaks are not yet implemented, and so the scheduler
only regains control when the running process calls <code>process-wait</code>.
Any process that simply computes for a long time without waiting will
keep all of the other processes from running.  In the future, seqence
breaks will happen periodically and at interesting times when some process&rsquo;s
wait condition may have become true.
</p>
<a name="Functions-for-Manipulating-Processes"></a>
<h3 class="section">21.1 Functions for Manipulating Processes</h3>

<dl>
<dt><a name="index-process_002dcreate"></a>Function: <strong>process-create</strong> <em>name job &amp;rest options</em></dt>
<dd><p><code>process-create</code> creates and returns a new process.  <i>name</i> may be any
string, <i>job</i> is usually <code>t</code>, and there are usually no options.
The options are used in creating the stack group which executes on behalf of this process.
</p>
<p>The fields of the new process are set up as follows:
</p>
<dl compact="compact">
<dt><code>process-name</code></dt>
<dd><p><i>name</i>, which should be a string.
</p></dd>
<dt><code>process-job</code></dt>
<dd><p><i>job</i>.  If <i>job</i> is <code>t</code>, the current job is used instead.
Otherwise <i>job</i> should be <code>nil</code> (meaning that the process
is not associated with any job), or a job.
</p></dd>
<dt><code>process-stack-group</code></dt>
<dd><p>A newly created stack group.  The <i>options</i> argument to <code>process-create</code>
are the options passed to <code>make-stack-group</code> (see (make-stack-group-fun))
used when creating this stack group.
</p></dd>
<dt><code>process-initial-stack-group</code></dt>
<dd><p>The same as the <code>process-stack-group</code>.
</p></dd>
</dl>

<p>The rest of the fields are set to <code>nil</code>; the process should not be enabled
until <code>process-preset</code> (see below) is called.
</p></dd></dl>

<dl>
<dt><a name="index-process_002dpreset"></a>Function: <strong>process-preset</strong> <em>process initial-function &amp;rest options</em></dt>
<dd><p><code>process-preset</code> initializes the state of a process.
First, it restores the <code>process-stack-group</code> from the
<code>process-initial-stack-group</code>.  Then it presets
the stack group, passing the <code>initial-function</code> and <code>options</code>
arguments to <code>stack-group-preset</code> (see (stack-group-preset-fun)).
Finally it sets
the <code>process-wait-function</code> and <code>process-argument-list</code>
to return <code>t</code>, so that the process will be ready to run.
The process is now ready to be enabled (see <code>process-enable</code>
below).
</p></dd></dl>

<dl>
<dt><a name="index-process_002dkill"></a>Function: <strong>process-kill</strong> <em>process</em></dt>
<dd><p>This deactivates <i>process</i> if it is active, and dissociates it from
its associated job (if any).
</p></dd></dl>

<dl>
<dt><a name="index-process_002denable"></a>Function: <strong>process-enable</strong> <em>process</em></dt>
<dd><p>Enable <code>process</code>.  If <i>process</i> has no associated job, or if its
job if process-enabled, <i>process</i> is activated.
</p></dd></dl>

<dl>
<dt><a name="index-process_002ddisable"></a>Function: <strong>process-disable</strong> <em>process</em></dt>
<dd><p>Disable <i>process</i>.  If it was active, deactivate it.
</p></dd></dl>

<dl>
<dt><a name="index-process_002dwait"></a>Function: <strong>process-wait</strong> <em>whostate function &amp;rest arguments</em></dt>
<dd><p><code>process-wait</code> sets the current-process&rsquo;s <code>process-whostate</code>,
<code>process-wait-function</code>, and <code>process-wait-argument-list</code> from
its three arguments, which makes the current process wait until the
application of <i>function</i> to <i>arguments</i> returns non-<code>nil</code>
(at which time <code>process-wait</code> returns).  Note that <i>function</i> is applied
in the environment of the scheduler, not the environment of the <code>process-wait</code>,
so bindings in effect when <code>process-wait</code> was called will <i>not</i> be
in effect when <i>function</i> is applied.  Be careful when using any free
references in <i>function</i>.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">;; This won't work.
((lambda (until)
    (process-wait &quot;sleep&quot; '(lambda () (&gt; (time) until))))
 500)

;; This is the right way to do it.
(process-wait &quot;sleep&quot; '(lambda (until) (&gt; (time) until)) 500)
</pre></div>

<p>When running the <code>process-wait-function</code>, the scheduler sets the
variables <code>current-process</code> and <code>current-job</code>
to the process being considered and its job, so the <code>process-wait-function</code>
can use them; for example:
</p>
<div class="lisp">
<pre class="lisp">;; Wait until I get the keyboard.
(process-wait &quot;kbd&quot; '(lambda () (eq kbd-job current-job)))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-process_002dsleep"></a>Function: <strong>process-sleep</strong> <em>interval</em></dt>
<dd><p>This simply waits for <i>interval</i> sixtieths of a second, and then returns.
It uses <code>process-wait</code>.
</p></dd></dl>

<dl>
<dt><a name="index-process_002dallow_002dschedule"></a>Function: <strong>process-allow-schedule</strong></dt>
<dd><p>This function simply waits for a condition which is always true;
all other processes will get a chance to run before the current process runs again.
</p></dd></dl>

<dl>
<dt><a name="index-without_002dinterrupts"></a>Special Form: <strong>without-interrupts</strong></dt>
<dd><p>The <code>without-interrupts</code> special form allows you to perform <i>atomic operations</i>.
Within the body of this form, control is guaranteed to remain in the current process.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(without-interrupts
  (push item list))

(without-interrupts
  (cond ((memq item list)
         (setq list (delq item list))
         t)
        (t nil)))
</pre></div>
</dd></dl>

<a name="Locks"></a>
<h3 class="section">21.2 Locks</h3>
<a name="index-lock"></a>

<p>A <i>lock</i> is a software construct used for synchronization
of two processes.  A lock is either held by some process, or is free.
When a process tries to seize a lock, it waits until the lock is free,
and then it becomes the process holding the lock.  When it is finished,
it should unlock the lock.
</p>
<p>In the Lisp Machine, a lock is a locative pointer to a cell.
If the lock is free, the cell contains <code>nil</code>; otherwise it contains
the process that holds the lock.  The <code>process-lock</code> and <code>process-unlock</code>
functions are written in such a way as to guarantee that two processes
can never both think that they hold a certain lock; only one process
can ever hold a lock at a time.
</p>
<dl>
<dt><a name="index-process_002dlock"></a>Function: <strong>process-lock</strong> <em>locative</em></dt>
<dd><p>This is used to seize the lock which <i>locative</i> points to.
If necessary, <code>process-lock</code> will wait until the lock becomes free.
When <code>process-lock</code> returns, the lock has been seized.
</p></dd></dl>

<dl>
<dt><a name="index-process_002dunlock"></a>Function: <strong>process-unlock</strong> <em>locative</em></dt>
<dd><p>This is used to unlock the lock which <i>locative</i> points to.
If the lock is free or was locked by some other process, an
error is signaled.  Otherwise the lock is unlocked.
</p></dd></dl>

<p>It is a good idea to use <code>unwind-protect</code> to make sure that
you unlock any lock that you seize.  For example, if you write
</p>
<div class="lisp">
<pre class="lisp">(unwind-protect
   (progn (process-lock lock-3)
          (function-1)
          (function-2))
   (process-unlock lock-3))
</pre></div>

<p>then even if <code>function-1</code> or <code>function-2</code> does a <code>*throw</code>,
<code>lock-3</code> will get unlocked correctly.
</p>
<p><code>process-lock</code> and <code>process-unlock</code> are written by
use of a sub-primitive function called <code>%store-conditional</code>
(see (%store-conditional-fun)), which
is sometimes useful in its own right.
</p>

<a name="TVOBs-and-Jobs"></a>
<h2 class="chapter">22 TVOBs and Jobs</h2>

<p>[The subject of this chapter is currently being redesigned.  The contents
of this chapter will be completely changed in the next edition of this manual.]
</p>
<a name="Introduction-to-the-Concepts-of-This-Chapter"></a>
<h3 class="section">22.1 Introduction to the Concepts of This Chapter</h3>
<a name="index-tvob"></a>

<p><i>TVOBs</i> (TV OBjects) represent permission to use
the TV screen.  The TVOB mechanism is provided to allow the
TV to be shared between all of the activities the user
may be conducting, without those activities getting in each other&rsquo;s
way.
</p>
<a name="index-job"></a>
<p>A <i>job</i> is a collection of processes and TVOBs, grouped
together for the user&rsquo;s convenience.  The processes can be started
and stopped together, and the TVOBs can be put on or taken off the
TV together.
</p>
<a name="TVOBs"></a>
<h3 class="section">22.2 TVOBs</h3>

<p>A <i>TVOB</i> (TV OBject) is a Lisp structure with the following
components:
</p>
<dl compact="compact">
<dt><code>tvob-name</code></dt>
<dd><p>This is the name of the TVOB, as a string.  It is only used for
the TVOB&rsquo;s printed representation, and can be anything reasonably
mnemonic.
</p></dd>
<dt><code>tvob-x1</code></dt>
<dd><p>The first (leftmost) column of the TVOB&rsquo;s area of the screen.
</p></dd>
<dt><code>tvob-y1</code></dt>
<dd><p>The first (highest) line of the TVOB&rsquo;s area of the screen.
The <code>tvob-x1</code> and <code>tvob-y1</code> are the co-ordinates of the
upper-left-hand corner of the TVOB&rsquo;s rectangular area.
</p></dd>
<dt><code>tvob-x2</code></dt>
<dd><p>The first (leftmost) column to the right of the TVOB&rsquo;s area of the screen.
</p></dd>
<dt><code>tvob-y2</code></dt>
<dd><p>The first (highest) line below the TVOB&rsquo;s area of the screen.
The <code>tvob-x2</code> and <code>tvob-y2</code> are the co-ordinates of the
lower-right-hand corner of the TVOB&rsquo;s rectangular area, with 1 added to each.
Thus the height of the tvob is the difference between its <code>tvob-y2</code> and <code>tvob-y1</code>,
and the width is the difference between the <code>tvob-x2</code> and <code>tvob-x1</code>.
</p></dd>
<dt><code>tvob-handler</code></dt>
<dd><p>A function, described below.
</p></dd>
<dt><code>tvob-info</code></dt>
<dd><p>This field may contain anything at all; it is meant to be used by the
<code>tvob-handler</code> function.
</p></dd>
<dt><code>tvob-job</code></dt>
<dd><p>The job associated with this TVOB, or <code>nil</code> if there is no associated
job.
</p></dd>
<dt><code>tvob-priority</code></dt>
<dd><p>Either <code>t</code> or <code>nil</code>.  If it is <code>t</code>, the functions which
allocate area on the screen (<code>tvob-create</code> and <code>tvob-create-expandable</code>,
see (tvob-create-fun))
will be reluctant to allocate over this TVOB&rsquo;s area of the screen.
</p></dd>
<dt><code>tvob-screen</code></dt>
<dd><p>The screen on which this TVOB is displayed.  See (screen).
</p></dd>
<dt><code>tvob-status</code></dt>
<dd><p>This field is provided for the convenience of <code>tvob-handler</code> functions.
It contains one of the following symbols:
</p><dl compact="compact">
<dt><code>:selected</code></dt>
<dd><p>The TVOB is the selected TVOB.  Only one TVOB will have this <code>tvob-status</code>.
</p></dd>
<dt><code>:exposed</code></dt>
<dd><p>The TVOB is not selected, but is on <code>exposed-tvobs</code>.  This means that this
TVOB is not covered by any other TVOB; its screen area is fully exposed.
</p></dd>
<dt><code>nil</code></dt>
<dd><p>The TVOB is not on <code>exposed-tvobs</code>.
</p></dd>
</dl>

</dd>
<dt><code>tvob-clobbered-p</code></dt>
<dd><p>This field is provided for the convenience of <code>tvob-handler</code> functions.
It is <code>t</code> if the TVOB has been sent a <code>:clobber</code> or <code>:set-edges</code>
command more recently
than an <code>:update</code> command; otherwise it is <code>nil</code>.
</p></dd>
<dt><code>tvob-mouse-handler</code></dt>
<dd><p>A function to call when the mouse enters this TVOB&rsquo;s screen region.  This allows
the TVOB to take over control of the mouse.  This field is <code>nil</code> if this TVOB
does not do anything special with the mouse.
</p></dd>
<dt><code>tvob-mouse-action</code></dt>
<dd><p>See <code>mouse-default-handler</code> ((mouse-default-handler-fun)).
</p></dd>
<dt><code>tvob-plist</code></dt>
<dd><p>A disembodied property list.  Use, for example, <code>(get (locf (tvob-plist tvob)) 'mumble)</code>.
</p></dd>
</dl>

<p>It is often useful to divide the TV screen up into several parts,
and do different things in each part.  Sometimes one program wants
to split up the screen, as Eine does; sometimes the user wants to run several
programs at once, and each program wants some space on the screen.
At any time, there is a set of <i>active TVOBs</i> (TV objects) which are sharing
the screen.  Each TVOB has a rectangular piece of the screen on which
it does its displaying; it is not allowed to go outside its area.
</p>
<p>It is possible for two active TVOB&rsquo;s regions of the screen
to overlap.  When this happens, only one of them is <i>exposed</i> (fully
visible); the other is partially or fully buried.  There is a subset of
the active TVOBs called the <i>exposed</i> TVOBs; no two exposed TVOBs
overlap.  The TVOBs act as if they were a bunch of rectangular sheets
of paper on a desktop; some are up at the top, and others are partially
buried.  Various programs can &quot;pull&quot; a non-exposed TVOB up to the top,
making it exposed and making some other TVOB(s) non-exposed.  Several functions
of the job system, explained below, keep track of and change which TVOBs
are active, and which are exposed.
</p>
<p>The job system also keeps track of one TVOB called the
<i>selected TVOB</i>.  Conceptually, the selected TVOB is the one in which
the user is interested at the moment, and it is usually the one that is
responding to the keyboard.  For example, when Eine is being used, the
TVOB of the window in which the user is editing is the selected TVOB.
The selected TVOB is always exposed.
A TVOB&rsquo;s being selected, exposed but not selected, or not exposed at
all is called the TVOB&rsquo;s <i>status</i>.
</p>
<p>Usually a program will want certain actions to be taken when
the status of a TVOB changes.  When the TVOB associated with an Eine window
becomes exposed, Eine generally wants
to redisplay the window, and when the TVOB is selected, Eine starts
blinking the window&rsquo;s blinkers and makes its buffer be the current
buffer.  In order to let a user program know that the status of a
TVOB has changed, so that it can do these things, there is a function
called the <i>handler</i> associated with every TVOB.  When the status of
the TVOB changes, its handler is applied to three arguments:  the TVOB
itself, a keyword symbol indicating what kind of change of status
is occurring, and a list of other information whose meaning is dependant
on the value of the second argument.  The applications of this function
can be thought of as a &quot;command&quot; being sent to the TVOB.  For example, when
a TVOB becomes selected, it is &quot;sent a command&quot; telling it so; that is,
the handler is applied to the TVOB, the keyword <code>:select</code>, and <code>nil</code>.
</p>
<p>Here is a list of all of the keyword symbols (i.e. all of the kinds
of commands) that are used.  In addition to status changes, requests
for the TVOB to update and relocate itself cause the handler to be
invoked.
</p>
<dl compact="compact">
<dt><code>:expose</code></dt>
<dd><p>The TVOB is being made exposed.  This command is only sent
when the TVOB is active and not exposed.
</p></dd>
<dt><code>:deexpose</code></dt>
<dd><p>The TVOB is no longer exposed.  This command is only sent when
the TVOB is active and exposed.
</p></dd>
<dt><code>:select</code></dt>
<dd><p>The TVOB is now selected.  This command is only sent when the TVOB
is exposed and not selected.
</p></dd>
<dt><code>:deselect</code></dt>
<dd><p>The TVOB is no longer selected.  This command is only sent when the TVOB
is selected.
</p></dd>
<dt><code>:clobber</code></dt>
<dd><p>This command means that for some reason, the TVOB&rsquo;s area of the screen has
been altered; future <code>:update</code> and <code>:clean</code> commands should not
assume that the screen is as it was left.  Most TVOBs will ignore this
message, since the information is saved in the <code>tvob-clobbered-p</code>
element of the TVOB (see below).  This command is only sent when the TVOB
is exposed.
</p></dd>
<dt><code>:update</code></dt>
<dd><p>This command is only sent when the TVOB is exposed.
The TVOB should assure that its area of the screen contains whatever
it is supposed to contain.  Just what <code>:update</code> means depends on the
program.  Some programs can remember the contents of what is on the TVOB
and can refresh it at will; others do not remember the contents, and cannot
reconstruct them.
</p>
<p>The former kind, upon receiving the <code>:update</code> command,
should update the TVOB.  If the TVOB has not been clobbered, the handler
can assume that whatever it last put there is still there, and it may
be able to avoid redisplaying.  The <code>tvob-clobbered-p</code> field
of the TVOB is set to <code>t</code> by the job system after a <code>:clobber</code>
or <code>:set-edges</code>
command is sent, and to <code>nil</code> after an <code>:update</code> or <code>:clean</code>
command is sent. The handler can determine whether or not its area
of the screen has been clobbered by simply looking at the <code>tvob-clobbered-p</code>.
</p>
<p>The latter kind of TVOB cannot update,
and should ignore the <code>:update</code> command entirely.
</p></dd>
<dt><code>:clean</code></dt>
<dd><p><code>:clean</code> is like <code>:update</code> except that TVOBs of the kind that
cannot refresh themselves should clear their areas instead of doing nothing.
Like <code>:update</code>, this command is only sent when the TVOB is exposed.
<code>:clean</code> is sent to all exposed TVOBs when the user requests that the screen be
cleaned up; for instance when the FORM key is pressed in most programs.
</p></dd>
<dt><code>:set-edges</code></dt>
<dd><p>The TVOB should change its area of the screen.  This command takes four
arguments: the new left edge, top edge, bottom edge, and right edge, in raster
units.  The first two are inclusive, and the other two are exclusive.
The elements of the TVOB structure that hold the screen area (<code>tvob-x1</code> etc.)
will be updated automatically; the handler need not change them itself.
The handler should update any other associated information; for example,
if the TVOB has an associated &quot;piece of paper&quot;, it should call <code>tv-redefine-pc-ppr</code>
(see (tv-redefine-pc-ppr-fun)).
</p></dd>
</dl>

<p>The <code>tvob-info</code> component of the TVOB is provided to give
the handler somewhere to put its internal state.  It is usually
some kind of structure, depending on what program created the TVOB.
For example, it might be a piece of paper (see (pc-ppr)).
</p>
<a name="Jobs"></a>
<h3 class="section">22.3 Jobs</h3>

<p>A <i>job</i> is a Lisp structure with the following components:
</p>
<dl compact="compact">
<dt><code>job-name</code></dt>
<dd><p>The name of the job, as a string.  This is only used for the printed
representation of the job or for display by programs, and may be anything
reasonably mnemonic.
</p></dd>
<dt><code>job-tvobs</code></dt>
<dd><p>A list of all TVOBs associated with this job.
</p></dd>
<dt><code>job-processes</code></dt>
<dd><p>A list of all processes associated with this job.
</p></dd>
<dt><code>job-enabled-tvobs</code></dt>
<dd><p>A list of this job&rsquo;s enabled tvobs.  Each TVOB on this list is also
on the <code>job-tvobs</code> list.  The order of the enabled tvobs list is
&quot;highest&quot; first; this list is sometimes passed to <code>tvob-setup</code>.
</p></dd>
<dt><code>job-enabled-processes</code></dt>
<dd><p>A list of this job&rsquo;s enabled processes.  This list is a subset of
the <code>job-processes</code> list.
</p></dd>
<dt><code>job-tvob-enabled-p</code></dt>
<dd><p>If this is non-<code>nil</code>, this job is <i>tvob-enabled</i>; its enabled
TVOBs are active.
</p></dd>
<dt><code>job-process-enabled-p</code></dt>
<dd><p>If this is non-<code>nil</code>, this job is <i>process-enabled</i>; its enabled
processes are active.
</p></dd>
<dt><code>job-who-line-process</code></dt>
<dd><p>Whenever this job becomes the <code>kbd-job</code>, the process in this component
becomes the <code>tv-who-line-process</code> (The process whose <code>process-whostate</code>
is displayed in the who-line) (see (tv-who-line-process-var)).
</p></dd>
<dt><code>job-tvob-selector</code></dt>
<dd><p><code>nil</code>, or a function which is called by <code>tvob-setup</code> (see (tvob-setup-fun))
when this job is current and a new <code>selected-tvob</code> is needed.
The function takes no arguments and doesn&rsquo;t return anything in particular.
It isn&rsquo;t required to do anything, but it normally should call <code>tvob-select</code>
with an appropriate TVOB.
</p></dd>
<dt><code>job-forced-input</code></dt>
<dd><p>If non-<code>nil</code>, a character or a string which is forced input for this job.
This is a character or characters which are pretending to come from the keyboard
but really originated from another process or the mouse.  See the function
<code>force-kbd-input</code> ((force-kbd-input-fun)).
</p></dd>
<dt><code>job-forced-input-index</code></dt>
<dd><p>Index into <code>job-forced-input</code> when it is a string.
</p></dd>
</dl>

<p>At any time, the user of the Lisp Machine may be conducting several
different activities.  For example, he may want to temporarily stop editing
in order to send some mail; he might want to start up a file transfer, and
while waiting for it to finish, continue editing.
</p>
<p>Each such activity, in general, will want some processes to do
computation, and some pieces of the screen (TVOBs) on which to do output.
When the user is not concerned with some activity, he may want its
processes to stop, and/or its TVOBs to stop displaying.  In order to
make it easy to deactivate a set of processes and TVOBs, such a set
may be grouped together as a <i>job</i>.
</p>
<p>Every job has a set of processes and TVOBs; these sets are
represented by the lists in the <code>job-processes</code> and <code>job-tvobs</code>
of the job.  Of each set, there is a subset that is <i>enabled</i>;
these are the <code>job-enabled-processes</code> and <code>job-enabled-tvobs</code>
of the job.  A process&rsquo;s being <i>enabled</i> means that whenever
the job is told that it may run, that process
will be made <i>active</i>.  The same is true for TVOBs.
When the job is told that it may run its enabled processes, it is
said to be <i>process-enabled</i>; when it is told that it may
display its enabled TVOBs, it is said to be <i>tvob-enabled</i>.
A job can control which of its processes and TVOBs are enabled
by means of the functions <code>process-enable</code>, <code>process-disable</code>,
<code>tvob-enable</code>, and <code>tvob-disable</code>, which are described below.
</p>
<p>At any time there is one job which is said to &quot;own the keyboard&quot;;
this job is the value of the variable <code>kbd-job</code>.  When a function calls
any of the keyboard input functions (such as <code>kbd-tyi</code>), the function
will wait until the current job is the <code>kbd-job</code> before returning.
The reason for this is that while the TV can be split up into areas
so that several programs can type on it at once, there is no similar
way to split up the keyboard; if several jobs want keyboard input,
one of them will get what the user types, and the rest will wait
until they become the <code>kbd-job</code>.
</p>
<p>When Lisp is initialized, one job is created and given the keyboard.
The job is given a single, active TVOB, the size of the screen, and
a single, active process.  It is both process-enabled and TVOB-enabled,
so the process and TVOB are both active.
</p>
<a name="Controlling-Jobs"></a>
<h3 class="section">22.4 Controlling Jobs</h3>

<p>It should be made easy for the user to control which jobs
are process-enabled and which are TVOB-enabled.
Unfortunately, the commands to allow easy control
of these parameters have not yet been fully developed.  This section
describes what has been implemented so far, but this will probably change.
</p>
<p>The following two simple functions control whether
a job is process-enabled or TVOB-enabled.
</p>
<dl>
<dt><a name="index-job_002dset_002dprocess_002dstate"></a>Function: <strong>job-set-process-state</strong> <em>job state</em></dt>
<dd><p>If <i>state</i> is non-<code>nil</code>, <i>job</i> is made process-enabled;
otherwise, it is made process-disabled.
</p></dd></dl>

<dl>
<dt><a name="index-job_002dset_002dtvob_002dstate"></a>Function: <strong>job-set-tvob-state</strong> <em>job state</em></dt>
<dd><p>If <i>state</i> is non-<code>nil</code>, <i>job</i> is made TVOB-enabled;
otherwise, it is made TVOB-disabled.  Since this function can change
the set of active TVOBs, the caller should follow with a call to
<code>tvob-setup</code> (see (tvob-setup-fun)).
</p></dd></dl>

<p>There is one job designated as the top-level job, from
which other jobs are selected.  This job is the value of the variable
<code>si:top-job</code>.  When Lisp is initialized, <code>si:top-job</code> is set
to the initial job, and usually it is never set again.  If this job
wants to let some other job run, it uses the function <code>job-select</code>,
which may be called directly by the user, or by a program&rsquo;s &quot;command interface&quot;
function.  (The functions <code>ed</code>, <code>edval</code>, and <code>edprop</code> serve
this purpose for Eine, and the function <code>supdup</code> for the Supdup program.)
</p>
<dl>
<dt><a name="index-job_002dselect"></a>Function: <strong>job-select</strong> <em>job</em></dt>
<dd><p><code>job-select</code> should be called from the top-level job to give the
keyboard to <i>job</i>.  The top-level job is made process-disabled
and TVOB-disabled, and <i>job</i> is made process-enabled and TVOB-enabled,
and is given the keyboard (made to be the <code>kbd-job</code>).
</p></dd></dl>

<p>When the keyboard belongs to some job other than the top-level job,
the &quot;CALL&quot; key is interpreted specially to mean &quot;Return the keyboard to the
top-level job.&quot;  If the user types a &quot;CALL&quot;, the current <code>kbd-job</code> will
be made process-disabled and TVOB-disabled, the top-level job will be made
process-enabled and TVOB-enabled, and the top-level job will be given the
keyboard. The Control and Meta keys can be used with CALL:
Control prevents the current <code>kbd-job</code> from being made TVOB-disabled,
and Meta stops it from being process-disabled.
</p>
<a name="Functions-for-Manipulating-TVOBs_002e"></a>
<h3 class="section">22.5 Functions for Manipulating TVOBs.</h3>

<p>The following four functions are all used to create TVOBs; they
differ primarily in the way the caller specifies the TVOB&rsquo;s area of the screen.
To fully specify the area, use <code>tvob-create-absolute</code>.
If you just want an area of a certain size, but don&rsquo;t care where the area
is, use <code>tvob-create</code>.
If you need at least a certain size but would accept a larger size
if the space is available, use <code>tvob-create-expandable</code>.
If you have a pc ppr (piece of paper) and want to make a TVOB
for it, use <code>tvob-create-for-pc-ppr</code>.
</p>
<dl>
<dt><a name="index-tvob_002dcreate_002dabsolute"></a>Function: <strong>tvob-create-absolute</strong> <em>x1 y1 x2 y2 &amp;rest options</em></dt>
<dd><p><code>tvob-create-absolute</code> creates and returns a new TVOB.
Its fields are set up as follows:
</p>
<dl compact="compact">
<dt><code>tvob-handler</code></dt>
<dd><p>The value of the <code>:handler</code> option.
</p></dd>
<dt><code>tvob-info</code></dt>
<dd><p>The value of the <code>:info</code> option.
</p></dd>
<dt><code>tvob-job</code></dt>
<dd><p>The value of the <code>:job</code> option.  If it is <code>t</code>, the current job is used instead;
this is the default.
Otherwise it should be <code>nil</code> (meaning that the TVOB
is not associated with any job), or a job.
</p></dd>
<dt><code>tvob-priority</code></dt>
<dd><p>The value of the <code>:priority</code> option.
</p></dd>
<dt><code>tvob-x1</code></dt>
<dd><p><i>x1</i>.
</p></dd>
<dt><code>tvob-y1</code></dt>
<dd><p><i>y1</i>.
</p></dd>
<dt><code>tvob-x2</code></dt>
<dd><p><i>x2</i>.
</p></dd>
<dt><code>tvob-y2</code></dt>
<dd><p><i>y2</i>.
</p></dd>
<dt><code>tvob-screen</code></dt>
<dd><p>The value of the <code>:screen</code> option, which should be a screen.  It defaults
to the value of <code>tv-default-screen</code>.
</p></dd>
<dt><code>tvob-status</code></dt>
<dd><p>The value of the <code>:status</code> option.
</p></dd>
<dt><code>tvob-clobbered-p</code></dt>
<dd><p><code>nil</code>.
</p></dd>
<dt><code>tvob-mouse-handler</code></dt>
<dd><p>The value of the <code>:mouse-handler</code> option.  If the value is <code>t</code>,
use the default mouse handler.
</p></dd>
</dl>

<p>The options to <code>tvob-create-absolute</code> are:
</p>
<dl compact="compact">
<dt><code>:handler</code></dt>
<dd><p>The <code>tvob-handler</code> function.
</p></dd>
<dt><code>:info</code></dt>
<dd><p>The value to go in the <code>tvob-info</code> field.
</p></dd>
<dt><code>:job</code></dt>
<dd><p>The job with which the TVOB will be associated.  <code>t</code> means the current
job and <code>nil</code> means no job.  The default is the current job.
</p></dd>
<dt><code>:mouse-handler</code></dt>
<dd><p>The <code>tvob-mouse-handler</code> function.  <code>nil</code> means this TVOB doesn&rsquo;t
do anything special with the mouse, and <code>t</code> means the <code>mouse-default-handler</code>
should be used.
</p></dd>
<dt><code>:name</code></dt>
<dd><p>The print-name of the TVOB.
</p></dd>
<dt><code>:priority</code></dt>
<dd><p><code>t</code> to make this TVOB more tenacious of its place on the screen.
</p></dd>
<dt><code>:screen</code></dt>
<dd><p>The screen on which the TVOB will appear.  The default is <code>tv-default-screen</code>.
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-tvob_002dcreate"></a>Function: <strong>tvob-create</strong> <em>x y &amp;rest options</em></dt>
<dd><p>This allocates an area of the screen of width <i>x</i> and height <i>y</i>, and
creates and returns a TVOB with that area.
The options are the same as for <code>tvob-create-absolute</code>.
The screen area of the TVOB will be within the rectangular boundaries described
by the <code>screen-x1</code>, <code>screen-y1</code>, <code>screen-x2</code>, and <code>screen-y2</code>
of the screen on which the TVOB is created.
<code>tvob-create</code> tries to choose an area that will overlap
the fewest interesting TVOBs.  Specifically, it tries to stay out of the area used by
the exposed TVOB of the highest priority, then that of the exposed TVOB of the second-highest
priority, etc.  The way priority works is that the exposed tvobs are divided into
two groups: those with <code>tvob-priority</code> of <code>t</code>, and those with <code>tvob-priority</code>
of <code>nil</code>; the former all have higher priority than the latter.  Within
these two groups, the TVOBs are ordered by their ordering in the list <code>active-tvobs</code>.
The priority is remembered by the ordering of the list <code>exposed-tvobs</code>, of which
the first element is the TVOB of <i>lowest</i> priority, and the last is the TVOB
of <i>highest</i> priority.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dcreate_002dexpandable"></a>Function: <strong>tvob-create-expandable</strong> <em>min-x min-y &amp;optional max-x max-y &amp;rest options</em></dt>
<dd><p>This first finds a <i>min-x</i> by <i>min-y</i> area of the screen, the same way
<code>tvob-create</code> does.  Then it tries to make that area larger,
up to <i>max-x</i> by <i>max-y</i>, without overlapping any other exposed TVOBs.
Otherwise it is like <code>tvob-create</code>.  <i>max-x</i> defaults to the size
of the area in which automatic allocation takes place: the difference between
the <code>screen-x2</code> and <code>screen-x1</code> of the screen.  <i>max-y</i> defaults similarly.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dcreate_002dfor_002dpc_002dppr"></a>Function: <strong>tvob-create-for-pc-ppr</strong> <em>pc-ppr &amp;rest options</em></dt>
<dd><p>If you want to use a pc ppr, you need an associated TVOB in order
to get permission for your pc ppr to use the screen.
This function takes a pc ppr and creates a TVOB, whose area of the
screen is that of the pc ppr.  The <code>tvob-info</code> will be the pc ppr,
the <code>tvob-handler</code> a function called <code>si:pc-ppr-tvob-handler</code>
(which does the right thing for pieces of paper which don&rsquo;t remember what they are
displaying and hence cannot <code>:update</code>),
and the screen used will be the <code>pc-ppr-screen</code> of the pc ppr.
If you give the <code>:handler</code> option, though, it will override
the <code>si:pc-ppr-tvob-handler</code>.  The rest of the options are the same
as in <code>tvob-create-absolute</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dkill"></a>Function: <strong>tvob-kill</strong> <em>tvob</em></dt>
<dd><p>This deactivates <i>tvob</i> if it is active, and dissociates it from
its associated job (if any).
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002denable"></a>Function: <strong>tvob-enable</strong> <em>tvob</em></dt>
<dd><p>Enable <i>tvob</i>.  If <i>tvob</i> has no associated job, or if its
job is tvob-enabled, activate <i>tvob</i>.  After making some calls
to <code>tvob-enable</code> and <code>tvob-disable</code>, the caller should call
<code>tvob-setup</code> (see (tvob-setup-fun)).
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002ddisable"></a>Function: <strong>tvob-disable</strong> <em>tvob</em></dt>
<dd><p>Disable <i>tvob</i>.  If it was active, deactivate it.  After making some calls
to <code>tvob-enable</code> and <code>tvob-disable</code>, the caller should call
<code>tvob-setup</code> (see (tvob-setup-fun)).
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dsetup"></a>Function: <strong>tvob-setup</strong> <em>no-reselection &amp;rest tvobs</em></dt>
<dd><p>This is the function in charge of keeping the state of the screen and
the internal database consistent when tvobs are activated, deactivated,
moved, etc.  After a program makes some calls to <code>tvob-enable</code> and
<code>tvob-disable</code>, it may have changed the set of <i>active</i> TVOBs, and
it should call <code>tvob-setup</code> to make sure that the set of <i>exposed</i>
TVOBs is recomputed, and that the right messages are sent to all TVOBs.
(If <code>tvob-enable</code> etc. did that themselves, then unneccesary
redisplay and computation would be unavoidable.) The
<code>job-set-tvob-state</code> function can also change the set of active
TVOBs, and it too should be followed by a call to <code>tvob-setup</code>.
</p>
<p><code>tvob-setup</code> looks at its argument, <i>tvobs</i>, and at the list of
active TVOBs and figures out which TVOBs should be exposed.
</p>
<p>First, <code>tvob-setup</code> examines the elements of <i>tvobs</i>, all of which
should be active, and rearranges the order of <code>active-tvobs</code>.  The
TVOBs in <i>tvobs</i> are moved to the front of <code>active-tvobs</code>, and
placed in the order they were given to <code>tvob-setup</code>.  The first TVOB
in <i>tvobs</i> is guaranteed to be first in <code>active-tvobs</code>.  The
remaining active TVOBs are moved to the end of <code>active-tvobs</code>.  Their
relative order is not changed.  The <code>job-enabled-tvobs</code> lists of the
TVOB&rsquo;s jobs are similarly reordered.
</p>
<p>Next, <code>tvob-setup</code> figures out the new subset of the active TVOBs
that should be exposed, by walking down the <code>active-tvobs</code> list and
taking every TVOB that doesn&rsquo;t overlap with some TVOB already on the
new <code>exposed-tvobs</code> list.  Since the new list starts out as <code>nil</code>,
the first element of <code>active-tvobs</code>, which was the second argument to
<code>tvob-setup</code>, will always be exposed.  The exposed list is kept in
reverse priority order, as explained under <code>tvob-create</code> (see
(tvob-create-fun)).
</p>
<p>Having determined the new set of exposed tvobs, <code>tvob-setup</code> sends
out <code>:deselect</code>, <code>:deexpose</code>, and <code>:expose</code> commands as needed.
It only sends <code>:deselect</code> if the selected tvob would no longer be exposed;
when it does this, it also sets <code>selected-tvob</code> to <code>nil</code>. At this point,
<code>exposed-tvobs</code> is set to its new value.  <code>tvob-select</code> then sends
<code>:clobber</code> and <code>:update</code> commands to all of the new exposed TVOBs.
</p>
<p>Finally, if there is no <code>selected-tvob</code>, and <i>no-reselection</i>
is <code>nil</code>, <code>tvob-setup</code> tries to choose a new <code>selected-tvob</code> by calling
the <code>job-tvob-selector</code> function of the <code>kbd-job</code> (if there is a <code>kbd-job</code>
and it has a <code>job-tvob-selector</code>).
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dselect"></a>Function: <strong>tvob-select</strong> <em>tvob</em></dt>
<dd><p>This makes <i>tvob</i> be the <code>selected-tvob</code>.  It makes sure
that <i>tvob</i>&rsquo;s job is TVOB-enabled, and that <i>tvob</i> is exposed.
Then it deselects the current <code>selected-tvob</code> (if any) and selects
<i>tvob</i>.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dupdate"></a>Function: <strong>tvob-update</strong></dt>
<dd><p>If the variable <code>tvob-complete-redisplay</code> is non-<code>nil</code>, set it to
<code>nil</code> and call <code>tvob-complete-redisplay</code>.  Otherwise send
an <code>:update</code> message to all exposed TVOBs.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dcomplete_002dredisplay-1"></a>Variable: <strong>tvob-complete-redisplay</strong></dt>
<dd><p>Used as a flag by <code>tvob-update</code> (see above): if non-<code>nil</code>, <code>tvob-update</code>
should do a <code>tvob-complete-redisplay</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dcomplete_002dredisplay"></a>Function: <strong>tvob-complete-redisplay</strong></dt>
<dd><p>Clears the screen, outlines the screen area of partially-exposed enabled TVOBs,
and sends <code>:clobber</code> and <code>:update</code> to all exposed TVOBs.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dclean"></a>Function: <strong>tvob-clean</strong></dt>
<dd><p>This &quot;cleans up&quot; the screen.  It sends a <code>:clean</code> message to all exposed TVOBs,
and clears portions of the screen not occupied by exposed TVOBs.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dcommand"></a>Function: <strong>tvob-command</strong> <em>command tvob &amp;rest arguments</em></dt>
<dd><p>Sends <i>command</i> to <i>tvob</i>, with the given <i>arguments</i>.
<i>command</i> should be one of the symbols mentioned above
(<code>:set-edges</code>, <code>:clobber</code>, etc.).  After sending the command,
<code>tvob-command</code> updates the <i>tvob</i>&rsquo;s <code>tvob-status</code>,
<code>tvob-clobbered-p</code>, or the screen area (<code>tvob-x1</code> et. al.) as
appropriate.
</p>
<p>In order to preserve consistency, only the <code>tvob-setup</code> and <code>tvob-select</code> functions
should send any of the commands <code>:select</code>, <code>:deselect</code>, <code>:expose</code>,
and <code>:deexpose</code>; you should never send these yourself.
</p></dd></dl>

<dl>
<dt><a name="index-tvob_002dunder_002dpoint"></a>Function: <strong>tvob-under-point</strong> <em>x y &amp;optional screen</em></dt>
<dd><p>Returns the TVOB under the point (<i>x</i>,<i>y</i>) on <i>screen</i>, or
<code>nil</code> if there is none.  If there are several TVOBs at that point,
the &quot;top-most&quot; one, i.e. the one which is actually visible, is
returned.  <i>screen</i> defaults to <code>tv-default-screen</code>.
</p></dd></dl>

<a name="Functions-for-Manipulating-Jobs_002e"></a>
<h3 class="section">22.6 Functions for Manipulating Jobs.</h3>

<dl>
<dt><a name="index-job_002dcreate"></a>Function: <strong>job-create</strong> <em>name</em></dt>
<dd><p>Creates and returns a job, whose name is <i>name</i>.
The job is created with no processes and no TVOBs,
and its initial <code>job-process-enabled-p</code> and <code>job-tvob-enabled-p</code>
are both <code>nil</code>.  <code>job-create</code> also puts the job on <code>job-list</code>.
</p></dd></dl>

<dl>
<dt><a name="index-job_002dkill"></a>Function: <strong>job-kill</strong> <em>job</em></dt>
<dd><p>Deactivates and kills all of <i>job</i>&rsquo;s processes and TVOBs,
and removes <i>job</i> from the <code>job-list</code>.
</p></dd></dl>

<dl>
<dt><a name="index-job_002dlist"></a>Variable: <strong>job-list</strong></dt>
<dd><p>A list of all jobs.  See <code>job-create</code> and <code>job-kill</code>.
</p></dd></dl>

<dl>
<dt><a name="index-job_002dreset_002dprocesses"></a>Function: <strong>job-reset-processes</strong> <em>job</em></dt>
<dd><p>Disables all of <i>job</i>&rsquo;s enabled processes, and unwinds those
processes&rsquo;s stack groups.
</p></dd></dl>

<dl>
<dt><a name="index-job_002dselect-1"></a>Function: <strong>job-select</strong> <em>job</em></dt>
<dd><p>This is meant to be called from the top-level job, which should have
the keyboard at the time.
It disables the <code>kbd-job</code>&rsquo;s processes and TVOBs,
enables those of <i>job</i>, and gives <i>job</i> the keyboard.
</p></dd></dl>

<dl>
<dt><a name="index-job_002dreturn"></a>Function: <strong>job-return</strong></dt>
<dd><p>This is meant to be called from jobs other than the top-level job.
It disables the current job&rsquo;s processes and TVOBs,
enables those of the top-level job, and gives the top-level job
the keyboard.
[The job calling it had better have the keyboard.]
</p></dd></dl>


<a name="The-TV-Display"></a>
<h2 class="chapter">23 The TV Display</h2>
<a name="index-tv"></a>

<p>The principal output device of the Lisp Machine is the TV display
system.  It is used in conjunction with the keyboard as an interactive
terminal, and it can output printed text or graphics.  This chapter
describes the Lisp functions used to manipulate the TV.
</p>
<a name="The-Hardware"></a>
<h3 class="section">23.1 The Hardware</h3>

<p>The Lisp machine display system is a raster-scan, bit-map
system.  This means that the screen is divided up rectangularly into
points.  The video signal that enters the TV comes from
a memory which has one bit for every point on the screen.
This memory is directly accessible to the program, allowing extremely
flexible graphics.
</p>
<p>The coordinate system normally used has the origin (0,0) at the
top left corner of the screen.  <i>X</i> increases to the right, and <i>Y</i>
increases downward.
</p>
<p>There are currently two TV controllers in use.  The 16-bit controller,
which is going away, generates industry-standard composite video, allowing
a screen size of 454. lines from top to bottom with 576. points on each
line.  The newer, 32-bit controller, provides various options.  With the
CPT monitor it generates a black-and-white display of 896. lines with
768. points on each line.  Other monitors can also be supported.
</p>
<p>One thing to be aware of is that the same fonts cannot be used
with both controllers, because the 16-bit controller has its bits reversed.
</p>
<p>It is possible to have a display in which there is more than
one bit per visible point, allowing gray-scale or color.  The set of all
bits which contribute to a single point on the screen is called a
<i>pixel</i>.  (The point on the screen itself is also sometimes called a
pixel.)  Some of the software operates in terms of pixels.  Pixels are
implemented in an entirely different way in the two controllers.  This
document doesn&rsquo;t really discuss them yet.
</p>
<p>Because of all these options, the Lisp machine system
includes <i>screen objects</i>.  A screen object contains all the
attributes of a particular TV controller and display monitor.
</p>
<a name="Screens"></a>
<h3 class="section">23.2 Screens</h3>
<a name="index-screen"></a>

<p>There is a type of Lisp object called a <i>screen</i>, which is the internal
representation for a physical display with someone looking at it.  Both
microcode and Lisp functions look at screen objects.
A screen is a structure which contains the following fields:
</p>
<dl compact="compact">
<dt><code>screen-name</code></dt>
<dd><p>An arbitrary character string which appears in the printed representation
of the screen-object.
</p></dd>
<dt><code>screen-height</code></dt>
<dd><p>The total height of the screen in bits (raster lines, pixels).
</p></dd>
<dt><code>screen-width</code></dt>
<dd><p>The total width of the screen in bits (pixels).
</p></dd>
<dt><code>screen-x1, screen-x2, screen-y1, screen-y2</code></dt>
<dd><p>The coordinates of a rectangle which is the portion of the
screen in which allocation of tvobs may occur.  Usually this
is the whole screen, but if there is a who-line it is excluded.
There could be other reserved areas of the screen.
</p></dd>
<dt><code>screen-plane-mask</code></dt>
<dd><p>0 if this screen is on a 32-bit controller.  If it is on a 16-bit
controller, one of the bits in this mask is on corresponding to
the memory &quot;plane&quot; which contains this screen.  (For instance,
for plane 0 the value of this field would be 1.)  Having more than
one bit on in this mask is not really supported.
</p></dd>
<dt><code>screen-bits-per-pixel</code></dt>
<dd><p>The number of bits in a pixel.
</p></dd>
<dt><code>screen-property-list</code></dt>
<dd><p>This is a property list for special features of this screen.
Access this via forms such as <code>(get (locf (screen-property-list s)) ':video)</code>
The following property names are standard.
</p><dl compact="compact">
<dt><code>:video</code></dt>
<dd><p>The kind of video this screen uses.
One of <code>:black-and-white</code>, <code>:gray</code>, <code>:color</code>.
</p></dd>
<dt><code>:controller</code></dt>
<dd><p>The only controller that exists currently is <code>:simple</code>.
</p></dd>
<dt><code>:monitor</code></dt>
<dd><p>The brand-name of the attached monitor, e.g. <code>:cpt</code>, <code>:barco</code>, etc.
</p></dd>
<dt><code>:sideways</code></dt>
<dd><p>If the value of this property is non-<code>nil</code>,
the monitor is standing on its left side.  The TV routines know how
to draw characters on such a screen, given a rotated font, so that
the text comes out in the normal orientation.
</p></dd>
</dl>

</dd>
<dt><code>screen-font-alist</code></dt>
<dd><p>An a-list that associates from font names to font objects.
This is not really used yet.
</p></dd>
<dt><code>screen-default-font</code></dt>
<dd><p>The font to be used by default on this screen.
</p></dd>
<dt><code>screen-buffer</code></dt>
<dd><p>The address in virtual memory of the video buffer for this screen.
</p></dd>
<dt><code>screen-locations-per-line</code></dt>
<dd><p>The number of locations (containing 16 or 32 bits depending on the controller)
of the video buffer for a scan line.
</p></dd>
<dt><code>screen-buffer-pixel-array</code></dt>
<dd><p>A two-dimensional array of positive integers, which are pixel values.
The first subscript is the X coordinate and the second subscript is the Y coordinate.
</p></dd>
<dt><code>screen-buffer-halfword-array</code></dt>
<dd><p>A one-dimensional array of 16-bit words of video buffer.  This is provided to allow
direct manipulation of the video buffer, bypassing the usual microcode primitives.
Note that on a 16-bit controller, the bits in these words are reversed.
</p></dd>
<dt><code>screen-control-address</code></dt>
<dd><p>The address, suitable for use with <code>%xbus-read</code>, of the hardware control registers
for this screen.
</p></dd>
</dl>

<dl>
<dt><a name="index-tv_002ddefault_002dscreen"></a>Variable: <strong>tv-default-screen</strong></dt>
<dd><p>The value of <code>tv-default-screen</code> is the &quot;normal&quot; screen where
text display happens.  Various functions that take a screen as an
optional argument default to this.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddefine_002dscreen"></a>Function: <strong>tv-define-screen</strong> <em>name &amp;rest options</em></dt>
<dd><p>Creates and returns a screen whose name is <i>name</i> (a string)
and whose attributes are controlled by the options.  These attributes
has better correspond to an existing hardware screen.
<i>options</i> is alternating keywords and arguments to those keywords.  The following
keywords are accepted:
</p>
<dl compact="compact">
<dt><code>:plane-mask</code></dt>
<dd><p>The value of the <code>screen-plane-mask</code> field.  Defaults to 0,
for screens on the 32-bit TV controller.
(This is obsolete.)
</p></dd>
<dt><code>:height</code></dt>
<dd><p>The value of the <code>screen-height</code> field.  Required argument.
</p></dd>
<dt><code>:width</code></dt>
<dd><p>The value of the <code>screen-width</code> field.  Required argument.
</p></dd>
<dt><code>:x1</code></dt>
<dd><p>The value of the <code>screen-x1</code> field.  Defaults to 0.
</p></dd>
<dt><code>:y1</code></dt>
<dd><p>The value of the <code>screen-y1</code> field.  Defaults to 0.
</p></dd>
<dt><code>:x2</code></dt>
<dd><p>The value of the <code>screen-x2</code> field.  Defaults to the width.
</p></dd>
<dt><code>:y2</code></dt>
<dd><p>The value of the <code>screen-y2</code> field.  Defaults to the height,
unless the <code>:who-line-p</code> option is specified, in which case
one line of space is left at the bottom of the screen for the who-line.
</p></dd>
<dt><code>:who-line-p</code></dt>
<dd><p><code>t</code> to leave space for a who-line, <code>nil</code> to make the entire
screen available for TVOB allocation.  Defaults to <code>t</code>.
</p></dd>
<dt><code>:buffer</code></dt>
<dd><p>A fixnum which is the address of the video buffer containing
the bits for this screen.  Required argument.
</p></dd>
<dt><code>:control-address</code></dt>
<dd><p>A fixnum which goes into the <code>screen-control-address</code> field.
</p></dd>
<dt><code>:locations-per-line</code></dt>
<dd><p>The value of the <code>screen-locations-per-line</code> field.  Defaults from
the width, the bits per pixel, and the controller type.
</p></dd>
<dt><code>:bits-per-pixel</code></dt>
<dd><p>The value of the <code>screen-bits-per-pixel</code> field.  Defaults to 1.
</p></dd>
<dt><code>:properties</code></dt>
<dd><p>The value of the <code>screen-attributes</code> field.  Defaults to <code>nil</code>.
</p></dd>
<dt><code>:font-alist</code></dt>
<dd><p>The value of the <code>screen-font-alist</code> field.  Defaults to <code>nil</code>.
</p></dd>
<dt><code>:default-font</code></dt>
<dd><p>The value of the <code>screen-default-font</code> field.  Defaults
according to the type of controller used.
</p></dd>
</dl>

</dd></dl>

<a name="Simple-Bit-Manipulation"></a>
<h3 class="section">23.3 Simple Bit Manipulation</h3>

<p>Some arrays of numbers exist which allow access to the TV memory.  These
are regular Lisp arrays and all array operations work on them, but they
are set up so that their data storage is actually in the TV memory.
These arrays are normally found in fields of a screen object.
</p>
<p><code>screen-buffer-pixel-array</code> is a two-dimensional array.  Array element
(<i>x</i>,<i>y</i>) corresponds to the point whose coordinates are <i>x</i> and
<i>y</i>: if the array element is 0, the point is illuminated, and if the
element is 1, the point is dark.  (The opposite is true when the TV is
in reverse-video mode; see below).
</p>
<p>The elements of this array are single bits in the usual case, but they can
be small positive numbers in the case of gray-scale or color screens.
</p>
<p>In the case of a 16-bit TV, this array accesses whichever
plane is currently selected.
</p>
<p><code>screen-buffer-halfword-array</code> is a one-dimensional array of 16-bit
elements, whose exact interpretation depends on the type of TV screen.
Certain programs use this to access the TV buffer memory.
</p>
<p>It is possible to do anything to a TV screen, albeit slowly, using the
above two arrays.  However, for efficiency several microcode primitives
are provided which perform certain common operations at much higher speed,
typically close to the maximum speed of the memory.  Most programs use
these microcode primitives or the higher-level functions built on them
rather than accessing the TV buffer memory directly.  The remainder of
this chapter describes these facilities.
</p>
<a name="Fonts"></a>
<h3 class="section">23.4 Fonts</h3>
<a name="index-font"></a>

<p>A font is a set of related characters.  It is represented by an array
(of type <code>art-1b</code>) which contains the bit patterns used to actually draw the
characters.  The leader of that array contains other required information
such as character widths, height, bookkeeping information, etc.
</p>
<p>There is a microcode entry for drawing characters, which understands the
structure of fonts.  It exists so as to make character drawing as fast
as possible.  User functions do not call the microcode entry directly,
as it is rather kludgey, and handles only the easy cases.  Instead the
TV routines do all the necessary calls.
</p>
<p>A font usually contains 128 characters.  The widths may be
variable, but the height is always fixed (characters need not actually have
ink all the way from the top to the bottom of the height, but the distance
between lines is fixed for each font).  There are special provisions
for fixed-width fonts to save space and time.  There is a thing called
the baseline, which is a certain vertical position in each character.
For example, the baseline touches the bottom of the legs of a capital A,
and passes through the stem of a lower-case p.
When several fonts are used together, all the baselines are made to line up.
</p>
<p>The way characters are drawn is a little strange (it is done this way for
speed).  There is a thing called a <i>raster element</i>, which is a row of
1-bits and 0-bits.  A character is drawn by taking a column of raster elements,
(making a rectangle) and OR&rsquo;ing this into the bit-map memory.  A raster
element can be at most 16 bits wide for hardware reasons, so for large characters
it may take several side-by-side columns to draw the character.  The font
is stored with several raster elements packed into each 32-bit word.  The width
of a raster element is chosen to give maximum packing, and depends on the font.
The reason for the existence of raster elements is to decrease the number
of memory cycles by processing several bits at a time.
</p>
<p>The structure of the array leader of a font is defined by <code>defstruct</code>
macros.  Here we list the element names and what they are for.  This structure
is not guaranteed not to be changed in the future, however the macros
are automatically made available to user programs.
</p>
<dl compact="compact">
<dt><code>font-name</code></dt>
<dd><p>A symbol, in the <code>fonts</code> package, whose value is this font.
This symbol also appears in the printed representation.
</p></dd>
<dt><code>font-char-height</code></dt>
<dd><p>Height of the characters in this font (with a VSP
of 0, this is how far apart the lines would be.)
</p></dd>
<dt><code>font-char-width</code></dt>
<dd><p>Width of the characters if this is a fixed-width font,
i.e. how far apart successive characters are drawn.
Otherwise contains the width of &quot;space&quot;.
</p></dd>
<dt><code>font-raster-height</code></dt>
<dd><p>Number of raster lines of &quot;ink&quot; in a character (often
the same as <code>font-char-height</code>).
</p></dd>
<dt><code>font-raster-width</code></dt>
<dd><p>Width of a raster element.
</p></dd>
<dt><code>font-rasters-per-word</code></dt>
<dd><p>Number of elements packed per word (used when accessing the font.)
</p></dd>
<dt><code>font-words-per-char</code></dt>
<dd><p>Number of words needed to hold one column of elements.
</p></dd>
<dt><code>font-baseline</code></dt>
<dd><p>Number of raster lines down from the top of the
character cell of the position to align.
</p></dd>
<dt><code>font-char-width-table</code></dt>
<dd><p><code>nil</code> for fixed width fonts.  Otherwise, contains the
128-long array of character widths.
</p></dd>
<dt><code>font-left-kern-table</code></dt>
<dd><p><code>nil</code> for non-kerned fonts.  Otherwise, contains the
128-long array of left-kerns.  This is the amount (positive
or negative) to back up the X position before drawing
the character.
</p></dd>
<dt><code>font-indexing-table</code></dt>
<dd><p><code>nil</code> for narrow fonts which only take one column of
raster elements to draw.  Otherwise, contains a
129-long array which determines what columns of the
font to draw for that character as follows: for
character <i>i</i>, draw columns <i>indexingtable</i>(<i>i</i>) through
<i>indexingtable</i>(<i>i</i>+1)-1
inclusive.
Note that 2 of the above 3 arrays only contain small
positive numbers, so they are usually of type <code>art-16b</code> or
<code>art-8b</code> to save space.
</p></dd>
<dt><code>font-next-plane</code></dt>
<dd><p><code>nil</code> usually.  For multi-plane fonts, contains the
font for the next higher plane.  This field is obsolete and no
longer supported.
</p></dd>
<dt><code>font-blinker-width</code></dt>
<dd><p>Default width for blinkers.
</p></dd>
<dt><code>font-blinker-height</code></dt>
<dd><p>Default height for blinkers.
</p></dd>
</dl>

<p>The data part of a font array contains an integral number of words per
character (per column in the case of wide characters that need an
indexing table).  Each word contains an integral number of raster
elements, left adjusted and processed from left to right.  All 32 bits
of each element in this array are used.  For easiest processing by Lisp
programs, it should be of <code>art-1b</code> array type.
</p>
<p>The exact format of the data part of a font array depends on whether
the font is intended to be used with a 16-bit TV controller or a 32-bit controller.
In the 32-bit case, the bits are displayed from right to left.  The maximum
width of a raster element is 32. bits; use of the <code>font-indexing-table</code>
is required if characters are wider than this.  If there is more than one
raster element per word, the elements are displayed from right to left.
In the 16-bit case, the bits and raster elements are displayed from
left to right, and the maximum width of a raster element is 16. bits.
</p>
<a name="TVOBs-1"></a>
<h3 class="section">23.5 TVOBs</h3>

<p>[Here explain what TVOBs are, how they differ from pieces of paper, what
you use them for, and point to JOBSYS chapter.]  Until this is written,
see (tvob).
</p>
<a name="Pieces-of-Paper"></a>
<h3 class="section">23.6 Pieces of Paper</h3>
<a name="index-pc-ppr"></a>
<a name="index-piece-of-paper"></a>

<p>A <i>piece of paper</i> is something on which you draw
characters.  It is displayed on a certain rectangular portion of a
screen.  It remembers what fonts to use, where to display the next
character, how to arrange margins and spacing, and what to do when
certain special conditions arise.  It optionally displays a blinking cursor
(or several of them).
</p>
<p>All character-drawing in the Lisp
Machine system is accomplished with pieces of paper.  One thing to note
is that pieces of paper do not remember the characters you draw on
them, except by making dots on the TV screen.  This means that if one
piece of paper overlays another, or if the screen is cleared, the
contents of the first is lost.  A higher-level facility (e.g. editor
buffers) must be used if the characters are to be remembered.  The
abbreviation &quot;pc ppr&quot; is often used for &quot;piece of paper&quot;.
</p>
<p>A piece of paper is represented as an ordinary array whose elements are
named by the following accessor macros.  These are automatically available
to the user, but should not normally be used as they are not guaranteed to remain unchanged,
and often contain internal values which are made into more palatable
form by the interface functions.  All screen coordinates in this structure
are absolute screen coordinates; the user interface functions convert these
into coordinates which are relative to the margins of the piece of paper.
</p>
<dl compact="compact">
<dt><code>pc-ppr-name</code></dt>
<dd><p>An arbitrary string which appears in the printed representation.
</p></dd>
<dt><code>pc-ppr-screen</code></dt>
<dd><p>The screen-object representing the screen on which this pc ppr displays.
</p></dd>
<dt><code>pc-ppr-top</code></dt>
<dd><p>The raster line number of the topmost screen line in this pc ppr.
</p></dd>
<dt><code>pc-ppr-top-margin</code></dt>
<dd><p>The raster line number of the topmost screen line used to draw characters.
The difference between <code>pc-ppr-top-margin</code> and <code>pc-ppr-top</code> is the size
of the top margin.
</p></dd>
<dt><code>pc-ppr-bottom</code></dt>
<dd><p>The raster line number of the screen line just below this pc ppr.
</p></dd>
<dt><code>pc-ppr-bottom-margin</code></dt>
<dd><p>The raster line number of the screen line just below the bottommost point
on which a character can be drawn.  The difference between <code>pc-ppr-bottom</code>
and <code>pc-ppr-bottom-margin</code> is the size of the bottom margin.
</p></dd>
<dt><code>pc-ppr-bottom-limit</code></dt>
<dd><p>The lowest raster line to which the cursor may be positioned.  This is a suitable
value to prevent excursion below the bottom margin.
</p></dd>
<dt><code>pc-ppr-left</code></dt>
<dd><p>The bit number of the leftmost bit in the pc ppr&rsquo;s screen area.
</p></dd>
<dt><code>pc-ppr-left-margin</code></dt>
<dd><p>The bit number of the leftmost bit used to draw characters.
The difference between <code>pc-ppr-left-margin</code> and <code>pc-ppr-left</code> is the left margin.
</p></dd>
<dt><code>pc-ppr-right</code></dt>
<dd><p>The bit number of the bit just to the right of the pc ppr&rsquo;s screen area.
</p></dd>
<dt><code>pc-ppr-right-margin</code></dt>
<dd><p>The bit number of the bit just to the right of the portion of the pc ppr
in which characters may be drawn.  The difference between <code>pc-ppr-right</code>
and <code>pc-ppr-right-margin</code> is the right margin.
</p></dd>
<dt><code>pc-ppr-right-limit</code></dt>
<dd><p>The rightmost bit position to which the cursor may be positioned.  This is
set to a suitable value to prevent excursion past the right margin.
</p></dd>
<dt><code>pc-ppr-current-x</code></dt>
<dd><p>The X position of the left edge of the next character to be drawn,
i.e. the X coordinate of the cursor position.
</p></dd>
<dt><code>pc-ppr-current-y</code></dt>
<dd><p>The Y position of the top edge of the next character to be drawn,
i.e. the Y coordinate of the cursor position.
</p></dd>
<dt><code>pc-ppr-flags</code></dt>
<dd><p>A fixnum containing various bit flags, as follows:
</p><dl compact="compact">
<dt><code>pc-ppr-sideways-p</code></dt>
<dd><p>0 normally.  1 if the pc ppr is on a sideways screen, so the X and Y
coordinates should be interchanged before calling the microcode.
</p></dd>
<dt><code>pc-ppr-exceptions</code></dt>
<dd><p>Non-zero if any special conditions which prevent typeout
are active.  The conditions are:
</p><dl compact="compact">
<dt><code>pc-ppr-end-line-flag</code></dt>
<dd><p>1 if <code>pc-ppr-current-x</code> is
greater than <code>pc-ppr-right-limit</code>.
The default response to this is to advance to the next line.
</p></dd>
<dt><code>pc-ppr-end-page-flag</code></dt>
<dd><p>1 if <code>pc-ppr-current-y</code> is greater than <code>pc-ppr-bottom-limit</code>.
The default response to this is to return to the top of the pc ppr.
</p></dd>
<dt><code>pc-ppr-more-flag</code></dt>
<dd><p>1 if &quot;more-processing&quot; must happen before the next character can
be output.  The default response to this is to display &quot;**MORE**&quot;
and await keyboard input.
</p></dd>
<dt><code>pc-ppr-output-hold-flag</code></dt>
<dd><p>1 if some higher-level function has decided that output is not to be
allowed on this pc ppr.  For example, its region of the screen might
be in use for something else.  When this is seen a function specified
when the pc ppr was created is called.
</p></dd>
</dl>
</dd>
</dl>
</dd>
<dt><code>pc-ppr-more-vpos</code></dt>
<dd><p>Y passing here triggers &quot;more processing&quot; by setting <code>pc-ppr-more-flag</code>.
Add 100000 to this field to delay until after screen wraparound.
Store <code>nil</code> here to inhibit more processing.
</p></dd>
<dt><code>pc-ppr-baseline</code></dt>
<dd><p>The number of raster lines from the top of the character cell (<code>pc-ppr-current-y</code>)
to the baseline.
</p></dd>
<dt><code>pc-ppr-font-map</code></dt>
<dd><p>An array of fonts.  Normally a font-change command
specifies a code number, which is looked up in this
array to find what font to actually use.  Font 0
is the &quot;principal&quot; font.  The array is usually 26. long.
</p></dd>
<dt><code>pc-ppr-current-font</code></dt>
<dd><p>The font which is currently selected.
</p></dd>
<dt><code>pc-ppr-baseline-adj</code></dt>
<dd><p>Y offset for current font to align baseline.  This is the difference between
the <code>pc-ppr-baseline</code> and the font&rsquo;s baseline.
</p></dd>
<dt><code>pc-ppr-line-height</code></dt>
<dd><p>The number of raster lines per character line.
</p></dd>
<dt><code>pc-ppr-char-width</code></dt>
<dd><p>A character width which is just used for old-style
space/backspace/tab operations and for blinkers.
</p></dd>
<dt><code>pc-ppr-char-aluf</code></dt>
<dd><p>ALU function for drawing characters.  The default is the value of <code>tv-alu-ior</code>.
</p></dd>
<dt><code>pc-ppr-erase-aluf</code></dt>
<dd><p>ALU function for erasing characters/lines/whole pc ppr.  The default is
the value of <code>tv-alu-andca</code>.
</p></dd>
<dt><code>pc-ppr-blinker-list</code></dt>
<dd><p>(Possibly null) list of blinkers on this pc ppr.
</p></dd>
<dt><code>pc-ppr-end-line-fcn</code></dt>
<dd><p>Function called when typeout is attempted with <code>pc-ppr-end-line-flag</code> set.
The default is to wrap around to the next line.
</p></dd>
<dt><code>pc-ppr-end-screen-fcn</code></dt>
<dd><p>Function called when typeout is attempted with <code>pc-ppr-end-page-flag</code> set.
The default is to wrap around to the top margin.
</p></dd>
<dt><code>pc-ppr-output-hold-fcn</code></dt>
<dd><p>Function called when typeout is attempted with <code>pc-ppr-output-hold-flag</code> set.
The default is to wait for the flag to be cleared by some other process.
</p></dd>
<dt><code>pc-ppr-more-fcn</code></dt>
<dd><p>Function called when typeout is attempted with <code>pc-ppr-more-flag</code> set.
The default is to type **MORE** and await typein.
</p></dd>
</dl>

<a name="Simple-Typeout"></a>
<h4 class="subsection">23.6.1 Simple Typeout</h4>

<dl>
<dt><a name="index-tv_002dtyo"></a>Function: <strong>tv-tyo</strong> <em>pc-ppr char</em></dt>
<dd><p>Draws a printing character, or executes a special format character.
The character is drawn at the current cursor position, in the current font,
and the cursor position is shifted to the right by the width of the character.
The following format effectors are recognized:
</p>
<dl compact="compact">
<dt><code>200</code></dt>
<dd><p>Null.  Nothing happens.
</p></dd>
<dt><code>210</code></dt>
<dd><p>Backspace.  The cursor is moved left the width of a space.  At the beginning
of a line it sticks.
</p></dd>
<dt><code>211</code></dt>
<dd><p>Tab.  The cursor is moved right to the next multiple of 8 times the width
of a space.
</p></dd>
<dt><code>215</code></dt>
<dd><p>Carriage return.  The cursor is advanced to the beginning of the next line,
and that line is erased.  More-processing and screen wrap-around may be
triggered.
</p></dd>
<dt><code>240-247</code></dt>
<dd><p>Font change.  The low 3 bits are the font number.
</p></dd>
</dl>

<p>Other non-printing characters are displayed as their name enclosed in a box.
These displays are quite wide and currently don&rsquo;t bother to respect the right margin.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dbeep"></a>Function: <strong>tv-beep</strong></dt>
<dd><p>This function is used to attract the user&rsquo;s attention.
It flashes the screen and beeps the beeper.  Doesn&rsquo;t really have
that much to do with TVs.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dbeep-1"></a>Variable: <strong>tv-beep</strong></dt>
<dd><p>If the value of <code>tv-beep</code> is non-<code>nil</code>, the <code>tv-beep</code>
function doesn&rsquo;t flash the screen, it only sounds a beep.
The initial value is <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-si_003atv_002dmove_002dbitpos"></a>Function: <strong>si:tv-move-bitpos</strong> <em>pc-ppr delta-x delta-y</em></dt>
<dd><p>Move current X, current Y on piece of paper, keeping inside boundaries.
This function is called from many others.  It is the central place
to keep track of edges, automatic wrap-around, **MORE** processing, etc.
It will set the <code>pc-ppr-exceptions</code> flags as necessary.
</p></dd></dl>

<dl>
<dt><a name="index-si_003atv_002dexception"></a>Function: <strong>si:tv-exception</strong> <em>pc-ppr</em></dt>
<dd><p>This function is called by various TV functions when they encounter
a <code>pc-ppr-exceptions</code> flag which they care about (for example, <code>tv-crlf</code>
does not care about <code>pc-ppr-end-line-flag</code>).
The appropriate function (stored in the pc ppr) is called.  It is up to
that function to correct the condition and clear the exception flag.
</p></dd></dl>

<p>If you want to supply your own exception-handling function for
a piece of paper, you would be well-advised to read the corresponding
system default function first.  They need to do non-obvious things
in some cases.
</p>
<dl>
<dt><a name="index-si_003atv_002dend_002dline_002ddefault"></a>Function: <strong>si:tv-end-line-default</strong> <em>pc-ppr</em></dt>
<dd><p>This is the default end-of-line function, called if an attempt is made
to display a character when the cursor is off the end of a line.
It essentially just does a crlf.
</p></dd></dl>

<dl>
<dt><a name="index-si_003atv_002dend_002dscreen_002ddefault"></a>Function: <strong>si:tv-end-screen-default</strong> <em>pc-ppr</em></dt>
<dd><p>This is the default end-of-screen function, called when an attempt is
made to display a character when the cursor is off the bottom of the pc ppr.
It wraps around to the top of the pc ppr.
Note that more-processing is separate from and unrelated to end-of-screen processing.
</p></dd></dl>

<dl>
<dt><a name="index-si_003atv_002dmore_002ddefault"></a>Function: <strong>si:tv-more-default</strong> <em>pc-ppr</em></dt>
<dd><p>This is the default more processor.  It types out **MORE**,
waits for input, and decides where the next &quot;more&quot; should happen.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dnote_002dinput"></a>Function: <strong>tv-note-input</strong></dt>
<dd><p>The purpose of <code>tv-note-input</code> is to prevent &quot;more&quot;s from happening
during normal interactive usage, since typeout is frequently pausing
for user input anyway, and presumably the user is keeping up in his reading.
This function is called by the keyboard handler when a process hangs
waiting for input.  <code>tv-note-input</code> arranges (on each active pc ppr)
for a more not to happen until the current
line is reached again; except, if this line is far from the bottom, we prefer
to more at the bottom before wrapping around.  This makes moreing usually happen at the bottom.
</p></dd></dl>

<a name="Cursor-Motion"></a>
<h4 class="subsection">23.6.2 Cursor Motion</h4>

<p>Note that the &quot;cursor&quot; is the x,y position where the top-left corner of the next
character printed will be placed.  (This is not strictly true because there is
base-line adjustment and kerning.)
The cursor doesn&rsquo;t necessarily have a corresponding
blinker; this is under the control of the user program.
</p>
<p>Many of these functions are not used by real Lisp Machine code,
but are present for completeness
and to aid compatibility with ITS I/O.  On the other hand, some are heavily used.
</p>
<dl>
<dt><a name="index-tv_002dhome"></a>Function: <strong>tv-home</strong> <em>pc-ppr</em></dt>
<dd><p>Home up to the top-left corner.
Usually you then want to do a <code>tv-clear-eol</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dhome_002ddown"></a>Function: <strong>tv-home-down</strong> <em>pc-ppr</em></dt>
<dd><p>Home down the cursor to the bottom-left corner (the beginning of the
last line in the pc ppr).
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dcrlf"></a>Function: <strong>tv-crlf</strong> <em>pc-ppr</em></dt>
<dd><p>Advance to the beginning of the next line, and erase its
previous contents.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dspace"></a>Function: <strong>tv-space</strong> <em>pc-ppr</em></dt>
<dd><p>Space forward.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dbackspace"></a>Function: <strong>tv-backspace</strong> <em>pc-ppr</em></dt>
<dd><p>Space backward.  Not too useful with variable-width fonts.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dtab"></a>Function: <strong>tv-tab</strong> <em>pc-ppr</em></dt>
<dd><p>Tab.  Spaces forward to the next multiple of 8 times the width of space.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dset_002dfont"></a>Function: <strong>tv-set-font</strong> <em>pc-ppr font</em></dt>
<dd><p>This is the common internal routine for changing what font a piece
of paper is to print with.  It does some bookkeeping,
such as adjusting the baseline.  It is OK to set the font to one
which is not in the font map, however this won&rsquo;t change the line-spacing,
which is initially set up according to the tallest font in the font map.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dset_002dcursorpos"></a>Function: <strong>tv-set-cursorpos</strong> <em>pc-ppr x y</em></dt>
<dd><p>Sets the &quot;cursor&quot; position of the piece of paper
in raster units (<i>not</i> character units).  <i>x</i> and <i>y</i>
are relative to the margins of the pc ppr.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dread_002dcursorpos"></a>Function: <strong>tv-read-cursorpos</strong> <em>pc-ppr</em></dt>
<dd><p>Returns two values, the X and Y coordinates of the cursor.
These are relative to the margins of the pc ppr.
</p></dd></dl>

<a name="Erasing_002c-etc_002e"></a>
<h4 class="subsection">23.6.3 Erasing, etc.</h4>

<dl>
<dt><a name="index-tv_002dclear_002dchar"></a>Function: <strong>tv-clear-char</strong> <em>pc-ppr</em></dt>
<dd><p>Clear the current character position.  In a variable-width font,
the width of space is used, which isn&rsquo;t likely to be the right thing.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dclear_002deol"></a>Function: <strong>tv-clear-eol</strong> <em>pc-ppr</em></dt>
<dd><p>Clear from current position to end of line.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dclear_002deof"></a>Function: <strong>tv-clear-eof</strong> <em>pc-ppr</em></dt>
<dd><p>Clear from current position to end of piece of paper.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dclear_002dpc_002dppr"></a>Function: <strong>tv-clear-pc-ppr</strong> <em>pc-ppr</em></dt>
<dd><p>Clear whole piece of paper.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dclear_002dpc_002dppr_002dexcept_002dmargins"></a>Function: <strong>tv-clear-pc-ppr-except-margins</strong> <em>pc-ppr</em></dt>
<dd><p>Clear all of <i>pc-ppr</i> except the margins, which are unaffected.
This is useful if the margins contain decorative graphics
such as outlines.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dclear_002dscreen"></a>Function: <strong>tv-clear-screen</strong> <em>&amp;optional screen</em></dt>
<dd><p>Clears the entire screen, and tells the who-line it has been clobbered.
<i>screen</i> defaults to <code>tv-default-screen</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddelete_002dchar"></a>Function: <strong>tv-delete-char</strong> <em>pc-ppr &amp;optional (char-count 1)</em></dt>
<dd><p>Deletes the specified number of character positions immediately to
the right of the cursor, on the current line.  The remainder of
the line slides to the left, and blank space slides in from the
right margin.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dinsert_002dchar"></a>Function: <strong>tv-insert-char</strong> <em>pc-ppr &amp;optional (char-count 1)</em></dt>
<dd><p>Inserts the specified number of blank character positions immediately
to the right of the cursor, on the current line.  The remainder of
the line slides to the right, and anything that goes off the right
margin is lost.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddelete_002dline"></a>Function: <strong>tv-delete-line</strong> <em>pc-ppr &amp;optional (line-count 1)</em></dt>
<dd><p>Deletes the specified number of lines immediately at and below the cursor.
The remaining lines of the piece of paper slide up, and blank spaces
slides in from the bottom margin.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dinsert_002dline"></a>Function: <strong>tv-insert-line</strong> <em>pc-ppr &amp;optional (line-count 1)</em></dt>
<dd><p>Inserts the specified number of blank lines at the cursor.
The remaining lines of the piece of paper slide down, and anything
that goes off the bottom margin is lost.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dblack_002don_002dwhite"></a>Function: <strong>tv-black-on-white</strong> <em>&amp;optional screen</em></dt>
<dd><p>Makes the hardware present the screen as black characters on a white background.
(Presently, the <i>screen</i> argument can also be a plane-mask.)
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwhite_002don_002dblack"></a>Function: <strong>tv-white-on-black</strong> <em>&amp;optional screen</em></dt>
<dd><p>Makes the hardware present the screen as white characters on a black background.
(Presently, the <i>screen</i> argument can also be a plane-mask.)
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dcomplement_002dbow_002dmode"></a>Function: <strong>tv-complement-bow-mode</strong> <em>&amp;optional screen</em></dt>
<dd><p>Makes the hardware present the screen in the reverse of its current mode.
(Presently, the <i>screen</i> argument can also be a plane-mask.)
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwhite_002don_002dblack_002dstate"></a>Function: <strong>tv-white-on-black-state</strong> <em>&amp;optional screen</em></dt>
<dd><p>Returns <code>:white</code> if the screen is currently presented as white-on-black,
or <code>:black</code> if it is currently presented as black-on-white.  The <i>screen</i>
argument can also be a plane-mask.  If more than one bit is on in the plane-mask,
and not all the planes are in the same state, <code>:both</code> is returned.
</p></dd></dl>

<a name="String-Typeout"></a>
<h4 class="subsection">23.6.4 String Typeout</h4>

<dl>
<dt><a name="index-tv_002dstring_002dout"></a>Function: <strong>tv-string-out</strong> <em>pc-ppr string &amp;optional (start 0) end</em></dt>
<dd><p>Print a string onto a piece of paper.
Optional starting and ending indices may be supplied; if unsupplied,
the whole string is printed.  This is basically just iterated <code>tv-tyo</code>,
except in the case of simple fonts it runs much faster by removing
a lot of overhead from the inner loop.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dline_002dout"></a>Function: <strong>tv-line-out</strong> <em>pc-ppr string &amp;optional (start 0) end</em></dt>
<dd><p>This variant of <code>tv-string-out</code>
is used by the editor&rsquo;s display routines to output one line.
The argument is a string of either 8-bit or 16-bit characters (usually
this is an EINE &quot;line&quot;, but the leader is not touched except for the fill pointer.)
The high 8 bits (<code>%%ch-font</code>) of each character are the index into the font map
for the font in which that character is to be displayed.  8-bit chars use font 0.
There are optional starting and ending indices; if these are omitted the
whole string is specified.
If during printing the cursor runs off the end of the line, typeout stops
and the index of the next character to be output is returned.  At this point,
the <code>pc-ppr-end-line-flag</code> is 1 and the cursor is off the end of the line.
If the whole string is successfully output, <code>nil</code> is returned,
and the pc ppr is pointing somewhere in the middle of the line.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dstring_002dlength"></a>Function: <strong>tv-string-length</strong> <em>pc-ppr string &amp;optional (start 0) end stop-x</em></dt>
<dd><p>Compute the display-length of a string, which is the sum of the widths
of the printing characters in it.  Newline characters are ignored.  Tab
characters act as if the string starts at the left margin.  <i>pc-ppr</i>
is used mainly for its font map.  <i>start</i> and <i>end</i> allow you to
process a substring.  <i>stop-x</i>, if non-<code>nil</code>, is a tv-length
at which to stop.  The index in the string of the character after the one
which exceeded the <i>stop-x</i> is returned as the second value.
</p>
<p>The first returned value is the <i>x</i>-position reached, i.e. the tv-length
of the string.  The second returned value is the next index in the string,
which is <i>end</i> if <i>stop-x</i> was not supplied.
</p>
<p>Contrast <code>tv-compute-motion</code>, which does a
two-dimensional computation taking line-length into account.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dcompute_002dmotion"></a>Function: <strong>tv-compute-motion</strong> <em>pc-ppr x y string &amp;optional (start 0) end (cr-at-end-p nil) (stop-x 0) stop-y</em></dt>
<dd><p>Compute the motion that would be caused by outputting a string.
This is used by the editor to aid in planning its display,
to compute indentations with variable width fonts, to
position the cursor on the current character, etc.
Note that this does not use the &quot;case shift&quot; flavor of font hacking.
Instead, it uses the 16-bit-character flavor that the editor uses.
This means that if you give it an ordinary 8-bit string it will
be assumed to be all in font 0.
</p>
<p>The arguments are: the piece of paper, the X and Y position to
start at (<code>nil</code>s here use the current position of the pc ppr),
the string, and optionally the starting and ending indices,
a flag saying to fake a crlf at the end of the string, and
two additional arguments which are the
X and Y to stop at; if not given these default to the end of the screen.
Returns 3 values: final-X, final-Y, and an indication of how far down the
string it got.  This is <code>nil</code> if the whole string (including the fake
carriage return, if any) was processed without
reaching the stopping point, or the index of the next character to be
processed when the stopping point was reached, or <code>t</code> if the stopping point
was reached after the fake carriage return.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dchar_002dwidth"></a>Function: <strong>tv-char-width</strong> <em>pc-ppr char</em></dt>
<dd><p>Returns the width of the character, if displayed in the font
current in the pc-ppr.  The width of backspace is negative,
the width of tab depends on the pc ppr&rsquo;s cursor position, and the width
of carriage return is zero.
</p></dd></dl>

<a name="More-Processing"></a>
<h4 class="subsection">23.6.5 More Processing</h4>

<p>More processing is a flow control mechanism for
output to the user.  Lisp machine more processing is similar to more
processing in ITS.  The problem that more processing solves is that
displayed output tends to appear faster than the user can read it.  The
solution is to stop just before output which has not been read yet is
wiped out, and display &quot;**MORE**&quot;.  The user then reads the whole
screen and hits space to allow the machine to continue output.  More
processing normally occurs one line above where the cursor was when the
machine last waited for user input; however, it tries to do an extra
**MORE** at the bottom of the pc ppr, so as to get into a phase where
the **MORE** always appears at the bottom, which is more aesthetic.
</p>
<a name="ALU-Functions"></a>
<h4 class="subsection">23.6.6 ALU Functions</h4>

<p>Some TV operations take an argument called an <i>ALU Function</i>,
which specifies how data being stored into the TV memory is to be combined with
data already present.  The ALU function is OR&rsquo;ed directly into a microinstruction,
so specifying a value other than one of those listed below may produce
unexpected disasters.
The following special variables have numeric values
which are useful ALU functions.
</p>
<dl>
<dt><a name="index-tv_002dalu_002dior"></a>Variable: <strong>tv-alu-ior</strong></dt>
<dd><p>Inclusive-OR.  Storing a 1 turns on the corresponding bit, otherwise
the bit in TV memory is left unchanged.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dalu_002dxor"></a>Variable: <strong>tv-alu-xor</strong></dt>
<dd><p>Exclusive-OR.  Storing a 1 complements the corresponding bit, otherwise
the bit in TV memory is left unchanged.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dalu_002dandca"></a>Variable: <strong>tv-alu-andca</strong></dt>
<dd><p>AND-with-complement.  Storing a 1 turns off the corresponding bit, otherwise
the bit in TV memory is left unchanged.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dalu_002dseta"></a>Variable: <strong>tv-alu-seta</strong></dt>
<dd><p>Bits are simply stored, replacing the previous contents.
With most functions, this is not useful since it clobbers unrelated
bits in the same word as the bits being operated on.  However,
it is useful for bitblt.
</p></dd></dl>

<a name="Blinkers"></a>
<h4 class="subsection">23.6.7 Blinkers</h4>

<p>A <i>blinker</i> is an attention-getting mark on the screen.
Often, but not always, it will blink.  The most common type is a
character-sized rectangle which blinks twice a second, but several
other types exist, and it is easy for the user to define new ones.
Often a piece of paper will have an associated blinker which shows
where the next character will be drawn.  A blinker can be on top of a
character, and the character will still be visible.  This done by
XORing the blinker into the TV memory.  Synchronization between pieces
of paper and blinkers is provided so that when characters are being
drawn on the screen, blinkers are turned off to prevent the picture
from being messed up.  (This is called &quot;opening&quot; a piece of paper, and
should be invisible to the user.)
</p>
<p>A blinker is an array, described as follows:
</p>
<dl compact="compact">
<dt><code>tv-blinker-x-pos</code></dt>
<dd><p>X position of the left edge of the blinker. <code>nil</code> if the blinker
should follow the <code>tv-blinker-pc-ppr</code>&rsquo;s current X and Y.
</p></dd>
<dt><code>tv-blinker-y-pos</code></dt>
<dd><p>Y position of the top edge of the blinker.
</p></dd>
<dt><code>tv-blinker-pc-ppr</code></dt>
<dd><p>Pc ppr the blinker is associated with.  <code>nil</code> for a <i>roving blinker</i>,
which can go anywhere.
</p></dd>
<dt><code>tv-blinker-screen</code></dt>
<dd><p>The screen on which the blinker is displayed.
</p></dd>
<dt><code>tv-blinker-visibility</code></dt>
<dd><p><code>nil</code> invisible, <code>t</code> visible, <code>blink</code> blinking.
</p></dd>
<dt><code>tv-blinker-half-period</code></dt>
<dd><p>Time interval in 60ths of a second between changes of the blinker.
</p></dd>
<dt><code>tv-blinker-phase</code></dt>
<dd><p><code>nil</code> means not visible, anything else means visible in some form.
A complementing blinker has only two phases,
<code>nil</code> and <code>t</code>, but provision is made for blinkers which go
through an elaborate sequence of states.
</p></dd>
<dt><code>tv-blinker-time-until-blink</code></dt>
<dd><p>Time interval in 60ths of a second until the next change.  The scheduler
decrements this 60 times a second if the <code>tv-blinker-visibility</code> is <code>blink</code>.
If it reaches zero, the blinker is blinked.
If this field is <code>nil</code>, the blinker is not to be looked at by the scheduler.
</p></dd>
<dt><code>tv-blinker-function</code></dt>
<dd><p>The function to call to blink the blinker.  The next two fields are for its use.
The arguments to the function are the blinker, an operation code, the
<code>tv-blinker-x-pos</code>, and the <code>tv-blinker-y-pos</code>.  The operation codes
are <code>nil</code> to make the blinker invisible, <code>t</code> to make it visible, and
<code>blink</code> to blink it.
When this function is called, interrupts have been disallowed and the proper
screen has been selected.
For additional conventions, read the function <code>tv-blink</code>.
</p></dd>
<dt><code>tv-blinker-width</code></dt>
<dd><p>Width in bits of area to complement if
<code>tv-rectangular-blinker</code>.
For other blinker types, miscellaneous data.
</p></dd>
<dt><code>tv-blinker-height</code></dt>
<dd><p>Height in raster lines of area to complement if <code>tv-rectangular-blinker</code>.
For other blinker types, miscellaneous data.
</p></dd>
<dt><code>tv-blinker-sideways-p</code></dt>
<dd><p><code>t</code> =&gt; interchange X and Y before calling microcode.
</p></dd>
</dl>

<dl>
<dt><a name="index-tv_002dset_002dblinker_002dcursorpos"></a>Function: <strong>tv-set-blinker-cursorpos</strong> <em>blinker x y</em></dt>
<dd><p>Set the cursor position of a blinker.  If <i>blinker</i> is a roving
blinker, <i>x</i> and <i>y</i> are absolute coordinates.  Otherwise,
they are relative to the margins of <i>blinker</i>&rsquo;s piece of paper.
If this blinker was following the pc ppr&rsquo;s cursor, it won&rsquo;t any more.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dread_002dblinker_002dcursorpos"></a>Function: <strong>tv-read-blinker-cursorpos</strong> <em>blinker</em></dt>
<dd><p>Read the cursor position of a blinker, returning two values, X and Y.
If the blinker is not roving, these are relative to the margins of its
piece of paper.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dset_002dblinker_002dvisibility"></a>Function: <strong>tv-set-blinker-visibility</strong> <em>blinker type</em></dt>
<dd><p>Carefully alters the visibility of a blinker.
<i>type</i> may be <code>nil</code> (off), <code>t</code> (on), or <code>blink</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dset_002dblinker_002dfunction"></a>Function: <strong>tv-set-blinker-function</strong> <em>blinker function &amp;optional arg1 arg2</em></dt>
<dd><p>Carefully alters the function which implements a blinker.
<i>arg1</i> and <i>arg2</i>, if supplied, change <code>tv-blinker-height</code>
and <code>tv-blinker-width</code>, which are really just general arguments to the function.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dset_002dblinker_002dsize"></a>Function: <strong>tv-set-blinker-size</strong> <em>blinker width height</em></dt>
<dd><p>Carefully changes the size of a blinker, consulting the function which
implements it if that function has a <code>tv-set-blinker-size-function</code> property.
</p></dd></dl>

<a name="Graphics"></a>
<h3 class="section">23.7 Graphics</h3>

<dl>
<dt><a name="index-tv_002ddraw_002dline"></a>Function: <strong>tv-draw-line</strong> <em>x1 y1 x2 y2 alu screen</em></dt>
<dd><p>Draws a straight line between the points (<i>x1</i>,<i>y1</i>) and (<i>x2</i>,<i>y2</i>),
merging the line into the existing contents of the screen with the specified
alu function.  This is a fast micro-coded function.
</p></dd></dl>

<dl>
<dt><a name="index-bitblt"></a>Function: <strong>bitblt</strong> <em>alu width height from-array from-x from-y to-array to-x to-y</em></dt>
<dd><p>This function moves a portion of one two-dimensional numeric array into
a portion of another, merging them under the control of a specified alu function.
It has several applications, including shifting portions of the TV screen
around (use the <code>screen-buffer-pixel-array</code>), saving and restoring
portions of the TV screen, writing half-tone and stipple patterns into the
TV screen, and general array-moving.
</p>
<p><code>bitblt</code> operates on a rectangular region of <i>to-array</i> which starts at the coordinates
(<i>to-x</i>,<i>to-y</i>) and has extent <code>(abs <i>width</i>)</code> in the <i>X</i>
direction and <code>(abs <i>height</i>)</code> in the <i>Y</i> direction.  An error occurs
if this region does not fit within the bounds of <i>to-array</i>.  Note that the
coordinates and the <i>height</i> and <i>width</i> are in terms of array elements,
not bits, although the actual operation is done bitwise.  <i>from-array</i> needn&rsquo;t
be as big as the specified region; conceptually, <code>bitblt</code> replicates
<i>from-array</i> a sufficiently-large number of times in both <i>X</i> and <i>Y</i>,
then picks out a rectangular region containing the same number of bits
as the destination region, starting at the coordinates (<i>from-x</i>,<i>from-y</i>).
<code>bitblt</code> combines these two regions
under control of <i>alu</i>.  The &quot;A&quot; operand is the <i>from-array</i>, thus
an alu function of <code>tv-alu-seta</code> copies the <i>from-array</i>, ignoring the
previous contents of the selected region of the <i>to-array</i>.
</p>
<p>The specified <i>X</i> and <i>Y</i> coordinates are always the upper-left corner
(minimum coordinate values) of the selected region.
</p>
<p><code>bitblt</code> normally works in a left-to-right and top-to-bottom order, that
is with increasing coordinate values.  When using overlapping <i>from</i> and
<i>to</i> arrays, for instance when shifting a portion of the TV screen slightly,
it may be necessary to work in one of the other three possible orders.
This is done using the sign of the <i>width</i> and <i>height</i> arguments.
If <i>width</i> is negative, decreasing <i>X</i> coordinates are used, and
if <i>height</i> is negative, decreasing <i>Y</i> coordinates are used.
</p>
<p>For the sake of efficiency, <code>bitblt</code> requires that the <i>from-array</i>
and <i>to-array</i> have word-aligned rows.  This means that the
first dimension of these arrays must be a multiple of 32. divided by the
number of bits per array-element.  All TV screen arrays are forced by
hardware to satisfy this criterion anyway.
</p></dd></dl>

<a name="The-Who-Line"></a>
<h3 class="section">23.8 The Who Line</h3>

<p>The <i>who line</i> is a line at the bottom of the screen which
contains information on what the program is currently doing.  The who
line has its own pc ppr and is updated whenever the software goes into
an I/O wait.  In addition, there are two short line segments (called <i>run lights</i>) at
the bottom of the screen which are controlled by the microcode and by the scheduler.  The
one on the right lights up when the machine is running (not waiting and
not paging), and the one on the left lights up when the disk is running
(paging).
</p>
<dl>
<dt><a name="index-tv_002dwho_002dline_002dupdate"></a>Function: <strong>tv-who-line-update</strong> <em>&amp;optional state</em></dt>
<dd><p>This function updates all fields of the who-line which have changed.  It is called
from various functions which change the &quot;state of the machine&quot; as perceived by
the user.  The optional argument, <i>state</i>, is a string to be displayed
in the state field.
If <i>state</i> is not specified, the value of <code>tv-who-line-run-state</code> is used, which is
usually <code>&quot;RUN&quot;</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dlist"></a>Variable: <strong>tv-who-line-list</strong></dt>
<dd><p>The value of <code>tv-who-line-list</code> is a list of who-line fields.  Each field
is a list; the first four elements of the list constitute a structure
containing the following components:
</p>
<dl compact="compact">
<dt><code>tv-who-line-item-function</code></dt>
<dd><p>A function to call, given the field as its argument.  The function is supposed
to update the field of the who-line if it has changed.  The list elements of the field
after the first four are for the use of this function.
</p></dd>
<dt><code>tv-who-line-item-state</code></dt>
<dd><p>If <code>nil</code>, the who-line has been clobbered (e.g. by clearing of the screen)
and the field must be updated.  Otherwise, this is used by the function in
an unspecified way to remember its previous state.
</p></dd>
<dt><code>tv-who-line-item-left</code></dt>
<dd><p>The bit position of the left edge of the portion of the who-line containing this field.
</p></dd>
<dt><code>tv-who-line-item-right</code></dt>
<dd><p>The bit position (+1) of the right edge of the portion of the who-line containing this field.
</p></dd>
</dl>

<p>The initial <code>tv-who-line-list</code> is set up to display the time, the name
of the person logged-on to the machine, the current package, the &quot;state&quot;
of a certain selected process, and name and position of the current input file.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dprepare_002dfield"></a>Function: <strong>tv-who-line-prepare-field</strong> <em>field</em></dt>
<dd><p>This is called by <code>tv-who-line-item-function</code>s in preparation for redisplay
of a who-line field.  The portion of the screen on which the field displays
is erased and the <code>tv-who-line-pc-ppr</code>&rsquo;s cursor is set to the beginning of
the field.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dstring"></a>Function: <strong>tv-who-line-string</strong> <em>field</em></dt>
<dd><p>This is a useful function to put into a who-line field.  It displays the
string which is the value of the symbol which is the fifth element of the field,
if it is not <code>eq</code> to the string previously displayed.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dpc_002dppr"></a>Variable: <strong>tv-who-line-pc-ppr</strong></dt>
<dd><p>The value of <code>tv-who-line-pc-ppr</code> is a piece of paper which
is used to display the characters in the who-line.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dstream"></a>Variable: <strong>tv-who-line-stream</strong></dt>
<dd><p>The value of <code>tv-who-line-stream</code> is a stream whose output
displays on the <code>tv-who-line-pc-ppr</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dprocess"></a>Variable: <strong>tv-who-line-process</strong></dt>
<dd><p>The value of <code>tv-who-line-process</code> is the process whose state is to
be displayed in the who-line.  <code>process-wait</code> calls <code>tv-who-line-update</code>
if this is the current process.
<code>tv-who-line-process</code> is normally the main process of the job
which owns the keyboard.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002drun_002dstate"></a>Variable: <strong>tv-who-line-run-state</strong></dt>
<dd><p>Normally the string &quot;RUN&quot;.  This is what appears in the wholine
when the machine isn&rsquo;t waiting for anything.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002drun_002dlight_002dloc"></a>Variable: <strong>tv-who-line-run-light-loc</strong></dt>
<dd><p>Unibus address of the TV memory location used for the run-light.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwho_002dline_002dstate"></a>Variable: <strong>tv-who-line-state</strong></dt>
<dd><p>This is a special variable which exists inside of <code>tv-who-line-update</code>.
</p></dd></dl>

<a name="Microcode-Routines"></a>
<h3 class="section">23.9 Microcode Routines</h3>

<dl>
<dt><a name="index-tv_002dselect_002dscreen"></a>Function: <strong>tv-select-screen</strong> <em>screen</em></dt>
<dd><p>This microcode primitive selects a screen for use by the <code>tv-draw-char</code>
and <code>tv-erase</code> functions.  It sets up microcode variables and hardware
registers.  Note that this state is not preserved through process switching,
so this primitive should only be called with <code>inhibit-scheduling-flag</code>
bound to <code>t</code>, which is normally desired for other reasons anyway.
</p>
<p><code>tv-select-screen</code> should also be used before referencing the TV arrays,
such as the <code>screen-buffer-pixel-array</code>, if a 16-bit TV controller is being used.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddraw_002dchar"></a>Function: <strong>tv-draw-char</strong> <em>font-array char-code x-bit-pos y-bit-pos alu-func</em></dt>
<dd><p>The <i>x-bit-pos</i> and <i>y-bit-pos</i> are of the top left corner of the character.
(0,0) is the top left corner of the screen.
<code>tv-draw-char</code> extracts the raster elements for one character
(or one column of a wide character) and displays them at the indicated
address in the currently-selected plane,
using the indicated ALU function to combine them with the bits
already there.  Note that this function does not know anything about
pieces of paper; no pc ppr handling is in microcode.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002derase"></a>Function: <strong>tv-erase</strong> <em>width height x-bit-pos y-bit-pos alu-func</em></dt>
<dd><p>This function is in microcode.
<i>width</i> and <i>height</i> are in bits, and should be fixnums.
A rectangle of the indicated
size, of all 1s, is created and merged into the rectangle of TV memory
in the currently-selected plane
whose top left corner is at (<i>x-bit-pos</i>,<i>y-bit-pos</i>),
using the specified <i>alu-func</i>.  Usually
the ANDCA function is used for erasing, but XOR is used
for the blinking cursor etc.  Note that <i>width</i> and <i>height</i>
must be greater than zero.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddraw_002dline-1"></a>Function: <strong>tv-draw-line</strong> <em>x0 y0 x1 y1 alu-func screen</em></dt>
<dd><p>This function is in microcode.
A straight line is drawn from the point (<i>x0,y0</i>)
to the point (<i>x1,y1</i>).  These points had better not
lie outside the screen.  The bits that form the line are
merged into the screen with the specified alu function.
<code>tv-select-screen</code> is applied to <i>screen</i> before
the line is drawn.
</p></dd></dl>

<a name="Opening-a-Piece-of-Paper"></a>
<h3 class="section">23.10 Opening a Piece of Paper</h3>

<p>Before a piece of paper can be manipulated, any blinkers
which may intercept it must be turned off (i.e. their <code>tv-blinker-phase</code>
must be <code>nil</code>).  The operation of assuring this is called <i>opening</i>
the piece of paper.  Similarly, before a blinker&rsquo;s location, size, shape,
visibility, or other attributes can be changed, it must be opened, that
is made to have no visible effect on the screen.
</p>
<p>Once a blinker has been opened, we must make sure that the clock
function, which implements the blinking, does not come in and turn the
blinker back on.  This is done in the simplest possible fashion, by
binding the <code>inhibit-scheduling-flag</code> non-<code>nil</code>, which causes
the microcode not to switch to another process.  [In the present system
processes are never interrupted, not even by the clock, and this variable is ignored.]
This also prevents any other process from coming in and messing up the
piece of paper by trying to type on it at the same time.
</p>
<p>Once we are done with a blinker or piece of paper, and don&rsquo;t
need to have it opened any more, we want the blinkers to reappear.
It looks best if a blinker reappears right away, rather than at the next
time it would have blinked.  However, for efficiency we don&rsquo;t want to
disappear and reappear the blinker every time a TV operation is performed.
Rather, if a program is doing several TV operations right in a row,
the first one will turn off the blinkers, the succeeding ones will
notice that the blinkers are already off, and then soon after the sequence
is completed the blinker will come back on.  This is implemented by having
the next clock interrupt after we get out of the TV code turn the blinker on.
</p>
<dl>
<dt><a name="index-tv_002dprepare_002dpc_002dppr"></a>Macro: <strong>tv-prepare-pc-ppr</strong></dt>
<dd><p>The form <code>(tv-prepare-pc-ppr (<i>pc-ppr</i>) <i>form1 form2 ...</i>)</code>
opens the piece of paper which is the value of the variable <i>pc-ppr</i>
and evaluates the forms with it open.  This macro contains all the knowledge
of how to open a pc ppr, including disabling interrupts, finding and
opening the blinkers, and selecting the proper screen.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dopen_002dblinker"></a>Function: <strong>tv-open-blinker</strong> <em>blinker</em></dt>
<dd><p>The specified blinker is temporarily turned off; the next clock interrupt
when <code>inhibit-scheduling-flag</code> is <code>nil</code> will turn it back on.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dopen_002dscreen"></a>Function: <strong>tv-open-screen</strong></dt>
<dd><p>Opens all the visible blinkers, preparatory to arbitrary
munging of the screen, for instance picture drawing.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dblink"></a>Function: <strong>tv-blink</strong> <em>blinker type</em></dt>
<dd><p>The function to blink a blinker.
<i>type</i> is one of the symbols <code>nil</code> (off), <code>t</code> (on), or <code>blink</code>.
<code>tv-blink</code> checks <i>type</i>, selects the proper screen, digs up the
blinker position out of the pc ppr if necessary, and calls the blinker&rsquo;s function
to do the actual display.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002drectangular_002dblinker"></a>Function: <strong>tv-rectangular-blinker</strong> <em>blinker type x y</em></dt>
<dd><p>A <code>tv-blinker-function</code> function for rectangular blinkers (the default).
Ignores <i>type</i>, just complements.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dhollow_002drectangular_002dblinker"></a>Function: <strong>tv-hollow-rectangular-blinker</strong> <em>blinker type x y</em></dt>
<dd><p>Function for hollow rectangles.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dcharacter_002dblinker"></a>Function: <strong>tv-character-blinker</strong> <em>blinker type x y</em></dt>
<dd><p>Function for blinkers defined by a character.  Arg1 (&quot;height&quot;)
is the font, and arg2 (&quot;width&quot;) is the character in the font.
The character is XORed in and out as the blinker blinks.
</p></dd></dl>

<a name="Creating-Pieces-of-Paper-and-Blinkers"></a>
<h3 class="section">23.11 Creating Pieces of Paper and Blinkers</h3>

<dl>
<dt><a name="index-tv_002ddefine_002dpc_002dppr"></a>Function: <strong>tv-define-pc-ppr</strong> <em>name font-map &amp;rest options</em></dt>
<dd><p>This function creates a returns a piece of paper.  Keyword arguments
allow the user to specify some of the many attributes of the piece of
paper and leave the remainder to default.
<i>name</i> is just a string which is remembered in the pc-ppr and appears
in its printed representation.  <i>font-map</i> may be either a list or an array of fonts;
or it may be <code>nil</code>, which causes the font map to be taken from the screen&rsquo;s default.
The remaining arguments are alternating keywords (which should
be quoted) and values for those keywords.  For example,
</p>
<div class="lisp">
<pre class="lisp">(setq foo (tv-define-pc-ppr &quot;foo&quot; (list fonts:tvfont)
                            ':top 300
                            ':bottom 400))
</pre></div>

<p>Valid option keywords are:
</p>
<dl compact="compact">
<dt><code>:screen</code></dt>
<dd><p>The screen on which the piece of paper is to display.
The default is <code>tv-default-screen</code>.
</p></dd>
<dt><code>:top</code></dt>
<dd><p>Raster line number of highest line in the pc ppr.
Defaults to <code>screen-y1</code> of the specified screen, the top.
</p></dd>
<dt><code>:bottom</code></dt>
<dd><p>Raster line number + 1 of lowest line in the pc ppr.
Defaults to <code>screen-y2</code> of the specified screen,
just above the who line (if there is one) at the bottom
of the screen.
</p></dd>
<dt><code>:left</code></dt>
<dd><p>Raster point number of left edge of pc ppr.
Defaults to <code>screen-x1</code> of the specified screen, the left edge.
</p></dd>
<dt><code>:right</code></dt>
<dd><p>Raster point number + 1 of right edge of the pc ppr.
Defaults to <code>screen-x2</code> of the specified screen, the right edge.
</p></dd>
<dt><code>:blinker-p</code></dt>
<dd><p><code>t</code> if this pc ppr should have a blinker on its cursor,
<code>nil</code> if the cursor should be invisible.
Default is <code>t</code>.
</p></dd>
<dt><code>:activate-p</code></dt>
<dd><p><code>t</code> if this pc ppr should be initially active.
Active means that its blinkers can blink.
The default is <code>t</code>.
</p></dd>
<dt><code>:reverse-video-p</code></dt>
<dd><p><code>t</code> if this pc ppr should be in the inverse of the
normal black-on-white mode.  This works by changing <code>pc-ppr-char-aluf</code>
and <code>pc-ppr-erase-aluf</code>.
Default is <code>nil</code>.
</p></dd>
<dt><code>:more-p</code></dt>
<dd><p><code>t</code> if this pc ppr should have more processing.
Default is <code>t</code>.
</p></dd>
<dt><code>:vsp</code></dt>
<dd><p>Number of raster lines between character lines.
This is added to the maximum height of the fonts in
the font map to get the height of a line in this
pc ppr.  The default is 2.
</p></dd>
<dt><code>:left-margin</code></dt>
<dd><p>Amount of unused space at the left edge of the pc ppr.
The default is 0.
</p></dd>
<dt><code>:top-margin</code></dt>
<dd><p>Amount of unused space at the top.  The default is 0.
</p></dd>
<dt><code>:right-margin</code></dt>
<dd><p>Amount of unused space at the right.  The default is 0.
</p></dd>
<dt><code>:bottom-margin</code></dt>
<dd><p>Amount of unused space at the bottom.  The default is 0.
</p></dd>
<dt><code>:end-line-fcn</code></dt>
<dd><p>A function which is invoked when typeout reaches the
end of a line.  The default is one which wraps around
to the next line.
</p></dd>
<dt><code>:end-screen-fcn</code></dt>
<dd><p>A function which is invoked when typeout reaches
the bottom of the pc ppr.  The default is one which
wraps around to the top.
</p></dd>
<dt><code>:output-hold-fcn</code></dt>
<dd><p>A function which is invoked when typeout encounters
the output-hold flag.  The default is one which waits
for some other process to clear the flag.
</p></dd>
<dt><code>:more-fcn</code></dt>
<dd><p>A function which is invoked when more processing
is necessary.  The default is one which types
**MORE** and waits for the user to hit a character,
then ignores that character and continues typing.
</p></dd>
<dt><code>:blink-fcn</code></dt>
<dd><p>The function to implement the blinker if <code>:blinker-p</code>
is not turned off.  The default is <code>tv-rectangular-blinker</code>.
</p></dd>
<dt><code>:sideways-p</code></dt>
<dd><p><code>t</code> means the monitor is standing on its left side
instead of its bottom; change things around
appropriately.  The default comes from the specified screen.
</p></dd>
<dt><code>:integral-p</code></dt>
<dd><p><code>t</code> means that the piece of paper should be forced
to be an integral number of lines high; it will be
made slightly smaller than the specified size if
necessary.  The default is <code>nil</code>.
</p></dd>
<dt><code>:font-map</code></dt>
<dd><p>Set the font-map.  This is intended to replace the passing
in of the font-map as the second argument.
</p></dd>
</dl>

</dd></dl>

<dl>
<dt><a name="index-tv_002ddefine_002dblinker"></a>Function: <strong>tv-define-blinker</strong> <em>pc-ppr &amp;rest options</em></dt>
<dd><p>Define a blinker on a piece of paper.  The options are similar
in syntax to those in <code>tv-define-pc-ppr</code>.  Valid options are:
</p>
<dl compact="compact">
<dt><code>:height</code></dt>
<dd><p>Number of raster lines high.  The default comes
from the first font in the pc ppr&rsquo;s font map.
</p></dd>
<dt><code>:width</code></dt>
<dd><p>Number of raster points wide.  The default comes
from the first font in the pc ppr&rsquo;s font map.
</p></dd>
<dt><code>:function</code></dt>
<dd><p>The function to implement the blinker.  The default
is <code>tv-rectangular-blinker</code>.
</p></dd>
<dt><code>:arg1</code></dt>
<dd><p>Another name for <code>:width</code>.  Use this with <code>:function</code>s
which don&rsquo;t interpret their first &quot;argument&quot; as a width.
</p></dd>
<dt><code>:arg2</code></dt>
<dd><p>Another name for <code>:height</code>.  Use this with <code>:function</code>s
which don&rsquo;t interpret their second &quot;argument&quot; as a height.
</p></dd>
<dt><code>:visibility</code></dt>
<dd><p>Initial visibility, <code>t</code>, <code>nil</code>, or <code>blink</code>.
Default is <code>blink</code>.
</p></dd>
<dt><code>:follow-p</code></dt>
<dd><p><code>t</code> if this blinker should follow that pc ppr&rsquo;s cursor.
Default is <code>nil</code>.
</p></dd>
<dt><code>:roving-p</code></dt>
<dd><p><code>t</code> if this blinker is not confined to a single piece
of paper.  In this case the pc ppr argument is ignored and should be <code>nil</code>.
Default is <code>nil</code>.
</p></dd>
<dt><code>:activate-p</code></dt>
<dd><p><code>t</code> if this blinker should be initially active.
The default is <code>nil</code>.
</p></dd>
<dt><code>:half-period</code></dt>
<dd><p>Number of 60ths of a second between changes in the blinker.
Default is 15.
</p></dd>
<dt><code>:screen</code></dt>
<dd><p>The screen on which the blinker should appear.  The default
is to take it from the pc ppr, or from <code>tv-default-screen</code>
in the case of a roving blinker.
</p></dd>
<dt><code>:sideways-p</code></dt>
<dd><p><code>t</code> to make the blinker be rotated 90 degrees.  Default
is to take it from the pc ppr.
</p></dd>
</dl>

<p>You may give <code>nil</code> as a pc-ppr, in which case you must specify
<code>:width</code> and <code>:height</code> (or <code>:arg1</code> and <code>:arg2</code>) since they will
default to <code>nil</code>.
You should give <code>nil</code> as pc-ppr if and only if you specify <code>:roving-p</code>,
probably, since <code>:roving-p</code> means this blinker is not on a pc ppr.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dredefine_002dpc_002dppr"></a>Function: <strong>tv-redefine-pc-ppr</strong> <em>pc-ppr &amp;rest &amp;eval options</em></dt>
<dd><p>Redefine some of the parameters of a pc ppr.
The allowed options are <code>:top</code>, <code>:bottom</code>, <code>:left</code>, <code>:right</code>,
<code>:top-margin</code>,
<code>:bottom-margin</code>, <code>:left-margin</code>, <code>:right-margin</code>, <code>:vsp</code>, <code>:integral-p</code>,
<code>:more-p</code>, <code>:screen</code>,
and <code>:fonts</code>.  <code>:fonts</code> allows you to change the font map,
which can change the line height.  The size of the blinker
will not be changed, but perhaps it should be.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddeactivate_002dpc_002dppr"></a>Function: <strong>tv-deactivate-pc-ppr</strong> <em>pc-ppr</em></dt>
<dd><p>Cause a piece of paper&rsquo;s blinkers to stop blinking.
It is illegal to type out on a pc ppr which is deactivated.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dactivate_002dpc_002dppr"></a>Function: <strong>tv-activate-pc-ppr</strong> <em>pc-ppr</em></dt>
<dd><p>Cause blinkers to blink again.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002ddeactivate_002dpc_002dppr_002dbut_002dshow_002dblinkers"></a>Function: <strong>tv-deactivate-pc-ppr-but-show-blinkers</strong> <em>pc-ppr</em></dt>
<dd><p>Cause all blinkers on this piece of paper to be stuck in the blunk (<code>t</code>) state.
I.e. mark place but don&rsquo;t flash.  Deactivates so that they won&rsquo;t flash.
Typing out on this piece of paper will cause blinkers to start blinking again.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dreturn_002dpc_002dppr"></a>Function: <strong>tv-return-pc-ppr</strong> <em>pc-ppr</em></dt>
<dd><p><code>return-array</code> all of a piece of paper.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dmake_002dstream"></a>Function: <strong>tv-make-stream</strong> <em>pc-ppr</em></dt>
<dd><p>Returns a stream which accepts output and displays it on <i>pc-ppr</i>,
and reads input from the keyboard, echoing it on <i>pc-ppr</i>.
</p></dd></dl>

<a name="The-Keyboard"></a>
<h3 class="section">23.12 The Keyboard</h3>

<p>Keyboard input can be done either by reading from the <code>standard-input</code>
stream, which is preferred, or by calling these keyboard routines directly.
</p>
<p>The characters read by the functions below are in the Lisp Machine
character set, with extra bits to incicate the Control and Meta
keys.  Also, the characters may come from the <i>forced-input</i>
mechanism (see (force-kbd-input-fun)), and may be from the mouse.
The byte fields which make up the fixnums returned by these functions
have names beginning with &quot;<code>%%kbd-</code>&quot;, and are explained on (%%kbd).
</p>
<p>The special characters Break, Call, and Escape are normally intercepted
by the keyboard routines.  Break causes the process which reads it to
enter a <code>break</code> loop (see (break-fun)).
Call returns control to the top-level job, or enters a <code>break</code> loop
if control is already in the top-level job.  Control and Meta modifiers
cause additional effects.  See (call-key) for details.
Escape is a prefix for various commands, as in ITS.  Commands consist of
Escape, an optional numeric argument (in octal), and a letter, and do not echo.
The commands that currently exist are:
</p>
<dl compact="compact">
<dt><span class="roman">&lt;esc&gt;C</span></dt>
<dd><p>Complement TV black-on-white mode.
</p></dd>
<dt><span class="roman">&lt;esc&gt;<i>n</i>C</span></dt>
<dd><p>Complement black-on-white mode of plane <i>n</i>.
</p></dd>
<dt><span class="roman">&lt;esc&gt;<i>n</i>S</span></dt>
<dd><p>Select video-switch input <i>n</i>.
</p></dd>
<dt><span class="roman">&lt;esc&gt;M</span></dt>
<dd><p>Complement more-processing enable.
</p></dd>
<dt><span class="roman">&lt;esc&gt;0M</span></dt>
<dd><p>Turn off more-processing.
</p></dd>
<dt><span class="roman">&lt;esc&gt;1M</span></dt>
<dd><p>Turn on more-processing.
</p></dd>
</dl>

<dl>
<dt><a name="index-kbd_002dtyi"></a>Function: <strong>kbd-tyi</strong> <em>&amp;optional (whostate <code>&quot;TYI&quot;</code>)</em></dt>
<dd><p>This is the main routine for reading from the keyboard.
The optional argument is what to display as the program state in the
who line (usually just &quot;TYI&quot;) while awaiting typein.  The value returned
is a number which consists of a Lisp machine character code,
augmented with bits for the control and meta keys.
The character is not echoed.
</p></dd></dl>

<dl>
<dt><a name="index-kbd_002dtyi_002dno_002dhang"></a>Function: <strong>kbd-tyi-no-hang</strong></dt>
<dd><p>Returns <code>nil</code> if no character has been typed, or the character
code as <code>kbd-tyi</code> would return it.
</p></dd></dl>

<dl>
<dt><a name="index-kbd_002dchar_002davailable"></a>Function: <strong>kbd-char-available</strong></dt>
<dd><p>Returns non-<code>nil</code> if there is a character waiting to be read; otherwise
returns <code>nil</code>.  It does not read the character out.  This function can
be used with <code>process-wait</code>.
</p></dd></dl>

<dl>
<dt><a name="index-kbd_002dsuper_002dimage_002dp"></a>Variable: <strong>kbd-super-image-p</strong></dt>
<dd><p>If the value of <code>kbd-super-image-p</code> is non-<code>nil</code>, checking for
the special characters Break, Call, and Escape is disabled.  Note that
you cannot lambda-bind this variable, because it is looked at in different
stack-groups.
</p></dd></dl>

<dl>
<dt><a name="index-kbd_002dsimulated_002dclock_002dfcn_002dlist"></a>Variable: <strong>kbd-simulated-clock-fcn-list</strong></dt>
<dd><p>List of functions to be called every 60th of a second (while the
machine is waiting for typein.)  This is used to implement blinkers.
[This variable should be renamed and moved to the scheduler section.]
</p></dd></dl>

<dl>
<dt><a name="index-force_002dkbd_002dinput"></a>Function: <strong>force-kbd-input</strong> <em>job input</em></dt>
<dd><p>This is used to make a job think it has keyboard input that was not
actually typed by the user.  The menu system, for example, uses this.
<i>job</i> is the job to receive the input.  <i>input</i> is either a fixnum,
representing a single character, or an array of characters (which may or
may not be a string).  <code>force-kbd-input</code> waits until previous
forced input has been read, then gives the new forced input to the job.
</p></dd></dl>

<a name="Internal-Special-Variables"></a>
<h3 class="section">23.13 Internal Special Variables</h3>

<dl>
<dt><a name="index-tv_002dblinker_002dlist"></a>Variable: <strong>tv-blinker-list</strong></dt>
<dd><p>This is a list of all blinkers which are visible (blinking or
solidly on).  It is used by the <code>tv-blinker-clock</code> routine
and by <code>tv-open-screen</code>.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002droving_002dblinker_002dlist"></a>Variable: <strong>tv-roving-blinker-list</strong></dt>
<dd><p>This is a list of peculiar blinkers which don&rsquo;t stay on any single
piece of paper.  Whenever any piece of paper is opened, in addition
to that piece of paper&rsquo;s own blinkers, all of the roving blinkers
will be temporarily turned off.  Only the visible ones are on this list.
This is primarily for the mouse&rsquo;s blinker.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dpc_002dppr_002dlist"></a>Variable: <strong>tv-pc-ppr-list</strong></dt>
<dd><p>This is a list of all the pieces of paper.
Currently for no particular reason.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dwhite_002don_002dblack_002dstate-1"></a>Variable: <strong>tv-white-on-black-state</strong></dt>
<dd><p>[??]
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dbeep_002dduration"></a>Variable: <strong>tv-beep-duration</strong></dt>
<dd><p>Controls beeping.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dbeep_002dwavelength"></a>Variable: <strong>tv-beep-wavelength</strong></dt>
<dd><p>Controls beeping.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dmore_002dprocessing_002dglobal_002denable"></a>Variable: <strong>tv-more-processing-global-enable</strong></dt>
<dd><p>This flag controls whether &quot;**MORE**&quot;&rsquo;s can happen.  Complemented
by &lt;esc&gt;M.  The initial value is <code>t</code>.
</p></dd></dl>

<a name="Font-Utility-Routines"></a>
<h3 class="section">23.14 Font Utility Routines</h3>

<p>[Are these the latest word?  I suspect not.]
</p>
<dl>
<dt><a name="index-tv_002dget_002dfont_002dpixel"></a>Function: <strong>tv-get-font-pixel</strong> <em>font char row col</em></dt>
<dd><p>Returns a number which is the pixel value of the specified
point in the specified character in the specified font.  This is
0 or 1 for normal fonts, or a gray-level value for multi-plane
fonts.  The value returned is zero if you address outside
of the character raster.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dstore_002dfont_002dpixel"></a>Function: <strong>tv-store-font-pixel</strong> <em>pixel font char row col</em></dt>
<dd><p>This is similar to the above, but stores.  It is an error to store
outside of the character raster.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dmake_002dsideways_002dfont"></a>Function: <strong>tv-make-sideways-font</strong> <em>font</em></dt>
<dd><p>Returns a new font which is the same, except turned on its side
in such a way that it works on pieces of paper created with
the <code>sideways-p</code> <code>t</code> option.
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dmake_002ddbl_002dhor_002dfont"></a>Function: <strong>tv-make-dbl-hor-font</strong> <em>font</em></dt>
<dd><p>Returns a new font with alternating bits split into two planes
in such a way that it will work with doubled horizontal resolution
(producing squished characters if the original font had a normal
aspect ratio.)
</p></dd></dl>

<dl>
<dt><a name="index-tv_002dmake_002dgray_002dfont"></a>Function: <strong>tv-make-gray-font</strong> <em>font1 &amp;optional (x-ratio 2) (y-ratio 2) (n-planes 2)</em></dt>
<dd><p>Returns a new font which is the original font with areas
<i>x-ratio</i> wide and <i>y-ratio</i> high converted into single points
with an appropriate gray level value.  <i>n-planes</i> determines
the number of gray levels available.
</p></dd></dl>

<a name="The-Font-Compiler"></a>
<h3 class="section">23.15 The Font Compiler</h3>
<a name="index-font-compiler"></a>

<p>The Font Compiler is a lisp program which runs on the pdp10.
It converts fonts represented as AST files into QFASL files
which can be loaded into the Lisp machine.  When a font is loaded,
a symbol in the <code>fonts</code> package is <code>setq</code>&rsquo;ed to
the representation of that font.
</p>
<p>To run the font compiler, incant
</p>
<div class="lisp">
<pre class="lisp">:lispm1;qcmp
(fasload (lmio)fcmp)
(crunit dsk lmfont)  ;Or whatever directory you keep fonts on
(fcmp-1 '<i>input</i> '<i>output</i> '<i>fontname</i> <i>screen-type</i>)
</pre></div>

<p><i>input</i> is the first-name of the AST file containing the font
to be processed.  <i>output</i> is the first-name of the QFASL file
to be produced.  <i>fontname</i> is the name of the symbol in the
<code>fonts</code> package whose value will be the font.  This symbol will
also appear in the <code>font-name</code> field of the font and in the printed
representation of the font.
<i>screen-type</i> is <code>t</code> if the font is to be used with the 32-bit
TV controller, or <code>nil</code> if the font is to be used with the 16-bit controller.
</p>
<p>[Here insert a catalog of fonts when things settle down a little more.]
</p>
<a name="Errors-and-Debugging"></a>
<h2 class="chapter">24 Errors and Debugging</h2>
<a name="index-error-system"></a>
<a name="index-handling-errors"></a>

<p>The first section of this chapter explains how programs
can handle errors, by means of condition handlers.  It also explains how
a program can signal an error if it detects something it doesn&rsquo;t like.
</p>
<p>The second explains how users can handle errors, by means of an interactive debugger;
that is, it explains how to recover if you do something wrong.
For a new user of the Lisp Machine, the second section is probably
much more useful; you may want to skip the first.
</p>
<p>The remaining sections describe some other debugging facilities.
Anyone who is going to be writing programs for the Lisp machine should
familiarize himself with these.
</p>
<p>The <i>trace</i> facility provides the ability to perform certain
actions at the time a function is called or at the time it returns.  The
actions may be simple typeout, or more sophisticated debugging functions.
</p>
<p>The <i>step</i> facility allows the evaluation of a form to be
intercepted at every step so that the user may examine just what is happening
throughout the execution of the form.
</p>
<p>The <i>MAR</i> facility provides the ability to cause a trap
on any memory reference to a word (or a set of words) in memory.  If
something is getting clobbered by agents unknown, this can help track
down the source of the clobberage.
</p>
<a name="The-Error-System"></a>
<h3 class="section">24.1 The Error System</h3>

<a name="Conditions"></a>
<h4 class="subsection">24.1.1 Conditions</h4>
<a name="index-conditions"></a>

<p>Programmers often want to control what action is taken by their
programs when errors or other exceptional situations occur.  Usually
different situations are handled in different ways, and in order to express
what kind of handling each situation should have, each situation
must have an associated name.  In Lisp Machine Lisp there is the
concept of a <i>condition</i>.  Every condition has a name, which is a
symbol.  When an unusual situation occurs, some condition is <i>signalled</i>, and a
<i>handler</i> for that condition is invoked.
</p>
<p>When a condition is signalled, the system (essentially) searches
up the stack of nested function invocations looking for a handler established
to handle that condition.
The handler is a function which gets called to deal with the condition.
The condition mechanism itself is
just a convenient way for finding an appropriate handler function given
the name of an exceptional situation.  On top of this is built the
error-condition system, which defines what arguments are passed to a handler
function and what is done with the values returned by a handler function.
Almost all current use of the condition mechanism is for errors, but the user
may find other uses for the underlying mechanism.
</p>
<a name="index-signaller"></a>
<a name="index-signalling-conditions"></a>
<p>The search for an appropriate handler is done by the function <code>signal</code>:
</p>
<dl>
<dt><a name="index-signal"></a>Function: <strong>signal</strong> <em>condition-name &amp;rest args</em></dt>
<dd><p><code>signal</code> searches through all currently-established condition handlers,
starting with the most recent.  If it finds one that will handle
the condition <i>condition-name</i>, then it calls that handler with a first argument
of <i>condition-name</i>, and with <i>args</i> as the rest of the arguments.
If the first value returned by the handler is <code>nil</code>, <code>signal</code>
will continue searching for another handler; otherwise,
it will return the first two values returned by the handler.
If <code>signal</code> doesn&rsquo;t find any handler that returns a non-<code>nil</code>
value, it will return <code>nil</code>.
</p></dd></dl>

<a name="index-condition-handler"></a>
<a name="index-handling-conditions"></a>
<p>Condition handlers are established through the <code>condition-bind</code> special form:
</p>
<dl>
<dt><a name="index-condition_002dbind"></a>Special Form: <strong>condition-bind</strong></dt>
<dd><p>The <code>condition-bind</code> special form is used for establishing handlers for conditions.
It looks like:
</p>
<div class="lisp">
<pre class="lisp">(condition-bind ((<i>cond-1</i> <i>hand-1</i>)
                 (<i>cond-2</i> <i>hand-2</i>)
                 ...)
  <i>body</i>)
</pre></div>

<p>Each <i>cond-n</i> is either the name of a condition, or a list of names of conditions,
or <code>nil</code>.  If it is <code>nil</code>, a handler is set up for <i>all</i> conditions
(this does not mean that the handler really has to handle all
conditions, but it will be offered the chance to do so, and can return
<code>nil</code> for conditions which it is not interested in).
Each <i>hand-n</i> is a form which is evaluated to produce a handler function.
The handlers are established sequentially such that the <i>cond-1</i>
handler would be looked at first.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(condition-bind ((:wrong-type-argument 'my-wta-handler)
                 ((lossage-1 lossage-2) lossage-handler))
    (princ &quot;Hello there.&quot;)
    (= t 69))
</pre></div>

<p>This first sets up the function <code>my-wta-handler</code> to handle
the <code>:wrong-type-argument</code> condition.  Then, it sets up the binding
of the symbol <code>lossage-handler</code> to handle both the <code>lossage-1</code>
and <code>lossage-2</code> conditions.  With these handlers set up, it prints out a message and
then runs headlong into a wrong-type-argument error by calling the
function <code>=</code> with an argument which is not a number.
The condition handler <code>my-wta-handler</code> will be given a chance to
handle the error.  <code>condition-bind</code>
makes use of ordinary variable binding, so that if the
<code>condition-bind</code> form is thrown through, the handlers will be
disestablished.  This also means that condition handlers are established
only within the current stack-group.
</p></dd></dl>

<a name="Error-Conditions"></a>
<h4 class="subsection">24.1.2 Error Conditions</h4>

<p>The use of the condition mechanism by the error system defines an
additional protocol for what arguments are passed to error-condition
handlers and what values they may return.
</p>
<p>There are basically four possible responses to an error: <i>proceeding</i>,
<i>restarting</i>, <i>throwing</i>, or entering the <i>debugger</i>.
The default action, taken if no handler exists or deigns to handle
the error (returns non-<code>nil</code>), is to enter the debugger.
A handler may give up on the execution that produced the error by
throwing (see <code>*throw</code>, (*throw-fun)).  <i>Proceeding</i> means to
repair the error and continue execution.  The exact meaning of this
depends on the particular error, but it generally takes the form of
supplying a replacement for an unacceptable argument to some function,
and retrying the invocation of that function.  <i>Restarting</i> means
throwing to a special standard catch-tag, <code>error-restart</code>.  Handlers
cause proceeding and restarting by returning certain special values,
described below.
</p>
<p>Each error condition is signalled with some parameters, the meanings of which
depend on the condition.  For example, the condition <code>:unbound-variable</code>,
which means that something tried to find the value of a symbol which was unbound,
is signalled with one parameter, the unbound symbol.  It is always
all right to signal an error condition with extra parameters.
</p>
<p>An error condition handler is applied to several arguments.  The first
argument is the name of the condition that was signalled (a symbol).
This allows the same function to handle several different conditions,
which is useful if the handling of those conditions is very similar.
(The first argument is also the name of the condition for non-error conditions.)
The second argument is a <code>format</code> control string (see the description
of <code>format</code>, on (format-fun)).  The third argument
is <code>t</code> if the error is <i>proceedable</i>; otherwise it is <code>nil</code>.  The
fourth argument is <code>t</code> if the error is <i>restartable</i>; otherwise it
is <code>nil</code>.
The fifth argument is the name of the function that signalled the
error, or <code>nil</code> if the signaller can&rsquo;t figure out the correct name to pass.
The rest of the arguments are the parameters with which the condition was signalled.
If the <code>format</code> control string is used with these parameters,
a readable English message should be produced.  Since more
information than just the parameters might be needed to print a reasonable
message, the program signalling the condition is free to pass any extra
parameters it wants to, after the parameters which the condition is <i>defined</i>
to take.  This means that every handler must expect to be called
with an arbitrarily high number of arguments, so every handler should
have a <code>&amp;rest</code> argument (see (&amp;rest)).
</p>
<p>An error condition handler may return any of several values.  If it
returns <code>nil</code>, then it is stating that it does not wish to handle
the condition after all; the process of signalling will continue
looking for a prior handler (established farther down on the stack) as
if the handler which returned <code>nil</code> had not existed at all.
(This is also true for non-error conditions.)
If the handler does wish to handle the condition, it can try to
proceed from the error if it is proceedable, or restart from it if it
is restartable, or it can throw to a catch tag.
Proceeding and restarting are done by returning two values.
To proceed, return the symbol <code>return</code> as the first value, and the
value to be returned by the function <code>cerror</code> as the second.
To restart, return the symbol <code>error-restart</code> as the first value,
and the value to be thrown to the tag <code>error-restart</code> as the second.
The condition handler must not return any other sort of values.  However,
it can legitimately throw to any tag instead of returning at all.
If a handler tries to proceed an unproceedable error or
restart an unrestartable one, an error is signalled.
</p>
<p>Note that if the handler returns <code>nil</code>, it is not said to have
handled the error; rather, it has decided not to handle it, but to &quot;continue to signal&quot;
it so that someone else may handle it.  If an error is signalled
and none of the handlers for the condition decide to handle it, the
debugger is entered.
</p>
<p>Here is an example of an excessively simple handler for the <code>:wrong-type-argument</code>
condition.
</p>
<div class="lisp">
<pre class="lisp">;;; This function handles the :wrong-type-argument condition,
;;; which takes two defined parameters: a symbol indicating
;;; the correct type, and the bad value.
(defun sample-wta-handler (condition control-string proceedable-flag
                           restartable-flag function
                           correct-type bad-value &amp;rest rest)
 (prog ()
   (format error-output &quot;~%There was an error in ~S~%&quot; function)
   (lexpr-funcall (function format)
                  control-string correct-type bad-value rest)
   (cond ((and proceedable-flag
               (yes-or-no-p query-io &quot;Do you want use nil instead?&quot;))
          (return 'return nil))
         (t (return nil))))) ;don't handle
</pre></div>

<p>If an error condition reaches the error handler, the control-C command may be
used to continue from it.  If the condition name has a <code>si:eh-proceed</code> property,
that property is called as a function with two arguments, the stack-group and
the &quot;ete&quot; (an internal error-handler data structure).  Usually it will ignore
these arguments.  If this function returns, its value will be returned from the
<code>ferror</code> or <code>cerror</code> that signalled the condition.  If no such property
exists, the error-handler asks the user for a form, evaluates it, and causes
<code>ferror</code> or <code>cerror</code> to return that value.  Putting such a property on can
be used to change the prompt for this form, avoid asking the user, or change
things in more far-reaching ways.
</p>
<a name="Signalling-Errors"></a>
<h4 class="subsection">24.1.3 Signalling Errors</h4>
<a name="index-signalling-errors"></a>

<p>Some error conditions are signalled by the Lisp system when it detects
that something has gone wrong.  Lisp programs can also signal errors,
by using any of the functions <code>ferror</code>, <code>cerror</code>, or <code>error</code>.
<code>ferror</code> is the most commonly used of these.  <code>cerror</code> is used
if the signaller of the error wishes to make the error be <i>proceedable</i>
or <i>restartable</i>, or both.  <code>error</code> is provided for Maclisp compatibility.
</p>
<p>A <code>ferror</code> or <code>cerror</code> that doesn&rsquo;t have any particular
condition to signal should use <code>nil</code> as the condition name.  The
only kind of handler that will be invoked by the signaller in this case is the kind
that handles <i>all</i> conditions, such as is set up by
</p>
<div class="lisp">
<pre class="lisp">(condition-bind ((nil <i>something</i>) ...) ...)
</pre></div>

<p>In practice, the <code>nil</code> condition is used a great deal.
<a name="index-nil_002c-used-as-a-condition-name"></a>
</p>
<dl>
<dt><a name="index-ferror"></a>Function: <strong>ferror</strong> <em>condition-name control-string &amp;rest params</em></dt>
<dd><p><code>ferror</code> signals the condition <i>condition-name</i>.  Any
handler(s) invoked will be passed <i>condition-name</i> and <i>control-string</i>
as their first and second arguments, <code>nil</code> and <code>nil</code> for the third and fourth
arguments (i.e. the error will be neither proceedable nor restartable), the name
of the function that called <code>ferror</code> for the fifth argument, and
<i>params</i> as the rest of their arguments.
</p>
<p>Note that <i>condition-name</i> can be <code>nil</code>, in which case no handler
will probably be found and the debugger will be entered.
</p>
<div class="lisp">
<pre class="lisp">Examples:
</pre><pre class="lisp">(cond ((&gt; sz 60)
       (ferror nil
               &quot;The size, ~S, was greater then the maximum&quot;
               sz))
      (t (foo sz)))

(defun func (a b)
   (cond ((and (&gt; a 3) (not (symbolp b)))
          (ferror ':wrong-type-argument
                  &quot;The name, ~1G~S, must be a symbol&quot;
                  'symbolp
                  b))
         (t (func-internal a b))))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-cerror"></a>Function: <strong>cerror</strong> <em>proceedable-flag restartable-flag condition-name control-string &amp;rest params</em></dt>
<dd><p><code>cerror</code> is just like <code>ferror</code> (see (ferror-fun)) except that the handler
is passed <i>proceedable-flag</i> and <i>restartable-flag</i> as its
third and fourth arguments.  If <code>cerror</code> is called with a
non-<code>nil</code> <i>proceedable-flag</i>, the caller should be prepared
to accept the returned value of <code>cerror</code> and use it to restart the
error.  Similarly, if he passes <code>cerror</code> a non-<code>nil</code> <i>restartable-flag</i>,
he should be sure that there is a <code>*catch</code> above him for the tag <code>error-restart</code>.
</p>
<p>If <i>proceedable-flag</i> is <code>t</code>, the user will be asked for a replacement
object which <code>cerror</code> will return.  If <i>proceedable-flag</i> is not
<code>t</code> and not <code>nil</code>, <code>cerror</code> will return without asking for
any particular object.
</p>
<p>Note:  Many programs that want to signal restartable errors will want to use
the <code>error-restart</code> special form; see (error-restart-fun).
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(do ()
    ((symbolp a))
  <span class="roman">; Do this stuff until </span>a<span class="roman"> becomes a symbol.</span>
  (setq a (cerror t nil ':wrong-type-argument
             &quot;The argument ~2G~A was ~1G~S, which is not ~3G~A&quot;
             'symbolp a 'a &quot;a symbol&quot;)))
</pre></div>

<p>Note: the form in this example is so useful that there is a standard
special form to do it, called <code>check-arg</code> (see (check-arg-fun)).
</p></dd></dl>

<dl>
<dt><a name="index-error"></a>Function: <strong>error</strong> <em>message &amp;optional object interrupt</em></dt>
<dd><p><code>error</code> is provided for Maclisp compatibility.  In Maclisp,
the functionality of <code>error</code> is, essentially, that <i>message</i>
gets printed, preceeded by <i>object</i> if present, and that
<i>interrupt</i>, if present, is a user interrupt channel to be invoked.
</p>
<p>In order to fit this definition into the Lisp Machine way of handling
errors, <code>error</code> is defined to be:
</p>
<div class="lisp">
<pre class="lisp">(cerror (not (null <i>interrupt</i>))
        nil
        (or (get <i>interrupt</i> 'si:condition-name)
            <i>interrupt</i>)
        (cond ((missing <i>object</i>) ;<span class="roman">If no <code>object</code> given</span>
               &quot;~*~a&quot;)
              (t &quot;~s ~a&quot;))
        <i>object</i>
        <i>message</i>)
</pre></div>

<p>Here is what that means in English: first of all, the condition
to be signalled is <code>nil</code> if <i>interrupt</i> is <code>nil</code>.  If there is some
condition whose meaning is close to that of one of the Maclisp user interrupt
channels, the name of that channel has an <code>si:condition-name</code> property,
and the value of that property is the name of the condition to signal.
Otherwise, <i>interrupt</i> is the name of the condition to signal; probably
there will be no handler and the debugger will be entered.
</p>
<p>If <i>interrupt</i> is specified, the error will be proceedable.
The error will not be restartable.  The <code>format</code> control string
and the arguments are chosen so that the right error message gets printed,
and the handler is passed everything there is to pass.
</p></dd></dl>

<dl>
<dt><a name="index-error_002drestart"></a>Macro: <strong>error-restart</strong></dt>
<dd><p><code>error-restart</code> is useful for denoting a section of a program
that can be restarted if certain errors occur during its execution.
An <code>error-restart</code> form looks like:
</p>
<div class="lisp">
<pre class="lisp">(error-restart
  <i>form-1</i>
  <i>form-2</i>
  <i>...</i>)
</pre></div>

<p>The forms of the body are evaluated sequentially.  If an error occurs
within the evaluation of the body and is restarted (by a condition handler
or the debugger), the evaluation resumes at the beginning of the <code>error-restart</code>&rsquo;s
body.
</p>
<div class="lisp">
<pre class="lisp">Example:
</pre><pre class="lisp">(error-restart
  (setq a (* b d))
  (cond ((&gt; a maxtemp)
         (cerror nil t 'overheat
                 &quot;The frammistat will overheat by ~D. degrees!&quot;
                 (- a maxtemp))))
  (setq q (cons a a)))
</pre></div>

<p>If the <code>cerror</code> happens, and the handler invoked (or the debugger) restarts
the error, then evaluation will continue with the <code>(setq a (* b d))</code>,
and the condition <code>(&gt; a maxtemp)</code> will get checked again.
</p>
<div class="lisp">
<pre class="lisp"><span class="roman"><code>error-restart</code> is implemented as a macro that expands into:</span>
(prog ()
 loop (*catch 'error-restart
              (return (progn
                         <i>form-1</i>
                         <i>form-2</i>
                         <i>...</i>)))
      (go loop))
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-check_002darg"></a>Macro: <strong>check-arg</strong></dt>
<dd><p>The <code>check-arg</code> form is useful for checking arguments
to make sure that they are valid.  A simple example is:
</p>
<div class="lisp">
<pre class="lisp">(check-arg foo stringp &quot;a string&quot;)
</pre></div>

<p><code>foo</code> is the name of an argument whose value should be a string.
<code>stringp</code> is a predicate of one argument, which returns <code>t</code>
if the argument is a string.  <code>&quot;a string&quot;</code> is an English description
of the correct type for the variable.
</p>
<p>The general form of <code>check-arg</code> is
</p>
<div class="lisp">
<pre class="lisp">(check-arg <i>var-name</i>
           <i>predicate</i>
           <i>description</i>
           <i>type-symbol</i>)
</pre></div>

<p><i>var-name</i> is the name of the variable
whose value is of the wrong type.  If the error is proceeded this variable will
be <code>setq</code>&rsquo;ed to a replacement value.  <i>predicate</i> is a test for whether the
variable is of the correct type.  It can be either a symbol whose function definition
takes one argument and returns non-<code>nil</code> if the type is correct, or it can be a non-atomic
form which is evaluated to check the type, and presumably contains a reference to
the variable <i>var-name</i>.  <i>description</i> is a string which expresses <i>predicate</i>
in English, to be used in error messages.  <i>type-symbol</i> is a symbol which
is used by condition handlers to determine what type of argument was expected.
It may be omitted if it is to be the same as <i>predicate</i>, which must be a symbol
in that case.
</p>
<p>The use of the <i>type-symbol</i> is not really well-defined yet, but the intention
is that if it is <code>numberp</code> (for example), the
condition handlers can tell that a number was needed, and might try to
convert the actual supplied value to a number and proceed.
</p>
<p>[We need to establish a conventional way of &quot;registering&quot; the
type-symbols to be used for various expected types.  It might as well
be in the form of a table right here.]
</p>
<p>The <i>predicate</i> is usually a symbol such as <code>fixp</code>, <code>stringp</code>,
<code>listp</code>, or <code>closurep</code>, but when there isn&rsquo;t any convenient predefined
predicate, or when the condition is complex, it can be a form.  In this case
you should supply a <i>type-symbol</i> which encodes the type.  For example:
</p>
<div class="lisp">
<pre class="lisp">(check-arg a
           (and (numberp a) ( a 10.) (&gt; a 0.))
           &quot;a number from one to ten&quot;
           one-to-ten)
</pre></div>

<p>If this error got to the debugger, the message
</p>
<div class="lisp">
<pre class="lisp">The argument a was 17, which is not a number from one to ten.
</pre></div>

<p>would be printed.
</p>
<p>In general, what constitutes a valid argument is specified in three
ways in a <code>check-arg</code>.  <i>description</i> is human-understandable,
<i>type-symbol</i> is program-understandable, and <i>predicate</i> is
executable.  It is up to the user to ensure that these three
specifications agree.
</p>
<p><code>check-arg</code> uses <i>predicate</i> to determine
whether the value of the variable is of the correct type.  If it is not,
<code>check-arg</code> signals the <code>:wrong-type-argument</code> condition, with four
parameters.  First, <i>type-symbol</i> if it was supplied, or else <i>predicate</i>
if it was atomic, or else <code>nil</code>.  Second, the bad value.
Third, the name of the argument (<i>var-name</i>).
Fourth, a string describing the proper type (<i>description</i>).
If the error is proceeded, the variable is set to the value returned,
and <code>check-arg</code> starts over, checking the type again.
Note that only the first two of these parameters are defined for
the <code>:wrong-type-argument</code> condition, and so <code>:wrong-type-argument</code>
handlers should only depend on the meaning of these two.
</p></dd></dl>

<a name="Standard-Condition-Names"></a>
<h4 class="subsection">24.1.4 Standard Condition Names</h4>

<p>Some condition names are used by the kernel Lisp system, and are
documented below; since they are of global interest, they are on
the keyword package.  Programs outside the kernel system are free
to define their own condition names; it is intended that the
description of a function include a description of any conditions
that it may signal, so that people writing programs that call
that function may handle the condition if they desire.  When you
decide what package your condition names should be in, you should
apply the same criteria you would apply for determining which package
a function name should be in; if a program
defines its own condition names, they should <i>not</i> be on the
keyword package. For example, the condition names <code>chaos:bad-packet-format</code>
and <code>arpa:bad-packet-format</code> should be distinct.  For further
discussion, see (package).
</p>
<p>The following table lists all standard conditions and the
parameters they take; more will be added in the future.
These are all error-conditions, so in addition to the condition name
and the parameters, the handler receives the other arguments described above.
</p>
<dl compact="compact">
<dt><code>:wrong-type-argument <i>type-name</i> <i>value</i></code></dt>
<dd><p><i>value</i> is the offending argument, and <i>type-name</i> is
a symbol for what type is required.  Often, <i>type-name</i>
is a predicate which returns non-<code>nil</code> if applied to an acceptable value.
If the error is proceeded, the value returned by the handler
should be a new value for the argument to be used instead of
the one which was of the wrong type.
</p>
</dd>
<dt><code>:inconsistent-arguments <i>list-of-inconsistent-argument-values</i></code></dt>
<dd><p>These arguments were inconsistent with each other, but the fault
does not belong to any particular one of them.
This is a catch-all, and it would be good to identify subcases
in which a more specific categorization can be made.
If the error is proceeded, the value returned by the
handler will be returned by the function whose arguments were inconsistent.
</p>
</dd>
<dt><code>:wrong-number-of-arguments <i>function</i> <i>number-of-args-supplied</i> <i>list-of-args-supplied</i></code></dt>
<dd><p><i>function</i> was invoked with the wrong number of arguments.
The elements of <i>list-of-args-supplied</i> have already been evaluated.
If the error is proceeded, the value returned should be
a value to be returned by <i>function</i>.
</p>
</dd>
<dt><code>:invalid-function <i>function-name</i></code></dt>
<dd><p>The name had a function definition but it was no good for calling.
You can proceed, supplying a value to return as the value of the
call to the function.
</p>
</dd>
<dt><code>:invalid-form <i>form</i></code></dt>
<dd><p>The so-called <i>form</i> was not a meaningful form for <code>eval</code>.
Probably it was of a bad data type.
If the error is proceeded, the value returned
should be a new form; <code>eval</code> will use it instead.
</p>
</dd>
<dt><code>:undefined-function <i>function-name</i></code></dt>
<dd><p>The symbol <i>function-name</i> was not defined as a function.
If the error is proceeded, then the symbol will be
defined to the function returned, and that function will be
used to continue execution.
</p>
</dd>
<dt><code>:unbound-variable <i>variable-name</i></code></dt>
<dd><p>The symbol <i>variable-name</i> had no value.
If the error is proceeded, then the symbol will be set to the value returned
by the handler, and that value will be used to continue execution.
</p>

</dd>
</dl>

<p>Currently, errors detected by microcode do not signal conditions.
Generally this means that errors in interpreted code signal conditions
and some errors in compiled code do not.  This will be corrected some
time in the future.
</p>
<a name="Errset"></a>
<h4 class="subsection">24.1.5 Errset</h4>

<p>As in Maclisp, there is an <i>errset</i> facility which allows a very simple
form of error handling.  If an error occurs inside an errset, and no condition
handler handles it, i.e. the debugger would be entered, control is
returned (<i>thrown</i>) to the errset.  The errset can control whether or
not the debugger&rsquo;s error message is printed.
</p>
<p>A problem with <code>errset</code> is that it is <i>too</i> powerful;
it will apply to any unhandled error at all.  If you are writing code
that anticipates some specific error, you should find out what condition
that error signals and set up a handler.  If you use <code>errset</code> and
some unanticipated error crops up, you may not be told&ndash;this can cause
very strange bugs.
</p>
<dl>
<dt><a name="index-errset"></a>Special Form: <strong>errset</strong></dt>
<dd><p>The special form <code>(errset <i>form</i> <i>flag</i>)</code> catches errors during
the evaluation of <i>form</i>.  If an error occurs, the usual error message
is printed unless <i>flag</i> is <code>nil</code>; then, control is thrown and the errset-form
returns <code>nil</code>.  <i>flag</i> is evaluated first and is optional, defaulting to <code>t</code>.
If no error occurs, the value of the errset-form is a list of one element,
the value of <i>form</i>.
</p></dd></dl>

<dl>
<dt><a name="index-errset-1"></a>Variable: <strong>errset</strong></dt>
<dd><p>If this variable is non-<code>nil</code>, errset-forms are not allowed to trap errors.
The debugger is entered just as if there was no errset.  This is intended mainly
for debugging errsets.  The initial value of <code>errset</code> is <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-err"></a>Special Form: <strong>err</strong></dt>
<dd><p>This is for Maclisp compatibility.
</p>
<p><code>(err)</code> is a dumb way to cause an error.  If executed inside an errset,
that errset returns <code>nil</code>, and no message is printed.
Otherwise an unseen throw-tag error occurs.
</p>
<p><code>(err <i>form</i>)</code> evaluates <i>form</i> and causes the containing errset
to return the result.  If executed when not inside an errset, an unseen throw-tag error occurs.
</p>
<p><code>(err <i>form</i> <i>flag</i>)</code>, which exists in Maclisp, is not supported.
</p></dd></dl>

<a name="The-Debugger"></a>
<h3 class="section">24.2 The Debugger</h3>
<a name="index-debugger"></a>

<p>When an error condition is signalled and no handlers decide to
handle the error, an interactive debugger is entered to allow the user to
look around and see what went wrong, and to help him continue the program
or abort it.  This section describes how to use the debugger.
</p>
<p>The user interface described herein is not thought too well of,
and we hope to redesign it sometime soon.
</p>
<a name="Entering-the-Debugger"></a>
<h4 class="subsection">24.2.1 Entering the Debugger</h4>

<p>There are two kinds of errors; those generated by the Lisp Machine&rsquo;s
microcode, and those generated by Lisp programs (by using <code>ferror</code> or
related functions).  When there
is a microcode error, the debugger prints out a message such as the following:
</p>
<div class="lisp">
<pre class="lisp">&gt;&gt;TRAP 5543 (TRANS-TRAP)
The symbol FOOBAR is unbound.
While in the function *EVAL  SI:LISP-TOP-LEVEL1
</pre></div>

<p>The first line of this error message indicates entry to
the debugger and contains some mysterious internal microcode information:
the micro program address, the microcode trap name and parameters, and a microcode backtrace.
Users can ignore this line in most cases.  The second line contains a description
of the error in English.  The third line indicates where the error
happened by printing a very abbreviated &quot;backtrace&quot; of the stack (see
below); in the example, it is saying that the error was signalled inside the
function <code>*eval</code>, which was called by <code>si:lisp-top-level1</code>.
</p>
<p>Here is an example of an error from Lisp code:
</p>
<div class="lisp">
<pre class="lisp">&gt;&gt;ERROR: The argument X was 1, which is not a symbol,
While in the function { FERROR  } FOO  *EVAL
</pre></div>

<p>Here the first line contains the English description of the
error message, and the second line contains the abbreviated backtrace.
The backtrace indicates that the function which actually entered
the error handler was <code>ferror</code>, but that function is enclosed in
braces because it is not very important; the useful information here is
that the function <code>foo</code> is what called <code>ferror</code> and thus signalled
the error.
</p>
<p>There is not any good way to manually get into the debugger;
the interface will someday be fixed so that you can enter it at any
time if you want to use its facilities to examine the state of the Lisp
environment and so on.  In the meantime, just type an unbound symbol
at Lisp top level.
</p>
<a name="How-to-Use-the-Debugger"></a>
<h4 class="subsection">24.2.2 How to Use the Debugger</h4>

<p>Once inside the debugger, the user may give a wide variety
of commands.  This section describes how to give the commands, and then
explains them in approximate order of usefulness.  A summary is provided
at the end of the listing.
</p>
<p>When the error hander is waiting for a command, it prompts
with an arrow:
</p>
<div class="lisp">
<pre class="lisp">
</pre></div>

<p>At this point, you may either type in a Lisp expression, or
type a command (a Control or Meta character is interpreted as a command,
whereas a normal character is interpreted as the first character of
an expression).  If you type a Lisp expression, it will be interpreted
as a Lisp form, and will be evaluated in the context of the function
which got the error.  (That is, all bindings which were in effect at
the time of the error will be in effect when your form is evaluated.)
The result of the evaluation will be printed, and the debugger
will prompt again with an arrow.  If, during the typing of the form,
you change your mind and want to get back to the debugger&rsquo;s
command level, type a Control-Z; the debugger will respond with
an arrow prompt.  In fact, at any time that typein is expected from
you, you may type a Control-Z to flush what you are doing and get back
to command level.  This <code>read-eval-print</code> loop maintains the values
of <code>+</code>, <code>*</code>, and <code>-</code> just as the top-level one does.
</p>
<p>Various debugger commands ask for Lisp objects, such as an
object to return, or the name of a catch-tag.  Whenever it tries to get
a Lisp object from you, it expects you to type in a <i>form</i>; it will
evaluate what you type in.  This provides greater generality, since
there are objects to which you might want to refer that cannot be
typed in (such as arrays).  If the form you type is non-trivial (not
just a constant form), the debugger will show you the result of
the evaluation, and ask you if it is what you intended.  It expects a Y
or N answer (see the function <code>y-or-n-p</code>, (y-or-n-p-fun)), and if you answer negatively
it will ask you for another form.  To quit out of the command, just type
Control-Z.
</p>
<a name="Debugger-Commands"></a>
<h4 class="subsection">24.2.3 Debugger Commands</h4>

<p>All debugger commands are single characters, usually with the
Control or Meta bits.  The single most useful command is Control-Z, which
exits from the debugger and throws back to the Lisp top level loop.
ITS users should note that Control-Z is not Call.
Often you are not interested in using the debugger at all and just
want to get back to Lisp top level; so you can do this in one character.
This is similar to Control-G in Maclisp.
</p>
<p>Self-documentation is provided by the Help (top-H) or &quot;?&quot; command,
which types out some documentation on the debugger commands.
</p>
<p>Often you want to try to continue from the error.  To do this,
use the Control-C command.  The exact way Control-C works depends on
the kind of error that happened.  For some errors, there is no standard
way to continue at all, and Control-C will just tell you this and
return to the debugger&rsquo;s command level.  For the very common &quot;unbound symbol&quot; error,
it will get a Lisp object from you, which it will store back into the
symbol.  Then it will continue as if the symbol had been bound to
that object in the first place.  For unbound-variable or undefined-function
errors, you can also just type Lisp forms to set the variable or define
the function, and then type Control-C; it will proceed without asking
anything.
</p>
<p>Several commands are provided to allow you to examine the
Lisp control stack (regular pdl), which keeps a record of all functions which are currently
active.  If you call <code>foo</code> at Lisp&rsquo;s top level, and it calls <code>bar</code>,
which in turn calls <code>baz</code>, and <code>baz</code> gets an error, then a
backtrace (a backwards trace of the stack) would show all of this
information.  The debugger has two backtrace commands.  Control-B
simply prints out the names of the functions on the stack; in the above
example it would print
</p>
<div class="lisp">
<pre class="lisp">BAZ  BAR  FOO  *SI:EVAL  SI:LISP-TOP-LEVEL1  SI:LISP-TOP-LEVEL
</pre></div>

<p>The arrows indicate the direction of calling.  The Meta-B command prints
a more extensive backtrace, indicating the names of the arguments to the functions
and their current values, and also the saved address at which the function was
executing (in case you want to look at the code generated by the compiler);
for the example above it might look like:
</p>
<div class="lisp">
<pre class="lisp">FOO: (P.C. = 23)
   Arg 0 (X): 13
   Arg 1 (Y): 1

BAR: (P.C. = 120)
   Arg 0 (ADDEND): 13
</pre></div>

<p>and so on.  This means that <code>foo</code> was executing at instruction 23, and was called
with two arguments, whose names (in the Lisp source code) are <code>x</code> and <code>y</code>.
The current values of <code>x</code> and <code>y</code> are <code>13</code> and <code>1</code> respectively.
</p>
<p>The debugger knows about a &quot;current stack frame&quot;, and there
are several commands which use it.  The initially &quot;current&quot; stack frame
is the one which signalled the error; either the one which got the microcode
error, or the one which called <code>ferror</code> or <code>error</code>.
</p>
<p>The command Control-L (or Form) clears the screen, retypes the
error message that was initially printed when the debugger was
entered, and then prints out a description of the current frame, in the
format used by Meta-B.  The Control-N command moves &quot;down&quot; to the &quot;next&quot; frame
(that is, it changes the current frame to be the frame which called it), and prints
out the frame in this same format.  Control-P moves &quot;up&quot; to the &quot;previous&quot; frame
(the one which this one called),
and prints out the frame in the same format.  Meta-&lt; moves to the
top of the stack, and Meta-&gt; to the bottom; both print out the new current
frame.  Control-S asks you for a string, and searches the stack for a frame
whose executing function&rsquo;s name contains that string.  That frame becomes current
and is printed out.  These commands are easy to remember since they are analogous
to editor commands.
</p>
<p>Meta-L prints out the current frame in &quot;full screen&quot; format, which
shows the arguments and their values, the local variables and their values,
and the machine code with an arrow pointing to the next instruction
to be executed.
Meta-N moves to the next frame and prints
it out in full-screen format, and Meta-P moves to the previous frame and
prints it out in full-screen format.  Meta-S is like Control-S but does a full-screen display.
</p>
<p>Control-A prints out the argument list for the function of the
current frame, as would be returned by the function <code>arglist</code> (see (arglist-fun)).
Control-R is used to return a value from the current frame; the frame
that called that frame continues running as if the function of the current frame
had returned.  This command prompts you for a form, which it will evaluate;
it returns the resulting value, possibly after confirming it with you.
Meta-R is used to return multiple values from the current frame, but
it is not currently implemented.  The Control-T command does a <i>throw</i>
to a given tag with a given value; you are prompted for the tag and the value.
</p>
<p>Commands such as Control-N and meta-N, which are meaningful to repeat,
take a prefix numeric argument and repeat that many types.  The numeric argument
is typed by using Control- or Meta- and the number keys, as in the editor.
</p>
<p>Control-Meta-A takes a numeric argument <i>n</i>, and prints out
the value of the <i>n</i>th argument of the current frame.  It leaves <code>*</code>
set to the value of the argument, so that you can use the Lisp <code>read-eval-print</code>
loop to examine it.  It also leaves <code>+</code> set to a locative pointing to the
argument on the stack, so that you can change that argument (by calling
<code>rplaca</code> or <code>rplacd</code> on the locative).  Control-Meta-L is similar,
but refers to the <i>n</i>th local variable of the frame.
</p>
<a name="Summary-of-Commands"></a>
<h4 class="subsection">24.2.4 Summary of Commands</h4>

<dl compact="compact">
<dt><span class="roman">Control-A</span></dt>
<dd><p>Print argument list of function in current frame.
</p></dd>
<dt><span class="roman">Control-Meta-A</span></dt>
<dd><p>Examine or change the <i>n</i>th argument of the current frame.
</p></dd>
<dt><span class="roman">Control-B</span></dt>
<dd><p>Print brief backtrace.
</p></dd>
<dt><span class="roman">Meta-B</span></dt>
<dd><p>Print longer backtrace.
</p></dd>
<dt><span class="roman">Control-C</span></dt>
<dd><p>Attempt to continue.
</p></dd>
<dt><span class="roman">Meta-C</span></dt>
<dd><p>Attempt to restart.
</p></dd>
<dt><span class="roman">Control-G</span></dt>
<dd><p>Quit to command level.
</p></dd>
<dt><span class="roman">Control-L</span></dt>
<dd><p>Redisplay error message and current frame.
</p></dd>
<dt><span class="roman">Meta-L</span></dt>
<dd><p>Full-screen typeout of current frame.
</p></dd>
<dt><span class="roman">Control-N</span></dt>
<dd><p>Move to next frame.  With argument, move down <i>n</i> frames.
</p></dd>
<dt><span class="roman">Meta-N</span></dt>
<dd><p>Move to next frame with full-screen typeout.  With argument, move down <i>n</i> frames.
</p></dd>
<dt><span class="roman">Control-P</span></dt>
<dd><p>Move to previous frame.  With argument, move up <i>n</i> frames.
</p></dd>
<dt><span class="roman">Meta-P</span></dt>
<dd><p>Move to previous frame with full-screen typeout.  With argument, move up <i>n</i> frames.
</p></dd>
<dt><span class="roman">Control-R</span></dt>
<dd><p>Return a value from the current frame.
</p></dd>
<dt><span class="roman">Meta-R</span></dt>
<dd><p>Return several values from the current frame.  (doesn&rsquo;t work)
</p></dd>
<dt><span class="roman">Control-S</span></dt>
<dd><p>Search for a frame containing a specified function.
</p></dd>
<dt><span class="roman">Meta-S</span></dt>
<dd><p>Same as control-S but does a full display.
</p></dd>
<dt><span class="roman">Control-T</span></dt>
<dd><p>Throw a value to a tag.
</p></dd>
<dt><span class="roman">Control-Z</span></dt>
<dd><p>Throw back to Lisp top level.
</p></dd>
<dt><span class="roman">? or Help</span></dt>
<dd><p>Print a help message.
</p></dd>
<dt><span class="roman">Meta-&lt;</span></dt>
<dd><p>Go to top of stack.
</p></dd>
<dt><span class="roman">Meta-&gt;</span></dt>
<dd><p>Go to bottom of stack.
</p></dd>
<dt><span class="roman">Form</span></dt>
<dd><p>Same as Control-L.
</p></dd>
<dt><span class="roman">Line</span></dt>
<dd><p>Move to next frame.  With argument, move down <i>n</i> frames.
Same as Control-N.
</p></dd>
<dt><span class="roman">Return</span></dt>
<dd><p>Move to previous frame.  With argument, move up <i>n</i> frames.
Same as control-P.
</p></dd>
</dl>

<a name="Miscellany"></a>
<h4 class="subsection">24.2.5 Miscellany</h4>

<p>Sometimes, e.g. when the debugger is running,
microcode trapping is &quot;disabled&quot;: any attempt by the
microcode to trap will cause the machine to halt.
</p>
<dl>
<dt><a name="index-trapping_002denabled_002dp"></a>Function: <strong>trapping-enabled-p</strong></dt>
<dd><p>This predicate returns <code>t</code> if trapping is enabled; otherwise
it returns <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-enable_002dtrapping"></a>Function: <strong>enable-trapping</strong> <em>&amp;optional (arg <code>1</code>)</em></dt>
<dd><p>If <i>arg</i> is <code>1</code>, trapping is enabled.  If it is <code>0</code>,
trapping is disabled.
</p></dd></dl>

<a name="Trace"></a>
<h3 class="section">24.3 Trace</h3>

<p>The <i>trace</i> facility allows the user to trace some functions.
When a function is traced, certain special actions will be taken when it is
called, and when it returns.  The function <code>trace</code> allows the user to
specify this.
</p>
<p>The trace facility is closely compatible with Maclisp.
Although the functions of the trace system which are presented here are
really functions, they are implemented as special forms because that
is the way Maclisp did it.
</p>
<p>Alternatively, you can use the trace system by clicking &quot;trace&quot;
in the system menu, or by using the &quot;meta-X trace&quot; command in the editor.
This allows you to select the trace options from a menu instead of having
to remember the following syntax.
</p>
<dl>
<dt><a name="index-trace"></a>Special Form: <strong>trace</strong></dt>
<dd><p>A <code>trace</code> form looks like:
</p>
<div class="lisp">
<pre class="lisp">(trace <i>spec-1</i> <i>spec-2</i> ...)
</pre></div>

<p>A <i>spec</i> may be either a symbol, which is interpreted as a function
name, or a list of the form <code>(<i>function-name</i> <i>option-1</i> <i>option-2</i> ...)</code>.
If <i>spec</i> is a symbol, it is the same as giving the function name with
no options.  Some options take &quot;arguments&quot;, which should be given immediately
following the option name.
</p></dd></dl>

<p>The following options exist:
</p>
<dl compact="compact">
<dt><code>:break <i>pred</i></code></dt>
<dd><p>Causes a breakpoint to be entered after printing
the entry trace information but before applying the traced function to its
arguments, if and only if <i>pred</i> evaluates to non-<code>nil</code>.
</p></dd>
<dt><code>:exitbreak <i>pred</i></code></dt>
<dd><p>This is just like <code>break</code> except that the
breakpoint is entered after the function has been executed and the exit trace information
has been printed, but before control returns.
</p></dd>
<dt><code>:step</code></dt>
<dd><p>Causes the function to be single-stepped whenever it is called.
See the documentation on the step facility below.
</p></dd>
<dt><code>:entrycond <i>pred</i></code></dt>
<dd><p>Causes trace information to be printed on function
entry only if <i>pred</i> evaluates to non-<code>nil</code>.
</p></dd>
<dt><code>:exitcond <i>pred</i></code></dt>
<dd><p>Causes trace information to be printed on function
exit only if <i>pred</i> evaluates to non-<code>nil</code>.
</p></dd>
<dt><code>:cond <i>pred</i></code></dt>
<dd><p>This specifies both <code>exitcond</code> and <code>entrycond</code>
together.
</p></dd>
<dt><code>:wherein <i>function</i></code></dt>
<dd><p>Causes the function to be traced only when called, directly or indirectly,
from the specified function <i>function</i>.  One can give several trace specs to
<code>trace</code>, all specifying the same function but with different <code>wherein</code>
options, so that the function is traced in different ways when called from
different functions.
</p></dd>
<dt><code>:argpdl <i>pdl</i></code></dt>
<dd><p>This specifies a symbol <i>pdl</i>, whose value is
initially set to <code>nil</code> by <code>trace</code>.  When the function is traced, a
list of the current recursion level for the function, the function&rsquo;s
name, and a list of arguments is consed onto the <i>pdl</i> when the
function is entered, and cdr&rsquo;ed back off when the function is exited.
The <i>pdl</i> can be inspected from within a breakpoint, for example, and
used to determine the very recent history of the function. This option
can be used with or without printed trace output.  Each function can be
given its own pdl, or one pdl may serve several functions.
</p></dd>
<dt><code>:entryprint <i>form</i></code></dt>
<dd><p>The <i>form</i> is evaluated and the value is included in the trace message
for calls to the function.  You can give this option more than once, and
all the values will appear, preceded by <code>\\</code>.
</p></dd>
<dt><code>:exitprint <i>form</i></code></dt>
<dd><p>The <i>form</i> is evaluated and the value is included in the trace message
for returns from the function.  You can give this option more than once, and
all the values will appear, preceded by <code>\\</code>.
</p></dd>
<dt><code>:print <i>form</i></code></dt>
<dd><p>The <i>form</i> is evaluated and the value is included in the trace messages
for both calls to and returns from the function.  You can give this option more than once, and
all the values will appear, preceded by <code>\\</code>.
</p></dd>
<dt><code>:entry <i>list</i></code></dt>
<dd><p>This specifies a list of arbitrary forms whose
values are to be printed along with the usual entry-trace.  The list of
resultant values, when printed, is preceded by a <code>\\</code> to separate it
from the other information.
</p></dd>
<dt><code>:exit <i>list</i></code></dt>
<dd><p>This is similar to <code>entry</code>, but specifies expressions
whose values are printed with the exit-trace.  Again, the list of
values printed is preceded by <code>\\</code>.
</p></dd>
<dt><code>:arg :value :both nil</code></dt>
<dd><p>These specify which of the usual trace
printout should be enabled.  If <code>arg</code> is specified, then on function
entry the name of the function and the values of its arguments will be
printed.  If <code>value</code> is specified, then on function exit the returned
value(s) of the function will be printed.  If <code>both</code> is specified,
both of these will be printed.  If <code>nil</code> is specified, neither will
be printed.  If none of these four options are specified the default is
to <code>both</code>.  If any further <i>options</i> appear after one of these,
they will not be treated as options! Rather, they will be considered to
be arbitrary forms whose values are to be printed on entry and/or exit
to the function, along with the normal trace information. The values
printed will be preceded by a <code>//</code>, and follow any values specified
by <code>entry</code> or <code>exit</code>.  Note that since these options &quot;swallow&quot; all
following options, if one is given it should be the last option
specified.
</p></dd>
</dl>

<p>If the variable <code>arglist</code> is used in any of the expressions given for
the <code>cond, break, entry, </code>or<code> exit</code> options, or after the <code>arg,
value, both, </code>or<code> nil</code> option, when those expressions are evaluated
the value of <code>arglist</code> will be bound to a list of the arguments
given to the traced function.  Thus
</p>
<div class="lisp">
<pre class="lisp">(trace (foo break (null (car arglist))))
</pre></div>

<p>would cause a break in <code>foo</code> if and only if the first
argument to <code>foo</code> is <code>nil</code>.
<code>arglist</code> should have a colon, but it is omitted because this is
the name of a system function and therefore global.
</p>
<p>Similarly, the variable <code>si:fnvalues</code> will
be a list of the resulting values of the traced function.  For obvious
reasons, this should only be used with the <code>exit</code> option.
</p>
<p>The trace specifications may be &quot;factored.&quot;  For example,
</p>
<div class="lisp">
<pre class="lisp">(trace ((foo bar) wherein baz value))
<span class="roman">is equivalent to</span>
(trace (foo wherein baz value) (bar wherein baz value))
</pre></div>

<p>Since a list as a function name is interpreted as a list of
functions, non-atomic function names (see (fdefine-fun))
are specified as follows:
</p>
<div class="lisp">
<pre class="lisp">(trace (:function (:method foo-class bar) :break t))
</pre></div>

<p>All output printed by trace can be ground into an indented,
readable format, by simply setting the variable <code>sprinter</code> to <code>t</code>.
Setting <code>sprinter</code> to <code>nil</code> changes the output back to use
the ordinary print function, which is faster and uses less
storage but is less readable for large list structures.
This is not yet supported.
</p>
<p><code>trace</code> returns as its value a list of names of all functions
traced; for any functions traced with the <code>wherein</code>
option, say <code>(trace (foo wherein bar))</code>, instead of putting
just <code>foo</code> in the list it puts in a 3-list <code>(foo wherein bar)</code>.
</p>
<p>If you attempt to specify to <code>trace</code> a function already
being traced, <code>trace</code> calls <code>untrace</code> before setting up the new
trace.
</p>
<p>It is possible to call <code>trace</code> with no arguments.  <code>(trace)</code>
evaluates to a list of all the functions currently
being traced.
</p>
<dl>
<dt><a name="index-untrace"></a>Special Form: <strong>untrace</strong></dt>
<dd><p><code>untrace</code> is used to undo the effects of <code>trace</code> and restore
functions to their normal, untraced state.  The argument
to <code>untrace</code> for a given function should be what
<code>trace</code> returned for it; i.e. if <code>trace</code> returned <code>foo</code>, use
<code>(untrace foo)</code>; if <code>trace</code> returned <code>(foo wherein bar)</code> use
<code>(untrace (foo wherein bar))</code>.  <code>untrace</code> will take multiple
specifications, e.g. <code>(untrace foo quux (bar wherein baz) fuphoo)</code>.
Calling <code>untrace</code> with no arguments will untrace all functions currently being traced.
</p></dd></dl>

<p>Unlike Maclisp, if there is an error <code>trace</code> (or <code>untrace</code>) will
invoke
the error system and give an English message, instead of returning
lists with question marks in them.  Also, the <code>remtrace</code> function
is not provided, since it is unnecessary.
</p>
<dl>
<dt><a name="index-trace_002dcompile_002dflag"></a>Variable: <strong>trace-compile-flag</strong></dt>
<dd><p>If the value of <code>trace-compile-flag</code> is non-<code>nil</code>, the functions
created by <code>trace</code> will get compiled, allowing you to trace special
forms such as <code>cond</code> without interfering with the execution of the
tracing functions.  The default value of this flag is <code>nil</code>.
</p></dd></dl>

<a name="The-Stepper"></a>
<h3 class="section">24.4 The Stepper</h3>

<p>The Step facility provides the ability to follow every step of
the evaluation of a form, and examine what is going on.  It is
analogous to a single-step proceed facility often found in
machine-language debuggers.  If your program is doing something
strange, and it isn&rsquo;t obvious how it&rsquo;s getting into its strange state,
then the stepper is for you.
</p>
<a name="How-to-Get-Into-the-Stepper_002e"></a>
<h4 class="subsection">24.4.1 How to Get Into the Stepper.</h4>

<p>There are two ways to enter the stepper.  One is by use of the
<code>step</code> function.
</p>
<dl>
<dt><a name="index-step"></a>Function: <strong>step</strong> <em>form</em></dt>
<dd><p>This evaluates <i>form</i> with single stepping.  It returns
the value of <i>form</i>.
</p></dd></dl>

<p>For example, if you have a function named <code>foo</code>, and typical arguments
to it might be <code>t</code> and <code>3</code>, you could say
</p>
<div class="lisp">
<pre class="lisp">(step '(foo t 3))
</pre></div>

<p>and the form <code>(foo t 3)</code> will be evaluated with single stepping.
</p>
<p>The other way to get into the stepper is to use the <code>step</code> option
of <code>trace</code> (see (trace-fun)).  If a function is traced with the <code>step</code> option, then
whenever that function is called it will be single stepped.
</p>
<p>Note that any function to be stepped must be interpreted; that is, it
must be a lambda-expression.  Compiled code cannot be stepped by the stepper.
</p>
<a name="How-to-Use-the-Stepper"></a>
<h4 class="subsection">24.4.2 How to Use the Stepper</h4>

<p>When evaluation is proceeding with single stepping, before any
form is evaluated, it is (partially) printed out, preceded by a forward
arrow (<code></code>) character  When a macro is expanded, the expansion is
printed out preceded by a double arrow (<code></code>) character.  When a form
returns a value, the form and the values are printed out preceded by a
backwards arrow (<code></code>) character; if there is more than one value being
returned, an and-sign (<code></code>) character is printed between the values.
</p>
<p>Since the forms may be very long, the stepper does not print all
of a form; it truncates the printed representation after a certain number
of characters.  Also, to show the recursion pattern of who calls whom in
a graphic fashion, it indents each form proportionally to its level
of recursion.
</p>
<p>After the stepper prints any of these things, it waits for a
command from the user.  There are several commands to tell the stepper
how to proceed, or to look at what is happening. The commands are:
</p>
<dl compact="compact">
<dt><span class="roman">Control-N (Next)</span></dt>
<dd><p>Step to the Next thing.  The stepper continues until the next thing
to print out, and it accepts another command.
</p></dd>
<dt><span class="roman">Space</span></dt>
<dd><p>Go to the next thing at this level.  In other words, continue to
evaluate at this level, but don&rsquo;t step anything at lower levels.  This is a good
way to skip over parts of the evaluation that don&rsquo;t interest you.
</p></dd>
<dt><span class="roman">Control-U (Up)</span></dt>
<dd><p>Continue evaluating until we go up one level.  This is like
the space command, only more so; it skips over anything on the current level
as well as lower levels.
</p></dd>
<dt><span class="roman">Control-X (eXit)</span></dt>
<dd><p>Exit; finish evaluating without any more stepping.
</p></dd>
<dt><span class="roman">Control-T (Type)</span></dt>
<dd><p>Retype the current form in full (without truncation).
</p></dd>
<dt><span class="roman">Control-G (Grind)</span></dt>
<dd><p>Grind (i.e. prettyprint) the current form.
</p></dd>
<dt><span class="roman">Control-E (Editor)</span></dt>
<dd><p>Editor escape (enter the Eine editor).
</p></dd>
<dt><span class="roman">Control-B (Breakpoint)</span></dt>
<dd><p>Breakpoint.  This command puts you into a breakpoint (i.e.
a read-eval-print loop) from which you can examine the values of
variables and other aspects of the current environment.  From
within this loop, the following variables are available:
</p><dl compact="compact">
<dt><code>step-form</code></dt>
<dd><p>which is the current form.
</p></dd>
<dt><code>step-values</code></dt>
<dd><p>which is the list of returned values.
</p></dd>
<dt><code>step-value</code></dt>
<dd><p>which is the first returned value.
</p></dd>
</dl>

<p>If you change the values of these variables, it will work.
</p></dd>
<dt><span class="roman">Control-L</span></dt>
<dd><p>Clear the screen and redisplay the last 10. pending forms (forms
which are being evaluated).
</p></dd>
<dt><span class="roman">Meta-L</span></dt>
<dd><p>Like Control-L, but doesn&rsquo;t clear the screen.
</p></dd>
<dt><span class="roman">Control-Meta-L</span></dt>
<dd><p>Like Control-L, but redisplays all pending forms.
</p></dd>
<dt><span class="roman">? or Help</span></dt>
<dd><p>Prints documentation on these commands.
</p></dd>
</dl>

<p>It is strongly suggested that you write some little function
and try the stepper on it.  If you get a feel for what the stepper does
and how it works, you will be able to tell when it is the right thing to use
to find bugs.
</p>
<a name="The-MAR"></a>
<h3 class="section">24.5 The MAR</h3>

<p>The MAR facility allows any word or contiguous set of words to
be monitored constantly, and can cause an error if the words are
referenced in a specified manner.  The name MAR is from the similar
device on the ITS PDP-10&rsquo;s; it is an acronym for &quot;Memory Address
Register&quot;.  The MAR checking is done by the Lisp Machine&rsquo;s memory
management hardware, and so the speed of general execution when the MAR is
enabled is not significantly slowed down.  However, the speed of accessing
pages of memory containing the locations being checked is slowed down, since every
reference involves a microcode trap.
</p>
<p>These are the functions that control the MAR:
</p>
<dl>
<dt><a name="index-set_002dmar"></a>Function: <strong>set-mar</strong> <em>location cycle-type &amp;optional n-words</em></dt>
<dd><p>The <code>set-mar</code> function clears any previous setting of the
MAR, and sets the MAR on <i>n-words</i> words, starting at <i>location</i>.
<i>location</i> may be any object.  <i>n-words</i> currently defaults to 1,
but eventually it will default to the size of the object.
<i>cycle-type</i> says under what conditions to trap.  <code>:read</code> means that
only reading the location should cause an error, <code>:write</code> means that
only writing the location should, <code>t</code> means that both should.
To set the MAR on the value of a variable, use
</p>
<div class="lisp">
<pre class="lisp">(set-mar (value-cell-location <i>symbol</i>) :write)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-clear_002dmar"></a>Function: <strong>clear-mar</strong></dt>
<dd><p>This turns off the MAR.  Restarting the machine disables the
MAR but does not turn it off, i.e. references to the MARed pages
are still slowed down.  <code>clear-mar</code> does not currently speed
things back up until the next time the pages are swapped out;
this may be fixed some day.
</p></dd></dl>

<dl>
<dt><a name="index-si_003a_0025mar_002dlow"></a>Variable: <strong>si:%mar-low</strong></dt>
<dt><a name="index-si_003a_0025mar_002dhigh"></a>Variable: <strong>si:%mar-high</strong></dt>
<dd><p>These two fixnums are the inclusive boundaries of the area
of memory monitored by the MAR.  The values of these variables live
inside the microcode.
</p></dd></dl>

<dl>
<dt><a name="index-mar_002dmode"></a>Function: <strong>mar-mode</strong></dt>
<dd><p><code>(mar-mode)</code> returns a symbol indicating the current state of
the MAR.  It returns one of:
</p>
<dl compact="compact">
<dt><code>nil</code></dt>
<dd><p>The MAR is not set.
</p></dd>
<dt><code>:read</code></dt>
<dd><p>The MAR will cause an error if there is a read.
</p></dd>
<dt><code>:write</code></dt>
<dd><p>The MAR will cause an error if there is a write.
</p></dd>
<dt><code>t</code></dt>
<dd><p>The MAR will cause an error if there is any reference.
</p></dd>
</dl>

</dd></dl>

<p>Note that using the MAR makes the pages on which it is set
considerably slower to access, until the next time they are
swapped out and back in again after the MAR is shut off.
Also, use of the MAR currently breaks the read-only feature
if those pages were read-only.  Currently it is not possible
to proceed from a MAR trrap, because some machine state is lost.
Eventually, most MAR traps will be continuable.
</p>


<a name="Useful-Commands"></a>
<h3 class="section">24.6 Useful Commands</h3>

<dl>
<dt><a name="index-who_002dcalls"></a>Function: <strong>who-calls</strong> <em>x &amp;optional package</em></dt>
<dt><a name="index-who_002duses"></a>Function: <strong>who-uses</strong> <em>x &amp;optional package</em></dt>
<dd><p><i>x</i> must be a symbol.  <code>who-calls</code> tries
to find all of the compiled functions in the Lisp world
which call <i>x</i> as a function, use <i>x</i> as a variable,
or use <i>x</i> as a constant.  (It won&rsquo;t find things
that use constants which contain <i>x</i>, such as a list one
of whose elements is <i>x</i>; it will only find it if <i>x</i>
itself is used as a constant.)  It tries to find all of the compiled
code objects by searching all of the function cells of
all of the symbols on <i>package</i> and <i>package</i>&rsquo;s decendants.
<i>package</i> defaults to the <code>global</code> package, and so normally
all packages are checked.
</p>
<p>If <code>who-calls</code> encounters an interpreted function definition, it
simply tells you if <i>x</i> appears anywhere in the interpreted code.
</p>
<p><code>who-uses</code> is currently the same thing as <code>who-calls</code>.
</p>
<p>The symbol <code>unbound-function</code> is treated specially by <code>who-calls</code>.
<code>(who-calls 'unbound-function)</code> will search the compiled
code objects for any calls through a symbol which is not currently
defined as a function.  This is useful for finding errors.
</p></dd></dl>

<dl>
<dt><a name="index-apropos"></a>Function: <strong>apropos</strong> <em>string &amp;optional package</em></dt>
<dd><p><code>(apropos <i>string</i>)</code> tries to find all symbols whose
print-names contain <i>string</i> as a substring.  Whenever it
finds a symbol, it prints out the symbol&rsquo;s name; if the symbol
is defined as a function and/or bound, it tells you so, and prints
the function (if any).  It finds the symbols on <i>package</i> and
<i>package</i>&rsquo;s decendants.  <i>package</i> defaults to the <code>global</code>
package, so normally all packages are searched.
</p></dd></dl>

<dl>
<dt><a name="index-where_002dis"></a>Function: <strong>where-is</strong> <em>pname &amp;optional package</em></dt>
<dd><p>Prints the names of all packages which contain a symbol with the print-name
<i>pname</i>.  <i>pname</i> gets upper-cased.  The package <i>package</i> and
all its sub-packages are searched; <i>package</i> defaults to the <code>global</code> package,
which causes all packages to be searched.
</p></dd></dl>

<dl>
<dt><a name="index-describe"></a>Function: <strong>describe</strong> <em>x</em></dt>
<dd><p><code>describe</code> tries to tell you all of the interesting information
about any object <i>x</i> (except for array contents).  <code>describe</code> knows
about arrays, symbols, flonums, packages, stack groups, closures, and FEFs, and prints
out the attributes of each in human-readable form.  Sometimes
it will describe something which it finds inside something else;
such recursive descriptions are indented appropriately.  For instance,
<code>describe</code> of a symbol will tell you about the symbol&rsquo;s value,
its definition, and each of its properties.  <code>describe</code> of a flonum
(regular or small) will show you its internal representation in a way
which is useful for tracking down roundoff errors and the like.
</p>
<p>If <i>x</i> is a named-structure, <code>describe</code> handles it specially.
To understand this, you should read the section on named structures
(see (named-structure)).
First it gets the named-structure symbol, and sees whether its function knows
about the <code>:describe</code> operation.  If the operation is known, it applies
the function to two arguments: the symbol <code>:describe</code>, and the named-structure
itself.  Otherwise, it looks on the named-structure symbol for information
which might have been left by <code>defstruct</code>; this information would
tell it what the symbolic names for the entries in the structure are,
and <code>describe</code> knows how to use the names to print out what each field&rsquo;s
name and contents is.
</p></dd></dl>

<dl>
<dt><a name="index-describe_002dfile"></a>Function: <strong>describe-file</strong> <em>filename</em></dt>
<dd><p>This prints what the system knows about the file <i>filename</i>.
It tells you what package it is in and what version of it is loaded.
</p></dd></dl>

<dl>
<dt><a name="index-describe_002dpackage"></a>Function: <strong>describe-package</strong> <em>package-name</em></dt>
<dd><p><code>(describe-package <i>package-name</i>)</code> is equivalent to
<code>(describe (pkg-find-package <i>package-name</i>))</code>;
that is, it describes the package whose name is <i>package-name</i>.
</p></dd></dl>

<dl>
<dt><a name="index-describe_002darea"></a>Function: <strong>describe-area</strong> <em>area</em></dt>
<dd><p><i>area</i> may be the name or the number of an area.  Various
attributes of the area are printed.
</p></dd></dl>

<dl>
<dt><a name="index-room"></a>Function: <strong>room</strong> <em>&amp;optional arg</em></dt>
<dd><p><i>room</i> tells you how much room is left in some areas.  For each
area it tells you about, it prints out the name of the area, the number
of words used in the area, the size of the area, and the percentage
of words which are used in the area.
</p>
<p>If <i>arg</i> is not given, the value of <code>room</code> should be a list
of area numbers and/or area names; <code>room</code> describes those areas.
If <i>arg</i> is a fixnum, <code>room</code> describes that area.  If <i>arg</i> is
<code>t</code>, <code>room</code> describes all areas.
</p></dd></dl>

<dl>
<dt><a name="index-room-1"></a>Variable: <strong>room</strong></dt>
<dd><p>The value of <code>room</code> is a list of area names and/or area numbers,
denoting the areas which the function <code>room</code> will describe if given
no arguments.  Its initial value is:
</p>
<div class="lisp">
<pre class="lisp">(working-storage-area macro-compiled-program)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-set_002dmemory_002dsize"></a>Function: <strong>set-memory-size</strong> <em>n-words</em></dt>
<dd><p><code>set-memory-size</code> tells the virtual memory system to only use
<i>n-words</i> words of main memory for paging.  Of course, <i>n-words</i> may
not exceed the amount of main memory on the machine.
</p></dd></dl>

<dl>
<dt><a name="index-recompile_002dworld"></a>Function: <strong>recompile-world</strong> <em>&amp;rest keywords</em></dt>
<dd><p><code>recompile-world</code> is a rather ad-hoc tool for recompiling all
of the Lisp Machine system packages.  It works by calling the <code>pkg-load</code>
facility (see (pkg-load-fun)).
It will find all files that need recompiling from any of the packages:
</p>
<div class="lisp">
<pre class="lisp">system-internals format compiler
chaos supdup peek eine
</pre></div>

<p><i>keywords</i> is a list of keywords; usually it is empty.
The useful keywords are:
</p>
<dl compact="compact">
<dt><code>load</code></dt>
<dd><p>After compiling, load in any files which are not loaded.
</p></dd>
<dt><code>noconfirm</code></dt>
<dd><p>Don&rsquo;t ask for confirmation for each package.
</p></dd>
<dt><code>selective</code></dt>
<dd><p>Ask for confirmation for each file.
</p></dd>
</dl>

<p>Any of the other keywords accepted by <code>pkg-load</code> will also work.
</p></dd></dl>

<dl>
<dt><a name="index-qld"></a>Function: <strong>qld</strong> <em>&amp;optional restart-p</em></dt>
<dd><p><code>qld</code> is used to generate a new Lisp Machine system after
the cold-load is loaded in.  If you don&rsquo;t know how to use this,
you don&rsquo;t need it.  If <code>restart-p</code> is non-<code>nil</code>, then
it ignores that it has done anything, and starts from scratch.
</p></dd></dl>

<dl>
<dt><a name="index-disassemble"></a>Function: <strong>disassemble</strong> <em>function</em></dt>
<dd><p><i>function</i> should be a FEF, or a symbol which is defined as a FEF.
This prints out a human-readable version of the macro-instructions
in <i>function</i>.  The macro-code instruction set is explained on (macro-code).
</p></dd></dl>

<dl>
<dt><a name="index-print_002ddisk_002dlabel"></a>Function: <strong>print-disk-label</strong></dt>
<dd><p>Tells you what is on the disk.
</p></dd></dl>

<dl>
<dt><a name="index-set_002dcurrent_002dband"></a>Function: <strong>set-current-band</strong> <em>band</em></dt>
<dd><p>Sets which &quot;band&quot; (saved virtual memory image) is to be loaded
when the machine is started.  Use with caution!
</p></dd></dl>

<dl>
<dt><a name="index-set_002dcurrent_002dmicroload"></a>Function: <strong>set-current-microload</strong> <em>band</em></dt>
<dd><p>Sets which microload (MCR1 or MCR2) is to be loaded when the machine
is started.  Use with caution!
</p></dd></dl>

<a name="Querying-the-User"></a>
<h3 class="section">24.7 Querying the User</h3>

<dl>
<dt><a name="index-y_002dor_002dn_002dp"></a>Function: <strong>y-or-n-p</strong> <em>&amp;optional stream message</em></dt>
<dd><p>This is used for asking the user a question whose answer is either
&quot;Yes&quot; or &quot;No&quot;.  It types out <i>message</i> (if any) and reads in one
character from the keyboard.  If the character is Y, T, or space, it
returns <code>t</code>.  If the character is N or rubout, it returns <code>nil</code>.
Otherwise it prints out <i>message</i> (if any), followed by &quot;(Y or N)&quot;,
to <i>stream</i> and tries again.  <i>stream</i> defaults to
<code>standard-output</code>.
</p>
<p><code>y-or-n-p</code> should only be used for questions which the user knows
are coming.  If the user is not going to be anticipating the question
(e.g., if the question is &quot;Do you really want to delete all of your files?&quot;
out of the blue)
then <code>y-or-n-p</code> should not be used, because the user might type ahead
a T, Y, N, space, or rubout, and therefore accidentally answer the question.
In such cases, use <code>yes-or-no-p</code>.
</p></dd></dl>

<dl>
<dt><a name="index-yes_002dor_002dno_002dp"></a>Function: <strong>yes-or-no-p</strong> <em>&amp;optional stream message</em></dt>
<dd><p>This is used for asking the user a question whose answer is either
&quot;Yes&quot; or &quot;No&quot;.  It types out <i>message</i> (if any) and reads in a line
from the keyboard.  If the line is the string &quot;Yes&quot;, it returns <code>t</code>.
If the line is &quot;No&quot;, it returns <code>nil</code>.  (Case is ignored, as are
leading and trailing spaces and tabs.) Otherwise it prints out
<i>message</i> (if any), followed by &lsquo;Please type either &quot;Yes&quot; or &quot;No&quot;&rsquo; to
<i>stream</i> and tries again.  <i>stream</i> defaults to
<code>standard-output</code>.
</p>
<p>To allow the user to answer a yes-or-no question with a single
character, use <code>y-or-n-p</code>.  <code>yes-or-no-p</code> should be
used for unanticipated or momentous questions.
</p></dd></dl>

<dl>
<dt><a name="index-setup_002dkeyboard_002ddispatch_002dtable"></a>Function: <strong>setup-keyboard-dispatch-table</strong> <em>array lists</em></dt>
<dd><p>Several programs on the Lisp Machine accept characters from
the keyboard and take a different action on each key. This function
helps the programmer initialize a dispatch table for the keyboard.
</p>
<p><i>array</i> should be a two-dimensional array with dimensions <code>(4 220)</code>.
The first subscript to the array represents the Control and Meta keys;
the Control key is the low order bit and the Meta key is the high order bit.
The second subscript is the character typed, with the Control and Meta bits
stripped off.  In other words, the first subscript is the <code>%%kbd-control-meta</code>
part of the character and the second is the <code>%%kbd-char</code> part.
</p>
<p><i>lists</i> should be a list of four lists.  Each of these lists
describes a row of the table.  The elements of one of these lists are
called <i>items</i>,  and may be any of a number of things.  If the item
is not a list, it is simply stored into the next location of the row.
If the item is a list, then its first element is inspected.  If the
first element is the symbol <code>:repeat</code>, then the second element should
be a fixnum <i>n</i>, and the third element is stored into the next <i>n</i>
locations of the row.  If the first element is <code>:repeat-eval</code>, it is
treated as is <code>:repeat</code> except that the third element of the item is
a form which is evaluated before being put into the array.  The form
may take advantage of the symbol <code>si:rpcnt</code>, which is set to <code>0</code>
the first time the form is evaluated, and is increased by one every
subsequent time.  If the first element of an item is <code>:eval</code>, then the second
element is evaluated, and the result is stored into the next location of
the row.  Otherwise, the item itself is stored in the next location of the row.
Altogether exactly all 220 locations of the row must be filled in, or else
an error will be signalled.
</p></dd></dl>

<a name="Stuff-That-Doesn_0027t-Fit-Anywhere-Else"></a>
<h3 class="section">24.8 Stuff That Doesn&rsquo;t Fit Anywhere Else</h3>

<dl>
<dt><a name="index-time"></a>Function: <strong>time</strong></dt>
<dd><p><code>(time)</code> returns a number which increases by 1 every 1/60
of a second, and wraps around at some point (currently after 18 bits&rsquo; worth).
Use the <code>time-lessp</code> and <code>time-difference</code> functions to avoid
getting in trouble due to the wrap-around.
The most important thing about <code>time</code> is
that it is completely incompatible with Maclisp; this will get
changed.
</p></dd></dl>

<dl>
<dt><a name="index-time_002dlessp"></a>Function: <strong>time-lessp</strong> <em>time1 time2</em></dt>
<dd><p><code>t</code> if <i>time1</i> is earlier than <i>time2</i>, compensating for wrap-around,
otherwise <code>nil</code>.
</p></dd></dl>

<dl>
<dt><a name="index-time_002ddifference"></a>Function: <strong>time-difference</strong> <em>time1 time2</em></dt>
<dd><p>Assuming <i>time1</i> is later than <i>time2</i>, returns the number of 60ths
of a second difference between them, compensating for wrap-around.
</p></dd></dl>

<dl>
<dt><a name="index-defun_002dcompatibility"></a>Function: <strong>defun-compatibility</strong> <em>x</em></dt>
<dd><p>This function is used by <code>defun</code> and the compiler to convert
Maclisp-style <code>defun</code>s to Lisp Machine definitions.  <i>x</i> should be
the cdr of a <code>(defun ...)</code> form.  <code>defun-compatibility</code> will return
a corresponding <code>(defun ...)</code> or <code>(macro ...)</code> form, in the usual Lisp
Machine format.
</p></dd></dl>

<dl>
<dt><a name="index-set_002derror_002dmode-1"></a>Function: <strong>set-error-mode</strong> <em>&amp;optional (car-sym-mode <code>1</code>) (cdr-sym-mode <code>1</code>) (car-num-mode <code>0</code>) (cdr-num-mode <code>0</code>)</em></dt>
<dd><p><code>set-error-mode</code> sets the four &quot;error mode&quot; variables.  See the documentation
of <code>car</code> and <code>cdr</code> ((car-fun)) which explains what these mean.
</p></dd></dl>

<dl>
<dt><a name="index-print_002derror_002dmode"></a>Function: <strong>print-error-mode</strong> <em>&amp;optional mode stream</em></dt>
<dd><p>This prints an English description of the error-mode number <i>mode</i>
onto the output stream <i>stream</i>.  <i>mode</i> defaults to the mode currently
in effect, and <i>stream</i> defaults to <code>standard-output</code>.
</p></dd></dl>

<dl>
<dt><a name="index-_002arset"></a>Function: <strong>*rset</strong> <em>flag</em></dt>
<dd><p>Sets the variable <code>*rset</code> to <i>flag</i>.  Nothing looks at this variable;
it is a vestigial crock left over from Maclisp.
</p></dd></dl>

<dl>
<dt><a name="index-disk_002drestore"></a>Function: <strong>disk-restore</strong> <em>&amp;optional partition</em></dt>
<dd><p><i>partition</i> may be the name or the number of a disk partition
containing a virtual-memory load, or <code>nil</code> or omitted, meaning
to use the default load, which is the one the machine loads automatically
when it is booted.  The specified partition is copied into the paging
area of the disk and then started.  Lisp-machine disks currently contain
seven partitions on which copies of virtual-memory may be saved for
later execution in this way.
</p>
<p><code>disk-restore</code> asks the user for confirmation before doing it.
</p></dd></dl>

<dl>
<dt><a name="index-disk_002dsave"></a>Function: <strong>disk-save</strong> <em>partition</em></dt>
<dd><p><i>partition</i> may be the name or the number of a disk partition
containing a virtual-memory load, or <code>nil</code>, meaning
to use the default load, which is the one the machine loads automatically
when it is booted.  The current contents of virtual memory are copied
from main memory and the paging area of the disk into the specified
partition, and then restarted as if it had just been reloaded.
</p>
<p><code>disk-save</code> asks the user for confirmation before doing it.
</p></dd></dl>

<a name="Status-and-SStatus"></a>
<h3 class="section">24.9 Status and SStatus</h3>

<p>The <code>status</code> and <code>sstatus</code> special forms exist for compatibility
with Maclisp.  Programs that wish to run in both Maclisp and Lisp Machine Lisp
can use <code>status</code> to determine which of these they are running in.  Also,
<code>(sstatus feature ...)</code> can be used as it is in Maclisp.
</p>
<dl>
<dt><a name="index-status"></a>Special Form: <strong>status</strong></dt>
<dd><p><code>(status features)</code> returns a list of symbols indicating features
of the Lisp environment.  The complete list of all symbols which may
appear on this list, and their meanings, is given in the Maclisp
manual.  The default list for the Lisp Machine is:
</p>
<div class="lisp">
<pre class="lisp">(sort fasload string newio roman trace grindef grind lispm)
</pre></div>

<p>The value of this list will be kept up to date as features are added
or removed from the Lisp Machine system.  Most important is the symbol
<code>lispm</code>, which is the last element of the list; this indicates
that the program is executing on the Lisp Machine.
</p>
<p><code>(status feature <i>symbol</i>)</code> returns <code>t</code> if <i>symbol</i>
is on the <code>(status features)</code> list, otherwise <code>nil</code>.
</p>
<p><code>(status nofeature <i>symbol</i>)</code> returns <code>t</code> if <i>symbol</i>
is not on the <code>(status features)</code> list, otherwise <code>nil</code>.
</p>
<p><code>(status status)</code> returns a list of all <code>status</code> operations.
</p>
<p><code>(status sstatus)</code> returns a list of all <code>sstatus</code> operations.
</p></dd></dl>

<dl>
<dt><a name="index-sstatus"></a>Special Form: <strong>sstatus</strong></dt>
<dd><p><code>(sstatus feature <i>symbol</i>)</code> adds <i>symbol</i> to the list
of features.
</p>
<p><code>(sstatus nofeature <i>symbol</i>)</code> removes <i>symbol</i> from
the list of features.
</p></dd></dl>

<a name="The-Lisp-Top-Level"></a>
<h3 class="section">24.10 The Lisp Top Level</h3>

<p>These functions constitute the Lisp top level,
and its associated functions.
</p>
<p>[This whole section needs to be rewritten.]
</p>
<dl>
<dt><a name="index-si_003alisp_002dtop_002dlevel"></a>Function: <strong>si:lisp-top-level</strong></dt>
<dd><p>This is the first function called in the initial Lisp environment.
It calls <code>lisp-reinitialize</code>, clears the screen, and calls <code>si:lisp-top-level1</code>.
</p></dd></dl>

<dl>
<dt><a name="index-lisp_002dreinitialize"></a>Function: <strong>lisp-reinitialize</strong></dt>
<dd><p>This function does a wide variety of things, such as resetting the values
of various global constants and initializing the error system.
</p></dd></dl>

<dl>
<dt><a name="index-si_003alisp_002dtop_002dlevel1"></a>Function: <strong>si:lisp-top-level1</strong></dt>
<dd><p>This is the actual top level loop.  It prints out &quot;<code>105 FOOBAR</code>&quot; and
then goes into a loop reading a form from <code>standard-input</code>,
evaluating it, and printing the result (with slashification) to
<code>standard-output</code>.  If several values are returned by the form
all of them will be printed.  Also the values of <code>*</code>, <code>+</code>, <code>-</code>, <code>//</code>,
<code>++</code>, <code>**</code>, <code>+++</code>, and <code>***</code>
are maintained (see below).
</p></dd></dl>

<dl>
<dt><a name="index-break"></a>Special Form: <strong>break</strong></dt>
<dd><p><code>break</code> is used to enter a breakpoint loop, which is similar
to a Lisp top level loop.  <code>(break <i>tag</i>)</code> will always
enter the loop; <code>(break <i>tag</i> <i>conditional-form</i>)</code>
will evaluate <i>conditional-form</i> and only enter the break loop
if it returns non-<code>nil</code>.  If the break loop is entered, <code>break</code>
prints out
</p>
<div class="lisp">
<pre class="lisp">;bkpt <i>tag</i>
</pre></div>

<p>and then enters a loop reading, evaluating, and printing forms.
A difference between a break loop and the top level loop
is that after reading a form, <code>break</code> checks for the
following special cases: if the symbol <code>g</code> is typed,
<code>break</code> throws back to the Lisp top level.  If <code>p</code>
is typed, <code>break</code> returns <code>nil</code>.  If <code>(return <i>form</i>)</code>
is typed, <code>break</code> evaluates <i>form</i> and returns the result.
</p></dd></dl>

<dl>
<dt><a name="index-_002d-1"></a>Variable: <strong>-</strong></dt>
<dd><p>While a form is being evaluated by a read-eval-print loop,
<code>-</code> is bound to the form itself.
</p></dd></dl>

<dl>
<dt><a name="index-_002b-1"></a>Variable: <strong>+</strong></dt>
<dd><p>While a form is being evaluated by a read-eval-print loop,
<code>+</code> is bound to the previous form that was read by the loop.
</p></dd></dl>

<dl>
<dt><a name="index-_002a-1"></a>Variable: <strong>*</strong></dt>
<dd><p>While a form is being evaluated by a read-eval-print loop,
<code>*</code> is bound to the result printed the last time through
the loop.  If there were several values printed (because
of a multiple-value return), <code>*</code> is bound to the first
value.
</p></dd></dl>

<dl>
<dt><a name="index-_002f_002f-1"></a>Variable: <strong>//</strong></dt>
<dd><p>While a form is being evaluated by a read-eval-print loop,
<code>//</code> is bound to a list of the results printed the last
time through the loop.
</p></dd></dl>

<dl>
<dt><a name="index-_002b_002b"></a>Variable: <strong>++</strong></dt>
<dd><p><code>++</code> holds the previous value of <code>+</code>, that is, the form evaluated
two interactions ago.
</p></dd></dl>

<dl>
<dt><a name="index-_002b_002b_002b"></a>Variable: <strong>+++</strong></dt>
<dd><p><code>+++</code> holds the previous value of <code>++</code>.
</p></dd></dl>

<dl>
<dt><a name="index-_002a_002a"></a>Variable: <strong>**</strong></dt>
<dd><p><code>**</code> holds the previous value of <code>*</code>, that is, the result of the
form evaluated two interactions ago.
</p></dd></dl>

<dl>
<dt><a name="index-_002a_002a_002a"></a>Variable: <strong>***</strong></dt>
<dd><p><code>***</code> holds the previous value of <code>**</code>.
</p></dd></dl>

<dl>
<dt><a name="index-lisp_002dinitialization_002dlist"></a>Variable: <strong>lisp-initialization-list</strong></dt>
<dd><p>The value of <code>lisp-initialization-list</code> is a list of forms, which
are sequentially evaluated by <code>lisp-reinitialize</code>.
</p></dd></dl>

<dl>
<dt><a name="index-lisp_002dcrash_002dlist"></a>Variable: <strong>lisp-crash-list</strong></dt>
<dd><p>The value of <code>lisp-crash-list</code> is a list of forms.
<code>lisp-reinitialize</code> sequentially evaluates these
forms, and then sets <code>lisp-crash-list</code> to <code>nil</code>.
</p></dd></dl>

<a name="Logging-In"></a>
<h3 class="section">24.11 Logging In</h3>

<p>Logging in tells the Lisp Machine who you are, so that
other users can see who is logged in, you can receive messages,
and your INIT file can be run.  An INIT file is a Lisp program
which gets loaded when you log in; it can be used to set up
a personalized environment.  The init file is named <i>user</i>; .LISPM (INIT)
if you have a directory.
</p>
<p>When you log out, it should be possible to undo any
personalizations you have made so that they do not affect the next user
of the machine.  Therefore, anything done by an INIT file should be
undoable.  In order to do this, for every form in the INIT file, a Lisp
form to undo its effects should be added to the list which is the value
of <code>logout-list</code>.  The functions <code>login-setq</code> and <code>login-eval</code>
help make this easy; see below.
</p>
<dl>
<dt><a name="index-user_002did"></a>Variable: <strong>user-id</strong></dt>
<dd><p>The value of <code>user-id</code> is either the name of the logged in user, as a string,
or else an empty string if there is no user logged in.
It appears in the who-line.
</p></dd></dl>

<dl>
<dt><a name="index-logout_002dlist"></a>Variable: <strong>logout-list</strong></dt>
<dd><p>The value of <code>logout-list</code> is a list of forms which are evaluated
when a user logs out.
</p></dd></dl>

<dl>
<dt><a name="index-login"></a>Function: <strong>login</strong> <em>name</em></dt>
<dd><p>If anyone is logged into the machine, <code>login</code> logs him out.
(See <code>logout</code>.)
Then <code>user-id</code> is set from <i>name</i>.
Finally <code>login</code> attempts to find your INIT file.
It first looks in &quot;<i>user-id</i>; .LISPM (INIT)&quot;,
then in &quot;(INIT); <i>user-id</i> .LISPM&quot;,
and finally in the default init file &quot;(INIT); * .LISPM&quot;.
When it finds one of these that exists, it loads it in.
<code>login</code> returns <code>t</code>.
</p></dd></dl>

<dl>
<dt><a name="index-logout"></a>Function: <strong>logout</strong></dt>
<dd><p>First, <code>logout</code> evaluates the forms on <code>logout-list</code>.
Then it tries to find a file to run, looking
first in &quot;<i>user-id</i>; .LSPM_ (INIT)&quot;,
then in &quot;(INIT); <i>user-id</i> .LSPM_&quot;,
and finally in the default file &quot;(INIT); * .LSPM_&quot;.
If and when it finds one it these that exists, it loads it in.
Then it sets <code>user-id</code> to an empty string and <code>logout-list</code>
to <code>nil</code>, and returns <code>t</code>.
</p></dd></dl>

<dl>
<dt><a name="index-login_002dsetq"></a>Special Form: <strong>login-setq</strong></dt>
<dd><p><code>login-setq</code> is like <code>setq</code> except that it puts
a <code>setq</code> form on <code>logout-list</code> to set the variables
to their previous values.
</p></dd></dl>

<dl>
<dt><a name="index-login_002deval"></a>Function: <strong>login-eval</strong> <em>x</em></dt>
<dd><p><code>login-eval</code> is used for functions which are &quot;meant to be called&quot;
from INIT files, such as <code>eine:ed-redefine-keys</code>, which conveniently
return a form to undo what they did.  <code>login-eval</code> adds
the result of the form <i>x</i> to the <code>logout-list</code>.
</p></dd></dl>

<a name="Concept-Index"></a>
<h2 class="unnumbered">Concept Index</h2>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Top_cp_symbol-1"><b>%</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Top_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-cp" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_symbol-1">%</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd-fields">%%kbd fields</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-area">area</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-area-1">area</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array">array</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-1">array</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-initialization">array initialization</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-leader">array leader</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-leader-1">array leader</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-leader-2">array leader</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-association-lists">association lists</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-association-lists-1">association lists</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atom">atom</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atom-1">atom</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-attribute">attribute</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-binding">binding</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-blocks">blocks</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-byte">byte</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-byte-specifiers">byte specifiers</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-catch">catch</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cell">cell</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character-object">character object</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character-set">character set</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cleanup-handlers">cleanup handlers</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-closure">closure</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-closure-1">closure</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compiler">compiler</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-condition-handler">condition handler</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-conditional">conditional</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-conditions">conditions</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cons">cons</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cons-vs-list">cons vs list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-conses">conses</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-control-structure">control structure</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-data_002dtype">data-type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-data_002dtype-1">data-type</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-debugger">debugger</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-declaring-packages">declaring packages</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-definition">definition</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-definition-1">definition</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defstruct">defstruct</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disembodied-property-list">disembodied property list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-displaced-array">displaced array</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-displaced-array-1">displaced array</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-displacing-macros">displacing macros</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dotted-list">dotted list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dotted-pair">dotted pair</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-eq-versus-equal">eq versus equal</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eq-versus-equal-1">eq versus equal</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error-system">error system</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evalhook">evalhook</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evaluation">evaluation</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exits">exits</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-fef">fef</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file">file</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fill-pointer">fill pointer</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-flow-of-control">flow of control</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-font">font</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-font-compiler">font compiler</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-formatted-output">formatted output</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-function-cell">function cell</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-handling-conditions">handling conditions</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-handling-errors">handling errors</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash-table">hash table</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-hash-table-1">hash table</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-index-offset">index offset</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-index-offset-1">index offset</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-indicator">indicator</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-indirect-array">indirect array</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-indirect-array-1">indirect array</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-indirect-arrays">indirect arrays</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input-and-output">input and output</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input-to-the-compiler">input to the compiler</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intern">intern</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-iteration">iteration</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-iteration-1">iteration</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-J">J</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-job">job</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-K">K</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-keyboard-characters">keyboard characters</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-lambda-lists">lambda lists</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lexpr">lexpr</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lists">lists</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-locative">locative</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-locative-1">locative</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lock">lock</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-macro-defining-macros">macro defining macros</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-macro_002ddefining-macros">macro-defining macros</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-macros">macros</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapping">mapping</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multiple-value">multiple value</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multiprocessing">multiprocessing</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-N">N</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-named_002dstructure">named-structure</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-named_002dstructure-1">named-structure</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-naming-convention">naming convention</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nil_002c-used-as-a-condition-name">nil, used as a condition name</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-non_002dlocal-exit">non-local exit</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-non_002dlocal-exit-1">non-local exit</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-number">number</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-number-1">number</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-package">package</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-package-declarations">package declarations</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pc-ppr">pc ppr</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-piece-of-paper">piece of paper</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ppss">ppss</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-predicate">predicate</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-print-name">print name</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-print-name-1">print name</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-printer">printer</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process">process</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property-list">property list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Property-list">Property list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property-list-1">property list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-Q">Q</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-quote">quote</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-reader">reader</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-recursion">recursion</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-resumer">resumer</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-returning-multiple-values">returning multiple values</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-S_002dexpression">S-expression</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-scheduler">scheduler</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-screen">screen</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set">set</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-signaller">signaller</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-signalling-conditions">signalling conditions</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-signalling-errors">signalling errors</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-slashification">slashification</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sorting">sorting</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stack-group">stack group</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stack-group-1">stack group</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string">string</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string-1">string</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-structures">structures</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subprimitives">subprimitives</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subscript">subscript</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-substitution">substitution</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol">symbol</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol-1">symbol</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbol-2">symbol</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-throw">throw</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv">tv</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob">tvob</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-types-of-arrays">types of arrays</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-U">U</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-unwind-protection">unwind protection</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unwinding-a-stack">unwinding a stack</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-value-cell">value cell</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_cp_letter-W">W</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-wait">wait</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Top_cp_symbol-1"><b>%</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Top_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_cp_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>

<a name="Variable-Index"></a>
<h2 class="unnumbered">Variable Index</h2>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Top_vr_symbol-1"><b>%</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-2"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-3"><b>+</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-4"><b>-</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-5"><b>/</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Top_vr_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-vr" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_symbol-1">%</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025ch_002dchar"><code>%%ch-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025ch_002dfont"><code>%%ch-font</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dchar"><code>%%kbd-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dcontrol"><code>%%kbd-control</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dcontrol_002dmeta"><code>%%kbd-control-meta</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dmeta"><code>%%kbd-meta</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dmouse"><code>%%kbd-mouse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dmouse_002dbutton"><code>%%kbd-mouse-button</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025_0025kbd_002dmouse_002dn_002dclicks"><code>%%kbd-mouse-n-clicks</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025error_002dhandler_002dstack_002dgroup"><code>%error-handler-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025initial_002dstack_002dgroup"><code>%initial-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025m_002dflags"><code>%m-flags</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025mar_002dhigh"><code>%mar-high</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025mar_002dlow"><code>%mar-low</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025method_002dclass"><code>%method-class</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025microcode_002dversion_002dnumber"><code>%microcode-version-number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025self"><code>%self</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_symbol-2">*</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a-1"><code>*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a_002a"><code>**</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a_002a_002a"><code>***</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002anopoint"><code>*nopoint</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002arset-1"><code>*rset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_symbol-3">+</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b-1"><code>+</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b_002b"><code>++</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b_002b_002b"><code>+++</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_symbol-4">-</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d-1"><code>-</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_symbol-5">/</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f_002f-1"><code>//</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-all_002dspecial_002dswitch"><code>all-special-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-allow_002dvariables_002din_002dfunction_002dposition_002dswitch"><code>allow-variables-in-function-position-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-alphabetic_002dcase_002daffects_002dstring_002dcomparison"><code>alphabetic-case-affects-string-comparison</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-area_002dlist"><code>area-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-area_002dname-1"><code>area-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dbits_002dper_002delement-1"><code>array-bits-per-element</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002delements_002dper_002dq-1"><code>array-elements-per-q</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dtypes-1"><code>array-types</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-base"><code>base</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-car-1"><code>car</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdr-1"><code>cdr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-default_002darray_002darea"><code>default-array-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-default_002dcons_002darea"><code>default-cons-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-default_002dcons_002darea-1"><code>default-cons-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-error_002doutput"><code>error-output</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-errset-1"><code>errset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evalhook-3"><code>evalhook</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002derror"><code>file-error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-ibase"><code>ibase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inhibit_002dscavenging_002dflag"><code>inhibit-scavenging-flag</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inhibit_002dscheduling_002dflag"><code>inhibit-scheduling-flag</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inhibit_002dstyle_002dwarnings_002dswitch"><code>inhibit-style-warnings-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-J">J</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dlist"><code>job-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-K">K</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-kbd_002dsimulated_002dclock_002dfcn_002dlist"><code>kbd-simulated-clock-fcn-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-kbd_002dsuper_002dimage_002dp"><code>kbd-super-image-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-lisp_002dcrash_002dlist"><code>lisp-crash-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lisp_002dinitialization_002dlist"><code>lisp-initialization-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logout_002dlist"><code>logout-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-macro_002dcompiled_002dprogram"><code>macro-compiled-program</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-obsolete_002dfunction_002dwarning_002dswitch"><code>obsolete-function-warning-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open_002dcode_002dmap_002dswitch"><code>open-code-map-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-package-1"><code>package</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-permanent_002dstorage_002darea"><code>permanent-storage-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prinlength"><code>prinlength</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prinlevel"><code>prinlevel</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-Q">Q</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-q_002ddata_002dtypes-1"><code>q-data-types</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-query_002dio"><code>query-io</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dpreserve_002ddelimiters"><code>read-preserve-delimiters</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-readtable"><code>readtable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-retain_002dvariable_002dnames_002dswitch"><code>retain-variable-names-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-room-1"><code>room</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-run_002din_002dmaclisp_002dswitch"><code>run-in-maclisp-switch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025aging_002drate"><code>si:%aging-rate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dage_002dflushed_002dpages"><code>si:%count-age-flushed-pages</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002daged_002dpages"><code>si:%count-aged-pages</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002ddisk_002derrors"><code>si:%count-disk-errors</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002ddisk_002dpage_002dreads"><code>si:%count-disk-page-reads</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002ddisk_002dpage_002dwrites"><code>si:%count-disk-page-writes</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dfirst_002dlevel_002dmap_002dreloads"><code>si:%count-first-level-map-reloads</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dfresh_002dpages"><code>si:%count-fresh-pages</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dpdl_002dbuffer_002dmemory_002dfaults"><code>si:%count-pdl-buffer-memory-faults</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dpdl_002dbuffer_002dread_002dfaults"><code>si:%count-pdl-buffer-read-faults</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dpdl_002dbuffer_002dwrite_002dfaults"><code>si:%count-pdl-buffer-write-faults</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025count_002dsecond_002dlevel_002dmap_002dreloads"><code>si:%count-second-level-map-reloads</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup"><code>si:%current-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup-1"><code>si:%current-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup_002dcalling_002dargs_002dnumber"><code>si:%current-stack-group-calling-args-number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup_002dcalling_002dargs_002dpointer"><code>si:%current-stack-group-calling-args-pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup_002dprevious_002dstack_002dgroup"><code>si:%current-stack-group-previous-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup_002dprevious_002dstack_002dgroup-1"><code>si:%current-stack-group-previous-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025current_002dstack_002dgroup_002dstate"><code>si:%current-stack-group-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025initial_002dfef"><code>si:%initial-fef</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025mar_002dhigh"><code>si:%mar-high</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025mar_002dlow"><code>si:%mar-low</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025trap_002dmicro_002dpc"><code>si:%trap-micro-pc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003arandom_002darray"><code>si:random-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003arubout_002dhandler"><code>si:rubout-handler</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-standard_002dinput"><code>standard-input</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-standard_002doutput"><code>standard-output</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sys_003a_0025number_002dof_002dmicro_002dentries"><code>sys:%number-of-micro-entries</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sys_003anr_002dsym"><code>sys:nr-sym</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sys_003ap_002dn_002dstring"><code>sys:p-n-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-terminal_002dio"><code>terminal-io</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-trace_002dcompile_002dflag"><code>trace-compile-flag</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dalu_002dandca"><code>tv-alu-andca</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dalu_002dior"><code>tv-alu-ior</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dalu_002dseta"><code>tv-alu-seta</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dalu_002dxor"><code>tv-alu-xor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dbeep-1"><code>tv-beep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dbeep_002dduration"><code>tv-beep-duration</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dbeep_002dwavelength"><code>tv-beep-wavelength</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dblinker_002dlist"><code>tv-blinker-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddefault_002dscreen"><code>tv-default-screen</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dmore_002dprocessing_002dglobal_002denable"><code>tv-more-processing-global-enable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dpc_002dppr_002dlist"><code>tv-pc-ppr-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002droving_002dblinker_002dlist"><code>tv-roving-blinker-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwhite_002don_002dblack_002dstate-1"><code>tv-white-on-black-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dlist"><code>tv-who-line-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dpc_002dppr"><code>tv-who-line-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dprocess"><code>tv-who-line-process</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002drun_002dlight_002dloc"><code>tv-who-line-run-light-loc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002drun_002dstate"><code>tv-who-line-run-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dstate"><code>tv-who-line-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dstream"><code>tv-who-line-stream</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcomplete_002dredisplay-1"><code>tvob-complete-redisplay</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-U">U</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-user_002did"><code>user-id</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_vr_letter-W">W</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-working_002dstorage_002darea"><code>working-storage-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Top_vr_symbol-1"><b>%</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-2"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-3"><b>+</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-4"><b>-</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_symbol-5"><b>/</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Top_vr_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_vr_letter-W"><b>W</b></a>
 &nbsp; 
</td></tr></table>

<a name="Function-index"></a>
<h2 class="unnumbered">Function index</h2>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Top_fn_symbol-1"><b></b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-2"><b>%</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-3"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-4"><b>+</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-5"><b>-</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-6"><b>/</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-7"><b>1</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-8"><b>&lt;</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-9"><b>=</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-10"><b>&gt;</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-11"><b>@</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-12"><b>\</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-13"><b>^</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Top_fn_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-W"><b>W</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-X"><b>X</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-Y"><b>Y</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-Z"><b>Z</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-fn" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-1"></a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0011_001a"><code></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0011_001c"><code></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0011_001d"><code></code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-2">%</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002524_002dbit_002ddifference"><code>%24-bit-difference</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002524_002dbit_002dplus"><code>%24-bit-plus</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002524_002dbit_002dtimes"><code>%24-bit-times</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025allocate_002dand_002dinitialize"><code>%allocate-and-initialize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025allocate_002dand_002dinitialize_002darray"><code>%allocate-and-initialize-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025area_002dnumber"><code>%area-number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025args_002dinfo"><code>%args-info</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025data_002dtype"><code>%data-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025divide_002ddouble"><code>%divide-double</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025find_002dstructure_002dheader"><code>%find-structure-header</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025find_002dstructure_002dleader"><code>%find-structure-leader</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025float_002ddouble"><code>%float-double</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025halt"><code>%halt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025logdpb"><code>%logdpb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025logldb"><code>%logldb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025make_002dpointer"><code>%make-pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025make_002dpointer_002doffset"><code>%make-pointer-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025multiply_002dfractions"><code>%multiply-fractions</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dcdr_002dcode"><code>%p-cdr-code</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dcontents_002das_002dlocative"><code>%p-contents-as-locative</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dcontents_002das_002dlocative_002doffset"><code>%p-contents-as-locative-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dcontents_002doffset"><code>%p-contents-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002ddata_002dtype"><code>%p-data-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002ddeposit_002dfield"><code>%p-deposit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002ddeposit_002dfield_002doffset"><code>%p-deposit-field-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002ddpb"><code>%p-dpb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002ddpb_002doffset"><code>%p-dpb-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dflag_002dbit"><code>%p-flag-bit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dldb"><code>%p-ldb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dldb_002doffset"><code>%p-ldb-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dmask_002dfield"><code>%p-mask-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dmask_002dfield_002doffset"><code>%p-mask-field-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dpointer"><code>%p-pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002dcdr_002dcode"><code>%p-store-cdr-code</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002dcontents"><code>%p-store-contents</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002dcontents_002doffset"><code>%p-store-contents-offset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002ddata_002dtype"><code>%p-store-data-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002dflag_002dbit"><code>%p-store-flag-bit</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002dpointer"><code>%p-store-pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025p_002dstore_002dtag_002dand_002dpointer"><code>%p-store-tag-and-pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025pointer"><code>%pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025pointer_002ddifference"><code>%pointer-difference</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025region_002dnumber"><code>%region-number</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025remainder_002ddouble"><code>%remainder-double</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025stack_002dframe_002dpointer"><code>%stack-frame-pointer</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025store_002dconditional"><code>%store-conditional</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025string_002dequal"><code>%string-equal</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025string_002dsearch_002dchar"><code>%string-search-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025structure_002dboxed_002dsize"><code>%structure-boxed-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025structure_002dtotal_002dsize"><code>%structure-total-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025unibus_002dread"><code>%unibus-read</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025unibus_002dwrite"><code>%unibus-write</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025xbus_002dread"><code>%xbus-read</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0025xbus_002dwrite"><code>%xbus-write</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-3">*</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a"><code>*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002a_0024"><code>*$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aarray"><code>*array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002acatch"><code>*catch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002adif"><code>*dif</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aexpr"><code>*expr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002afexpr"><code>*fexpr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002alexpr"><code>*lexpr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aplus"><code>*plus</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aquo"><code>*quo</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002arset"><code>*rset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002athrow"><code>*throw</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002atimes"><code>*times</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aunwind_002dstack"><code>*unwind-stack</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-4">+</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b"><code>+</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002b_0024"><code>+$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-5">-</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d"><code>-</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002d_0024"><code>-$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-6">/</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f_002f"><code>//</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002f_002f_0024"><code>//$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-7">1</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-1_002b"><code>1+</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-1_002b_0024"><code>1+$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-1_002d"><code>1-</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-1_002d_0024"><code>1-$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-8">&lt;</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003c"><code>&lt;</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003c_003d"><code>&lt;=</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-9">=</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003d"><code>=</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-10">&gt;</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003e"><code>&gt;</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003e_003d"><code>&gt;=</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-11">@</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0040"><code>@</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-12">\</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005c"><code>\</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005c_005c"><code>\\</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_symbol-13">^</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005e"><code>^</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005e_0024"><code>^$</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-abs"><code>abs</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-add1"><code>add1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-adjust_002darray_002dsize"><code>adjust-array-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-aloc"><code>aloc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-alphalessp"><code>alphalessp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-and"><code>and</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ap_002d1"><code>ap-1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ap_002d2"><code>ap-2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ap_002d3"><code>ap-3</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ap_002dleader"><code>ap-leader</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-append"><code>append</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-apply"><code>apply</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-apropos"><code>apropos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ar_002d1"><code>ar-1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ar_002d2"><code>ar-2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ar_002d3"><code>ar-3</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-area_002dname"><code>area-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-aref"><code>aref</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arg"><code>arg</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arglist"><code>arglist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-args_002dinfo"><code>args-info</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array-2"><code>array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002d_002f_0023_002ddims"><code>array-/#-dims</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dactive_002dlength"><code>array-active-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dbits_002dper_002delement"><code>array-bits-per-element</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002ddimension_002dn"><code>array-dimension-n</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002ddimensions"><code>array-dimensions</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002ddisplaced_002dp"><code>array-displaced-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002delement_002dsize"><code>array-element-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002delements_002dper_002dq"><code>array-elements-per-q</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dhas_002dleader_002dp"><code>array-has-leader-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002din_002dbounds_002dp"><code>array-in-bounds-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dindexed_002dp"><code>array-indexed-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dindirect_002dp"><code>array-indirect-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dleader"><code>array-leader</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dleader_002dlength"><code>array-leader-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dlength"><code>array-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dpop"><code>array-pop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dpush"><code>array-push</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dpush_002dextend"><code>array-push-extend</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dtype"><code>array-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-array_002dtypes"><code>array-types</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arraycall"><code>arraycall</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arraycall-1"><code>arraycall</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arraydims"><code>arraydims</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-arrayp"><code>arrayp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-as_002d1"><code>as-1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-as_002d2"><code>as-2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-as_002d3"><code>as-3</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ascii"><code>ascii</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-aset"><code>aset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ash"><code>ash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ass"><code>ass</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-assoc"><code>assoc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-assq"><code>assq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atan"><code>atan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atan2"><code>atan2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-atom-2"><code>atom</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-bigp"><code>bigp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bind"><code>bind</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bit_002dtest"><code>bit-test</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-bitblt"><code>bitblt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-boole"><code>boole</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-boundp"><code>boundp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-break"><code>break</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-butlast"><code>butlast</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-c_002e_002e_002er"><code>c...r</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caaaar"><code>caaaar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caaadr"><code>caaadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caaar"><code>caaar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caadar"><code>caadar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caaddr"><code>caaddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caadr"><code>caadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caar"><code>caar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cadaar"><code>cadaar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cadadr"><code>cadadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cadar"><code>cadar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caddar"><code>caddar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cadddr"><code>cadddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-caddr"><code>caddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cadr"><code>cadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-car"><code>car</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-car_002dlocation"><code>car-location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-catch-1"><code>catch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-catch_002dall"><code>catch-all</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdaaar"><code>cdaaar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdaadr"><code>cdaadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdaar"><code>cdaar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdadar"><code>cdadar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdaddr"><code>cdaddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdadr"><code>cdadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdar"><code>cdar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cddaar"><code>cddaar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cddadr"><code>cddadr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cddar"><code>cddar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdddar"><code>cdddar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cddddr"><code>cddddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdddr"><code>cdddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cddr"><code>cddr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cdr"><code>cdr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cerror"><code>cerror</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002ddowncase"><code>char-downcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dequal"><code>char-equal</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dlessp"><code>char-lessp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-char_002dupcase"><code>char-upcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-character"><code>character</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-check_002darg"><code>check-arg</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-circular_002dlist"><code>circular-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clear_002dmar"><code>clear-mar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-close"><code>close</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-closure-2"><code>closure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-closurep"><code>closurep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clrhash"><code>clrhash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-comment"><code>comment</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile"><code>compile</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compiler_002dlet"><code>compiler-let</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cond"><code>cond</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-condition_002dbind"><code>condition-bind</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cons-1"><code>cons</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cons_002din_002darea"><code>cons-in-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copy_002darray_002dcontents"><code>copy-array-contents</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copy_002darray_002dcontents_002dand_002dleader"><code>copy-array-contents-and-leader</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copy_002darray_002dportion"><code>copy-array-portion</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copyalist"><code>copyalist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copylist"><code>copylist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copylist_002a"><code>copylist*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-copysymbol"><code>copysymbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cos"><code>cos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cosd"><code>cosd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cursorpos"><code>cursorpos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-data_002dtype-2"><code>data-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-declare"><code>declare</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-def"><code>def</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-deff"><code>deff</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defmacro"><code>defmacro</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defmacro_002ddisplace"><code>defmacro-displace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defprop"><code>defprop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defstruct-1"><code>defstruct</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defsubst"><code>defsubst</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defun"><code>defun</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defun_002dcompatibility"><code>defun-compatibility</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defunp"><code>defunp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defvar"><code>defvar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-del"><code>del</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-del_002dif"><code>del-if</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-del_002dif_002dnot"><code>del-if-not</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-delete"><code>delete</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-delq"><code>delq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-deposit_002dfield"><code>deposit-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-describe"><code>describe</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-describe_002darea"><code>describe-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-describe_002dfile"><code>describe-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-describe_002dpackage"><code>describe-package</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-difference"><code>difference</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disassemble"><code>disassemble</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disk_002drestore"><code>disk-restore</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disk_002dsave"><code>disk-save</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dispatch"><code>dispatch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-displace"><code>displace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-do"><code>do</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-do_002dnamed"><code>do-named</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dolist"><code>dolist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dotimes"><code>dotimes</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dpb"><code>dpb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-enable_002dtrapping"><code>enable-trapping</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eq"><code>eq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-equal"><code>equal</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-err"><code>err</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error"><code>error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error_002drestart"><code>error-restart</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-errset"><code>errset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eval"><code>eval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eval_002dwhen"><code>eval-when</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evalhook-1"><code>evalhook</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evalhook-2"><code>evalhook</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evenp"><code>evenp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-every"><code>every</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exp"><code>exp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-explode"><code>explode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-explodec"><code>explodec</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-exploden"><code>exploden</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-expt"><code>expt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-fasload"><code>fasload</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fboundp"><code>fboundp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ferror"><code>ferror</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fifth"><code>fifth</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dcommand"><code>file-command</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dcommand_002dcareful"><code>file-command-careful</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002ddefault_002dfn2"><code>file-default-fn2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002derror_002dstatus"><code>file-error-status</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dexists_002dp"><code>file-exists-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dexpand_002dpathname"><code>file-expand-pathname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dmapped_002dopen"><code>file-mapped-open</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dqfasl_002dp"><code>file-qfasl-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dset_002dfn2"><code>file-set-fn2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fillarray"><code>fillarray</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-find_002dposition_002din_002dlist"><code>find-position-in-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-find_002dposition_002din_002dlist_002dequal"><code>find-position-in-list-equal</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-first"><code>first</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-firstn"><code>firstn</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fix"><code>fix</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fixp"><code>fixp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fixr"><code>fixr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-flatc"><code>flatc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-flatsize"><code>flatsize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-float"><code>float</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-floatp"><code>floatp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fmakunbound"><code>fmakunbound</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-force_002dkbd_002dinput"><code>force-kbd-input</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format"><code>format</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-format_003aprint_002dlist"><code>format:print-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-forward_002dvalue_002dcell"><code>forward-value-cell</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fourth"><code>fourth</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-freturn"><code>freturn</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fset"><code>fset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fset_002dcarefully"><code>fset-carefully</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fsymeval"><code>fsymeval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-funcall"><code>funcall</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-function"><code>function</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-function_002dcell_002dlocation"><code>function-cell-location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-g_002dl_002dp"><code>g-l-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-gcd"><code>gcd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-gensym"><code>gensym</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get"><code>get</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002dlist_002dpointer_002dinto_002darray"><code>get-list-pointer-into-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002dlocative_002dpointer_002dinto_002darray"><code>get-locative-pointer-into-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002dpname"><code>get-pname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-get_002dpname-1"><code>get-pname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-getchar"><code>getchar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-getcharn"><code>getcharn</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-gethash"><code>gethash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-getl"><code>getl</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-globalize"><code>globalize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-go"><code>go</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-greaterp"><code>greaterp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-haipart"><code>haipart</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-haulong"><code>haulong</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-if"><code>if</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if_002dfor_002dlispm"><code>if-for-lispm</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if_002dfor_002dmaclisp"><code>if-for-maclisp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if_002dfor_002dmaclisp_002delse_002dlispm"><code>if-for-maclisp-else-lispm</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if_002din_002dlispm"><code>if-in-lispm</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-if_002din_002dmaclisp"><code>if-in-maclisp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-implode"><code>implode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inhibit_002dstyle_002dwarnings"><code>inhibit-style-warnings</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intern-1"><code>intern</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intern_002dlocal"><code>intern-local</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intern_002dlocal_002dsoft"><code>intern-local-soft</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-intern_002dsoft"><code>intern-soft</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-J">J</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dcreate"><code>job-create</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dkill"><code>job-kill</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dreset_002dprocesses"><code>job-reset-processes</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dreturn"><code>job-return</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dselect"><code>job-select</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dselect-1"><code>job-select</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dset_002dprocess_002dstate"><code>job-set-process-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-job_002dset_002dtvob_002dstate"><code>job-set-tvob-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-K">K</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-kbd_002dchar_002davailable"><code>kbd-char-available</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-kbd_002dtyi"><code>kbd-tyi</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-kbd_002dtyi_002dno_002dhang"><code>kbd-tyi-no-hang</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-last"><code>last</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ldb"><code>ldb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ldb-1"><code>ldb</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ldb_002dtest"><code>ldb-test</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ldiff"><code>ldiff</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-length"><code>length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lessp"><code>lessp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let"><code>let</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let_002dclosed"><code>let-closed</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-let_002dglobally"><code>let-globally</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lexpr_002dfuncall"><code>lexpr-funcall</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lisp_002dreinitialize"><code>lisp-reinitialize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list"><code>list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002a"><code>list*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002darray_002dleader"><code>list-array-leader</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-list_002din_002darea"><code>list-in-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-listarray"><code>listarray</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-listify"><code>listify</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-listp"><code>listp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load"><code>load</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-local_002ddeclare"><code>local-declare</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-locativep"><code>locativep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-locf"><code>locf</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-log"><code>log</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logand"><code>logand</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-login"><code>login</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-login_002deval"><code>login-eval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-login_002dsetq"><code>login-setq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logior"><code>logior</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logout"><code>logout</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logxor"><code>logxor</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lsh"><code>lsh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-lsubrcall"><code>lsubrcall</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-macro"><code>macro</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-macroexpand"><code>macroexpand</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-macroexpand_002d1"><code>macroexpand-1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002darea"><code>make-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002darray"><code>make-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002darray_002dinto_002dnamed_002dstructure"><code>make-array-into-named-structure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dhash_002dtable"><code>make-hash-table</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dlist"><code>make-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dlist-1"><code>make-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dstack_002dgroup"><code>make-stack-group</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dsymbol"><code>make-symbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dsyn_002dstream"><code>make-syn-stream</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-maknam"><code>maknam</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-makunbound"><code>makunbound</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-map"><code>map</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapatoms"><code>mapatoms</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapatoms_002dall"><code>mapatoms-all</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapc"><code>mapc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapcan"><code>mapcan</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapcar"><code>mapcar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mapcon"><code>mapcon</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-maphash"><code>maphash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-maplist"><code>maplist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mar_002dmode"><code>mar-mode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mask_002dfield"><code>mask-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-max"><code>max</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mem"><code>mem</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-memass"><code>memass</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-member"><code>member</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-memq"><code>memq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mexp"><code>mexp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-min"><code>min</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-minus"><code>minus</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-minusp"><code>minusp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multiple_002dvalue"><code>multiple-value</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multiple_002dvalue_002dbind"><code>multiple-value-bind</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multiple_002dvalue_002dlist"><code>multiple-value-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-multiple_002dvalue_002dreturn"><code>multiple-value-return</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-N">N</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-named_002dstructure_002dinvoke"><code>named-structure-invoke</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-named_002dstructure_002dp"><code>named-structure-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-named_002dstructure_002dsymbol"><code>named-structure-symbol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nbutlast"><code>nbutlast</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nconc"><code>nconc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ncons"><code>ncons</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ncons_002din_002darea"><code>ncons-in-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-neq"><code>neq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nlistp"><code>nlistp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-not"><code>not</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nreconc"><code>nreconc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nreverse"><code>nreverse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nsublis"><code>nsublis</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nsubst"><code>nsubst</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nsubstring"><code>nsubstring</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nsubstring-1"><code>nsubstring</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nsymbolp"><code>nsymbolp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nth"><code>nth</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nthcdr"><code>nthcdr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-null"><code>null</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-numberp"><code>numberp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-oddp"><code>oddp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-open"><code>open</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-or"><code>or</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-package_002dcell_002dlocation"><code>package-cell-location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-package_002ddeclare"><code>package-declare</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pairlis"><code>pairlis</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pkg_002dbind"><code>pkg-bind</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pkg_002dcreate_002dpackage"><code>pkg-create-package</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pkg_002dfind_002dpackage"><code>pkg-find-package</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pkg_002dgoto"><code>pkg-goto</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pkg_002dkill"><code>pkg-kill</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pkg_002dload"><code>pkg-load</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-plist"><code>plist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-plist-1"><code>plist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-plus"><code>plus</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-plusp"><code>plusp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pop"><code>pop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prin1"><code>prin1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prin1_002dthen_002dspace"><code>prin1-then-space</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-princ"><code>princ</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-print"><code>print</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-print_002ddisk_002dlabel"><code>print-disk-label</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-print_002derror_002dmode"><code>print-error-mode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-print_002dname_002dcell_002dlocation"><code>print-name-cell-location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dallow_002dschedule"><code>process-allow-schedule</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dcreate"><code>process-create</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002ddisable"><code>process-disable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002denable"><code>process-enable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dkill"><code>process-kill</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dlock"><code>process-lock</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dpreset"><code>process-preset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dsleep"><code>process-sleep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dunlock"><code>process-unlock</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-process_002dwait"><code>process-wait</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prog"><code>prog</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prog_002a"><code>prog*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prog1"><code>prog1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prog2"><code>prog2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-progn"><code>progn</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-progv"><code>progv</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-property_002dcell_002dlocation"><code>property-cell-location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-psetq"><code>psetq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-push"><code>push</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-puthash"><code>puthash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-putprop"><code>putprop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-Q">Q</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-q_002ddata_002dtypes"><code>q-data-types</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-qc_002dfile"><code>qc-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-qc_002dfile_002dload"><code>qc-file-load</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-qld"><code>qld</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quote-1"><code>quote</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-quotient"><code>quotient</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-random"><code>random</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rassoc"><code>rassoc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read"><code>read</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-read_002dfrom_002dstring"><code>read-from-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-readch"><code>readch</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-readfile"><code>readfile</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-readline"><code>readline</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-readlist"><code>readlist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-recompile_002dworld"><code>recompile-world</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rem"><code>rem</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rem_002dif"><code>rem-if</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rem_002dif_002dnot"><code>rem-if-not</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remainder"><code>remainder</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remhash"><code>remhash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remob"><code>remob</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remove"><code>remove</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remprop"><code>remprop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-remq"><code>remq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rest1"><code>rest1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rest2"><code>rest2</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rest3"><code>rest3</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rest4"><code>rest4</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-return"><code>return</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-return_002darray"><code>return-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-return_002dfrom"><code>return-from</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-return_002dlist"><code>return-list</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-reverse"><code>reverse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-room"><code>room</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rot"><code>rot</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rplaca"><code>rplaca</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-rplacd"><code>rplacd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-samepnamep"><code>samepnamep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sassoc"><code>sassoc</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sassq"><code>sassq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-second"><code>second</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-select"><code>select</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-selector"><code>selector</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-selectq"><code>selectq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set-1"><code>set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dcurrent_002dband"><code>set-current-band</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dcurrent_002dmicroload"><code>set-current-microload</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002derror_002dmode"><code>set-error-mode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002derror_002dmode-1"><code>set-error-mode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002din_002dclosure"><code>set-in-closure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dmar"><code>set-mar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_002dmemory_002dsize"><code>set-memory-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setarg"><code>setarg</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setf"><code>setf</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setplist"><code>setplist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setplist-1"><code>setplist</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setq"><code>setq</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-setup_002dkeyboard_002ddispatch_002dtable"><code>setup-keyboard-dispatch-table</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-seventh"><code>seventh</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025change_002dpage_002dstatus"><code>si:%change-page-status</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025compute_002dpage_002dhash"><code>si:%compute-page-hash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025create_002dphysical_002dpage"><code>si:%create-physical-page</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025delete_002dphysical_002dpage"><code>si:%delete-physical-page</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025disk_002drestore"><code>si:%disk-restore</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003a_0025disk_002dsave"><code>si:%disk-save</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003alisp_002dtop_002dlevel"><code>si:lisp-top-level</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003alisp_002dtop_002dlevel1"><code>si:lisp-top-level1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003arandom_002dcreate_002darray"><code>si:random-create-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003arandom_002dinitialize"><code>si:random-initialize</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003atv_002dend_002dline_002ddefault"><code>si:tv-end-line-default</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003atv_002dend_002dscreen_002ddefault"><code>si:tv-end-screen-default</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003atv_002dexception"><code>si:tv-exception</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003atv_002dmore_002ddefault"><code>si:tv-more-default</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003atv_002dmove_002dbitpos"><code>si:tv-move-bitpos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003aunwire_002dpage"><code>si:unwire-page</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-si_003awire_002dpage"><code>si:wire-page</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-signal"><code>signal</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-signp"><code>signp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sin"><code>sin</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sind"><code>sind</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sixth"><code>sixth</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-small_002dfloat"><code>small-float</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-small_002dfloatp"><code>small-floatp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-some"><code>some</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sort"><code>sort</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sort_002dgrouped_002darray"><code>sort-grouped-array</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sort_002dgrouped_002darray_002dgroup_002dkey"><code>sort-grouped-array-group-key</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sortcar"><code>sortcar</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-special"><code>special</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sqrt"><code>sqrt</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sstatus"><code>sstatus</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stack_002dgroup_002dpreset"><code>stack-group-preset</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stack_002dgroup_002dresume"><code>stack-group-resume</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stack_002dgroup_002dreturn"><code>stack-group-return</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-status"><code>status</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-step"><code>step</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-store"><code>store</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-store_002darray_002dleader"><code>store-array-leader</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stream_002dcopy_002duntil_002deof"><code>stream-copy-until-eof</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stream_002ddefault_002dhandler"><code>stream-default-handler</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string-2"><code>string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dappend"><code>string-append</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002ddowncase"><code>string-downcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dequal"><code>string-equal</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dleft_002dtrim"><code>string-left-trim</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dlength"><code>string-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dlessp"><code>string-lessp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dnreverse"><code>string-nreverse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreverse"><code>string-reverse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreverse_002dsearch"><code>string-reverse-search</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreverse_002dsearch_002dchar"><code>string-reverse-search-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreverse_002dsearch_002dnot_002dchar"><code>string-reverse-search-not-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreverse_002dsearch_002dnot_002dset"><code>string-reverse-search-not-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dreverse_002dsearch_002dset"><code>string-reverse-search-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dright_002dtrim"><code>string-right-trim</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsearch"><code>string-search</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsearch_002dchar"><code>string-search-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsearch_002dnot_002dchar"><code>string-search-not-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsearch_002dnot_002dset"><code>string-search-not-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dsearch_002dset"><code>string-search-set</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dtrim"><code>string-trim</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-string_002dupcase"><code>string-upcase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stringp"><code>stringp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-structure_002dforward"><code>structure-forward</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sub1"><code>sub1</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sublis"><code>sublis</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subrcall"><code>subrcall</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subrp"><code>subrp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subst"><code>subst</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-substring"><code>substring</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sxhash"><code>sxhash</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symbolp"><code>symbolp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symeval"><code>symeval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symeval-1"><code>symeval</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-symeval_002din_002dclosure"><code>symeval-in-closure</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-tailp"><code>tailp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tailp-1"><code>tailp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-terpri"><code>terpri</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-third"><code>third</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-throw-1"><code>throw</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-time"><code>time</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-time_002ddifference"><code>time-difference</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-time_002dlessp"><code>time-lessp</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-times"><code>times</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-trace"><code>trace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-trapping_002denabled_002dp"><code>trapping-enabled-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dactivate_002dpc_002dppr"><code>tv-activate-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dbackspace"><code>tv-backspace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dbeep"><code>tv-beep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dblack_002don_002dwhite"><code>tv-black-on-white</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dblink"><code>tv-blink</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dchar_002dwidth"><code>tv-char-width</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dcharacter_002dblinker"><code>tv-character-blinker</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dclear_002dchar"><code>tv-clear-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dclear_002deof"><code>tv-clear-eof</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dclear_002deol"><code>tv-clear-eol</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dclear_002dpc_002dppr"><code>tv-clear-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dclear_002dpc_002dppr_002dexcept_002dmargins"><code>tv-clear-pc-ppr-except-margins</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dclear_002dscreen"><code>tv-clear-screen</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dcomplement_002dbow_002dmode"><code>tv-complement-bow-mode</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dcompute_002dmotion"><code>tv-compute-motion</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dcrlf"><code>tv-crlf</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddeactivate_002dpc_002dppr"><code>tv-deactivate-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddeactivate_002dpc_002dppr_002dbut_002dshow_002dblinkers"><code>tv-deactivate-pc-ppr-but-show-blinkers</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddefine_002dblinker"><code>tv-define-blinker</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddefine_002dpc_002dppr"><code>tv-define-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddefine_002dscreen"><code>tv-define-screen</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddelete_002dchar"><code>tv-delete-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddelete_002dline"><code>tv-delete-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddraw_002dchar"><code>tv-draw-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddraw_002dline"><code>tv-draw-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002ddraw_002dline-1"><code>tv-draw-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002derase"><code>tv-erase</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dget_002dfont_002dpixel"><code>tv-get-font-pixel</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dhollow_002drectangular_002dblinker"><code>tv-hollow-rectangular-blinker</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dhome"><code>tv-home</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dhome_002ddown"><code>tv-home-down</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dinsert_002dchar"><code>tv-insert-char</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dinsert_002dline"><code>tv-insert-line</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dline_002dout"><code>tv-line-out</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dmake_002ddbl_002dhor_002dfont"><code>tv-make-dbl-hor-font</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dmake_002dgray_002dfont"><code>tv-make-gray-font</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dmake_002dsideways_002dfont"><code>tv-make-sideways-font</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dmake_002dstream"><code>tv-make-stream</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dnote_002dinput"><code>tv-note-input</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dopen_002dblinker"><code>tv-open-blinker</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dopen_002dscreen"><code>tv-open-screen</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dprepare_002dpc_002dppr"><code>tv-prepare-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dread_002dblinker_002dcursorpos"><code>tv-read-blinker-cursorpos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dread_002dcursorpos"><code>tv-read-cursorpos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002drectangular_002dblinker"><code>tv-rectangular-blinker</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dredefine_002dpc_002dppr"><code>tv-redefine-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dreturn_002dpc_002dppr"><code>tv-return-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dselect_002dscreen"><code>tv-select-screen</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dset_002dblinker_002dcursorpos"><code>tv-set-blinker-cursorpos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dset_002dblinker_002dfunction"><code>tv-set-blinker-function</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dset_002dblinker_002dsize"><code>tv-set-blinker-size</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dset_002dblinker_002dvisibility"><code>tv-set-blinker-visibility</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dset_002dcursorpos"><code>tv-set-cursorpos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dset_002dfont"><code>tv-set-font</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dspace"><code>tv-space</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dstore_002dfont_002dpixel"><code>tv-store-font-pixel</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dstring_002dlength"><code>tv-string-length</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dstring_002dout"><code>tv-string-out</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dtab"><code>tv-tab</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dtyo"><code>tv-tyo</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwhite_002don_002dblack"><code>tv-white-on-black</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwhite_002don_002dblack_002dstate"><code>tv-white-on-black-state</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dprepare_002dfield"><code>tv-who-line-prepare-field</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dstring"><code>tv-who-line-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tv_002dwho_002dline_002dupdate"><code>tv-who-line-update</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dclean"><code>tvob-clean</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcommand"><code>tvob-command</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcomplete_002dredisplay"><code>tvob-complete-redisplay</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcreate"><code>tvob-create</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcreate_002dabsolute"><code>tvob-create-absolute</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcreate_002dexpandable"><code>tvob-create-expandable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dcreate_002dfor_002dpc_002dppr"><code>tvob-create-for-pc-ppr</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002ddisable"><code>tvob-disable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002denable"><code>tvob-enable</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dkill"><code>tvob-kill</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dselect"><code>tvob-select</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dsetup"><code>tvob-setup</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dunder_002dpoint"><code>tvob-under-point</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tvob_002dupdate"><code>tvob-update</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tyi"><code>tyi</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tyipeek"><code>tyipeek</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tyo"><code>tyo</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-typep"><code>typep</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-U">U</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-uncompile"><code>uncompile</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-undefun"><code>undefun</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unspecial"><code>unspecial</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-untrace"><code>untrace</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-unwind_002dprotect"><code>unwind-protect</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-value_002dcell_002dlocation"><code>value-cell-location</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-W">W</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-where_002dis"><code>where-is</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-who_002dcalls"><code>who-calls</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-who_002duses"><code>who-uses</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dinput_002dfrom_002dstring"><code>with-input-from-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002dopen_002dfile"><code>with-open-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-with_002doutput_002dto_002dstring"><code>with-output-to-string</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-without_002dinterrupts"><code>without-interrupts</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-X">X</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-xcons"><code>xcons</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xcons_002din_002darea"><code>xcons-in-area</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-xstore"><code>xstore</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-Y">Y</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-y_002dor_002dn_002dp"><code>y-or-n-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-yes_002dor_002dno_002dp"><code>yes-or-no-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="Top_fn_letter-Z">Z</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-zerop"><code>zerop</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Top">Top</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#Top_fn_symbol-1"><b></b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-2"><b>%</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-3"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-4"><b>+</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-5"><b>-</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-6"><b>/</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-7"><b>1</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-8"><b>&lt;</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-9"><b>=</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-10"><b>&gt;</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-11"><b>@</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-12"><b>\</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_symbol-13"><b>^</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#Top_fn_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-G"><b>G</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-K"><b>K</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-W"><b>W</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-X"><b>X</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-Y"><b>Y</b></a>
 &nbsp; 
<a class="summary-letter" href="#Top_fn_letter-Z"><b>Z</b></a>
 &nbsp; 
</td></tr></table>

<hr>



</body>
</html>
